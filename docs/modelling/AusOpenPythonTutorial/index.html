
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/AusOpenPythonTutorial/">
      
      
        <link rel="prev" href="../AusOpenRTutorial/">
      
      
        <link rel="next" href="../../automation/GoldenRulesofAutomation/">
      
      
      <link rel="icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.6">
    
    
      
        <title>Aus Open Python Tutorial - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/betfair.css">
    
      <link rel="stylesheet" href="../../css/buttons_and_animations.css">
    
      <link rel="stylesheet" href="../../css/fonts.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","UA-125973915-1"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","UA-125973915-1",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=UA-125973915-1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#australian-open-datathon-python-tutorial" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      
  
  <header class="md-header" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="header.title">
      <a href="../.." title="The Automation Hub" class="md-header__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
        
  <img src="../../img/logo.svg" alt="logo">

      </a>
      <label class="md-header__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              The Automation Hub
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">
              
                Aus Open Python Tutorial
              
            </span>
          </div>
        </div>
      </div>

      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
        </form>
      
      

      
     
      <div class="bf-nav">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#"
          xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26" />
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z" />
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>

      

    </nav>
    
  </header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../data/dataListing/" class="md-tabs__link">
          
  
  Data

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../wagering/betfairHowTo/" class="md-tabs__link">
          
  
  Wagering

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/apiResources/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../howToModel/" class="md-tabs__link">
          
  
  Modelling

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../automation/GoldenRulesofAutomation/" class="md-tabs__link">
          
  
  Automation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/How_to_Automate_1/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mentalGame/intro/" class="md-tabs__link">
          
  
  Mental Game

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contactUs/test/" class="md-tabs__link">
          
  
  Contact Us

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Automation Hub" class="md-nav__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
      
  <img src="../../img/logo.svg" alt="logo">

    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/dataListing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSV Files
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Wagering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Wagering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/betfairHowTo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betfair How-To
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/bettingGlossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betting Glossary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/stakingMethods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staking Methods and Bankroll Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/valueAndOdds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Value and Odds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/commission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commission and other charges
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/hubPredictionsModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hub Predictions Model
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiResources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiappkey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to access the Betfair API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiRtutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API tutorial in R
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiPythontutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API tutorial in Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Modelling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Modelling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to modelling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataSources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pricing Data Sources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Racing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Racing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../topazTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound Topaz API Tutorial (New)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fasttrackTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound form FastTrack API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../greyhoundModellingPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound modelling in Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Soccer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Soccer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingELO2022WorldCup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling tutorial in R for 2022 FIFA World Cup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingTutorialPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling tutorial in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EPLmlPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EPL ML walk through in Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AFL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            AFL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLmodellingPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AFL modelling walk through in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../brownlowModelTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelling the Brownlow Medal in Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_6" checked>
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tennis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Tennis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToModelTheAusOpen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to model the Australian Open
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenRTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aus Open R Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Aus Open Python Tutorial
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Aus Open Python Tutorial
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Overview">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-task" class="md-nav__link">
    <span class="md-ellipsis">
      The Task
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#intention" class="md-nav__link">
    <span class="md-ellipsis">
      Intention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-pre-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Data pre-processing
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#feature-engineering" class="md-nav__link">
    <span class="md-ellipsis">
      Feature Engineering
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convert-the-raw-data-frames-into-long-format" class="md-nav__link">
    <span class="md-ellipsis">
      Convert the raw data frames into long format:
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-some-new-features" class="md-nav__link">
    <span class="md-ellipsis">
      Create some new features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#take-the-rolling-average-for-each-player-and-each-match" class="md-nav__link">
    <span class="md-ellipsis">
      Take the rolling average for each player and each match
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#calculate-the-difference-of-averages-for-each-match-in-the-data-frames" class="md-nav__link">
    <span class="md-ellipsis">
      Calculate the difference of averages for each match in the data frames
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelling" class="md-nav__link">
    <span class="md-ellipsis">
      Modelling
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#h2o-model-for-atp" class="md-nav__link">
    <span class="md-ellipsis">
      H2O model for ATP
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-the-models-to-predict-and-make-submissions" class="md-nav__link">
    <span class="md-ellipsis">
      Use the models to predict and make submissions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-the-features-for-the-predict-df" class="md-nav__link">
    <span class="md-ellipsis">
      Get the features for the predict df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#make-the-prediction" class="md-nav__link">
    <span class="md-ellipsis">
      Make the prediction
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Make the prediction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#disclaimer" class="md-nav__link">
    <span class="md-ellipsis">
      Disclaimer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Automation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GoldenRulesofAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golden rules of automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Bet Angel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Bet Angel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngel/betAngel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelbeginners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Beginner's guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelintermediate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intermediate guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngeladvanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelRatingsAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ratings auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelMarketFavouriteAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Market fav auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelTippingAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tipping auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelSimultaneousMarkets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simultaneous markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelKellyStake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelly criterion staking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Gruss Betting Assistant
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Gruss Betting Assistant
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/Gruss/Gruss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GrussSettingupbasicmarketview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup basic market view and one click betting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussRatingsAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ratings auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussMarketFavouriteAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Market fav auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grusslSimultaneousMarkets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simultaneous markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussKellyStake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelly criterion staking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Cymatic Trader
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Cymatic Trader
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/CymaticTrader/CymaticTrader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/cymaticTraderRatingsAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ratings auto
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Geeks Toy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            Geeks Toy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GeeksToyinstallationandsetup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation and setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GeeksToybasicmarketviewstakingandoneclickbetting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup basic market view and one click betting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/geeksToyRefreshSettings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimising refresh settings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Bet Jet Pro
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            Bet Jet Pro
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betJetOverview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/processingTarFiles101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Take away the pain! Processing TAR Files 101
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/jsonToCsvRevisited/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON to CSV | Revisited
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/backtestingRatingsTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Back testing ratings in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/automatedBettingAnglesTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automated betting angles in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingMarketMovements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Do they know? Analysing Betfair market formation & market movements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingBSP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wisdom of the crowd? Analysing & understanding BSP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Mental Game
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Mental Game
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/roleOfEmotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/mapYourEmotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/handlingBadVariance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/winbyBeingGreatatLosing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/correctingyouremotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/responsibleGambling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/InchwormConcept/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/HighExpectations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/TappingYourIntuition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 9
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Contact Us
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Contact Us
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contactUs/test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meet the Team
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="australian-open-datathon-python-tutorial">Australian Open Datathon Python Tutorial</h1>
<h2 id="overview">Overview</h2>
<h3 id="the-task">The Task</h3>
<p>This notebook will outline how the Betfair Data Scientists went about modelling the Australian Open for Betfair's Australian Open Datathon. The task is simple: we ask you to predict the winner of every possible Australian Open matchup using data which we provide.</p>
<p>The metric used to determine the winner will be log loss, based on the actual matchups that happen in the Open. For more information on log loss, click <a href="https://en.wikipedia.org/wiki/Cross_entropy">here</a>.</p>
<p>How an outline of our methodology and thought process, read <a href="/modelling/howToModelTheAusOpen">this</a> article.</p>
<h3 id="intention">Intention</h3>
<p>This notebook will demonstrate how to:</p>
<ul>
<li>Process the raw data sets</li>
<li>Produce simple features</li>
<li>Run a predictive model on H2O</li>
<li>Outputs the final predictions for the submissions</li>
<li>Load the data and required packages</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">import</span><span class="w"> </span><span class="n">numpy</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="n">import</span><span class="w"> </span><span class="n">pandas</span><span class="w"> </span><span class="n">as</span><span class="w"> </span><span class="n">pd</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="n">import</span><span class="w"> </span><span class="n">os</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">import</span><span class="w"> </span><span class="n">gc</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">import</span><span class="w"> </span><span class="n">sys</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="n">import</span><span class="w"> </span><span class="n">warnings</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="nf">warnings.filterwarnings</span><span class="p">(</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="n">import</span><span class="w"> </span><span class="n">h2o</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="n">from</span><span class="w"> </span><span class="n">h2o.automl</span><span class="w"> </span><span class="n">import</span><span class="w"> </span><span class="n">H2OAutoML</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="n">pd.options.display.max_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">999</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># We are loading both the mens and womens match csvs</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.read_csv</span><span class="p">(</span><span class="s">&quot;data/ATP_matches.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.read_csv</span><span class="p">(</span><span class="s">&quot;data/WTA_matches.csv&quot;</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="data-pre-processing">Data pre-processing</h2>
<p>Filter the matches to hard and indoor hard only due to the fact that Australian Open is on hard surface and we want the models to train specifically for hard surfaces matches</p>
<p>Convert the columns in both datasets to the correct types. For example, we want to make sure the date columns are in the datetime format and numerical columns are either integer or floats. This will help reduce the memory in use and make the feature engineering process easier</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">### Include hard and indoor hard only</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp.loc</span><span class="p">[</span><span class="nf">df_atp.Court_Surface.isin</span><span class="p">([</span><span class="s">&#39;Hard&#39;</span><span class="p">,</span><span class="s">&#39;Indoor Hard&#39;</span><span class="p">])]</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta.loc</span><span class="p">[</span><span class="nf">df_wta.Court_Surface.isin</span><span class="p">([</span><span class="s">&#39;Hard&#39;</span><span class="p">,</span><span class="s">&#39;Indoor Hard&#39;</span><span class="p">])]</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1">### Exclude qualifying rounds</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp.loc</span><span class="p">[</span><span class="n">df_atp.Round_Description</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&#39;Qualifying&#39;</span><span class="p">]</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta.loc</span><span class="p">[</span><span class="n">df_wta.Round_Description</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&#39;Qualifying&#39;</span><span class="p">]</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1"># Store the shape of the data for reference check later</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="n">atp_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp.shape</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="n">wta_shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta.shape</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">numeric_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Winner_Rank&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_Rank&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Retirement_Ind&#39;</span><span class="p">,</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">                   </span><span class="s">&#39;Winner_Sets_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_Games_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_Aces&#39;</span><span class="p">,</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">                   </span><span class="s">&#39;Winner_DoubleFaults&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_FirstServes_Won&#39;</span><span class="p">,</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">                   </span><span class="s">&#39;Winner_FirstServes_In&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_SecondServes_Won&#39;</span><span class="p">,</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">                   </span><span class="s">&#39;Winner_SecondServes_In&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_BreakPoints_Won&#39;</span><span class="p">,</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">                   </span><span class="s">&#39;Winner_BreakPoints&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_ReturnPoints_Won&#39;</span><span class="p">,</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">                   </span><span class="s">&#39;Winner_ReturnPoints_Faced&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Winner_TotalPoints_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_Sets_Won&#39;</span><span class="p">,</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">                   </span><span class="s">&#39;Loser_Games_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_Aces&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_DoubleFaults&#39;</span><span class="p">,</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">                   </span><span class="s">&#39;Loser_FirstServes_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_FirstServes_In&#39;</span><span class="p">,</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">                   </span><span class="s">&#39;Loser_SecondServes_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_SecondServes_In&#39;</span><span class="p">,</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                   </span><span class="s">&#39;Loser_BreakPoints_Won&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_BreakPoints&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_ReturnPoints_Won&#39;</span><span class="p">,</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">                   </span><span class="s">&#39;Loser_ReturnPoints_Faced&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser_TotalPoints_Won&#39;</span><span class="p">]</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="n">text_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Winner&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Loser&#39;</span><span class="p">,</span><span class="w">  </span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Court_Surface&#39;</span><span class="p">,</span><span class="s">&#39;Round_Description&#39;</span><span class="p">]</span><span class="w"> </span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">date_columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="c1"># we set the **erros** to coerce so any non-numerical values (text,special characters) will return an NA</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="n">df_atp</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="nf">.apply</span><span class="p">(</span><span class="n">pd.to_numeric</span><span class="p">,</span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;coerce&#39;</span><span class="p">)</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="n">df_wta</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="nf">.apply</span><span class="p">(</span><span class="n">pd.to_numeric</span><span class="p">,</span><span class="n">errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;coerce&#39;</span><span class="p">)</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="n">df_atp</span><span class="p">[</span><span class="n">date_columns</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp</span><span class="p">[</span><span class="n">date_columns</span><span class="p">]</span><span class="nf">.apply</span><span class="p">(</span><span class="n">pd.to_datetime</span><span class="p">)</span><span class="w"> </span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="n">df_wta</span><span class="p">[</span><span class="n">date_columns</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta</span><span class="p">[</span><span class="n">date_columns</span><span class="p">]</span><span class="nf">.apply</span><span class="p">(</span><span class="n">pd.to_datetime</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="feature-engineering">Feature Engineering</h2>
<p>The raw datasets are constructed in a way that each row will have the seperate stats for both the winner and loser of that match. However, we want to reshape the data so that each row we will only have one player randomly selected from the winner/loser columns and the features are the difference between opponents statistics (Difference of Averages), such as the difference between average first serve % in a single column rather than Player 1s first serve % and Player 2s first serve % in two separate columns.</p>
<p>In addition, for the features, we will take the rolling average of the player's most recent 15 matches before the particular tournament starts. For example, if the match is the second round of the Australian Open 2018, the features will be the last 15 matches before the first round of Australian Open 2018. The reason of not including the stats in the first round is that we would not have known the player's stats in the first round for the final submissions</p>
<p>A typical row of the transformed data will look like this  For a match between Player A  Roger Federer and Player B  Rafael Nadal, we will have a bunch of features like the difference in first serve %, difference in ELO rating etc. The target variable will be whether or not Player A wins (1=Player A wins and 0=lose).</p>
<p>The steps we take are:</p>
<ul>
<li>Convert the raw data frames into long format:</li>
<li>Create some new features</li>
<li>
<p>Take the rolling average for each player and each match
    Since we will be only training our models on US Open and Australian Open, we will only be creating features for those matches. However, the rolling average will take into account any hard surface matches before those tournaments</p>
</li>
<li>
<p>Calculate the difference of averages for each match in the data frames</p>
</li>
</ul>
<hr />
<h2 id="convert-the-raw-data-frames-into-long-format">Convert the raw data frames into long format:</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Before we split the data frame into winner and loser, we want to create a feature that captures the total number of games the match takes.</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># We have to do it before the split or we will lose this information</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;Total_Games&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp.Winner_Games_Won</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">df_atp.Loser_Games_Won</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;Total_Games&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta.Winner_Games_Won</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">df_wta.Loser_Games_Won</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="c1"># Get the column names for the winner and loser stats</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">winner_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">col</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">df_atp.columns</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="nf">col.startswith</span><span class="p">(</span><span class="s">&#39;Winner&#39;</span><span class="p">)]</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="n">loser_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">col</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">df_atp.columns</span><span class="w"> </span><span class="n">if</span><span class="w"> </span><span class="nf">col.startswith</span><span class="p">(</span><span class="s">&#39;Loser&#39;</span><span class="p">)]</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="c1"># create a winner data frame to store the winner stats and a loser data frame for the losers</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="c1"># In addition to the winner and loser columns, we are adding common columns as well (e.g. tournamnt dates)</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="n">common_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Total_Games&#39;</span><span class="p">,</span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Court_Surface&#39;</span><span class="p">,</span><span class="s">&#39;Round_Description&#39;</span><span class="p">]</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="n">df_winner_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp</span><span class="p">[</span><span class="n">winner_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">common_cols</span><span class="p">]</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="n">df_loser_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp</span><span class="p">[</span><span class="n">loser_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">common_cols</span><span class="p">]</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="n">df_winner_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta</span><span class="p">[</span><span class="n">winner_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">common_cols</span><span class="p">]</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="n">df_loser_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta</span><span class="p">[</span><span class="n">loser_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">common_cols</span><span class="p">]</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="c1"># Create a new column to show whether the player has won or not. </span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="n">df_winner_atp</span><span class="p">[</span><span class="s">&quot;won&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="n">df_loser_atp</span><span class="p">[</span><span class="s">&quot;won&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="n">df_winner_wta</span><span class="p">[</span><span class="s">&quot;won&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="n">df_loser_wta</span><span class="p">[</span><span class="s">&quot;won&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="c1"># Rename the columns for the winner and loser data frames so we can append them later on.</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="c1"># We will rename the Winner_ / Loser_ columns to Player_</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="n">new_column_names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nf">col.replace</span><span class="p">(</span><span class="s">&#39;Winner&#39;</span><span class="p">,</span><span class="s">&#39;Player&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">col</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">winner_cols</span><span class="p">]</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="n">df_winner_atp.columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_column_names</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">common_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;won&#39;</span><span class="p">]</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="c1"># They all should be the same</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="n">df_loser_atp.columns</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">df_winner_atp.columns</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="n">df_winner_wta.columns</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">df_winner_atp.columns</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="n">df_loser_wta.columns</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">df_winner_atp.columns</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="c1"># append the winner and loser data frames </span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="n">df_long_atp</span><span class="o">=</span><span class="w"> </span><span class="nf">df_winner_atp.append</span><span class="p">(</span><span class="n">df_loser_atp</span><span class="p">)</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="n">df_long_wta</span><span class="o">=</span><span class="w"> </span><span class="nf">df_winner_wta.append</span><span class="p">(</span><span class="n">df_loser_wta</span><span class="p">)</span>
</code></pre></div>
<p>So now our data frames are in long format and should looks like this</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nf">df_long_atp.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Player</th>
<th>Player_Rank</th>
<th>Player_Sets_Won</th>
<th>Player_Games_Won</th>
<th>Player_Aces</th>
<th>Player_DoubleFaults</th>
<th>Player_FirstServes_Won</th>
<th>Player_FirstServes_In</th>
<th>Player_SecondServes_Won</th>
<th>Player_SecondServes_In</th>
<th>Player_BreakPoints_Won</th>
<th>Player_BreakPoints</th>
<th>Player_ReturnPoints_Won</th>
<th>Player_ReturnPoints_Faced</th>
<th>Player_TotalPoints_Won</th>
<th>Total_Games</th>
<th>Tournament</th>
<th>Tournament_Date</th>
<th>Court_Surface</th>
<th>Round_Description</th>
<th>won</th>
</tr>
</thead>
<tbody>
<tr>
<td>Edouard Roger-Vasselin</td>
<td>106.0</td>
<td>2.0</td>
<td>12</td>
<td>5.0</td>
<td>2.0</td>
<td>22</td>
<td>30</td>
<td>12</td>
<td>19</td>
<td>4.0</td>
<td>7.0</td>
<td>25.0</td>
<td>59.0</td>
<td>59</td>
<td>19</td>
<td>Chennai</td>
<td>2012-01-02</td>
<td>Hard</td>
<td>First Round</td>
<td>1</td>
</tr>
<tr>
<td>Dudi Sela</td>
<td>83.0</td>
<td>2.0</td>
<td>12</td>
<td>2.0</td>
<td>0.0</td>
<td>14</td>
<td>17</td>
<td>11</td>
<td>16</td>
<td>6.0</td>
<td>14.0</td>
<td>36.0</td>
<td>58.0</td>
<td>61</td>
<td>13</td>
<td>Chennai</td>
<td>2012-01-02</td>
<td>Hard</td>
<td>First Round</td>
<td>1</td>
</tr>
<tr>
<td>Go Soeda</td>
<td>120.0</td>
<td>2.0</td>
<td>19</td>
<td>6.0</td>
<td>1.0</td>
<td>48</td>
<td>64</td>
<td>19</td>
<td>39</td>
<td>5.0</td>
<td>11.0</td>
<td>42.0</td>
<td>105.0</td>
<td>109</td>
<td>33</td>
<td>Chennai</td>
<td>2012-01-02</td>
<td>Hard</td>
<td>First Round</td>
<td>1</td>
</tr>
<tr>
<td>Yuki Bhambri</td>
<td>345.0</td>
<td>2.0</td>
<td>12</td>
<td>1.0</td>
<td>2.0</td>
<td>22</td>
<td>29</td>
<td>9</td>
<td>17</td>
<td>5.0</td>
<td>13.0</td>
<td>34.0</td>
<td>62.0</td>
<td>65</td>
<td>17</td>
<td>Chennai</td>
<td>2012-01-02</td>
<td>Hard</td>
<td>First Round</td>
<td>1</td>
</tr>
<tr>
<td>Yuichi Sugita</td>
<td>235.0</td>
<td>2.0</td>
<td>12</td>
<td>3.0</td>
<td>1.0</td>
<td>37</td>
<td>51</td>
<td>11</td>
<td>27</td>
<td>3.0</td>
<td>7.0</td>
<td>22.0</td>
<td>54.0</td>
<td>70</td>
<td>19</td>
<td>Chennai</td>
<td>2012-01-02</td>
<td>Hard</td>
<td>First Round</td>
<td>1</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="create-some-new-features">Create some new features</h2>
<p>Thinking about the dynamics of tennis, we know that players often will matches by breaking the opponents serve (i.e. winning a game when the opponent is serving). This is especially important in tennis. Lets create a feature called Player_BreakPoints_Per_Game, which is the number of breakpoints a player gets per game that they play (even though they can only get breakpoints every second game, we will use total games). Lets also create a feature called Player_Return_Win_Ratio which is the proportion of points won when returning.</p>
<p>Similarly, holding serve is important (i.e. winning a game when you are serving). Lets create a feature called Player_Serve_Win_Ratio which is the proportion of points won when serving.</p>
<p>Finally, you only win a set of tennis by winning more sets than your opponent. To win a set, you need to win games. Lets create a feature called Player_Game_Win_Percentage which is the propotion of games that a player wins.</p>
<p>So the four new features we will create are:</p>
<ul>
<li><code>Player_Serve_Win_Ratio</code></li>
<li><code>Player_Return_Win_Ratio</code></li>
<li><code>Player_BreakPoints_Per_Return_Game</code></li>
<li><code>Player_Game_Win_Percentage</code></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Here, we will define a function so we can apply it to both atp and wta data frames</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">def</span><span class="w"> </span><span class="nf">get_new_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="c1"># Input: </span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="c1">#     df: data frame to get the data from</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">     </span><span class="c1"># Return: the df with the new features</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span><span class="c1"># Point Win ratio when serving</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Serve_Win_Ratio&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">df.Player_FirstServes_Won</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">df.Player_SecondServes_Won</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">df.Player_DoubleFaults</span><span class="p">)</span><span class="w"> </span>\
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">                                  </span><span class="o">/</span><span class="p">(</span><span class="n">df.Player_FirstServes_In</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">df.Player_SecondServes_In</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">df.Player_DoubleFaults</span><span class="p">)</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span><span class="c1"># Point win ratio when returning</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Return_Win_Ratio&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df.Player_ReturnPoints_Won</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">df.Player_ReturnPoints_Faced</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span><span class="c1"># Breakpoints per receiving game</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_BreakPoints_Per_Return_Game&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df.Player_BreakPoints</span><span class="o">/</span><span class="n">df.Total_Games</span><span class="w">  </span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Game_Win_Percentage&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df.Player_Games_Won</span><span class="o">/</span><span class="n">df.Total_Games</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="n">df</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="c1"># Apply the function we just created to the long data frames</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="n">df_long_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_new_features</span><span class="p">(</span><span class="n">df_long_atp</span><span class="p">)</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="n">df_long_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_new_features</span><span class="p">(</span><span class="n">df_long_wta</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="c1"># The long table should have exactly twice of the rows of the original data</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">assert</span><span class="w"> </span><span class="n">df_long_atp.shape</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">atp_shape</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">*</span><span class="m">2</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">assert</span><span class="w"> </span><span class="n">df_long_wta.shape</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">wta_shape</span><span class="p">[</span><span class="m">0</span><span class="p">]</span><span class="o">*</span><span class="m">2</span>
</code></pre></div>
<hr />
<h2 id="take-the-rolling-average-for-each-player-and-each-match">Take the rolling average for each player and each match</h2>
<p>To train our models, we cannot simply use the player stats for that current match. In fact, we wont be able to use any stats from the same tournament. The logic behind this is that when we try to predict the results in 2019, we would not know the stats of any of the matches in the Australian Open 2019 tournament. As a result, we will use the players' past performance. Here, we will do a rolling average of the most recent 15 matches before the tournament.</p>
<p>To do the above, we will follow the steps below:</p>
<ol>
<li>List all the tournament dates for US and Australian Opens</li>
<li>Loop through the dates from point 1, for each date, we filter the data to only include matches before that date and take the most recent 15 games</li>
<li>Take the average of those 15 games</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="c1"># the two tournaments we will be using for training and thus the feature generation</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="n">tournaments</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;U.S. Open, New York&#39;</span><span class="p">,</span><span class="s">&#39;Australian Open, Melbourne&#39;</span><span class="p">]</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="c1"># Store the dates for the loops </span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">tournament_dates_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp.loc</span><span class="p">[</span><span class="nf">df_atp.Tournament.isin</span><span class="p">(</span><span class="n">tournaments</span><span class="p">)]</span><span class="nf">.groupby</span><span class="p">([</span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">])</span><span class="w"> </span>\
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nf">.size</span><span class="p">()</span><span class="nf">.reset_index</span><span class="p">()[[</span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]]</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="n">tournament_dates_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta.loc</span><span class="p">[</span><span class="nf">df_wta.Tournament.isin</span><span class="p">(</span><span class="n">tournaments</span><span class="p">)]</span><span class="nf">.groupby</span><span class="p">([</span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">])</span><span class="w"> </span>\
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="nf">.size</span><span class="p">()</span><span class="nf">.reset_index</span><span class="p">()[[</span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]]</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="c1"># We are adding one more date for the final prediction</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="n">tournament_dates_atp.loc</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Australian Open, Melbourne&#39;</span><span class="p">,</span><span class="nf">pd.to_datetime</span><span class="p">(</span><span class="s">&#39;2019-01-15&#39;</span><span class="p">)]</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="n">tournament_dates_wta.loc</span><span class="p">[</span><span class="m">-1</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Australian Open, Melbourne&#39;</span><span class="p">,</span><span class="nf">pd.to_datetime</span><span class="p">(</span><span class="s">&#39;2019-01-15&#39;</span><span class="p">)]</span>
</code></pre></div>
<p>Following are the dates for each tournament</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">tournament_dates_atp</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Tournament</th>
<th>Tournament_Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>Australian Open, Melbourne</td>
<td>2012-01-16</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2013-01-1</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2014-01-1</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2015-01-1</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2016-01-1</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2017-01-1</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2018-01-1</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2012-08-2</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2013-08-2</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2014-08-25</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2015-08-31</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2016-08-29</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2017-08-28</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2018-08-27</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2019-01-15</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">tournament_dates_wta</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Tournament</th>
<th>Tournament_Date</th>
</tr>
</thead>
<tbody>
<tr>
<td>Australian Open, Melbourne</td>
<td>2014-01-13</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2015-01-19</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2016-01-18</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2017-01-16</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2018-01-15</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2014-08-25</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2015-08-31</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2016-08-29</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2017-08-28</td>
</tr>
<tr>
<td>U.S. Open, New York</td>
<td>2018-08-27</td>
</tr>
<tr>
<td>Australian Open, Melbourne</td>
<td>2019-01-15</td>
</tr>
</tbody>
</table>
<p>They look fine but it is interesting that for men's, we have two more years of data from 2012 to 2013</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="c1"># Let&#39;s define a function to calculate the rolling averages</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="n">def</span><span class="w"> </span><span class="nf">get_rolling_features </span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">date_df</span><span class="o">=</span><span class="n">None</span><span class="p">,</span><span class="n">rolling_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">,</span><span class="w"> </span><span class="n">last_cols</span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">    </span><span class="c1"># Input: </span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="c1">#     df: data frame to get the data from</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="c1">#     date_df: data frame that has the start dates for each tournament</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="c1">#     rolling_cols: columns to get the rolling averages</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="c1">#     last_cols: columns to get the last value (most recent)</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
<a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="w">     </span><span class="c1"># Return: the df with the new features</span>
<a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a>
<a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a>
<a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">    </span><span class="c1"># Sort the data by player and dates so the most recent matches are at the bottom</span>
<a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a><span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df.sort_values</span><span class="p">([</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">,</span><span class="s">&#39;Tournament&#39;</span><span class="p">],</span><span class="w"> </span><span class="n">ascending</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a>
<a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">    </span><span class="c1"># For each tournament, get the rolling averages of that player&#39;s past matches before the tournament start date</span>
<a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">    </span><span class="n">for</span><span class="w"> </span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">tournament_date</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="nf">enumerate</span><span class="p">(</span><span class="n">date_df.Tournament_Date</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">        </span><span class="c1"># create a temp df to store the interim results</span>
<a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a><span class="w">        </span><span class="n">df_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df.loc</span><span class="p">[</span><span class="n">df.Tournament_Date</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tournament_date</span><span class="p">]</span>
<a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a>
<a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">        </span><span class="c1"># for ranks, we only take the last one. (comment this out if want to take avg of rank)</span>
<a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">        </span><span class="n">df_temp_last</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_temp.groupby</span><span class="p">(</span><span class="s">&#39;Player&#39;</span><span class="p">)[</span><span class="n">last_cols</span><span class="p">]</span><span class="nf">.last</span><span class="p">()</span><span class="nf">.reset_index</span><span class="p">()</span>
<a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a>
<a id="__codelineno-11-24" name="__codelineno-11-24" href="#__codelineno-11-24"></a><span class="w">        </span><span class="c1"># take the most recent 15 matches for the rolling average</span>
<a id="__codelineno-11-25" name="__codelineno-11-25" href="#__codelineno-11-25"></a><span class="w">        </span><span class="n">df_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_temp.groupby</span><span class="p">(</span><span class="s">&#39;Player&#39;</span><span class="p">)[</span><span class="n">rolling_cols</span><span class="p">]</span><span class="nf">.rolling</span><span class="p">(</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">min_periods</span><span class="o">=</span><span class="m">1</span><span class="p">)</span><span class="nf">.mean</span><span class="p">()</span><span class="nf">.reset_index</span><span class="p">()</span>
<a id="__codelineno-11-26" name="__codelineno-11-26" href="#__codelineno-11-26"></a><span class="w">        </span><span class="n">df_temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_temp.groupby</span><span class="p">(</span><span class="s">&#39;Player&#39;</span><span class="p">)</span><span class="nf">.tail</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="c1"># take the last row of the above</span>
<a id="__codelineno-11-27" name="__codelineno-11-27" href="#__codelineno-11-27"></a>
<a id="__codelineno-11-28" name="__codelineno-11-28" href="#__codelineno-11-28"></a><span class="w">        </span><span class="n">df_temp</span><span class="o">=</span><span class="w"> </span><span class="nf">df_temp.merge</span><span class="p">(</span><span class="n">df_temp_last</span><span class="p">,</span><span class="w"> </span><span class="n">on</span><span class="o">=</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">)</span>
<a id="__codelineno-11-29" name="__codelineno-11-29" href="#__codelineno-11-29"></a>
<a id="__codelineno-11-30" name="__codelineno-11-30" href="#__codelineno-11-30"></a><span class="w">        </span><span class="n">if</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="m">0</span><span class="o">:</span>
<a id="__codelineno-11-31" name="__codelineno-11-31" href="#__codelineno-11-31"></a><span class="w">            </span><span class="n">df_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_temp</span>
<a id="__codelineno-11-32" name="__codelineno-11-32" href="#__codelineno-11-32"></a><span class="w">            </span><span class="n">df_result</span><span class="p">[</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tournament_date</span><span class="w"> </span><span class="c1"># so we know which tournament this feature is for</span>
<a id="__codelineno-11-33" name="__codelineno-11-33" href="#__codelineno-11-33"></a><span class="w">        </span><span class="n">else</span><span class="o">:</span>
<a id="__codelineno-11-34" name="__codelineno-11-34" href="#__codelineno-11-34"></a><span class="w">            </span><span class="n">df_temp</span><span class="p">[</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tournament_date</span>
<a id="__codelineno-11-35" name="__codelineno-11-35" href="#__codelineno-11-35"></a><span class="w">            </span><span class="n">df_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_result.append</span><span class="p">(</span><span class="n">df_temp</span><span class="p">)</span>
<a id="__codelineno-11-36" name="__codelineno-11-36" href="#__codelineno-11-36"></a>
<a id="__codelineno-11-37" name="__codelineno-11-37" href="#__codelineno-11-37"></a><span class="w">    </span><span class="nf">df_result.drop</span><span class="p">(</span><span class="s">&#39;level_1&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<a id="__codelineno-11-38" name="__codelineno-11-38" href="#__codelineno-11-38"></a>
<a id="__codelineno-11-39" name="__codelineno-11-39" href="#__codelineno-11-39"></a><span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="n">df_result</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="c1"># columns we are applying the rolling averages on</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="n">rolling_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player_Serve_Win_Ratio&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Player_Return_Win_Ratio&#39;</span><span class="p">,</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">               </span><span class="s">&#39;Player_BreakPoints_Per_Return_Game&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Player_Game_Win_Percentage&#39;</span><span class="p">]</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="c1"># columns we are taking the most recent values on</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="c1"># For the player rank, we think we can just use the latest rank (before the tournament starts) </span>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="c1"># as it should refect the most recent performance of the player</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="n">last_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player_Rank&#39;</span><span class="p">]</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="c1"># Apply the rolling average function to the long data frames (it will take a few mins to run)</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="n">df_rolling_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_rolling_features </span><span class="p">(</span><span class="n">df_long_atp</span><span class="p">,</span><span class="w"> </span><span class="n">tournament_dates_atp</span><span class="p">,</span><span class="w"> </span><span class="n">rolling_cols</span><span class="p">,</span><span class="w"> </span><span class="n">last_cols</span><span class="o">=</span><span class="w"> </span><span class="n">last_cols</span><span class="w"> </span><span class="p">)</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="n">df_rolling_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_rolling_features </span><span class="p">(</span><span class="n">df_long_wta</span><span class="p">,</span><span class="w"> </span><span class="n">tournament_dates_wta</span><span class="p">,</span><span class="w"> </span><span class="n">rolling_cols</span><span class="p">,</span><span class="w"> </span><span class="n">last_cols</span><span class="o">=</span><span class="w"> </span><span class="n">last_cols</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="nf">df_rolling_atp.head</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Player</th>
<th>Player_Serve_Win_Ratio</th>
<th>Player_Return_Win_Ratio</th>
<th>Player_BreakPoints_Per_Return_Game</th>
<th>Player_Game_Win_Percentage</th>
<th>Player_Rank</th>
<th>tournament_date_index</th>
</tr>
</thead>
<tbody>
<tr>
<td>Adrian Mannarino</td>
<td>0.623408</td>
<td>0.353397</td>
<td>0.257859</td>
<td>0.447246</td>
<td>87.0</td>
<td>2012-01-16</td>
</tr>
<tr>
<td>Albert Montanes</td>
<td>0.507246</td>
<td>0.195652</td>
<td>0.000000</td>
<td>0.294118</td>
<td>50.0</td>
<td>2012-01-16</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nf">df_rolling_wta.head</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Player</th>
<th>Player_Serve_Win_Ratio</th>
<th>Player_Return_Win_Ratio</th>
<th>Player_BreakPoints_Per_Return_Game</th>
<th>Player_Game_Win_Percentage</th>
<th>Player_Rank</th>
<th>tournament_date_index</th>
</tr>
</thead>
<tbody>
<tr>
<td>Agnieszka Radwanska</td>
<td>0.413333</td>
<td>0.475410</td>
<td>0.350000</td>
<td>0.350000</td>
<td>5.0</td>
<td>2014-01-13</td>
</tr>
<tr>
<td>Ajla Tomljanovic</td>
<td>0.468457</td>
<td>0.407319</td>
<td>0.242253</td>
<td>0.462634</td>
<td>75.0</td>
<td>2014-01-13</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="calculate-the-difference-of-averages-for-each-match-in-the-data-frames">Calculate the difference of averages for each match in the data frames</h2>
<p>In the original data frames, the first column is always the winner and followed by the loser. Same for the player stats. Thus, we cannot simply calculate the difference between winner and loser and create a target variable indicating player 1 will win or not because it will always be the winner in this case (target always = 1). As a result, we need to pick a player randomly so the player might or might not be the winner</p>
<p>In addition, instead of using both the features for player 1 and 2, we will take the difference of averages between the randomised player 1 and 2. The main benefit is that it will reduce the number of features to half</p>
<p>Steps:</p>
<ol>
<li>We will create a random number for each player which only return 0 or 1</li>
<li>If it is zero, we will assign the winner to player 1 and loser to player 2</li>
<li>We will join the features to the player 1 and 2. The join will be on the player names and the tournament date (tournament_index in the feature data frames)</li>
<li>For players who do not have any history, we will fill the stats by zeros and rank by 999</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1"># Randomise the match_wide dataset so the first player is not always the winner</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="c1"># set a seed so the random number is reproducable</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="nf">np.random.seed</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="c1"># randomise a number 0/1 with 50% chance each</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="c1"># if 0 then take the winner, 1 then take loser</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.random.randint</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">df_atp</span><span class="p">))</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.where</span><span class="p">(</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;Winner&#39;</span><span class="p">],</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;Loser&#39;</span><span class="p">])</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.where</span><span class="p">(</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;Loser&#39;</span><span class="p">],</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;Winner&#39;</span><span class="p">])</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.random.randint</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">df_wta</span><span class="p">))</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.where</span><span class="p">(</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;Winner&#39;</span><span class="p">],</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;Loser&#39;</span><span class="p">])</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.where</span><span class="p">(</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;Loser&#39;</span><span class="p">],</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;Winner&#39;</span><span class="p">])</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="c1"># set the target (win/loss) based on the new randomise number</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;player_1_win&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.where</span><span class="p">(</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;player_1_win&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">np.where</span><span class="p">(</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;random_number&#39;</span><span class="p">]</span><span class="o">==</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="nf">print </span><span class="p">(</span><span class="s">&#39;After shuffling, the win rate for player 1 for the mens is {}%&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_atp</span><span class="p">[</span><span class="s">&#39;player_1_win&#39;</span><span class="p">]</span><span class="nf">.mean</span><span class="p">()</span><span class="o">*</span><span class="m">100</span><span class="p">))</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="nf">print </span><span class="p">(</span><span class="s">&#39;After shuffling, the win rate for player 1 for the womens is {}%&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_wta</span><span class="p">[</span><span class="s">&#39;player_1_win&#39;</span><span class="p">]</span><span class="nf">.mean</span><span class="p">()</span><span class="o">*</span><span class="m">100</span><span class="p">))</span>
</code></pre></div>
<p>After shuffling, the win rate for player 1 for the mens is 49.64798919857267%
After shuffling, the win rate for player 1 for the womens is 49.697671426733564%
The win rates are close enough to 50%. So we are good to go</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># To get our data frames ready for model training, we will exclude other tournaments from the data now because we have gotten the rolling averages from them and </span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="c1"># for training, we only need US and Australian Open matches</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp.loc</span><span class="p">[</span><span class="nf">df_atp.Tournament.isin</span><span class="p">(</span><span class="n">tournaments</span><span class="p">)]</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta.loc</span><span class="p">[</span><span class="nf">df_wta.Tournament.isin</span><span class="p">(</span><span class="n">tournaments</span><span class="p">)]</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="c1"># now we can remove other stats columns because we will be using the differences</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="n">cols_to_keep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Winner&#39;</span><span class="p">,</span><span class="s">&#39;Loser&#39;</span><span class="p">,</span><span class="s">&#39;Tournament&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">,</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="w">                    </span><span class="s">&#39;player_1_win&#39;</span><span class="p">,</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">,</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="w">                    </span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">]</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp</span><span class="p">[</span><span class="n">cols_to_keep</span><span class="p">]</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta</span><span class="p">[</span><span class="n">cols_to_keep</span><span class="p">]</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="c1"># Here, we are joining the rolling average data frames to the individual matches. </span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="c1"># We need to do it twice. One for player 1 and one for player 2</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="c1"># Get the rolling features for player 1</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_atp.merge</span><span class="p">(</span><span class="n">df_rolling_atp</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">                      </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a><span class="w">                      </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="w">                      </span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">)</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_wta.merge</span><span class="p">(</span><span class="n">df_rolling_wta</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="w">                      </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a><span class="w">                      </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="w">                      </span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">)</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="c1"># Get the rolling features for player 2</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="c1"># we will use &#39;_p1&#39; to denote player 1 and &#39;_p2&#39; for player 2</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="n">df_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_atp.merge</span><span class="p">(</span><span class="n">df_rolling_atp</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">                      </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">                      </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="w">                      </span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">,</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a><span class="w">                      </span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;_p1&#39;</span><span class="p">,</span><span class="s">&#39;_p2&#39;</span><span class="p">))</span>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="n">df_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_wta.merge</span><span class="p">(</span><span class="n">df_rolling_wta</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">                      </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">                      </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">                      </span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">,</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">                      </span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;_p1&#39;</span><span class="p">,</span><span class="s">&#39;_p2&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1"># How many players do not have previous match history</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_1s do Not have previous match history before the tournament&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_atp.loc</span><span class="p">[</span><span class="nf">df_atp.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_2s do Not have previous match history before the tournament&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_atp.loc</span><span class="p">[</span><span class="nf">df_atp.Player_p2.isna</span><span class="p">(),</span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
</code></pre></div>
<p>59 player_1s do Not have previous match history before the tournament
56 player_2s do Not have previous match history before the tournament</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="c1"># How many players do not have previous match history</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_1s do Not have previous match history before the tournament&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_wta.loc</span><span class="p">[</span><span class="nf">df_wta.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;randomised_player_1&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_2s do Not have previous match history before the tournament&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_wta.loc</span><span class="p">[</span><span class="nf">df_wta.Player_p2.isna</span><span class="p">(),</span><span class="s">&#39;randomised_player_2&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
</code></pre></div>
<p>41 player_1s do Not have previous match history before the tournament
37 player_2s do Not have previous match history before the tournament</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Most of the missing are for the early years which makes sense as we dont have enough history for them</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="n">df_wta.loc</span><span class="p">[</span><span class="nf">df_wta.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]</span><span class="nf">.value_counts</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>2014-01-13    29
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>2014-08-25     7
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>2015-08-31     5
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>2015-01-19     3
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>2017-08-28     3
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>2018-01-15     3
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>2018-08-27     3
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>Name: Tournament_Date, dtype: int64
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="n">df_atp.loc</span><span class="p">[</span><span class="nf">df_atp.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]</span><span class="nf">.value_counts</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>2012-01-16    29
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>2012-08-27     9
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>2014-01-13     5
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>2013-08-26     5
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a>2016-01-18     5
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a>2013-01-14     4
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a>2014-08-25     3
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a>2018-01-15     3
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>2017-08-28     3
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a>2018-08-27     2
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a>2016-08-29     2
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>2015-01-19     1
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>Name: Tournament_Date, dtype: int64
</code></pre></div>
<p>Now we have gotten the rolling averages for both player 1 and 2. What we need to do next is to simply calculate their difference.</p>
<p>To calculate the difference, we need to:</p>
<ol>
<li>Split the data frames into two new data frames: Player 1 and Player 2</li>
<li>Take the difference between the two data frames</li>
</ol>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="n">def</span><span class="w"> </span><span class="nf">get_player_difference</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">diff_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">None</span><span class="p">)</span><span class="o">:</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">        </span><span class="c1"># Input: </span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="c1">#     df: data frame to get the data from</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="c1">#     diff_cols: columns we take the difference on. For example is diff_cols = win rate. This function will calculate the </span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="c1">#                difference of the win rates between player 1 and player 2</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">     </span><span class="c1"># Return: the df with the new features</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">    </span><span class="n">p1_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#39;_p1&#39;</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">diff_cols</span><span class="p">]</span><span class="w"> </span><span class="c1"># column names for player 1 stats</span>
<a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">    </span><span class="n">p2_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#39;_p2&#39;</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">diff_cols</span><span class="p">]</span><span class="w"> </span><span class="c1"># column names for player 2 stats</span>
<a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a>
<a id="__codelineno-23-13" name="__codelineno-23-13" href="#__codelineno-23-13"></a>
<a id="__codelineno-23-14" name="__codelineno-23-14" href="#__codelineno-23-14"></a><span class="w">    </span><span class="c1"># For any missing values, we will fill them by zeros except the ranking where we will use 999</span>
<a id="__codelineno-23-15" name="__codelineno-23-15" href="#__codelineno-23-15"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Rank_p1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Rank_p1&#39;</span><span class="p">]</span><span class="nf">.fillna</span><span class="p">(</span><span class="m">999</span><span class="p">)</span>
<a id="__codelineno-23-16" name="__codelineno-23-16" href="#__codelineno-23-16"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="n">p1_cols</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">p1_cols</span><span class="p">]</span><span class="nf">.fillna</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<a id="__codelineno-23-17" name="__codelineno-23-17" href="#__codelineno-23-17"></a>
<a id="__codelineno-23-18" name="__codelineno-23-18" href="#__codelineno-23-18"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Rank_p2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="s">&#39;Player_Rank_p2&#39;</span><span class="p">]</span><span class="nf">.fillna</span><span class="p">(</span><span class="m">999</span><span class="p">)</span>
<a id="__codelineno-23-19" name="__codelineno-23-19" href="#__codelineno-23-19"></a><span class="w">    </span><span class="n">df</span><span class="p">[</span><span class="n">p2_cols</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">p2_cols</span><span class="p">]</span><span class="nf">.fillna</span><span class="p">(</span><span class="m">0</span><span class="p">)</span>
<a id="__codelineno-23-20" name="__codelineno-23-20" href="#__codelineno-23-20"></a>
<a id="__codelineno-23-21" name="__codelineno-23-21" href="#__codelineno-23-21"></a>
<a id="__codelineno-23-22" name="__codelineno-23-22" href="#__codelineno-23-22"></a><span class="w">    </span><span class="n">new_column_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&#39;_diff&#39;</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">diff_cols</span><span class="p">]</span>
<a id="__codelineno-23-23" name="__codelineno-23-23" href="#__codelineno-23-23"></a>
<a id="__codelineno-23-24" name="__codelineno-23-24" href="#__codelineno-23-24"></a><span class="w">    </span><span class="c1"># Take the difference</span>
<a id="__codelineno-23-25" name="__codelineno-23-25" href="#__codelineno-23-25"></a><span class="w">    </span><span class="n">df_p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">p1_cols</span><span class="p">]</span>
<a id="__codelineno-23-26" name="__codelineno-23-26" href="#__codelineno-23-26"></a><span class="w">    </span><span class="n">df_p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="p">[</span><span class="n">p2_cols</span><span class="p">]</span>
<a id="__codelineno-23-27" name="__codelineno-23-27" href="#__codelineno-23-27"></a>
<a id="__codelineno-23-28" name="__codelineno-23-28" href="#__codelineno-23-28"></a><span class="w">    </span><span class="n">df_p1.columns</span><span class="o">=</span><span class="n">new_column_name</span>
<a id="__codelineno-23-29" name="__codelineno-23-29" href="#__codelineno-23-29"></a><span class="w">    </span><span class="n">df_p2.columns</span><span class="o">=</span><span class="n">new_column_name</span>
<a id="__codelineno-23-30" name="__codelineno-23-30" href="#__codelineno-23-30"></a>
<a id="__codelineno-23-31" name="__codelineno-23-31" href="#__codelineno-23-31"></a><span class="w">    </span><span class="n">df_diff</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_p1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">df_p2</span>
<a id="__codelineno-23-32" name="__codelineno-23-32" href="#__codelineno-23-32"></a><span class="w">    </span><span class="n">df_diff.columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_column_name</span>
<a id="__codelineno-23-33" name="__codelineno-23-33" href="#__codelineno-23-33"></a>
<a id="__codelineno-23-34" name="__codelineno-23-34" href="#__codelineno-23-34"></a><span class="w">    </span><span class="c1"># drop the p1 and p2 columns because We have the differences now</span>
<a id="__codelineno-23-35" name="__codelineno-23-35" href="#__codelineno-23-35"></a><span class="w">    </span><span class="nf">df.drop</span><span class="p">(</span><span class="n">p1_cols</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p2_cols</span><span class="p">,</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">inplace</span><span class="o">=</span><span class="n">True</span><span class="p">)</span>
<a id="__codelineno-23-36" name="__codelineno-23-36" href="#__codelineno-23-36"></a>
<a id="__codelineno-23-37" name="__codelineno-23-37" href="#__codelineno-23-37"></a><span class="w">    </span><span class="c1"># Concat the df_diff and raw_df</span>
<a id="__codelineno-23-38" name="__codelineno-23-38" href="#__codelineno-23-38"></a><span class="w">    </span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="w"> </span><span class="n">df_diff</span><span class="p">],</span><span class="w"> </span><span class="n">axis</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<a id="__codelineno-23-39" name="__codelineno-23-39" href="#__codelineno-23-39"></a>
<a id="__codelineno-23-40" name="__codelineno-23-40" href="#__codelineno-23-40"></a><span class="w">    </span><span class="n">return</span><span class="w"> </span><span class="n">df</span><span class="p">,</span><span class="n">new_column_name</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">diff_cols</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player_Serve_Win_Ratio&#39;</span><span class="p">,</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">            </span><span class="s">&#39;Player_Return_Win_Ratio&#39;</span><span class="p">,</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="w">            </span><span class="s">&#39;Player_BreakPoints_Per_Return_Game&#39;</span><span class="p">,</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="w">            </span><span class="s">&#39;Player_Game_Win_Percentage&#39;</span><span class="p">,</span><span class="s">&#39;Player_Rank&#39;</span><span class="p">]</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="c1"># Apply the function and get the difference between player 1 and 2</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="n">df_atp</span><span class="p">,</span>_<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_player_difference</span><span class="p">(</span><span class="n">df_atp</span><span class="p">,</span><span class="n">diff_cols</span><span class="o">=</span><span class="n">diff_cols</span><span class="p">)</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="n">df_wta</span><span class="p">,</span>_<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_player_difference</span><span class="p">(</span><span class="n">df_wta</span><span class="p">,</span><span class="n">diff_cols</span><span class="o">=</span><span class="n">diff_cols</span><span class="p">)</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="c1"># Make a copy of the data frames in case we need to come back to check the values</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="n">df_atp_final</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_atp.copy</span><span class="p">()</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a><span class="n">df_wta_final</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_wta.copy</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="nf">df_atp_final.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Winner</th>
<th>Loser</th>
<th>Tournament</th>
<th>Tournament_Date</th>
<th>player_1_win</th>
<th>randomised_player_1</th>
<th>randomised_player_2</th>
<th>Player_p1</th>
<th>tournament_date_index_p1</th>
<th>Player_p2</th>
<th>tournament_date_index_p2</th>
<th>Player_Serve_Win_Ratio_diff</th>
<th>Player_Return_Win_Ratio_diff</th>
<th>Player_BreakPoints_Per_Return_Game_diff</th>
<th>Player_Game_Win_Percentage_diff</th>
<th>Player_Rank_diff</th>
</tr>
</thead>
<tbody>
<tr>
<td>Juan Martin del Potro</td>
<td>Adrian Mannarino</td>
<td>Australian Open, Melbourne</td>
<td>2012-01-16</td>
<td>1</td>
<td>Juan Martin del Potro</td>
<td>Adrian Mannarino</td>
<td>Juan Martin del Potro</td>
<td>2012-01-16</td>
<td>Adrian Mannarino</td>
<td>2012-01-16</td>
<td>0.035030</td>
<td>-0.021271</td>
<td>-0.025975</td>
<td>0.103479</td>
<td>-76.0</td>
</tr>
<tr>
<td>Pere Riba</td>
<td>Albert Montanes</td>
<td>Australian Open, Melbourne</td>
<td>2012-01-16</td>
<td>1</td>
<td>Pere Riba</td>
<td>Albert Montanes</td>
<td>Pere Riba</td>
<td>2012-01-16</td>
<td>Albert Montanes</td>
<td>2012-01-16</td>
<td>-0.156369</td>
<td>0.008893</td>
<td>0.066667</td>
<td>-0.094118</td>
<td>39.0</td>
</tr>
<tr>
<td>Tomas Berdych</td>
<td>Albert Ramos-Vinolas</td>
<td>Australian Open, Melbourne</td>
<td>2012-01-16</td>
<td>0</td>
<td>Albert Ramos-Vinolas</td>
<td>Tomas Berdych</td>
<td>Albert Ramos-Vinolas</td>
<td>2012-01-16</td>
<td>NaN</td>
<td>NaT</td>
<td>0.498027</td>
<td>0.380092</td>
<td>0.414815</td>
<td>0.394444</td>
<td>-934.0</td>
</tr>
<tr>
<td>Rafael Nadal</td>
<td>Alex Kuznetsov</td>
<td>Australian Open, Melbourne</td>
<td>2012-01-16</td>
<td>0</td>
<td>Alex Kuznetsov</td>
<td>Rafael Nadal</td>
<td>NaN</td>
<td>NaT</td>
<td>Rafael Nadal</td>
<td>2012-01-16</td>
<td>-0.670139</td>
<td>-0.423057</td>
<td>-0.445623</td>
<td>-0.574767</td>
<td>997.0</td>
</tr>
<tr>
<td>Roger Federer</td>
<td>Alexander Kudryavtsev</td>
<td>Australian Open, Melbourne</td>
<td>2012-01-16</td>
<td>0</td>
<td>Alexander Kudryavtsev</td>
<td>Roger Federer</td>
<td>NaN</td>
<td>NaT</td>
<td>Roger Federer</td>
<td>2012-01-16</td>
<td>-0.721415</td>
<td>-0.449516</td>
<td>-0.360255</td>
<td>-0.668090</td>
<td>996.0</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="modelling">Modelling</h2>
<p>We will trian two models here, one for mens and one for womens.</p>
<p>For training, we will use all available data from the second year (too many missing values in the first year) up until 2017.</p>
<p>For validation, we will test the model on the 2018 Australian Open data</p>
<p>This setup allows us to 'mimic' the final prediction (using historical matches to predict 2019 results)</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="n">df_train_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp_final.loc</span><span class="p">[(</span><span class="n">df_atp_final.Tournament_Date</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&#39;2018-01-15&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1"># excluding Aus Open 2018, and</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">                                </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">df_atp_final.Tournament_Date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s">&#39;2012-01-16&#39;</span><span class="p">)]</span><span class="w"> </span><span class="c1"># excluding first year</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="n">df_valid_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_atp_final.loc</span><span class="p">[</span><span class="n">df_atp_final.Tournament_Date</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&#39;2018-01-15&#39;</span><span class="p">]</span><span class="w"> </span><span class="c1"># Australian Open 2018 only</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="n">df_train_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_wta_final.loc</span><span class="p">[(</span><span class="n">df_wta_final.Tournament_Date</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s">&#39;2018-01-15&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1"># excluding Aus Open 2018, and</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="w">                                </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">df_wta_final.Tournament_Date</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="s">&#39;2014-01-13&#39;</span><span class="p">)]</span><span class="w"> </span><span class="c1"># excluding first year</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nf">df_train_atp.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Winner</th>
<th>Loser</th>
<th>Tournament</th>
<th>Tournament_Date</th>
<th>player_1_win</th>
<th>randomised_player_1</th>
<th>randomised_player_2</th>
<th>Player_p1</th>
<th>tournament_date_index_p1</th>
<th>Player_p2</th>
<th>tournament_date_index_p2</th>
<th>Player_Serve_Win_Ratio_diff</th>
<th>Player_Return_Win_Ratio_diff</th>
<th>Player_BreakPoints_Per_Return_Game_diff</th>
<th>Player_Game_Win_Percentage_diff</th>
<th>Player_Rank_diff</th>
</tr>
</thead>
<tbody>
<tr>
<td>Daniel Brands</td>
<td>Adrian Ungur</td>
<td>U.S. Open, New York</td>
<td>2012-08-27</td>
<td>0</td>
<td>Adrian Ungur</td>
<td>Daniel Brands</td>
<td>NaN</td>
<td>NaT</td>
<td>Daniel Brands</td>
<td>2012-08-27</td>
<td>-0.535211</td>
<td>-0.300000</td>
<td>-0.043478</td>
<td>-0.434783</td>
<td>870.0</td>
</tr>
<tr>
<td>Richard Gasquet</td>
<td>Albert Montanes</td>
<td>U.S. Open, New York</td>
<td>2012-08-27</td>
<td>1</td>
<td>Richard Gasquet</td>
<td>Albert Montanes</td>
<td>Richard Gasquet</td>
<td>2012-08-27</td>
<td>Albert Montanes</td>
<td>2012-08-27</td>
<td>0.080003</td>
<td>0.077451</td>
<td>0.180847</td>
<td>0.131108</td>
<td>-37.0</td>
</tr>
<tr>
<td>Martin Klizan</td>
<td>Alejandro Falla</td>
<td>U.S. Open, New York</td>
<td>2012-08-27</td>
<td>1</td>
<td>Martin Klizan</td>
<td>Alejandro Falla</td>
<td>Martin Klizan</td>
<td>2012-08-27</td>
<td>Alejandro Falla</td>
<td>2012-08-27</td>
<td>0.077117</td>
<td>-0.044716</td>
<td>-0.087362</td>
<td>0.068180</td>
<td>-2.0</td>
</tr>
<tr>
<td>Andy Murray</td>
<td>Alex Bogomolov Jr.</td>
<td>U.S. Open, New York</td>
<td>2012-08-27</td>
<td>1</td>
<td>Andy Murray</td>
<td>Alex Bogomolov Jr.</td>
<td>Andy Murray</td>
<td>2012-08-27</td>
<td>Alex Bogomolov Jr.</td>
<td>2012-08-27</td>
<td>0.039641</td>
<td>0.031701</td>
<td>0.094722</td>
<td>0.059010</td>
<td>-69.0</td>
</tr>
<tr>
<td>Tommy Robredo</td>
<td>Andreas Seppi</td>
<td>U.S. Open, New York</td>
<td>2012-08-27</td>
<td>1</td>
<td>Tommy Robredo</td>
<td>Andreas Seppi</td>
<td>Tommy Robredo</td>
<td>2012-08-27</td>
<td>Andreas Seppi</td>
<td>2012-08-27</td>
<td>-0.026814</td>
<td>0.006442</td>
<td>-0.009930</td>
<td>-0.067780</td>
<td>151.0</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># target variable</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">target</span><span class="o">=</span><span class="w"> </span><span class="s">&#39;player_1_win&#39;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="c1"># features being fed into the models</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="n">feats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player_Serve_Win_Ratio_diff&#39;</span><span class="p">,</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">         </span><span class="s">&#39;Player_Return_Win_Ratio_diff&#39;</span><span class="p">,</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">         </span><span class="s">&#39;Player_BreakPoints_Per_Return_Game_diff&#39;</span><span class="p">,</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a><span class="w">         </span><span class="s">&#39;Player_Game_Win_Percentage_diff&#39;</span><span class="p">,</span>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">         </span><span class="s">&#39;Player_Rank_diff&#39;</span><span class="p">]</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="nf">print</span><span class="p">(</span><span class="n">feats</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="h2o-model-for-atp">H2O model for ATP</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nf">h2o.init</span><span class="p">()</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="c1"># Convert to an h2o frame</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="n">df_train_atp_h2o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.H2OFrame</span><span class="p">(</span><span class="n">df_train_atp</span><span class="p">)</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="n">df_valid_atp_h2o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.H2OFrame</span><span class="p">(</span><span class="n">df_valid_atp</span><span class="p">)</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="c1"># For binary classification, response should be a factor</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a><span class="n">df_train_atp_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_train_atp_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="nf">.asfactor</span><span class="p">()</span>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="n">df_valid_atp_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_valid_atp_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="nf">.asfactor</span><span class="p">()</span>
<a id="__codelineno-29-11" name="__codelineno-29-11" href="#__codelineno-29-11"></a>
<a id="__codelineno-29-12" name="__codelineno-29-12" href="#__codelineno-29-12"></a><span class="c1"># Run AutoML for 20 base models (limited to 1 hour max runtime by default)</span>
<a id="__codelineno-29-13" name="__codelineno-29-13" href="#__codelineno-29-13"></a><span class="n">aml_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.automl.H2OAutoML</span><span class="p">(</span><span class="n">max_runtime_secs</span><span class="o">=</span><span class="m">300</span><span class="p">,</span>
<a id="__codelineno-29-14" name="__codelineno-29-14" href="#__codelineno-29-14"></a><span class="w">                           </span><span class="n">max_models</span><span class="o">=</span><span class="m">100</span><span class="p">,</span>
<a id="__codelineno-29-15" name="__codelineno-29-15" href="#__codelineno-29-15"></a><span class="w">                           </span><span class="n">stopping_metric</span><span class="o">=</span><span class="s">&#39;logloss&#39;</span><span class="p">,</span>
<a id="__codelineno-29-16" name="__codelineno-29-16" href="#__codelineno-29-16"></a><span class="w">                           </span><span class="n">sort_metric</span><span class="o">=</span><span class="s">&#39;logloss&#39;</span><span class="p">,</span>
<a id="__codelineno-29-17" name="__codelineno-29-17" href="#__codelineno-29-17"></a><span class="w">                           </span><span class="n">balance_classes</span><span class="o">=</span><span class="n">True</span><span class="p">,</span>
<a id="__codelineno-29-18" name="__codelineno-29-18" href="#__codelineno-29-18"></a><span class="w">                           </span><span class="n">seed</span><span class="o">=</span><span class="m">183</span>
<a id="__codelineno-29-19" name="__codelineno-29-19" href="#__codelineno-29-19"></a><span class="w">                          </span><span class="p">)</span>
<a id="__codelineno-29-20" name="__codelineno-29-20" href="#__codelineno-29-20"></a><span class="nf">aml_atp.train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feats</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">training_frame</span><span class="o">=</span><span class="n">df_train_atp_h2o</span><span class="p">,</span><span class="n">validation_frame</span><span class="o">=</span><span class="n">df_valid_atp_h2o</span><span class="p">)</span>
<a id="__codelineno-29-21" name="__codelineno-29-21" href="#__codelineno-29-21"></a>
<a id="__codelineno-29-22" name="__codelineno-29-22" href="#__codelineno-29-22"></a><span class="c1"># View the AutoML Leaderboard</span>
<a id="__codelineno-29-23" name="__codelineno-29-23" href="#__codelineno-29-23"></a><span class="n">lb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aml_atp.leaderboard</span>
<a id="__codelineno-29-24" name="__codelineno-29-24" href="#__codelineno-29-24"></a><span class="nf">lb.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>model_id</th>
<th>auc</th>
<th>logloss</th>
<th>mean_per_class_error</th>
<th>rmse</th>
<th>mse</th>
</tr>
</thead>
<tbody>
<tr>
<td>GBM_5_AutoML_20181221_094949</td>
<td>0.790281</td>
<td>0.554852</td>
<td>0.281363</td>
<td>0.431379</td>
<td>0.186088</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_094949_model_15</td>
<td>0.789329</td>
<td>0.556804</td>
<td>0.29856</td>
<td>0.431931</td>
<td>0.186564</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_094949_model_7</td>
<td>0.788013</td>
<td>0.557808</td>
<td>0.295899</td>
<td>0.432968</td>
<td>0.187461</td>
</tr>
<tr>
<td>StackedEnsemble_BestOfFamily_AutoML_20181221_094949</td>
<td>0.788131</td>
<td>0.558028</td>
<td>0.285321</td>
<td>0.432849</td>
<td>0.187358</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_094949_model_20</td>
<td>0.785633</td>
<td>0.561094</td>
<td>0.283932</td>
<td>0.43479</td>
<td>0.189043</td>
</tr>
<tr>
<td>StackedEnsemble_AllModels_AutoML_20181221_094949</td>
<td>0.784411</td>
<td>0.561587</td>
<td>0.293244</td>
<td>0.434667</td>
<td>0.188935</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_094949_model_25</td>
<td>0.785311</td>
<td>0.561783</td>
<td>0.291912</td>
<td>0.434888</td>
<td>0.189127</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_094949_model_17</td>
<td>0.774832</td>
<td>0.570883</td>
<td>0.295836</td>
<td>0.439375</td>
<td>0.193051</td>
</tr>
<tr>
<td>DeepLearning_1_AutoML_20181221_094949</td>
<td>0.779388</td>
<td>0.572823</td>
<td>0.311737</td>
<td>0.438479</td>
<td>0.192264</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_094949_model_14</td>
<td>0.7718</td>
<td>0.578867</td>
<td>0.285835</td>
<td>0.441373</td>
<td>0.19481</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="n">H2O</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="n">for</span><span class="w"> </span><span class="n">WTA</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="c1"># Convert to an h2o frame</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="n">df_train_wta_h2o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.H2OFrame</span><span class="p">(</span><span class="n">df_train_wta</span><span class="p">)</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="n">df_valid_wta_h2o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.H2OFrame</span><span class="p">(</span><span class="n">df_valid_wta</span><span class="p">)</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="c1"># For binary classification, response should be a factor</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="n">df_train_wta_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_train_wta_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="nf">.asfactor</span><span class="p">()</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="n">df_valid_wta_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_valid_wta_h2o</span><span class="p">[</span><span class="n">target</span><span class="p">]</span><span class="nf">.asfactor</span><span class="p">()</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="c1"># Run AutoML for 20 base models (limited to 1 hour max runtime by default)</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="n">aml_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.automl.H2OAutoML</span><span class="p">(</span><span class="n">max_runtime_secs</span><span class="o">=</span><span class="m">300</span><span class="p">,</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">                           </span><span class="n">max_models</span><span class="o">=</span><span class="m">100</span><span class="p">,</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">                           </span><span class="n">stopping_metric</span><span class="o">=</span><span class="s">&#39;logloss&#39;</span><span class="p">,</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">                           </span><span class="n">sort_metric</span><span class="o">=</span><span class="s">&#39;logloss&#39;</span><span class="p">,</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="w">                           </span><span class="n">balance_classes</span><span class="o">=</span><span class="n">True</span><span class="p">,</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a><span class="w">                           </span><span class="n">seed</span><span class="o">=</span><span class="m">183</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="w">                          </span><span class="p">)</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a><span class="nf">aml_wta.train</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">feats</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">training_frame</span><span class="o">=</span><span class="n">df_train_wta_h2o</span><span class="p">,</span><span class="n">validation_frame</span><span class="o">=</span><span class="n">df_valid_wta_h2o</span><span class="p">)</span>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="c1"># View the AutoML Leaderboard</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a><span class="n">lb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aml_wta.leaderboard</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a><span class="nf">lb.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>model_id</th>
<th>auc</th>
<th>logloss</th>
<th>mean_per_class_error</th>
<th>rmse</th>
<th>mse</th>
</tr>
</thead>
<tbody>
<tr>
<td>StackedEnsemble_AllModels_AutoML_20181221_095400</td>
<td>0.726046</td>
<td>0.60827</td>
<td>0.321222</td>
<td>0.457117</td>
<td>0.208956</td>
</tr>
<tr>
<td>StackedEnsemble_BestOfFamily_AutoML_20181221_095400</td>
<td>0.724911</td>
<td>0.609329</td>
<td>0.337847</td>
<td>0.457659</td>
<td>0.209452</td>
</tr>
<tr>
<td>DeepLearning_grid_1_AutoML_20181221_095400_model_3</td>
<td>0.729152</td>
<td>0.612669</td>
<td>0.315971</td>
<td>0.45641</td>
<td>0.20831</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_095400_model_7</td>
<td>0.721204</td>
<td>0.615763</td>
<td>0.336848</td>
<td>0.460885</td>
<td>0.212415</td>
</tr>
<tr>
<td>GBM_5_AutoML_20181221_095400</td>
<td>0.719252</td>
<td>0.616535</td>
<td>0.319179</td>
<td>0.461055</td>
<td>0.212572</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_095400_model_15</td>
<td>0.715921</td>
<td>0.619263</td>
<td>0.318673</td>
<td>0.462215</td>
<td>0.213643</td>
</tr>
<tr>
<td>GLM_grid_1_AutoML_20181221_095400_model_1</td>
<td>0.726048</td>
<td>0.622989</td>
<td>0.366124</td>
<td>0.463099</td>
<td>0.214461</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_095400_model_17</td>
<td>0.709261</td>
<td>0.624902</td>
<td>0.34876</td>
<td>0.465628</td>
<td>0.216809</td>
</tr>
<tr>
<td>GBM_grid_1_AutoML_20181221_095400_model_18</td>
<td>0.70946</td>
<td>0.625704</td>
<td>0.393556</td>
<td>0.466147</td>
<td>0.217293</td>
</tr>
<tr>
<td>DeepLearning_grid_1_AutoML_20181221_095400_model_2</td>
<td>0.713419</td>
<td>0.628008</td>
<td>0.311334</td>
<td>0.463638</td>
<td>0.21496</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="use-the-models-to-predict-and-make-submissions">Use the models to predict and make submissions</h2>
<p>Now let's use the models we just created to make the submissions</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">df_predict_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.read_csv</span><span class="p">(</span><span class="s">&quot;data/men_dummy_submission_file.csv&quot;</span><span class="p">)</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">df_predict_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.read_csv</span><span class="p">(</span><span class="s">&quot;data/women_dummy_submission_file.csv&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;latin1&#39;</span><span class="p">)</span><span class="w"> </span><span class="c1"># for womens, there are some names need a different encoding</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nf">df_predict_wta.head</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>player_1</th>
<th>player_2</th>
<th>player_1_win_probability</th>
</tr>
</thead>
<tbody>
<tr>
<td>Simona Halep</td>
<td>Angelique Kerber</td>
<td>0.5</td>
</tr>
<tr>
<td>Simona Halep</td>
<td>Caroline Wozniacki</td>
<td>0.5</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="get-the-features-for-the-predict-df">Get the features for the predict df</h2>
<p>We need to join the features to the 2019 players</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Before we join the features by the names and the dates, we need to convert any non-english characters to english first</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">translationTable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">str.maketrans</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;eaeuaeioucna&quot;</span><span class="p">)</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_atp.player_1.apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="nf">x.translate</span><span class="p">(</span><span class="n">translationTable</span><span class="p">))</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_atp.player_2.apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="nf">x.translate</span><span class="p">(</span><span class="n">translationTable</span><span class="p">))</span>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_wta.player_1.apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="nf">x.translate</span><span class="p">(</span><span class="n">translationTable</span><span class="p">))</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_wta.player_2.apply</span><span class="p">(</span><span class="n">lambda</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="nf">x.translate</span><span class="p">(</span><span class="n">translationTable</span><span class="p">))</span>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="c1"># Also we need to convert the names into lower cases </span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="nf">.str.lower</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="nf">.str.lower</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="nf">.str.lower</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="nf">.str.lower</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="n">df_rolling_atp</span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_rolling_atp</span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">]</span><span class="nf">.str.lower</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="n">df_rolling_wta</span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_rolling_wta</span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">]</span><span class="nf">.str.lower</span><span class="p">()</span><span class="w"> </span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="c1"># Lastly, some players have slightly difference names in the submission data and the match data. So we are editing them here manually</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="n">df_predict_atp.loc</span><span class="p">[</span><span class="n">df_predict_atp.player_1</span><span class="o">==</span><span class="s">&#39;jaume munar&#39;</span><span class="p">,</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;jaume antoni munar clar&#39;</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a><span class="n">df_predict_atp.loc</span><span class="p">[</span><span class="n">df_predict_atp.player_2</span><span class="o">==</span><span class="s">&#39;jaume munar&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;jaume antoni munar clar&#39;</span>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_1</span><span class="o">==</span><span class="s">&#39;daria kasatkina&#39;</span><span class="p">,</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;darya kasatkina&#39;</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_2</span><span class="o">==</span><span class="s">&#39;daria kasatkina&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;darya kasatkina&#39;</span>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_1</span><span class="o">==</span><span class="s">&#39;lesia tsurenko&#39;</span><span class="p">,</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;lesya tsurenko&#39;</span>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_2</span><span class="o">==</span><span class="s">&#39;lesia tsurenko&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;lesya tsurenko&#39;</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_1</span><span class="o">==</span><span class="s">&#39;danielle collins&#39;</span><span class="p">,</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;danielle rose collins&#39;</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_2</span><span class="o">==</span><span class="s">&#39;danielle collins&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;danielle rose collins&#39;</span>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_1</span><span class="o">==</span><span class="s">&#39;anna karolina schmiedlova&#39;</span><span class="p">,</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;anna schmiedlova&#39;</span>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_2</span><span class="o">==</span><span class="s">&#39;anna karolina schmiedlova&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;anna schmiedlova&#39;</span>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_1</span><span class="o">==</span><span class="s">&#39;georgina garcia perez&#39;</span><span class="p">,</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;georgina garcia-perez&#39;</span>
<a id="__codelineno-34-34" name="__codelineno-34-34" href="#__codelineno-34-34"></a><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="n">df_predict_wta.player_2</span><span class="o">==</span><span class="s">&#39;georgina garcia perez&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;georgina garcia-perez&#39;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1"># create and tournament date column and set it to 2019 so we can join the lastest features</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.to_datetime</span><span class="p">(</span><span class="s">&#39;2019-01-15&#39;</span><span class="p">)</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">pd.to_datetime</span><span class="p">(</span><span class="s">&#39;2019-01-15&#39;</span><span class="p">)</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="c1"># Get the rolling features for player 1</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="n">df_predict_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_atp.merge</span><span class="p">(</span><span class="n">df_rolling_atp</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">                     </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">                     </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">)</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="n">df_predict_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_wta.merge</span><span class="p">(</span><span class="n">df_rolling_wta</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">                     </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;player_1&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">                     </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">)</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="c1"># Get the rolling features for player 2</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="c1"># For duplicate columns, we will use &#39;_p1&#39; to denote player 1 and &#39;_p2&#39; for player 2</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a><span class="n">df_predict_atp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_atp.merge</span><span class="p">(</span><span class="n">df_rolling_atp</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">                     </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">                     </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;_p1&#39;</span><span class="p">,</span><span class="s">&#39;_p2&#39;</span><span class="p">))</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="n">df_predict_wta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">df_predict_wta.merge</span><span class="p">(</span><span class="n">df_rolling_wta</span><span class="p">,</span><span class="w"> </span><span class="n">how</span><span class="o">=</span><span class="s">&#39;left&#39;</span><span class="p">,</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">                     </span><span class="n">left_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;player_2&#39;</span><span class="p">,</span><span class="s">&#39;Tournament_Date&#39;</span><span class="p">],</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">                     </span><span class="n">right_on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Player&#39;</span><span class="p">,</span><span class="s">&#39;tournament_date_index&#39;</span><span class="p">],</span><span class="n">validate</span><span class="w"> </span><span class="o">=</span><span class="s">&#39;m:1&#39;</span><span class="p">,</span><span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;_p1&#39;</span><span class="p">,</span><span class="s">&#39;_p2&#39;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nf">df_predict_atp.head</span><span class="p">(</span><span class="m">2</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>player_1</th>
<th>player_2</th>
<th>player_1_win_probability</th>
<th>Tournament_Date</th>
<th>Player_p1</th>
<th>Player_Serve_Win_Ratio_p1</th>
<th>Player_Return_Win_Ratio_p1</th>
<th>Player_BreakPoints_Per_Return_Game_p1</th>
<th>Player_Game_Win_Percentage_p1</th>
<th>Player_Rank_p1</th>
<th>tournament_date_index_p1</th>
<th>Player_p2</th>
<th>Player_Serve_Win_Ratio_p2</th>
<th>Player_Return_Win_Ratio_p2</th>
<th>Player_BreakPoints_Per_Return_Game_p2</th>
<th>Player_Game_Win_Percentage_p2</th>
<th>Player_Rank_p2</th>
<th>tournament_date_index_p2</th>
</tr>
</thead>
<tbody>
<tr>
<td>novak djokovic</td>
<td>rafael nadal</td>
<td>0.5</td>
<td>2019-01-15</td>
<td>novak djokovic</td>
<td>0.685903</td>
<td>0.426066</td>
<td>0.42378</td>
<td>0.640857</td>
<td>2.0</td>
<td>2019-01-15</td>
<td>rafael nadal</td>
<td>0.622425</td>
<td>0.401028</td>
<td>0.334270</td>
<td>0.570833</td>
<td>1.0</td>
<td>2019-01-15</td>
</tr>
<tr>
<td>novak djokovic</td>
<td>roger federer</td>
<td>0.5</td>
<td>2019-01-15</td>
<td>novak djokovic</td>
<td>0.685903</td>
<td>0.426066</td>
<td>0.42378</td>
<td>0.640857</td>
<td>2.0</td>
<td>2019-01-15</td>
<td>roger federer</td>
<td>0.620070</td>
<td>0.389781</td>
<td>0.269224</td>
<td>0.564244</td>
<td>3.0</td>
<td>2019-01-15</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># How many players do not have previous match history</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_1s do Not have previous match history before the tournament in the mens&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_predict_atp.loc</span><span class="p">[</span><span class="nf">df_predict_atp.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_2s do Not have previous match history before the tournament in the mens&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_predict_atp.loc</span><span class="p">[</span><span class="nf">df_predict_atp.Player_p2.isna</span><span class="p">(),</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
</code></pre></div>
<p>3 player_1s do Not have previous match history before the tournament in the mens
3 player_2s do Not have previous match history before the tournament in the mens</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># How many players do not have previous match history</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_1s do Not have previous match history before the tournament in the womens&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="nf">df_predict_wta.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="nf">print</span><span class="p">(</span><span class="s">&#39;{} player_2s do Not have previous match history before the tournament in the womens&#39;</span><span class="nf">.format</span><span class="p">(</span><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="nf">df_predict_wta.Player_p2.isna</span><span class="p">(),</span><span class="s">&#39;player_2&#39;</span><span class="p">]</span><span class="nf">.nunique</span><span class="p">()))</span>
</code></pre></div>
<p>0 player_1s do Not have previous match history before the tournament in the womens
0 player_2s do Not have previous match history before the tournament in the womens</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nf">print</span><span class="p">(</span><span class="n">df_predict_atp.loc</span><span class="p">[</span><span class="nf">df_predict_atp.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="nf">.unique</span><span class="p">()</span><span class="nf">.tolist</span><span class="p">())</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="p">[</span><span class="s">&#39;christian garin&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;pedro sousa&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;hugo dellien&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nf">print</span><span class="p">(</span><span class="n">df_predict_wta.loc</span><span class="p">[</span><span class="nf">df_predict_wta.Player_p1.isna</span><span class="p">(),</span><span class="s">&#39;player_1&#39;</span><span class="p">]</span><span class="nf">.unique</span><span class="p">()</span><span class="nf">.tolist</span><span class="p">())</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="p">[]</span>
</code></pre></div>
<p>We will do the differencing again for the prediction data frames exactly like what we did for training</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1"># Apply the function and get the difference between player 1 and 2</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="n">df_predict_atp</span><span class="p">,</span>_<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_player_difference</span><span class="p">(</span><span class="n">df_predict_atp</span><span class="p">,</span><span class="n">diff_cols</span><span class="o">=</span><span class="n">diff_cols</span><span class="p">)</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="n">df_predict_wta</span><span class="p">,</span>_<span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">get_player_difference</span><span class="p">(</span><span class="n">df_predict_wta</span><span class="p">,</span><span class="n">diff_cols</span><span class="o">=</span><span class="n">diff_cols</span><span class="p">)</span>
</code></pre></div>
<hr />
<h2 id="make-the-prediction">Make the prediction</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="n">df_predict_atp_h2o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.H2OFrame</span><span class="p">(</span><span class="n">df_predict_atp</span><span class="p">[</span><span class="n">feats</span><span class="p">])</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="n">df_predict_wta_h2o</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">h2o.H2OFrame</span><span class="p">(</span><span class="n">df_predict_wta</span><span class="p">[</span><span class="n">feats</span><span class="p">])</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="n">atp_preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aml_atp.predict</span><span class="p">(</span><span class="n">df_predict_atp_h2o</span><span class="p">)[</span><span class="s">&#39;p1&#39;</span><span class="p">]</span><span class="nf">.as_data_frame</span><span class="p">()</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="n">wta_preds</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">aml_wta.predict</span><span class="p">(</span><span class="n">df_predict_wta_h2o</span><span class="p">)[</span><span class="s">&#39;p1&#39;</span><span class="p">]</span><span class="nf">.as_data_frame</span><span class="p">()</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="n">df_predict_atp</span><span class="p">[</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atp_preds</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="n">df_predict_wta</span><span class="p">[</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wta_preds</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">atp_submission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_predict_atp</span><span class="p">[[</span><span class="s">&#39;player_1&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">,</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">]]</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="n">wta_submission</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df_predict_wta</span><span class="p">[[</span><span class="s">&#39;player_1&#39;</span><span class="p">,</span><span class="s">&#39;player_2&#39;</span><span class="p">,</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">]]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nf">atp_submission.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>player_1</th>
<th>player_2</th>
<th>player_1_win_probability</th>
</tr>
</thead>
<tbody>
<tr>
<td>novak djokovic</td>
<td>rafael nadal</td>
<td>0.571588</td>
</tr>
<tr>
<td>novak djokovic</td>
<td>roger federer</td>
<td>0.662511</td>
</tr>
<tr>
<td>novak djokovic</td>
<td>juan martin del potro</td>
<td>0.544306</td>
</tr>
<tr>
<td>novak djokovic</td>
<td>alexander zverev</td>
<td>0.709483</td>
</tr>
<tr>
<td>novak djokovic</td>
<td>kevin anderson</td>
<td>0.687195</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nf">wta_submission.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>player_1</th>
<th>player_2</th>
<th>player_1_win_probability</th>
</tr>
</thead>
<tbody>
<tr>
<td>simona halep</td>
<td>angelique kerber</td>
<td>0.455224</td>
</tr>
<tr>
<td>simona halep</td>
<td>caroline wozniacki</td>
<td>0.546276</td>
</tr>
<tr>
<td>simona halep</td>
<td>elina svitolina</td>
<td>0.408014</td>
</tr>
<tr>
<td>simona halep</td>
<td>naomi osaka</td>
<td>0.285125</td>
</tr>
<tr>
<td>simona halep</td>
<td>sloane stephens</td>
<td>0.576643</td>
</tr>
</tbody>
</table>
<p>Let's look at who has the highest win rate from our models</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="nf">atp_submission.groupby</span><span class="p">(</span><span class="s">&#39;player_1&#39;</span><span class="p">)[</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">]</span><span class="nf">.mean</span><span class="p">()</span><span class="w"> </span>\
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="nf">.reset_index</span><span class="p">()</span><span class="nf">.sort_values</span><span class="p">(</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="nf">.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>player_1</th>
<th>player_1_win_probability</th>
</tr>
</thead>
<tbody>
<tr>
<td>novak djokovic</td>
<td>0.846377</td>
</tr>
<tr>
<td>juan martin del potro</td>
<td>0.787337</td>
</tr>
<tr>
<td>karen khachanov</td>
<td>0.782963</td>
</tr>
<tr>
<td>rafael nadal</td>
<td>0.778707</td>
</tr>
<tr>
<td>roger federer</td>
<td>0.767337</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nf">wta_submission.groupby</span><span class="p">(</span><span class="s">&#39;player_1&#39;</span><span class="p">)[</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">]</span><span class="nf">.mean</span><span class="p">()</span><span class="w"> </span>\
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="nf">.reset_index</span><span class="p">()</span><span class="nf">.sort_values</span><span class="p">(</span><span class="s">&#39;player_1_win_probability&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="n">False</span><span class="p">)</span><span class="nf">.head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>player_1</th>
<th>player_1_win_probability</th>
</tr>
</thead>
<tbody>
<tr>
<td>madison keys</td>
<td>0.750580</td>
</tr>
<tr>
<td>naomi osaka</td>
<td>0.749195</td>
</tr>
<tr>
<td>caroline wozniacki</td>
<td>0.722409</td>
</tr>
<tr>
<td>kiki bertens</td>
<td>0.713904</td>
</tr>
<tr>
<td>aryna sabalenka</td>
<td>0.707368</td>
</tr>
</tbody>
</table>
<p>Now we can output the predictions as csvs</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nf">atp_submission.to_csv</span><span class="p">(</span><span class="s">&#39;submission/atp_submission_python.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="nf">wta_submission.to_csv</span><span class="p">(</span><span class="s">&#39;submission/wta_submission_pthon.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">False</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="n">atp_submission.shape</span>
</code></pre></div>
<p>(16256, 3)</p>
<hr />
<h3 id="disclaimer">Disclaimer</h3>
<p>Note that whilst models and automated strategies are fun and rewarding to create, we can't promise that your model or betting strategy will be profitable, and we make no representations in relation to the code shared or information on this page. If you're using this code or implementing your own strategies, you do so entirely at your own risk and you are responsible for any winnings/losses incurred. Under no circumstances will Betfair be liable for any loss or damage you suffer.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="footer.title">
        
          
          <a href="../AusOpenRTutorial/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Aus Open R Tutorial" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Aus Open R Tutorial
              </div>
            </div>
          </a>
        
        
          
          <a href="../../automation/GoldenRulesofAutomation/" class="md-footer__link md-footer__link--next" aria-label="Next: Golden rules of automation" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Golden rules of automation
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-copyright">
  
  
</div>
        
          <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/Betfair_Aus" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/company/betfair-australia" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://facebook.com/betfairaustralia" target="_blank" rel="noopener" title="facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/user/betfairaus" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/betfair-datascientists" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
        
      </div>

      <div class="bf-footer">
          <div class="bf-footer-inner">
              <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
              <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its <a class='inner-link' href="https://www.betfair.com.au/info/responsible-gambling/">Responsible Gambling Code of Conduct</a> and for South
              Australian residents by the <a class='inner-link' href="https://www.betfair.com.au/info/pdf/SA-GCoP.pdf">South Australian Responsible Gambling Code of Practice.</a></p>
              <p class="bf-dark">BetStop is the Australian National Self-Exclusion Register. For more information, please visit <a class="inner-link" href="https://betstop.gov.au">https://betstop.gov.au</a><br /> <div class="full-screen"> <p style="font-family: Arial, sans-serif; font-size: 1.2rem; font-weight: bold;text-align: center;">What are you really gambling with&#63</p> <p style="font-family: Arial, sans-serif; font-size: 0.8rem; font-weight: bold;text-align: center;">For free and confidential support call 1800 858 858 or visit <a href="http://www.gamblinghelponline.org.au" style="color: black; text-decoration: underline;">www.gamblinghelponline.org.au</a></p> </div> </p>
              <ul class="bf-links">
                <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
                <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
                <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
                <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
                <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
              </ul>
          </div>
      </div>
    </div>

    <script src="https://js.adsrvr.org/up_loader.1.1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        ttd_dom_ready( function() {
            if (typeof TTDUniversalPixelApi === 'function') {
                var universalPixelApi = new TTDUniversalPixelApi();
                universalPixelApi.init("y12d1ir", ["8ml4f17"], "https://insight.adsrvr.org/track/up");
            }
        });
    </script>

</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1c3ead8.min.js"></script>
      
        <script src="../../js/scripts.js"></script>
      
    
  </body>
</html>