
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/EPLmlPython/">
      
      
        <link rel="prev" href="../soccerModellingTutorialPython/">
      
      
        <link rel="next" href="../soccerModellingELO2022WorldCup/">
      
      
      <link rel="icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>EPL Machine Learning (Python) - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/betfair.css">
    
      <link rel="stylesheet" href="../../css/buttons_and_animations.css">
    
      <link rel="stylesheet" href="../../css/fonts.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-125973915-1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","UA-125973915-1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=UA-125973915-1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#epl-machine-learning-walkthrough" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      
  
  <header class="md-header" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="header.title">
      <a href="../.." title="The Automation Hub" class="md-header__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
        
  <img src="../../img/logo.svg" alt="logo">

      </a>
      <label class="md-header__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              The Automation Hub
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">
              
                EPL Machine Learning (Python)
              
            </span>
          </div>
        </div>
      </div>

      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
              </label>
            
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
              </label>
            
          
        </form>
      
      

      
     
      <div class="bf-nav">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#"
          xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26" />
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z" />
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>

      

    </nav>
    
  </header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../data/dataListing/" class="md-tabs__link">
          
  
  Data

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../wagering/betfairHowTo/" class="md-tabs__link">
          
  
  Wagering

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/apiResources/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../ALeagueDatathon/" class="md-tabs__link">
          
  
  Modelling

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../automation/GoldenRulesofAutomation/" class="md-tabs__link">
          
  
  Automation

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/How_to_Automate_1/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mentalGame/intro/" class="md-tabs__link">
          
  
  Mental Game

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contactUs/test/" class="md-tabs__link">
          
  
  Contact Us

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Automation Hub" class="md-nav__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
      
  <img src="../../img/logo.svg" alt="logo">

    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/dataListing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSV Files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/usingHistoricDataSite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Historic Data Site
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Wagering
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Wagering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/betfairHowTo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betfair How-To
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/bettingGlossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betting Glossary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/stakingMethods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staking Methods and Bankroll Management
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/valueAndOdds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Value and Odds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/commission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commission and other charges
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/hubPredictionsModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hub Predictions Model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/2ndPlaceVoid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashback 2nd Markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/exactaQuinella/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exactas & Quinella
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiResources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API resources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiappkey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to access the Betfair API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiRtutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API tutorial in R
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiPythontutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API tutorial in Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Modelling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Modelling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ALeagueDatathon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    A-League Datathon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to modelling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataSources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pricing Data Sources
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloudOrLocalMachine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud or Local
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monteCarloSimulations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monte Carlo Simulations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AFL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            AFL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLPlayerDisposalsTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Player Disposal Lines
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLPlayerDisposalsFlumine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betting Player Disposal Markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLmodellingPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AFL modelling walk through in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modellingTheBrownlowMedal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How does a Data Scientist model the Brownlow?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../brownlowModelTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelling the Brownlow Medal in Python
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Racing
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Racing
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../topazTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound Topaz API (Python)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fasttrackTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound FastTrack API (Python)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../greyhoundModellingPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound modelling (Python)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Soccer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Soccer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToBuildASoccerBotPartI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Build A Soccer Bot P1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToBuildASoccerBotPartII/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Build A Soccer Bot P2
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_9" checked>
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Soccer (Archive)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            Soccer (Archive)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingTutorialPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling (Python)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    EPL Machine Learning (Python)
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingELO2022WorldCup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling (R) - 2022 FIFA World Cup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerEloTutorialR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elo soccer tutorial (R)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingTutorialR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling (R)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tennis
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            Tennis
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToModelTheAusOpen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to model the Australian Open
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenRTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aus Open R Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenPythonTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aus Open Python Tutorial
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Automation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Automation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GoldenRulesofAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Golden rules of automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/overview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tools Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bet Angel
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Bet Angel
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngel/betAngel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelbeginners/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Beginner's guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelintermediate/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intermediate guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngeladvanced/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Advanced guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelRatingsAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ratings auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelMarketFavouriteAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Market fav auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelTippingAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tipping auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelSimultaneousMarkets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simultaneous markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelKellyStake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelly criterion staking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Gruss Betting Assistant
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            Gruss Betting Assistant
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/Gruss/Gruss/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GrussSettingupbasicmarketview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup basic market view and one click betting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussRatingsAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ratings auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussMarketFavouriteAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Market fav auto
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grusslSimultaneousMarkets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simultaneous markets
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussKellyStake/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kelly criterion staking
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cymatic Trader
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Cymatic Trader
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/CymaticTrader/CymaticTrader/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/cymaticTraderRatingsAutomation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ratings auto
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Geeks Toy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            Geeks Toy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GeeksToyinstallationandsetup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation and setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GeeksToybasicmarketviewstakingandoneclickbetting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup basic market view and one click betting
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/geeksToyRefreshSettings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Optimising refresh settings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_7" >
        
          
          <label class="md-nav__link" for="__nav_6_7" id="__nav_6_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Bet Jet Pro
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_7">
            <span class="md-nav__icon md-icon"></span>
            Bet Jet Pro
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betJetOverview/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/flumineSimulations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flumine Simulations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/processingTarFiles101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Take away the pain! Processing TAR Files 101
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/jsonToCsvRevisited/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON to CSV | Revisited
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/backtestingRatingsTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Back testing ratings in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/automatedBettingAnglesTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automated betting angles in Python
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingMarketMovements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Do they know? Analysing Betfair market formation & market movements
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingBSP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wisdom of the crowd? Analysing & understanding BSP
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mental Game
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Mental Game
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/roleOfEmotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/mapYourEmotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/handlingBadVariance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/winbyBeingGreatatLosing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/correctingyouremotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/responsibleGambling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/InchwormConcept/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 7
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/HighExpectations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 8
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/TappingYourIntuition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 9
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contact Us
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Contact Us
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contactUs/test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meet the Team
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="epl-machine-learning-walkthrough">EPL Machine Learning Walkthrough</h1>
<hr />
<h1 id="01-data-acquisition-exploration">01. Data Acquisition &amp; Exploration</h1>
<p>Welcome to the first part of this Machine Learning Walkthrough. This tutorial will be made of four parts; how we actually acquired our data (programmatically), exploring the data to find potential features, building the model and using the model to make predictions.</p>
<hr />
<h2 id="data-acquisition">Data Acquisition</h2>
<p>We will be grabbing our data from <a href="http://www.football-data.co.uk/englandm.php">football-data.co.uk</a>, which has an enormous amount of soccer data dating back to the 90s. They also generously allow us to use it for free! However, the data is in separate CSVs based on the season. That means we would need to manually download 20 different files if we wanted the past 20 seasons. Rather than do this laborious and boring task, let's create a function which downloads the files for us, and appends them all into one big CSV.</p>
<p>To do this, we will use BeautifulSoup, a Python library which helps to pull data from HTML and XML files. We will then define a function which collates all the data for us into one DataFrame.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Import Modules</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kn">import</span> <span class="nn">requests</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="kn">import</span> <span class="nn">datetime</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="kn">from</span> <span class="nn">data_preparation_functions</span> <span class="kn">import</span> <span class="o">*</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">def</span> <span class="nf">grab_epl_data</span><span class="p">():</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>    <span class="c1"># Connect to football-data.co.uk</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;http://www.football-data.co.uk/englandm.php&quot;</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="c1"># Create a BeautifulSoup object</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>    <span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s1">&#39;lxml&#39;</span><span class="p">)</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>    <span class="c1"># Find the tables with the links to the data in them.</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>    <span class="n">table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;align&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;cellspacing&#39;</span><span class="p">:</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="s1">&#39;800&#39;</span><span class="p">})[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>    <span class="n">body</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;valign&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">})[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="c1"># Grab the urls for the csv files</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">links_text</span> <span class="o">=</span> <span class="p">[</span><span class="n">link_text</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">link_text</span> <span class="ow">in</span> <span class="n">body</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)]</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="n">data_urls</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="c1"># Create a list of links</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;http://www.football-data.co.uk/&#39;</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">links_text</span><span class="p">):</span>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;Premier League&#39;</span><span class="p">:</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>            <span class="n">data_urls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>    <span class="c1"># Get rid of last 11 uls as these don&#39;t include match stats and odds, and we</span>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="c1"># only want from 2005 onwards</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    <span class="n">data_urls</span> <span class="o">=</span> <span class="n">data_urls</span><span class="p">[:</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>    <span class="c1"># Iterate over the urls</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">data_urls</span><span class="p">:</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>        <span class="c1"># Get the season and make it a column</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>        <span class="n">season</span> <span class="o">=</span> <span class="n">url</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting data for season </span><span class="si">{</span><span class="n">season</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>        <span class="c1"># Read the data from the url into a DataFrame</span>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>        <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>        <span class="n">temp_df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">season</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>        <span class="c1"># Create helpful columns like Day, Month, Year, Date etc. so that our data is clean</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>        <span class="n">temp_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="n">temp_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">30</span><span class="p">)</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>                          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Day</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>                                  <span class="n">Month</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>                                  <span class="n">Year</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>                          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Month</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">Day</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">df</span><span class="o">.</span><span class="n">Year</span><span class="p">)</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>                          <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">))</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>                          <span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>        <span class="c1"># Append the temp_df to the main df</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>    <span class="c1"># Drop all NAs</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Finished grabbing data.&quot;</span><span class="p">)</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>    <span class="k">return</span> <span class="n">df</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">grab_epl_data</span><span class="p">()</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="c1"># df.to_csv(&quot;data/epl_data.csv&quot;, index=False)</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1819</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1718</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1617</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1516</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1415</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1314</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1213</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1112</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">1011</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0910</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0809</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0708</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0607</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a>    <span class="n">Getting</span> <span class="n">data</span> <span class="k">for</span> <span class="n">season</span> <span class="mi">0506</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>    <span class="n">Finished</span> <span class="n">grabbing</span> <span class="n">data</span><span class="o">.</span>
</code></pre></div>
<p>Whenever we want to update our data (for example if we want the most recent Gameweek included), all we have to do is run that function and then save the data to a csv with the commented out line above.</p>
<hr />
<h2 id="data-exploration">Data Exploration</h2>
<p>Now that we have our data, let's explore it. Let's first look at home team win rates since 2005 to see if there is a consistent trend. To get an idea of what our data looks like, we'll look at the tail of the dataset first.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>AC</th>
<th>AF</th>
<th>AR</th>
<th>AS</th>
<th>AST</th>
<th>AY</th>
<th>AwayTeam</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Date</th>
<th>Day</th>
<th>Div</th>
<th>FTAG</th>
<th>FTHG</th>
<th>FTR</th>
<th>HC</th>
<th>HF</th>
<th>HR</th>
<th>HS</th>
<th>HST</th>
<th>HTAG</th>
<th>HTHG</th>
<th>HTR</th>
<th>HY</th>
<th>HomeTeam</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>Referee</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>season</th>
</tr>
</thead>
<tbody>
<tr>
<td>28</td>
<td>3.0</td>
<td>11.0</td>
<td>0.0</td>
<td>9.0</td>
<td>3.0</td>
<td>2.0</td>
<td>Crystal Palace</td>
<td>3.00</td>
<td>3.25</td>
<td>2.60</td>
<td>2.95</td>
<td>3.1</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.71</td>
<td>2.13</td>
<td>2.92</td>
<td>1.73</td>
<td>2.16</td>
<td>3.22</td>
<td>2.55</td>
<td>1.79</td>
<td>2.21</td>
<td>3.04</td>
<td>1.77</td>
<td>2.23</td>
<td>3.36</td>
<td>2.66</td>
<td>39.0</td>
<td>2018-08-26</td>
<td>26</td>
<td>E0</td>
<td>1.0</td>
<td>2.0</td>
<td>H</td>
<td>6.0</td>
<td>14.0</td>
<td>0.0</td>
<td>13.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>4.0</td>
<td>Watford</td>
<td>2.95</td>
<td>3.20</td>
<td>2.5</td>
<td>2.90</td>
<td>3.1</td>
<td>2.50</td>
<td>08</td>
<td>A Taylor</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>18</td>
<td>1819</td>
</tr>
<tr>
<td>27</td>
<td>5.0</td>
<td>8.0</td>
<td>0.0</td>
<td>15.0</td>
<td>3.0</td>
<td>1.0</td>
<td>Chelsea</td>
<td>1.66</td>
<td>4.00</td>
<td>5.75</td>
<td>1.67</td>
<td>3.8</td>
<td>5.25</td>
<td>42.0</td>
<td>22.0</td>
<td>1.00</td>
<td>1.92</td>
<td>1.88</td>
<td>1.67</td>
<td>2.18</td>
<td>1.71</td>
<td>3.90</td>
<td>5.25</td>
<td>2.01</td>
<td>1.95</td>
<td>1.71</td>
<td>2.28</td>
<td>1.76</td>
<td>4.17</td>
<td>5.75</td>
<td>40.0</td>
<td>2018-08-26</td>
<td>26</td>
<td>E0</td>
<td>2.0</td>
<td>1.0</td>
<td>A</td>
<td>4.0</td>
<td>16.0</td>
<td>0.0</td>
<td>6.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>3.0</td>
<td>Newcastle</td>
<td>1.70</td>
<td>3.75</td>
<td>5.0</td>
<td>1.67</td>
<td>3.8</td>
<td>5.25</td>
<td>08</td>
<td>P Tierney</td>
<td>1.67</td>
<td>4.0</td>
<td>5.5</td>
<td>18</td>
<td>1819</td>
</tr>
<tr>
<td>29</td>
<td>2.0</td>
<td>16.0</td>
<td>0.0</td>
<td>9.0</td>
<td>5.0</td>
<td>4.0</td>
<td>Tottenham</td>
<td>2.90</td>
<td>3.30</td>
<td>2.62</td>
<td>2.90</td>
<td>3.2</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.79</td>
<td>2.03</td>
<td>2.86</td>
<td>1.72</td>
<td>2.18</td>
<td>3.27</td>
<td>2.56</td>
<td>1.84</td>
<td>2.10</td>
<td>3.00</td>
<td>1.76</td>
<td>2.25</td>
<td>3.40</td>
<td>2.67</td>
<td>40.0</td>
<td>2018-08-27</td>
<td>27</td>
<td>E0</td>
<td>3.0</td>
<td>0.0</td>
<td>A</td>
<td>5.0</td>
<td>11.0</td>
<td>0.0</td>
<td>23.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>2.0</td>
<td>Man United</td>
<td>2.75</td>
<td>3.25</td>
<td>2.6</td>
<td>2.75</td>
<td>3.2</td>
<td>2.55</td>
<td>08</td>
<td>C Pawson</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>18</td>
<td>1819</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Create Home Win, Draw Win and Away Win columns</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">homeWin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">),</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>              <span class="n">draw</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">),</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>              <span class="n">awayWin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">&lt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">))</span>
</code></pre></div>
<h3 id="home-ground-advantage">Home Ground Advantage</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">win_rates</span> <span class="o">=</span> \
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>    <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;homeWin&#39;</span><span class="p">,</span> <span class="s1">&#39;draw&#39;</span><span class="p">,</span> <span class="s1">&#39;awayWin&#39;</span><span class="p">]])</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="n">win_rates</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>homeWin</th>
<th>draw</th>
<th>awayWin</th>
</tr>
</thead>
<tbody>
<tr>
<td>season</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0506</td>
<td>0.505263</td>
<td>0.202632</td>
<td>0.292105</td>
</tr>
<tr>
<td>0607</td>
<td>0.477573</td>
<td>0.258575</td>
<td>0.263852</td>
</tr>
<tr>
<td>0708</td>
<td>0.463158</td>
<td>0.263158</td>
<td>0.273684</td>
</tr>
<tr>
<td>0809</td>
<td>0.453826</td>
<td>0.255937</td>
<td>0.290237</td>
</tr>
<tr>
<td>0910</td>
<td>0.507895</td>
<td>0.252632</td>
<td>0.239474</td>
</tr>
<tr>
<td>1011</td>
<td>0.471053</td>
<td>0.292105</td>
<td>0.236842</td>
</tr>
<tr>
<td>1112</td>
<td>0.450000</td>
<td>0.244737</td>
<td>0.305263</td>
</tr>
<tr>
<td>1213</td>
<td>0.433862</td>
<td>0.285714</td>
<td>0.280423</td>
</tr>
<tr>
<td>1314</td>
<td>0.472973</td>
<td>0.208108</td>
<td>0.318919</td>
</tr>
<tr>
<td>1415</td>
<td>0.453826</td>
<td>0.245383</td>
<td>0.300792</td>
</tr>
<tr>
<td>1516</td>
<td>0.414248</td>
<td>0.282322</td>
<td>0.303430</td>
</tr>
<tr>
<td>1617</td>
<td>0.492105</td>
<td>0.221053</td>
<td>0.286842</td>
</tr>
<tr>
<td>1718</td>
<td>0.455263</td>
<td>0.260526</td>
<td>0.284211</td>
</tr>
<tr>
<td>1819</td>
<td>0.466667</td>
<td>0.200000</td>
<td>0.333333</td>
</tr>
</tbody>
</table>
<h3 id="findings">Findings</h3>
<p>As we can see, winrates across home team wins, draws and away team wins are very consistent. It seems that the home team wins around 46-47% of the time, the draw happens about 25% of the time, and the away team wins about 27% of the time. Let's plot this DataFrame so that we can see the trend more easily.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="c1"># Set the style</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">home_line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win_rates</span><span class="o">.</span><span class="n">homeWin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Home Win Rate&#39;</span><span class="p">)</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="n">away_line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win_rates</span><span class="o">.</span><span class="n">awayWin</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Away Win Rate&#39;</span><span class="p">)</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">draw_line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">win_rates</span><span class="o">.</span><span class="n">draw</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Draw Win Rate&#39;</span><span class="p">)</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;season&quot;</span><span class="p">)</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Win Rate&quot;</span><span class="p">)</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Win Rates&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1"># Add the legend locations</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="n">home_legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">home_line</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">home_legend</span><span class="p">)</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="n">away_legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">away_line</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">))</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">away_legend</span><span class="p">)</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="n">draw_legend</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">draw_line</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.06</span><span class="p">))</span>
</code></pre></div>
<p><img alt="png" src="../img/output_10_0.png" /></p>
<p>As we can see, the winrates are relatively stable each season, except for in 14/15 when the home win rate drops dramatically.</p>
<p>Out of interest, let's also have a look at which team has the best home ground advantage. Let's define HGA as home win rate - away win rate. And then plot some of the big clubs' HGA against each other.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">home_win_rates</span> <span class="o">=</span> \
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">])</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    <span class="o">.</span><span class="n">homeWin</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>    <span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="n">away_win_rates</span> <span class="o">=</span> \
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;AwayTeam&#39;</span><span class="p">])</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>    <span class="o">.</span><span class="n">awayWin</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a>    <span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="n">hga</span> <span class="o">=</span> <span class="p">(</span><span class="n">home_win_rates</span> <span class="o">-</span> <span class="n">away_win_rates</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;HGA&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;HGA&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">hga</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>HomeTeam</th>
<th>HGA</th>
</tr>
</thead>
<tbody>
<tr>
<td>15</td>
<td>Fulham</td>
<td>0.315573</td>
</tr>
<tr>
<td>7</td>
<td>Brighton</td>
<td>0.304762</td>
</tr>
<tr>
<td>20</td>
<td>Man City</td>
<td>0.244980</td>
</tr>
<tr>
<td>14</td>
<td>Everton</td>
<td>0.241935</td>
</tr>
<tr>
<td>30</td>
<td>Stoke</td>
<td>0.241131</td>
</tr>
<tr>
<td>10</td>
<td>Charlton</td>
<td>0.236842</td>
</tr>
<tr>
<td>0</td>
<td>Arsenal</td>
<td>0.236140</td>
</tr>
<tr>
<td>27</td>
<td>Reading</td>
<td>0.234962</td>
</tr>
<tr>
<td>33</td>
<td>Tottenham</td>
<td>0.220207</td>
</tr>
<tr>
<td>21</td>
<td>Man United</td>
<td>0.215620</td>
</tr>
</tbody>
</table>
<p>So the club with the best HGA is Fulham - interesting. This is most likely because Fulham have won 100% of home games in 2018 so far which is skewing the mean. Let's see how the HGA for some of the big clubs based compare over seasons.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">big_clubs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Liverpool&#39;</span><span class="p">,</span> <span class="s1">&#39;Man City&#39;</span><span class="p">,</span> <span class="s1">&#39;Man United&#39;</span><span class="p">,</span> <span class="s1">&#39;Chelsea&#39;</span><span class="p">,</span> <span class="s1">&#39;Arsenal&#39;</span><span class="p">]</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">home_win_rates_5</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">HomeTeam</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">big_clubs</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">homeWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">away_win_rates_5</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">AwayTeam</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">big_clubs</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">awayWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="n">hga_top_5</span> <span class="o">=</span> <span class="n">home_win_rates_5</span> <span class="o">-</span> <span class="n">away_win_rates_5</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="n">hga_top_5</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>HomeTeam</th>
<th>Arsenal</th>
<th>Chelsea</th>
<th>Liverpool</th>
<th>Man City</th>
<th>Man United</th>
</tr>
</thead>
<tbody>
<tr>
<td>season</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>0506</td>
<td>0.421053</td>
<td>0.368421</td>
<td>0.263158</td>
<td>0.263158</td>
<td>0.052632</td>
</tr>
<tr>
<td>0607</td>
<td>0.263158</td>
<td>0.000000</td>
<td>0.421053</td>
<td>-0.052632</td>
<td>0.105263</td>
</tr>
<tr>
<td>0708</td>
<td>0.210526</td>
<td>-0.052632</td>
<td>0.157895</td>
<td>0.368421</td>
<td>0.368421</td>
</tr>
<tr>
<td>0809</td>
<td>0.105263</td>
<td>-0.157895</td>
<td>-0.052632</td>
<td>0.578947</td>
<td>0.210526</td>
</tr>
<tr>
<td>0910</td>
<td>0.368421</td>
<td>0.368421</td>
<td>0.421053</td>
<td>0.315789</td>
<td>0.263158</td>
</tr>
<tr>
<td>1011</td>
<td>0.157895</td>
<td>0.368421</td>
<td>0.368421</td>
<td>0.263158</td>
<td>0.684211</td>
</tr>
<tr>
<td>1112</td>
<td>0.157895</td>
<td>0.315789</td>
<td>-0.105263</td>
<td>0.421053</td>
<td>0.105263</td>
</tr>
<tr>
<td>1213</td>
<td>0.052632</td>
<td>0.105263</td>
<td>0.105263</td>
<td>0.248538</td>
<td>0.201754</td>
</tr>
<tr>
<td>1314</td>
<td>0.143275</td>
<td>0.251462</td>
<td>0.307018</td>
<td>0.362573</td>
<td>-0.026316</td>
</tr>
<tr>
<td>1415</td>
<td>0.131579</td>
<td>0.210526</td>
<td>0.105263</td>
<td>0.210526</td>
<td>0.421053</td>
</tr>
<tr>
<td>1516</td>
<td>0.210526</td>
<td>-0.105263</td>
<td>0.000000</td>
<td>0.263158</td>
<td>0.263158</td>
</tr>
<tr>
<td>1617</td>
<td>0.263158</td>
<td>0.210526</td>
<td>0.105263</td>
<td>-0.052632</td>
<td>-0.105263</td>
</tr>
<tr>
<td>1718</td>
<td>0.578947</td>
<td>0.052632</td>
<td>0.157895</td>
<td>0.000000</td>
<td>0.263158</td>
</tr>
<tr>
<td>1819</td>
<td>0.500000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.500000</td>
<td>0.500000</td>
</tr>
</tbody>
</table>
<p>Now let's plot it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">sns</span><span class="o">.</span><span class="n">lineplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;HGA&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">hga_top_5</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s1">&#39;HGA&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeTeam&#39;</span><span class="p">:</span> <span class="s1">&#39;team&#39;</span><span class="p">}))</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.45</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">))</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;HGA Among the top 5 clubs&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../img/output_17_0.png" /></p>
<p>The results here seem to be quite erratic, although it seems that Arsenal consistently has a HGA above 0.</p>
<p>Let's now look at the distributions of each of our columns. The odds columns are likely to be highly skewed, so we may have to account for this later.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>    <span class="n">sns</span><span class="o">.</span><span class="n">distplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Distribution for </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="png" src="../img/output_20_0.png" /></p>
<p><img alt="png" src="../img/output_20_1.png" /></p>
<p><img alt="png" src="../img/output_20_2.png" /></p>
<p><img alt="png" src="../img/output_20_3.png" /></p>
<p><img alt="png" src="../img/output_20_4.png" /></p>
<p><img alt="png" src="../img/output_20_5.png" /></p>
<p><img alt="png" src="../img/output_20_6.png" /></p>
<p><img alt="png" src="../img/output_20_7.png" /></p>
<p><img alt="png" src="../img/output_20_8.png" /></p>
<p><img alt="png" src="../img/output_20_9.png" /></p>
<p><img alt="png" src="../img/output_20_10.png" /></p>
<p><img alt="png" src="../img/output_20_11.png" /></p>
<p><img alt="png" src="../img/output_20_12.png" /></p>
<p><img alt="png" src="../img/output_20_13.png" /></p>
<p><img alt="png" src="../img/output_20_14.png" /></p>
<p><img alt="png" src="../img/output_20_15.png" /></p>
<p><img alt="png" src="../img/output_20_16.png" /></p>
<p><img alt="png" src="../img/output_20_17.png" /></p>
<p><img alt="png" src="../img/output_20_18.png" /></p>
<p><img alt="png" src="../img/output_20_19.png" /></p>
<p><img alt="png" src="../img/output_20_20.png" /></p>
<p><img alt="png" src="../img/output_20_21.png" /></p>
<p><img alt="png" src="../img/output_20_22.png" /></p>
<p><img alt="png" src="../img/output_20_23.png" /></p>
<p><img alt="png" src="../img/output_20_24.png" /></p>
<p><img alt="png" src="../img/output_20_25.png" /></p>
<p><img alt="png" src="../img/output_20_26.png" /></p>
<p><img alt="png" src="../img/output_20_27.png" /></p>
<p><img alt="png" src="../img/output_20_28.png" /></p>
<p><img alt="png" src="../img/output_20_29.png" /></p>
<p><img alt="png" src="../img/output_20_30.png" /></p>
<p><img alt="png" src="../img/output_20_31.png" /></p>
<p><img alt="png" src="../img/output_20_32.png" /></p>
<p><img alt="png" src="../img/output_20_33.png" /></p>
<p><img alt="png" src="../img/output_20_34.png" /></p>
<p><img alt="png" src="../img/output_20_35.png" /></p>
<p><img alt="png" src="../img/output_20_36.png" /></p>
<p><img alt="png" src="../img/output_20_37.png" /></p>
<p><img alt="png" src="../img/output_20_38.png" /></p>
<p><img alt="png" src="../img/output_20_39.png" /></p>
<p><img alt="png" src="../img/output_20_40.png" /></p>
<p><img alt="png" src="../img/output_20_41.png" /></p>
<p><img alt="png" src="../img/output_20_42.png" /></p>
<p><img alt="png" src="../img/output_20_43.png" /></p>
<p><img alt="png" src="../img/output_20_44.png" /></p>
<p><img alt="png" src="../img/output_20_45.png" /></p>
<p><img alt="png" src="../img/output_20_46.png" /></p>
<p><img alt="png" src="../img/output_20_47.png" /></p>
<p><img alt="png" src="../img/output_20_48.png" /></p>
<p><img alt="png" src="../img/output_20_49.png" /></p>
<p><img alt="png" src="../img/output_20_50.png" /></p>
<p><img alt="png" src="../img/output_20_51.png" /></p>
<p><img alt="png" src="../img/output_20_52.png" /></p>
<hr />
<h2 id="exploring-referee-home-ground-bias">Exploring Referee Home Ground Bias</h2>
<p>What may be of interest is whether certain referees are correlated with the home team winning more often. Let's explore referee home ground bias for referees for the top 10 Referees based on games.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Overall Home Win Rate: </span><span class="si">{:.4}</span><span class="s1">%&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">homeWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="c1"># Get the top 10 refs based on games</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="n">top_10_refs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">Referee</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">Referee</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">top_10_refs</span><span class="p">)]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;Referee&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">homeWin</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
    Overall Home Win Rate: 46.55%</p>
<div class="highlight"><pre><span></span><code>Referee
L Mason          0.510373
C Foy            0.500000
M Clattenburg    0.480000
M Jones          0.475248
P Dowd           0.469880
M Atkinson       0.469565
M Oliver         0.466019
H Webb           0.456604
A Marriner       0.455516
M Dean           0.442049
Name: homeWin, dtype: float64
</code></pre></div>
<p>It seems that L Mason may be the most influenced by the home crowd. Whilst the overall home win rate is 46.5%, the home win rate when he is the Referee is 51%. However it should be noted that this doesn't mean that he causes the win through bias. It could just be that he referees the best clubs, so naturally their home win rate is high.</p>
<hr />
<h2 id="variable-correlation-with-margin">Variable Correlation With Margin</h2>
<p>Let's now explore different variables' relationships with margin. First, we'll create a margin column, then we will pick a few different variables to look at the correlations amongst each other, using a correlation heatmap.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;FTHG&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;FTAG&#39;</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">stat_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AC&#39;</span><span class="p">,</span> <span class="s1">&#39;AF&#39;</span><span class="p">,</span> <span class="s1">&#39;AR&#39;</span><span class="p">,</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;AST&#39;</span><span class="p">,</span> <span class="s1">&#39;AY&#39;</span><span class="p">,</span> <span class="s1">&#39;HC&#39;</span><span class="p">,</span> <span class="s1">&#39;HF&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">,</span> <span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;HST&#39;</span><span class="p">,</span> <span class="s1">&#39;HTR&#39;</span><span class="p">,</span> <span class="s1">&#39;HY&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">]</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">stat_correlations</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">stat_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="n">stat_correlations</span><span class="p">[</span><span class="s1">&#39;margin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">()</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>    <span class="n">AST</span>      <span class="o">-</span><span class="mf">0.345703</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>    <span class="n">AS</span>       <span class="o">-</span><span class="mf">0.298665</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>    <span class="n">HY</span>       <span class="o">-</span><span class="mf">0.153806</span>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>    <span class="n">HR</span>       <span class="o">-</span><span class="mf">0.129393</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>    <span class="n">AC</span>       <span class="o">-</span><span class="mf">0.073204</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>    <span class="n">HF</span>       <span class="o">-</span><span class="mf">0.067469</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>    <span class="n">AF</span>        <span class="mf">0.005474</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a>    <span class="n">AY</span>        <span class="mf">0.013746</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>    <span class="n">HC</span>        <span class="mf">0.067433</span>
<a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a>    <span class="n">AR</span>        <span class="mf">0.103528</span>
<a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a>    <span class="n">HS</span>        <span class="mf">0.275847</span>
<a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a>    <span class="n">HST</span>       <span class="mf">0.367591</span>
<a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a>    <span class="n">margin</span>    <span class="mf">1.000000</span>
<a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a>    <span class="n">Name</span><span class="p">:</span> <span class="n">margin</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></div>
<p>Unsurprisingly, Home Shots on Target correlate the most with Margin, and Away Reds is also high. What is surprising is that Home Yellows has quite a strong negative correlation with margin - this may be because players will play more aggresively when they are losing to try and get the lead back, and hence receive more yellow cards.</p>
<p>Let's now look at the heatmap between variables.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">stat_correlations</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>    <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0x220a4227048</span><span class="o">&gt;</span>
</code></pre></div>
<p><img alt="png" src="../img/output_28_1.png" /></p>
<hr />
<h2 id="analysing-features">Analysing Features</h2>
<p>What we are really interested in, is how our features (creating in the next tutorial), correlate with winning. We will skip ahead here and use a function to create our features for us, and then examine how the moving averages/different features correlate with winning.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># Create a cleaned df of all of our data</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">pre_features_df</span> <span class="o">=</span> <span class="n">create_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># Create our features</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="n">features</span> <span class="o">=</span> <span class="n">create_feature_df</span><span class="p">(</span><span class="n">pre_features_df</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>    <span class="n">Creating</span> <span class="nb">all</span> <span class="n">games</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>    <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">wardj</span>\<span class="n">Documents</span>\<span class="n">Betfair</span> <span class="n">Public</span> <span class="n">Github</span>\<span class="n">predictive</span><span class="o">-</span><span class="n">models</span>\<span class="n">epl</span>\<span class="n">data_preparation_functions</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">419</span><span class="p">:</span> <span class="ne">RuntimeWarning</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">value</span> <span class="n">encountered</span> <span class="ow">in</span> <span class="n">double_scalars</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>      <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">eloAgainst</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">goalsForOrAgainstCol</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">eloAgainst</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>    <span class="n">Creating</span> <span class="n">stats</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>    <span class="n">Creating</span> <span class="n">odds</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>    <span class="n">Creating</span> <span class="n">market</span> <span class="n">values</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>    <span class="n">Filling</span> <span class="n">NAs</span>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a>    <span class="n">Merging</span> <span class="n">stats</span><span class="p">,</span> <span class="n">odds</span> <span class="ow">and</span> <span class="n">market</span> <span class="n">values</span> <span class="n">into</span> <span class="n">one</span> <span class="n">features</span> <span class="n">DataFrame</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a>    <span class="n">Complete</span><span class="o">.</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="n">features</span> <span class="o">=</span> <span class="p">(</span><span class="n">pre_features_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">FTAG</span><span class="p">)</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>                           <span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;margin&#39;</span><span class="p">]]</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>                           <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="n">features</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span><span class="o">.</span><span class="n">margin</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">20</span><span class="p">]</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>    <span class="n">margin</span>                     <span class="mf">1.000000</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="n">f_awayOdds</span>                 <span class="mf">0.413893</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>    <span class="n">f_totalMktH</span><span class="o">%</span>               <span class="mf">0.330420</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="n">f_defMktH</span><span class="o">%</span>                 <span class="mf">0.325392</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>    <span class="n">f_eloAgainstAway</span>           <span class="mf">0.317853</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>    <span class="n">f_eloForHome</span>               <span class="mf">0.317853</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>    <span class="n">f_midMktH</span><span class="o">%</span>                 <span class="mf">0.316080</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>    <span class="n">f_attMktH</span><span class="o">%</span>                 <span class="mf">0.312262</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>    <span class="n">f_sizeOfHandicapAway</span>       <span class="mf">0.301667</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>    <span class="n">f_goalsForHome</span>             <span class="mf">0.298930</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>    <span class="n">f_wtEloGoalsForHome</span>        <span class="mf">0.297157</span>
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>    <span class="n">f_shotsForHome</span>             <span class="mf">0.286239</span>
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>    <span class="n">f_cornersForHome</span>           <span class="mf">0.279917</span>
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>    <span class="n">f_gkMktH</span><span class="o">%</span>                  <span class="mf">0.274732</span>
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>    <span class="n">f_homeWinPc38Away</span>          <span class="mf">0.271326</span>
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>    <span class="n">f_homeWinPc38Home</span>          <span class="mf">0.271326</span>
<a id="__codelineno-18-19" name="__codelineno-18-19" href="#__codelineno-18-19"></a>    <span class="n">f_wtEloGoalsAgainstAway</span>    <span class="mf">0.269663</span>
<a id="__codelineno-18-20" name="__codelineno-18-20" href="#__codelineno-18-20"></a>    <span class="n">f_goalsAgainstAway</span>         <span class="mf">0.258418</span>
<a id="__codelineno-18-21" name="__codelineno-18-21" href="#__codelineno-18-21"></a>    <span class="n">f_cornersAgainstAway</span>       <span class="mf">0.257148</span>
<a id="__codelineno-18-22" name="__codelineno-18-22" href="#__codelineno-18-22"></a>    <span class="n">f_drawOdds</span>                 <span class="mf">0.256807</span>
<a id="__codelineno-18-23" name="__codelineno-18-23" href="#__codelineno-18-23"></a>    <span class="n">Name</span><span class="p">:</span> <span class="n">margin</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">float64</span>
</code></pre></div>
<p>As we can see away odds is most highly correlated to margin. This makes sense, as odds generally have most/all information included in the price. What is interesting is that elo seems to also be highly correlated, which is good news for our elo model that we made. Similarly, weighted goals and the the value of the defence relative to other teams ('defMktH%' etc.) is strongly correlated to margin.</p>
<hr />
<h1 id="02-data-preparation-feature-engineering">02. Data Preparation &amp; Feature Engineering</h1>
<p>Welcome to the second part of this Machine Learning Walkthrough. This tutorial will focus on data preparation and feature creation, before we dive into modelling in the next tutorial.</p>
<p>Specifically, this tutorial will cover a few things:</p>
<ol>
<li>Data wrangling specifically for sport</li>
<li>Feature creation - focussing on commonly used features in sports modelling, such as exponential moving averages</li>
<li>Using functions to modularise the data preparation process</li>
</ol>
<hr />
<h2 id="data-wrangling">Data Wrangling</h2>
<p>We will begin by utilising functions we have defined in our data_preparation_functions script to wrangle our data into a format that can be consumed by Machine Learning algorithms.</p>
<p>A typical issue faced by aspect of modelling sport is the issue of Machine Learning algorithms requiring all features for the teams playing to be on the same row of a table, whereas when we actual calculate these features, we usually require the teams to be on separate rows as it makes it a lot easier to calculate typical features, such as <a href="https://en.wikipedia.org/wiki/Moving_average#Exponential_moving_average">expontentially weighted moving averages</a>. We will explore this issue and show how we deal with issues like these.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="c1"># Import libraries</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="kn">from</span> <span class="nn">data_preparation_functions</span> <span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">log_loss</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">cross_val_score</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<p>We have created some functions which prepare the data for you. For thoroughly commented explanation of how the functions work, read through the data_preparation_functions.py script along side this walkthrough.</p>
<p>Essentially, each functions wrangles the data through a similar process. It first reads in the data from a csv file, then converts the columns to datatypes that we can work with, such as converting the Date column to a datetime data type. It then adds a Game ID column, so each game is easily identifiable and joined on. We then assign the DataFrame some other columns which may be useful, such as 'Year', 'Result' and 'homeWin'. Finally, we drop redundant column and return the DataFrame.</p>
<p>Let us now create six different DataFrames, which we will use to create features. Later, we will join these features back into one main feature DataFrame.</p>
<h3 id="create-6-distinct-dataframes">Create 6 distinct DataFrames</h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="c1"># This table includes all of our data in one big DataFrame</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="n">df</span> <span class="o">=</span> <span class="n">create_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>AC</th>
<th>AF</th>
<th>AR</th>
<th>AS</th>
<th>AST</th>
<th>AY</th>
<th>AwayTeam</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Date</th>
<th>Day</th>
<th>Div</th>
<th>FTAG</th>
<th>FTHG</th>
<th>FTR</th>
<th>HC</th>
<th>HF</th>
<th>HR</th>
<th>HS</th>
<th>HST</th>
<th>HTAG</th>
<th>HTHG</th>
<th>HTR</th>
<th>HY</th>
<th>HomeTeam</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>Referee</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>season</th>
<th>gameId</th>
<th>homeWin</th>
<th>awayWin</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>6.0</td>
<td>14.0</td>
<td>1.0</td>
<td>11.0</td>
<td>5.0</td>
<td>1.0</td>
<td>Blackburn</td>
<td>2.75</td>
<td>3.20</td>
<td>2.5</td>
<td>2.90</td>
<td>3.30</td>
<td>2.20</td>
<td>55.0</td>
<td>20.0</td>
<td>0.00</td>
<td>1.71</td>
<td>2.02</td>
<td>2.74</td>
<td>2.04</td>
<td>1.82</td>
<td>3.16</td>
<td>2.40</td>
<td>1.80</td>
<td>2.25</td>
<td>2.9</td>
<td>2.08</td>
<td>1.86</td>
<td>3.35</td>
<td>2.60</td>
<td>35.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>1.0</td>
<td>3.0</td>
<td>H</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>13.0</td>
<td>5.0</td>
<td>1.0</td>
<td>0.0</td>
<td>A</td>
<td>0.0</td>
<td>West Ham</td>
<td>2.7</td>
<td>3.0</td>
<td>2.3</td>
<td>2.75</td>
<td>3.0</td>
<td>2.38</td>
<td>8</td>
<td>A Wiley</td>
<td>2.75</td>
<td>3.25</td>
<td>2.4</td>
<td>2005</td>
<td>0506</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>home</td>
</tr>
<tr>
<td>1</td>
<td>8.0</td>
<td>16.0</td>
<td>0.0</td>
<td>13.0</td>
<td>6.0</td>
<td>2.0</td>
<td>Bolton</td>
<td>3.00</td>
<td>3.25</td>
<td>2.3</td>
<td>3.15</td>
<td>3.25</td>
<td>2.10</td>
<td>56.0</td>
<td>22.0</td>
<td>-0.25</td>
<td>1.70</td>
<td>2.01</td>
<td>3.05</td>
<td>1.84</td>
<td>2.01</td>
<td>3.16</td>
<td>2.20</td>
<td>1.87</td>
<td>2.20</td>
<td>3.4</td>
<td>1.92</td>
<td>2.10</td>
<td>3.30</td>
<td>2.40</td>
<td>36.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>2.0</td>
<td>2.0</td>
<td>D</td>
<td>7.0</td>
<td>14.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>D</td>
<td>0.0</td>
<td>Aston Villa</td>
<td>3.1</td>
<td>3.0</td>
<td>2.1</td>
<td>3.20</td>
<td>3.0</td>
<td>2.10</td>
<td>8</td>
<td>M Riley</td>
<td>3.10</td>
<td>3.25</td>
<td>2.2</td>
<td>2005</td>
<td>0506</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>draw</td>
</tr>
<tr>
<td>2</td>
<td>6.0</td>
<td>14.0</td>
<td>0.0</td>
<td>12.0</td>
<td>5.0</td>
<td>1.0</td>
<td>Man United</td>
<td>1.72</td>
<td>3.40</td>
<td>5.0</td>
<td>1.75</td>
<td>3.35</td>
<td>4.35</td>
<td>56.0</td>
<td>23.0</td>
<td>0.75</td>
<td>1.79</td>
<td>1.93</td>
<td>1.69</td>
<td>1.86</td>
<td>2.00</td>
<td>3.36</td>
<td>4.69</td>
<td>1.87</td>
<td>2.10</td>
<td>1.8</td>
<td>1.93</td>
<td>2.05</td>
<td>3.70</td>
<td>5.65</td>
<td>36.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>2.0</td>
<td>0.0</td>
<td>A</td>
<td>8.0</td>
<td>15.0</td>
<td>0.0</td>
<td>10.0</td>
<td>5.0</td>
<td>1.0</td>
<td>0.0</td>
<td>A</td>
<td>3.0</td>
<td>Everton</td>
<td>1.8</td>
<td>3.1</td>
<td>3.8</td>
<td>1.83</td>
<td>3.2</td>
<td>3.75</td>
<td>8</td>
<td>G Poll</td>
<td>1.80</td>
<td>3.30</td>
<td>4.5</td>
<td>2005</td>
<td>0506</td>
<td>3</td>
<td>0</td>
<td>1</td>
<td>away</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="c1"># This includes only the typical soccer stats, like home corners, home shots on target etc.</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="n">stats</span> <span class="o">=</span> <span class="n">create_stats_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="n">stats</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>FTHG</th>
<th>FTAG</th>
<th>HTHG</th>
<th>HTAG</th>
<th>HS</th>
<th>AS</th>
<th>HST</th>
<th>AST</th>
<th>HF</th>
<th>AF</th>
<th>HC</th>
<th>AC</th>
<th>HY</th>
<th>AY</th>
<th>HR</th>
<th>AR</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>West Ham</td>
<td>Blackburn</td>
<td>3.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
<td>13.0</td>
<td>11.0</td>
<td>5.0</td>
<td>5.0</td>
<td>11.0</td>
<td>14.0</td>
<td>2.0</td>
<td>6.0</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>1.0</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>Aston Villa</td>
<td>Bolton</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>3.0</td>
<td>13.0</td>
<td>2.0</td>
<td>6.0</td>
<td>14.0</td>
<td>16.0</td>
<td>7.0</td>
<td>8.0</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>Everton</td>
<td>Man United</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>1.0</td>
<td>10.0</td>
<td>12.0</td>
<td>5.0</td>
<td>5.0</td>
<td>15.0</td>
<td>14.0</td>
<td>8.0</td>
<td>6.0</td>
<td>3.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="c1"># This includes all of our betting related data, such as win/draw/lose odds, asian handicaps etc.</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="n">betting</span> <span class="o">=</span> <span class="n">create_betting_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="n">betting</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Day</th>
<th>Div</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>homeWin</th>
<th>awayWin</th>
<th>result</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>gameId</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2.75</td>
<td>3.20</td>
<td>2.5</td>
<td>2.90</td>
<td>3.30</td>
<td>2.20</td>
<td>55.0</td>
<td>20.0</td>
<td>0.00</td>
<td>1.71</td>
<td>2.02</td>
<td>2.74</td>
<td>2.04</td>
<td>1.82</td>
<td>3.16</td>
<td>2.40</td>
<td>1.80</td>
<td>2.25</td>
<td>2.9</td>
<td>2.08</td>
<td>1.86</td>
<td>3.35</td>
<td>2.60</td>
<td>35.0</td>
<td>13</td>
<td>E0</td>
<td>2.7</td>
<td>3.0</td>
<td>2.3</td>
<td>2.75</td>
<td>3.0</td>
<td>2.38</td>
<td>8</td>
<td>2.75</td>
<td>3.25</td>
<td>2.4</td>
<td>2005</td>
<td>1</td>
<td>0</td>
<td>home</td>
<td>West Ham</td>
<td>Blackburn</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>3.00</td>
<td>3.25</td>
<td>2.3</td>
<td>3.15</td>
<td>3.25</td>
<td>2.10</td>
<td>56.0</td>
<td>22.0</td>
<td>-0.25</td>
<td>1.70</td>
<td>2.01</td>
<td>3.05</td>
<td>1.84</td>
<td>2.01</td>
<td>3.16</td>
<td>2.20</td>
<td>1.87</td>
<td>2.20</td>
<td>3.4</td>
<td>1.92</td>
<td>2.10</td>
<td>3.30</td>
<td>2.40</td>
<td>36.0</td>
<td>13</td>
<td>E0</td>
<td>3.1</td>
<td>3.0</td>
<td>2.1</td>
<td>3.20</td>
<td>3.0</td>
<td>2.10</td>
<td>8</td>
<td>3.10</td>
<td>3.25</td>
<td>2.2</td>
<td>2005</td>
<td>0</td>
<td>0</td>
<td>draw</td>
<td>Aston Villa</td>
<td>Bolton</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>1.72</td>
<td>3.40</td>
<td>5.0</td>
<td>1.75</td>
<td>3.35</td>
<td>4.35</td>
<td>56.0</td>
<td>23.0</td>
<td>0.75</td>
<td>1.79</td>
<td>1.93</td>
<td>1.69</td>
<td>1.86</td>
<td>2.00</td>
<td>3.36</td>
<td>4.69</td>
<td>1.87</td>
<td>2.10</td>
<td>1.8</td>
<td>1.93</td>
<td>2.05</td>
<td>3.70</td>
<td>5.65</td>
<td>36.0</td>
<td>13</td>
<td>E0</td>
<td>1.8</td>
<td>3.1</td>
<td>3.8</td>
<td>1.83</td>
<td>3.2</td>
<td>3.75</td>
<td>8</td>
<td>1.80</td>
<td>3.30</td>
<td>4.5</td>
<td>2005</td>
<td>0</td>
<td>1</td>
<td>away</td>
<td>Everton</td>
<td>Man United</td>
<td>3</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="c1"># This includes all of the team information for each game.</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="n">team_info</span> <span class="o">=</span> <span class="n">create_team_info_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="n">team_info</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>Date</th>
<th>season</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>FTR</th>
<th>HTR</th>
<th>Referee</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>2005-08-13</td>
<td>0506</td>
<td>West Ham</td>
<td>Blackburn</td>
<td>H</td>
<td>A</td>
<td>A Wiley</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2005-08-13</td>
<td>0506</td>
<td>Aston Villa</td>
<td>Bolton</td>
<td>D</td>
<td>D</td>
<td>M Riley</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2005-08-13</td>
<td>0506</td>
<td>Everton</td>
<td>Man United</td>
<td>A</td>
<td>A</td>
<td>G Poll</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="c1"># Whilst the other DataFrames date back to 2005, this DataFrame has data from 2001 to 2005.</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="n">historic_games</span> <span class="o">=</span> <span class="n">create_historic_games_df</span><span class="p">(</span><span class="s1">&#39;data/historic_games_pre2005.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="n">historic_games</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>FTHG</th>
<th>FTAG</th>
<th>gameId</th>
<th>season</th>
<th>homeWin</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2001-08-18</td>
<td>Charlton</td>
<td>Everton</td>
<td>1</td>
<td>2</td>
<td>-1</td>
<td>20012002</td>
<td>0</td>
</tr>
<tr>
<td>1</td>
<td>2001-08-18</td>
<td>Derby</td>
<td>Blackburn</td>
<td>2</td>
<td>1</td>
<td>-1</td>
<td>20012002</td>
<td>1</td>
</tr>
<tr>
<td>2</td>
<td>2001-08-18</td>
<td>Leeds</td>
<td>Southampton</td>
<td>2</td>
<td>0</td>
<td>-1</td>
<td>20012002</td>
<td>1</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="c1"># This is the historic_games DataFrame appended to the df DataFrame.</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="n">all_games</span> <span class="o">=</span> <span class="n">create_all_games_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;data/historic_games_pre2005.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="n">all_games</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>FTHG</th>
<th>FTAG</th>
<th>gameId</th>
<th>season</th>
<th>homeWin</th>
<th>awayWin</th>
<th>homeWinPc5</th>
<th>homeWinPc38</th>
<th>awayWinPc5</th>
<th>awayWinPc38</th>
<th>gameIdHistoric</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2001-08-18</td>
<td>Charlton</td>
<td>Everton</td>
<td>1.0</td>
<td>2.0</td>
<td>-1</td>
<td>20012002</td>
<td>0</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>1</td>
</tr>
<tr>
<td>1</td>
<td>2001-08-18</td>
<td>Derby</td>
<td>Blackburn</td>
<td>2.0</td>
<td>1.0</td>
<td>-1</td>
<td>20012002</td>
<td>1</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2</td>
</tr>
<tr>
<td>2</td>
<td>2001-08-18</td>
<td>Leeds</td>
<td>Southampton</td>
<td>2.0</td>
<td>0.0</td>
<td>-1</td>
<td>20012002</td>
<td>1</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>3</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="feature-creation">Feature Creation</h2>
<p>Now that we have all of our pre-prepared DataFrames, and we know that the data is clean, we can move onto feature creation. As is common practice with sports modelling, we are going to start by creating expontentially weighted moving averages (EMA) as features. To get a better understanding of how EMAs work, read <a href="https://en.wikipedia.org/wiki/Moving_average#Exponential_moving_average">here</a>. </p>
<p>In short, an EMA is like a simple moving average, except it weights recent instances more than older instances based on an alpha parameter. The documentation for the pandas (emw method)[https://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.ewm.html] we will be using states that we can specify alpha in a number of ways. We will specify it in terms of span, where $\alpha = 2 / (span+1), span ≥ 1 $.</p>
<p>Let's first define a function which calculates the exponential moving average for each column in the stats DataFrame. We will then apply this function with other functions we have created, such as create_betting_features_ema, which creates moving averages of betting data.</p>
<p>However, we must first change the structure of our data. Notice that currently each row has both the Home Team's data and the Away Team's data on a single row. This makes it difficult to calculate rolling averages, so we will restructure our DataFrames to ensure each row only contains single team's data. To do this, we will define a function, reate_multiline_df_stats.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="c1"># Define a function which restructures our DataFrame</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="k">def</span> <span class="nf">create_multiline_df_stats</span><span class="p">(</span><span class="n">old_stats_df</span><span class="p">):</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>    <span class="c1"># Create a list of columns we want and their mappings to more interpretable names</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="n">home_stats_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;FTHG&#39;</span><span class="p">,</span> <span class="s1">&#39;FTAG&#39;</span><span class="p">,</span> <span class="s1">&#39;HTHG&#39;</span><span class="p">,</span> <span class="s1">&#39;HTAG&#39;</span><span class="p">,</span> <span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;HST&#39;</span><span class="p">,</span> <span class="s1">&#39;AST&#39;</span><span class="p">,</span> <span class="s1">&#39;HF&#39;</span><span class="p">,</span> <span class="s1">&#39;AF&#39;</span><span class="p">,</span> <span class="s1">&#39;HC&#39;</span><span class="p">,</span> <span class="s1">&#39;AC&#39;</span><span class="p">,</span> <span class="s1">&#39;HY&#39;</span><span class="p">,</span> <span class="s1">&#39;AY&#39;</span><span class="p">,</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>                       <span class="s1">&#39;HR&#39;</span><span class="p">,</span> <span class="s1">&#39;AR&#39;</span><span class="p">]</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a>    <span class="n">away_stats_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;FTAG&#39;</span><span class="p">,</span> <span class="s1">&#39;FTHG&#39;</span><span class="p">,</span> <span class="s1">&#39;HTAG&#39;</span><span class="p">,</span> <span class="s1">&#39;HTHG&#39;</span><span class="p">,</span> <span class="s1">&#39;AS&#39;</span><span class="p">,</span> <span class="s1">&#39;HS&#39;</span><span class="p">,</span> <span class="s1">&#39;AST&#39;</span><span class="p">,</span> <span class="s1">&#39;HST&#39;</span><span class="p">,</span> <span class="s1">&#39;AF&#39;</span><span class="p">,</span> <span class="s1">&#39;HF&#39;</span><span class="p">,</span> <span class="s1">&#39;AC&#39;</span><span class="p">,</span> <span class="s1">&#39;HC&#39;</span><span class="p">,</span> <span class="s1">&#39;AY&#39;</span><span class="p">,</span> <span class="s1">&#39;HY&#39;</span><span class="p">,</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>                       <span class="s1">&#39;AR&#39;</span><span class="p">,</span> <span class="s1">&#39;HR&#39;</span><span class="p">]</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a>    <span class="n">stats_cols_mapping</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;goalsFor&#39;</span><span class="p">,</span> <span class="s1">&#39;goalsAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;halfTimeGoalsFor&#39;</span><span class="p">,</span> <span class="s1">&#39;halfTimeGoalsAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;shotsFor&#39;</span><span class="p">,</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a>                          <span class="s1">&#39;shotsAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;shotsOnTargetFor&#39;</span><span class="p">,</span> <span class="s1">&#39;shotsOnTargetAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;freesFor&#39;</span><span class="p">,</span> <span class="s1">&#39;freesAgainst&#39;</span><span class="p">,</span> 
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>                          <span class="s1">&#39;cornersFor&#39;</span><span class="p">,</span> <span class="s1">&#39;cornersAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;yellowsFor&#39;</span><span class="p">,</span> <span class="s1">&#39;yellowsAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;redsFor&#39;</span><span class="p">,</span> <span class="s1">&#39;redsAgainst&#39;</span><span class="p">]</span>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a>    <span class="c1"># Create a dictionary of the old column names to new column names</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a>    <span class="n">home_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">old_col</span><span class="p">:</span> <span class="n">new_col</span> <span class="k">for</span> <span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">home_stats_cols</span><span class="p">,</span> <span class="n">stats_cols_mapping</span><span class="p">)}</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a>    <span class="n">away_mapping</span> <span class="o">=</span> <span class="p">{</span><span class="n">old_col</span><span class="p">:</span> <span class="n">new_col</span> <span class="k">for</span> <span class="n">old_col</span><span class="p">,</span> <span class="n">new_col</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">away_stats_cols</span><span class="p">,</span> <span class="n">stats_cols_mapping</span><span class="p">)}</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a>
<a id="__codelineno-26-18" name="__codelineno-26-18" href="#__codelineno-26-18"></a>    <span class="c1"># Put each team onto an individual row</span>
<a id="__codelineno-26-19" name="__codelineno-26-19" href="#__codelineno-26-19"></a>    <span class="n">multi_line_stats</span> <span class="o">=</span> <span class="p">(</span><span class="n">old_stats_df</span><span class="p">[[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">home_stats_cols</span><span class="p">]</span> <span class="c1"># Filter for only the home team columns</span>
<a id="__codelineno-26-20" name="__codelineno-26-20" href="#__codelineno-26-20"></a>                    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">home_mapping</span><span class="p">)</span> <span class="c1"># Rename the columns</span>
<a id="__codelineno-26-21" name="__codelineno-26-21" href="#__codelineno-26-21"></a>                    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">homeGame</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># Assign homeGame=1 so that we can use a general function later</span>
<a id="__codelineno-26-22" name="__codelineno-26-22" href="#__codelineno-26-22"></a>                    <span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">old_stats_df</span><span class="p">[[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">away_stats_cols</span><span class="p">])</span> <span class="c1"># Append the away team columns</span>
<a id="__codelineno-26-23" name="__codelineno-26-23" href="#__codelineno-26-23"></a>                            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">away_mapping</span><span class="p">)</span> <span class="c1"># Rename the away team columns</span>
<a id="__codelineno-26-24" name="__codelineno-26-24" href="#__codelineno-26-24"></a>                            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">homeGame</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-26-25" name="__codelineno-26-25" href="#__codelineno-26-25"></a>                    <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;gameId&#39;</span><span class="p">)</span> <span class="c1"># Sort the values</span>
<a id="__codelineno-26-26" name="__codelineno-26-26" href="#__codelineno-26-26"></a>                    <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<a id="__codelineno-26-27" name="__codelineno-26-27" href="#__codelineno-26-27"></a>    <span class="k">return</span> <span class="n">multi_line_stats</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="c1"># Define a function which creates an EMA DataFrame from the stats DataFrame</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="k">def</span> <span class="nf">create_stats_features_ema</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>    <span class="c1"># Create a restructured DataFrames so that we can calculate EMA</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a>    <span class="n">multi_line_stats</span> <span class="o">=</span> <span class="n">create_multiline_df_stats</span><span class="p">(</span><span class="n">stats</span><span class="p">)</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a>    <span class="c1"># Create a copy of the DataFrame</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>    <span class="n">ema_features</span> <span class="o">=</span> <span class="n">multi_line_stats</span><span class="p">[[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;homeGame&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a>    <span class="c1"># Get the columns that we want to create EMA for</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a>    <span class="n">feature_names</span> <span class="o">=</span> <span class="n">multi_line_stats</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;homeGame&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a>    <span class="c1"># Loop over the features</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a>    <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">feature_names</span><span class="p">:</span>
<a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a>        <span class="n">feature_ema</span> <span class="o">=</span> <span class="p">(</span><span class="n">multi_line_stats</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)[</span><span class="n">feature_name</span><span class="p">]</span> <span class="c1"># Calculate the EMA</span>
<a id="__codelineno-27-15" name="__codelineno-27-15" href="#__codelineno-27-15"></a>                                                  <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">ewm</span><span class="p">(</span><span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-27-16" name="__codelineno-27-16" href="#__codelineno-27-16"></a>                                                             <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-27-17" name="__codelineno-27-17" href="#__codelineno-27-17"></a>                                                             <span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="c1"># Shift the data down 1 so we don&#39;t leak data</span>
<a id="__codelineno-27-18" name="__codelineno-27-18" href="#__codelineno-27-18"></a>        <span class="n">ema_features</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">feature_ema</span> <span class="c1"># Add the new feature to the DataFrame</span>
<a id="__codelineno-27-19" name="__codelineno-27-19" href="#__codelineno-27-19"></a>    <span class="k">return</span> <span class="n">ema_features</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="c1"># Apply the function</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="n">stats_features</span> <span class="o">=</span> <span class="n">create_stats_features_ema</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="n">stats_features</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>team</th>
<th>homeGame</th>
<th>cornersAgainst</th>
<th>cornersFor</th>
<th>freesAgainst</th>
<th>freesFor</th>
<th>goalsAgainst</th>
<th>goalsFor</th>
<th>halfTimeGoalsAgainst</th>
<th>halfTimeGoalsFor</th>
<th>redsAgainst</th>
<th>redsFor</th>
<th>shotsAgainst</th>
<th>shotsFor</th>
<th>shotsOnTargetAgainst</th>
<th>shotsOnTargetFor</th>
<th>yellowsAgainst</th>
<th>yellowsFor</th>
</tr>
</thead>
<tbody>
<tr>
<td>9903</td>
<td>4952</td>
<td>Newcastle</td>
<td>1</td>
<td>4.301743</td>
<td>4.217300</td>
<td>11.789345</td>
<td>12.245066</td>
<td>0.797647</td>
<td>0.833658</td>
<td>0.644214</td>
<td>0.420832</td>
<td>2.323450e-10</td>
<td>3.333631e-01</td>
<td>11.335147</td>
<td>13.265955</td>
<td>3.211345</td>
<td>4.067990</td>
<td>1.848860</td>
<td>1.627140</td>
</tr>
<tr>
<td>9904</td>
<td>4953</td>
<td>Burnley</td>
<td>0</td>
<td>4.880132</td>
<td>5.165915</td>
<td>13.326703</td>
<td>8.800033</td>
<td>1.945502</td>
<td>0.667042</td>
<td>0.609440</td>
<td>0.529409</td>
<td>3.874405e-03</td>
<td>3.356120e-10</td>
<td>13.129631</td>
<td>10.642381</td>
<td>4.825874</td>
<td>3.970285</td>
<td>0.963527</td>
<td>0.847939</td>
</tr>
<tr>
<td>9905</td>
<td>4953</td>
<td>Fulham</td>
<td>1</td>
<td>4.550255</td>
<td>4.403060</td>
<td>10.188263</td>
<td>8.555589</td>
<td>2.531046</td>
<td>1.003553</td>
<td>0.860573</td>
<td>0.076949</td>
<td>1.002518e-04</td>
<td>8.670776e-03</td>
<td>17.463779</td>
<td>12.278877</td>
<td>8.334019</td>
<td>4.058213</td>
<td>0.980097</td>
<td>1.102974</td>
</tr>
<tr>
<td>9906</td>
<td>4954</td>
<td>Man United</td>
<td>1</td>
<td>3.832573</td>
<td>4.759683</td>
<td>11.640608</td>
<td>10.307946</td>
<td>1.397234</td>
<td>1.495032</td>
<td>1.034251</td>
<td>0.809280</td>
<td>6.683080e-05</td>
<td>1.320468e-05</td>
<td>8.963022</td>
<td>10.198642</td>
<td>3.216957</td>
<td>3.776900</td>
<td>1.040077</td>
<td>1.595650</td>
</tr>
<tr>
<td>9907</td>
<td>4954</td>
<td>Tottenham</td>
<td>0</td>
<td>3.042034</td>
<td>5.160211</td>
<td>8.991460</td>
<td>9.955635</td>
<td>1.332704</td>
<td>2.514789</td>
<td>0.573728</td>
<td>1.010491</td>
<td>4.522878e-08</td>
<td>1.354409e-05</td>
<td>12.543406</td>
<td>17.761004</td>
<td>3.757437</td>
<td>7.279845</td>
<td>1.478976</td>
<td>1.026601</td>
</tr>
</tbody>
</table>
<p>As we can see, we now have averages for each team. Let's create a quick table to see the top 10 teams' goalsFor average EMAs since 2005.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">stats_features</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;team&#39;</span><span class="p">)</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>                           <span class="o">.</span><span class="n">goalsFor</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a>                           <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>                           <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)[:</span><span class="mi">10</span><span class="p">])</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>goalsFor</th>
</tr>
</thead>
<tbody>
<tr>
<td>team</td>
<td></td>
</tr>
<tr>
<td>Man United</td>
<td>1.895026</td>
</tr>
<tr>
<td>Chelsea</td>
<td>1.888892</td>
</tr>
<tr>
<td>Arsenal</td>
<td>1.876770</td>
</tr>
<tr>
<td>Man City</td>
<td>1.835863</td>
</tr>
<tr>
<td>Liverpool</td>
<td>1.771125</td>
</tr>
<tr>
<td>Tottenham</td>
<td>1.655063</td>
</tr>
<tr>
<td>Leicester</td>
<td>1.425309</td>
</tr>
<tr>
<td>Blackpool</td>
<td>1.390936</td>
</tr>
<tr>
<td>Everton</td>
<td>1.387110</td>
</tr>
<tr>
<td>Southampton</td>
<td>1.288349</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="optimising-alpha">Optimising Alpha</h2>
<p>It looks like Man United and Chelsea have been two of the best teams since 2005, based on goalsFor. Now that we have our stats features, we may be tempted to move on. However, we have arbitrarily chosen a span of 5. How do we know that this is the best value? We don't. Let's try and optimise this value. </p>
<p>To do this, we will use a simple Logistic Regression model to create probabilistic predictions based on the stats features we created before. We will iterate a range of span values, from say, 3 to 15, and choose the value which produces a model with the lowest log loss, based on cross validation.</p>
<p>To do this, we need to restructure our DataFrame back to how it was before.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">def</span> <span class="nf">restructure_stats_features</span><span class="p">(</span><span class="n">stats_features</span><span class="p">):</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>    <span class="n">non_features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;homeGame&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;gameId&#39;</span><span class="p">]</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="n">stats_features_restructured</span> <span class="o">=</span> <span class="p">(</span><span class="n">stats_features</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;homeGame == 1&#39;</span><span class="p">)</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a>                                    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;f_&#39;</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;Home&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats_features</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">non_features</span><span class="p">})</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>                                    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;team&#39;</span><span class="p">:</span> <span class="s1">&#39;HomeTeam&#39;</span><span class="p">})</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a>                                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="p">(</span><span class="n">stats_features</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;homeGame == 0&#39;</span><span class="p">)</span>
<a id="__codelineno-30-8" name="__codelineno-30-8" href="#__codelineno-30-8"></a>                                                        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;team&#39;</span><span class="p">:</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">})</span>
<a id="__codelineno-30-9" name="__codelineno-30-9" href="#__codelineno-30-9"></a>                                                        <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;f_&#39;</span> <span class="o">+</span> <span class="n">col</span> <span class="o">+</span> <span class="s1">&#39;Away&#39;</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">stats_features</span><span class="o">.</span><span class="n">columns</span> 
<a id="__codelineno-30-10" name="__codelineno-30-10" href="#__codelineno-30-10"></a>                                                                         <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">non_features</span><span class="p">})),</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">])</span>
<a id="__codelineno-30-11" name="__codelineno-30-11" href="#__codelineno-30-11"></a>                                    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;gameId&#39;</span><span class="p">)</span>
<a id="__codelineno-30-12" name="__codelineno-30-12" href="#__codelineno-30-12"></a>                                    <span class="o">.</span><span class="n">dropna</span><span class="p">())</span>
<a id="__codelineno-30-13" name="__codelineno-30-13" href="#__codelineno-30-13"></a>    <span class="k">return</span> <span class="n">stats_features_restructured</span>
<a id="__codelineno-30-14" name="__codelineno-30-14" href="#__codelineno-30-14"></a>
<a id="__codelineno-30-15" name="__codelineno-30-15" href="#__codelineno-30-15"></a><span class="n">restructure_stats_features</span><span class="p">(</span><span class="n">stats_features</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>HomeTeam</th>
<th>homeGame_x</th>
<th>f_cornersAgainstHome</th>
<th>f_cornersForHome</th>
<th>f_freesAgainstHome</th>
<th>f_freesForHome</th>
<th>f_goalsAgainstHome</th>
<th>f_goalsForHome</th>
<th>f_halfTimeGoalsAgainstHome</th>
<th>f_halfTimeGoalsForHome</th>
<th>f_redsAgainstHome</th>
<th>f_redsForHome</th>
<th>f_shotsAgainstHome</th>
<th>f_shotsForHome</th>
<th>f_shotsOnTargetAgainstHome</th>
<th>f_shotsOnTargetForHome</th>
<th>f_yellowsAgainstHome</th>
<th>f_yellowsForHome</th>
<th>AwayTeam</th>
<th>homeGame_y</th>
<th>f_cornersAgainstAway</th>
<th>f_cornersForAway</th>
<th>f_freesAgainstAway</th>
<th>f_freesForAway</th>
<th>f_goalsAgainstAway</th>
<th>f_goalsForAway</th>
<th>f_halfTimeGoalsAgainstAway</th>
<th>f_halfTimeGoalsForAway</th>
<th>f_redsAgainstAway</th>
<th>f_redsForAway</th>
<th>f_shotsAgainstAway</th>
<th>f_shotsForAway</th>
<th>f_shotsOnTargetAgainstAway</th>
<th>f_shotsOnTargetForAway</th>
<th>f_yellowsAgainstAway</th>
<th>f_yellowsForAway</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr>
<td>20</td>
<td>21</td>
<td>Birmingham</td>
<td>1</td>
<td>4.8</td>
<td>7.8</td>
<td>12.0</td>
<td>9.4</td>
<td>1.2</td>
<td>0.6</td>
<td>0.6</td>
<td>0.6</td>
<td>0.0</td>
<td>0.0</td>
<td>11.4</td>
<td>8.2</td>
<td>6.4</td>
<td>2.8</td>
<td>1.0</td>
<td>2.6</td>
<td>Middlesbrough</td>
<td>0</td>
<td>3.0</td>
<td>5.6</td>
<td>14.0</td>
<td>12.8</td>
<td>1.2</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.4</td>
<td>17.2</td>
<td>8.8</td>
<td>7.6</td>
<td>2.6</td>
<td>3.0</td>
<td>1.4</td>
<td>away</td>
</tr>
<tr>
<td>21</td>
<td>22</td>
<td>Portsmouth</td>
<td>1</td>
<td>2.6</td>
<td>4.6</td>
<td>21.8</td>
<td>16.6</td>
<td>2.0</td>
<td>0.6</td>
<td>1.0</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>8.0</td>
<td>10.4</td>
<td>3.6</td>
<td>4.0</td>
<td>3.2</td>
<td>1.8</td>
<td>Aston Villa</td>
<td>0</td>
<td>9.8</td>
<td>7.0</td>
<td>14.2</td>
<td>18.2</td>
<td>1.4</td>
<td>0.8</td>
<td>0.8</td>
<td>0.8</td>
<td>0.0</td>
<td>0.0</td>
<td>16.0</td>
<td>3.0</td>
<td>9.6</td>
<td>2.6</td>
<td>2.0</td>
<td>0.6</td>
<td>draw</td>
</tr>
<tr>
<td>22</td>
<td>23</td>
<td>Sunderland</td>
<td>1</td>
<td>5.0</td>
<td>5.0</td>
<td>11.6</td>
<td>18.0</td>
<td>1.8</td>
<td>0.4</td>
<td>1.0</td>
<td>0.4</td>
<td>0.4</td>
<td>0.6</td>
<td>14.6</td>
<td>6.0</td>
<td>5.2</td>
<td>3.2</td>
<td>1.2</td>
<td>2.6</td>
<td>Man City</td>
<td>0</td>
<td>7.8</td>
<td>3.6</td>
<td>8.6</td>
<td>12.4</td>
<td>0.6</td>
<td>1.2</td>
<td>0.6</td>
<td>0.6</td>
<td>0.0</td>
<td>0.0</td>
<td>10.6</td>
<td>11.4</td>
<td>2.4</td>
<td>6.8</td>
<td>3.0</td>
<td>1.4</td>
<td>away</td>
</tr>
<tr>
<td>23</td>
<td>24</td>
<td>Arsenal</td>
<td>1</td>
<td>3.0</td>
<td>7.4</td>
<td>17.0</td>
<td>18.6</td>
<td>0.6</td>
<td>0.8</td>
<td>0.0</td>
<td>0.0</td>
<td>0.4</td>
<td>0.0</td>
<td>6.2</td>
<td>11.4</td>
<td>4.0</td>
<td>6.6</td>
<td>1.6</td>
<td>1.8</td>
<td>Fulham</td>
<td>0</td>
<td>7.2</td>
<td>3.0</td>
<td>20.8</td>
<td>13.2</td>
<td>1.2</td>
<td>0.6</td>
<td>0.6</td>
<td>0.0</td>
<td>0.0</td>
<td>0.0</td>
<td>12.4</td>
<td>10.8</td>
<td>7.0</td>
<td>5.2</td>
<td>2.0</td>
<td>1.6</td>
<td>home</td>
</tr>
<tr>
<td>24</td>
<td>25</td>
<td>Blackburn</td>
<td>1</td>
<td>1.4</td>
<td>7.2</td>
<td>12.8</td>
<td>21.2</td>
<td>1.8</td>
<td>1.6</td>
<td>0.0</td>
<td>1.0</td>
<td>0.0</td>
<td>0.4</td>
<td>10.0</td>
<td>14.0</td>
<td>4.4</td>
<td>7.4</td>
<td>1.2</td>
<td>1.6</td>
<td>Tottenham</td>
<td>0</td>
<td>6.4</td>
<td>3.8</td>
<td>11.2</td>
<td>18.8</td>
<td>0.0</td>
<td>2.0</td>
<td>0.0</td>
<td>0.4</td>
<td>0.0</td>
<td>0.0</td>
<td>11.6</td>
<td>15.2</td>
<td>4.6</td>
<td>7.2</td>
<td>0.6</td>
<td>2.6</td>
<td>draw</td>
</tr>
</tbody>
</table>
<p>Now let's write a function that optimises our span based on log loss of the output of a Logistic Regression model.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">def</span> <span class="nf">optimise_alpha</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>    <span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">result</span><span class="p">)</span> <span class="c1"># Encode the result from away, draw, home win to 0, 1, 2</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>    <span class="n">X</span> <span class="o">=</span> <span class="n">features</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;f_&#39;</span><span class="p">)]]</span> <span class="c1"># Only get the features - these all start with f_</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>    <span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>    <span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>    <span class="n">ave_cv_score</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">lr</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_log_loss&#39;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfold</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a>    <span class="k">return</span> <span class="n">ave_cv_score</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="n">best_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="n">best_span</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="n">cv_scores</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="c1"># Iterate over a range of spans</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="k">for</span> <span class="n">span</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>    <span class="n">stats_features</span> <span class="o">=</span> <span class="n">create_stats_features_ema</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="n">span</span><span class="p">)</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>    <span class="n">restructured_stats_features</span> <span class="o">=</span> <span class="n">restructure_stats_features</span><span class="p">(</span><span class="n">stats_features</span><span class="p">)</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a>    <span class="n">cv_score</span> <span class="o">=</span> <span class="n">optimise_alpha</span><span class="p">(</span><span class="n">restructured_stats_features</span><span class="p">)</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a>    <span class="n">cv_scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cv_score</span><span class="p">)</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a>    <span class="k">if</span> <span class="n">cv_score</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>        <span class="n">best_score</span> <span class="o">=</span> <span class="n">cv_score</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a>        <span class="n">best_span</span> <span class="o">=</span> <span class="n">span</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;ggplot&#39;</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">cv_scores</span><span class="p">)</span><span class="o">*-</span><span class="mi">1</span><span class="p">))</span> <span class="c1"># Plot our results</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Optimising alpha&quot;</span><span class="p">)</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Span&quot;</span><span class="p">)</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Log Loss&quot;</span><span class="p">)</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Our lowest log loss (</span><span class="si">{:2f}</span><span class="s2">) occurred at a span of </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_score</span><span class="p">,</span> <span class="n">best_span</span><span class="p">))</span>
</code></pre></div>
<p><img alt="png" src="../img/output_20_0_EPL.png" /></p>
<div class="highlight"><pre><span></span><code>Our lowest log loss (0.980835) occurred at a span of 55
</code></pre></div>
<p>The above method is just an example of how you can optimise hyparameters. Obviously this example has many limitations, such as attempting to optimise each statistic with the same alpha. However, for the rest of these tutorial series we will use this span value.</p>
<p>Now let's create the rest of our features. For thorough explanations and the actual code behind some of the functions used, please refer to the data_preparation_functions.py script.</p>
<hr />
<h2 id="creating-our-features-dataframe">Creating our Features DataFrame</h2>
<p>We will utilise pre-made functions to create all of our features in just a few lines of code.</p>
<p>As part of this process we will create features which include margin weighted elo, an exponential average for asian handicap data, and odds as features.</p>
<p>Our Elo function is essentially the same as the one we created in the AFL tutorial; if you would like to know more about Elo models please read <a href="https://en.wikipedia.org/wiki/Elo_rating_system">this</a> article.</p>
<p>Note that the cell below may take a few minutes to run.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1"># Create feature DataFrames</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="n">features_all_games</span> <span class="o">=</span> <span class="n">create_all_games_features</span><span class="p">(</span><span class="n">all_games</span><span class="p">)</span>
</code></pre></div>
    C:\Users\wardj\Documents\Betfair Public Github\predictive-models\epl\data_preparation_functions.py:419: RuntimeWarning: invalid value encountered in double_scalars
      .pipe(lambda df: (df.eloAgainst * df[goalsForOrAgainstCol]).sum() / df.eloAgainst.sum()))</p>
<p>The features_all_games df includes elo for each team, as well as their win percentage at home and away over the past 5 and 38 games. For more information on how it was calculated, read through the data_preparation_functions script.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="n">features_all_games</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>awayWin</th>
<th>awayWinPc38</th>
<th>awayWinPc5</th>
<th>eloAgainst</th>
<th>eloFor</th>
<th>gameId</th>
<th>gameIdHistoric</th>
<th>goalsAgainst</th>
<th>goalsFor</th>
<th>homeGame</th>
<th>homeWin</th>
<th>homeWinPc38</th>
<th>homeWinPc5</th>
<th>season</th>
<th>team</th>
<th>wtEloGoalsFor</th>
<th>wtEloGoalsAgainst</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2001-08-18</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1500.0</td>
<td>1500.0</td>
<td>-1</td>
<td>1</td>
<td>2.0</td>
<td>1.0</td>
<td>1</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>20012002</td>
<td>Charlton</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td>1</td>
<td>2001-08-18</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>1500.0</td>
<td>1500.0</td>
<td>-1</td>
<td>1</td>
<td>1.0</td>
<td>2.0</td>
<td>0</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>20012002</td>
<td>Everton</td>
<td>NaN</td>
<td>NaN</td>
</tr>
<tr>
<td>2</td>
<td>2001-08-18</td>
<td>0</td>
<td>NaN</td>
<td>NaN</td>
<td>1500.0</td>
<td>1500.0</td>
<td>-1</td>
<td>2</td>
<td>1.0</td>
<td>2.0</td>
<td>1</td>
<td>1</td>
<td>NaN</td>
<td>NaN</td>
<td>20012002</td>
<td>Derby</td>
<td>NaN</td>
<td>NaN</td>
</tr>
</tbody>
</table>
<p>The features_stats df includes all the expontential weighted averages for each stat in the stats df.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1"># Create feature stats df</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="n">features_stats</span> <span class="o">=</span> <span class="n">create_stats_features_ema</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="n">best_span</span><span class="p">)</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="n">features_stats</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>team</th>
<th>homeGame</th>
<th>cornersAgainst</th>
<th>cornersFor</th>
<th>freesAgainst</th>
<th>freesFor</th>
<th>goalsAgainst</th>
<th>goalsFor</th>
<th>halfTimeGoalsAgainst</th>
<th>halfTimeGoalsFor</th>
<th>redsAgainst</th>
<th>redsFor</th>
<th>shotsAgainst</th>
<th>shotsFor</th>
<th>shotsOnTargetAgainst</th>
<th>shotsOnTargetFor</th>
<th>yellowsAgainst</th>
<th>yellowsFor</th>
</tr>
</thead>
<tbody>
<tr>
<td>9905</td>
<td>4953</td>
<td>Fulham</td>
<td>1</td>
<td>6.006967</td>
<td>5.045733</td>
<td>10.228997</td>
<td>9.965651</td>
<td>2.147069</td>
<td>1.093550</td>
<td>0.630485</td>
<td>0.364246</td>
<td>0.032937</td>
<td>0.043696</td>
<td>16.510067</td>
<td>11.718122</td>
<td>7.184386</td>
<td>4.645762</td>
<td>1.310424</td>
<td>1.389716</td>
</tr>
<tr>
<td>9906</td>
<td>4954</td>
<td>Man United</td>
<td>1</td>
<td>4.463018</td>
<td>5.461075</td>
<td>11.605712</td>
<td>10.870367</td>
<td>0.843222</td>
<td>1.586308</td>
<td>0.427065</td>
<td>0.730650</td>
<td>0.042588</td>
<td>0.027488</td>
<td>10.865754</td>
<td>13.003121</td>
<td>3.562675</td>
<td>4.626450</td>
<td>1.740735</td>
<td>1.712785</td>
</tr>
<tr>
<td>9907</td>
<td>4954</td>
<td>Tottenham</td>
<td>0</td>
<td>3.868619</td>
<td>6.362901</td>
<td>10.784145</td>
<td>10.140388</td>
<td>0.954928</td>
<td>2.100166</td>
<td>0.439129</td>
<td>0.799968</td>
<td>0.024351</td>
<td>0.026211</td>
<td>9.947515</td>
<td>16.460598</td>
<td>3.370010</td>
<td>6.136120</td>
<td>1.925005</td>
<td>1.364268</td>
</tr>
</tbody>
</table>
<p>The features_odds df includes a moving average of some of the odds data.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1"># Create feature_odds df</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="n">features_odds</span> <span class="o">=</span> <span class="n">create_betting_features_ema</span><span class="p">(</span><span class="n">betting</span><span class="p">,</span> <span class="n">span</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="n">features_odds</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>team</th>
<th>avAsianHandicapOddsAgainst</th>
<th>avAsianHandicapOddsFor</th>
<th>avgreaterthan2.5</th>
<th>avlessthan2.5</th>
<th>sizeOfHandicap</th>
</tr>
</thead>
<tbody>
<tr>
<td>9905</td>
<td>4953</td>
<td>Fulham</td>
<td>1.884552</td>
<td>1.985978</td>
<td>1.756776</td>
<td>2.128261</td>
<td>0.502253</td>
</tr>
<tr>
<td>9906</td>
<td>4954</td>
<td>Man United</td>
<td>1.871586</td>
<td>2.031787</td>
<td>1.900655</td>
<td>1.963478</td>
<td>-0.942445</td>
</tr>
<tr>
<td>9907</td>
<td>4954</td>
<td>Tottenham</td>
<td>1.947833</td>
<td>1.919607</td>
<td>1.629089</td>
<td>2.383593</td>
<td>-1.235630</td>
</tr>
</tbody>
</table>
<p>The features market values has market values and the % of total market for each position. These values are in millions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="c1"># Create feature market values df</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="n">features_market_values</span> <span class="o">=</span> <span class="n">create_market_values_features</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="c1"># This creates a df with one game per row</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="n">features_market_values</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>gameId</th>
<th>Year</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>defMktValH</th>
<th>attMktValH</th>
<th>gkMktValH</th>
<th>totalMktValH</th>
<th>midMktValH</th>
<th>defMktValA</th>
<th>attMktValA</th>
<th>gkMktValA</th>
<th>totalMktValA</th>
<th>midMktValA</th>
<th>attMktH%</th>
<th>attMktA%</th>
<th>midMktH%</th>
<th>midMktA%</th>
<th>defMktH%</th>
<th>defMktA%</th>
<th>gkMktH%</th>
<th>gkMktA%</th>
<th>totalMktH%</th>
<th>totalMktA%</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>1</td>
<td>2005</td>
<td>West Ham</td>
<td>Blackburn</td>
<td>16.90</td>
<td>18.50</td>
<td>6.40</td>
<td>46.40</td>
<td>4.60</td>
<td>27.25</td>
<td>13.00</td>
<td>3.25</td>
<td>70.70</td>
<td>27.20</td>
<td>2.252911</td>
<td>1.583126</td>
<td>0.588168</td>
<td>3.477861</td>
<td>2.486940</td>
<td>4.010007</td>
<td>4.524247</td>
<td>2.297469</td>
<td>1.913986</td>
<td>2.916354</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>2005</td>
<td>Aston Villa</td>
<td>Bolton</td>
<td>27.63</td>
<td>31.85</td>
<td>7.60</td>
<td>105.83</td>
<td>38.75</td>
<td>9.60</td>
<td>24.55</td>
<td>8.50</td>
<td>72.40</td>
<td>29.75</td>
<td>3.878659</td>
<td>2.989673</td>
<td>4.954673</td>
<td>3.803910</td>
<td>4.065926</td>
<td>1.412700</td>
<td>5.372543</td>
<td>6.008766</td>
<td>4.365456</td>
<td>2.986478</td>
</tr>
<tr>
<td>2</td>
<td>3</td>
<td>2005</td>
<td>Everton</td>
<td>Man United</td>
<td>44.35</td>
<td>31.38</td>
<td>8.55</td>
<td>109.78</td>
<td>25.50</td>
<td>82.63</td>
<td>114.60</td>
<td>9.25</td>
<td>288.48</td>
<td>82.00</td>
<td>3.821423</td>
<td>13.955867</td>
<td>3.260494</td>
<td>10.484727</td>
<td>6.526378</td>
<td>12.159517</td>
<td>6.044111</td>
<td>6.538951</td>
<td>4.528392</td>
<td>11.899714</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="n">all_games_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;homeGame&#39;</span><span class="p">,</span> <span class="s1">&#39;homeWinPc38&#39;</span><span class="p">,</span> <span class="s1">&#39;homeWinPc5&#39;</span><span class="p">,</span> <span class="s1">&#39;awayWinPc38&#39;</span><span class="p">,</span> <span class="s1">&#39;awayWinPc5&#39;</span><span class="p">,</span> <span class="s1">&#39;eloFor&#39;</span><span class="p">,</span> <span class="s1">&#39;eloAgainst&#39;</span><span class="p">,</span> <span class="s1">&#39;wtEloGoalsFor&#39;</span><span class="p">,</span> <span class="s1">&#39;wtEloGoalsAgainst&#39;</span><span class="p">]</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="c1"># Join the features together</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="n">features_multi_line</span> <span class="o">=</span> <span class="p">(</span><span class="n">features_all_games</span><span class="p">[</span><span class="n">all_games_cols</span><span class="p">]</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>                                         <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">features_stats</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;homeGame&#39;</span><span class="p">),</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">])</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>                                         <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">features_odds</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;team&#39;</span><span class="p">]))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1"># Put each instance on an individual row</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="n">features_with_na</span> <span class="o">=</span> <span class="n">put_features_on_one_line</span><span class="p">(</span><span class="n">features_multi_line</span><span class="p">)</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="n">market_val_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;attMktH%&#39;</span><span class="p">,</span> <span class="s1">&#39;attMktA%&#39;</span><span class="p">,</span> <span class="s1">&#39;midMktH%&#39;</span><span class="p">,</span> <span class="s1">&#39;midMktA%&#39;</span><span class="p">,</span> <span class="s1">&#39;defMktH%&#39;</span><span class="p">,</span> <span class="s1">&#39;defMktA%&#39;</span><span class="p">,</span> <span class="s1">&#39;gkMktH%&#39;</span><span class="p">,</span> <span class="s1">&#39;gkMktA%&#39;</span><span class="p">,</span> <span class="s1">&#39;totalMktH%&#39;</span><span class="p">,</span> <span class="s1">&#39;totalMktA%&#39;</span><span class="p">]</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="c1"># Merge our team values dataframe to features and result from df</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="n">features_with_na</span> <span class="o">=</span> <span class="p">(</span><span class="n">features_with_na</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="p">(</span><span class="n">features_market_values</span><span class="p">[</span><span class="n">market_val_feature_names</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]])</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>                                                      <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">col</span><span class="p">:</span> <span class="s1">&#39;f_&#39;</span> <span class="o">+</span> <span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">market_val_feature_names</span><span class="p">}),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;gameId&#39;</span><span class="p">)</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>                            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;gameId&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">,</span> <span class="s1">&#39;B365A&#39;</span><span class="p">,</span> <span class="s1">&#39;B365D&#39;</span><span class="p">,</span> <span class="s1">&#39;B365H&#39;</span><span class="p">]],</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;gameId&#39;</span><span class="p">]))</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="c1"># Drop NAs from calculating the rolling averages - don&#39;t drop Win Pc 38 and Win Pc 5 columns</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="n">features</span> <span class="o">=</span> <span class="n">features_with_na</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="n">features_with_na</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">features_with_na</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;WinPc&#39;</span> <span class="ow">in</span> <span class="n">col</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="c1"># Fill NAs for the Win Pc columns</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="n">features</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="n">features</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>gameId</th>
<th>HomeTeam</th>
<th>season</th>
<th>homeGame</th>
<th>f_homeWinPc38Home</th>
<th>f_homeWinPc5Home</th>
<th>f_awayWinPc38Home</th>
<th>f_awayWinPc5Home</th>
<th>f_eloForHome</th>
<th>f_eloAgainstHome</th>
<th>f_wtEloGoalsForHome</th>
<th>f_wtEloGoalsAgainstHome</th>
<th>f_cornersAgainstHome</th>
<th>f_cornersForHome</th>
<th>f_freesAgainstHome</th>
<th>f_freesForHome</th>
<th>f_goalsAgainstHome</th>
<th>f_goalsForHome</th>
<th>f_halfTimeGoalsAgainstHome</th>
<th>f_halfTimeGoalsForHome</th>
<th>f_redsAgainstHome</th>
<th>f_redsForHome</th>
<th>f_shotsAgainstHome</th>
<th>f_shotsForHome</th>
<th>f_shotsOnTargetAgainstHome</th>
<th>f_shotsOnTargetForHome</th>
<th>f_yellowsAgainstHome</th>
<th>f_yellowsForHome</th>
<th>f_avAsianHandicapOddsAgainstHome</th>
<th>f_avAsianHandicapOddsForHome</th>
<th>f_avgreaterthan2.5Home</th>
<th>f_avlessthan2.5Home</th>
<th>f_sizeOfHandicapHome</th>
<th>AwayTeam</th>
<th>f_homeWinPc38Away</th>
<th>f_homeWinPc5Away</th>
<th>f_awayWinPc38Away</th>
<th>f_awayWinPc5Away</th>
<th>f_eloForAway</th>
<th>f_eloAgainstAway</th>
<th>f_wtEloGoalsForAway</th>
<th>f_wtEloGoalsAgainstAway</th>
<th>f_cornersAgainstAway</th>
<th>f_cornersForAway</th>
<th>f_freesAgainstAway</th>
<th>f_freesForAway</th>
<th>f_goalsAgainstAway</th>
<th>f_goalsForAway</th>
<th>f_halfTimeGoalsAgainstAway</th>
<th>f_halfTimeGoalsForAway</th>
<th>f_redsAgainstAway</th>
<th>f_redsForAway</th>
<th>f_shotsAgainstAway</th>
<th>f_shotsForAway</th>
<th>f_shotsOnTargetAgainstAway</th>
<th>f_shotsOnTargetForAway</th>
<th>f_yellowsAgainstAway</th>
<th>f_yellowsForAway</th>
<th>f_avAsianHandicapOddsAgainstAway</th>
<th>f_avAsianHandicapOddsForAway</th>
<th>f_avgreaterthan2.5Away</th>
<th>f_avlessthan2.5Away</th>
<th>f_sizeOfHandicapAway</th>
<th>attMktH%</th>
<th>attMktA%</th>
<th>midMktH%</th>
<th>midMktA%</th>
<th>defMktH%</th>
<th>defMktA%</th>
<th>gkMktH%</th>
<th>gkMktA%</th>
<th>totalMktH%</th>
<th>totalMktA%</th>
<th>result</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
</tr>
</thead>
<tbody>
<tr>
<td>20</td>
<td>2005-08-23</td>
<td>21</td>
<td>Birmingham</td>
<td>0506</td>
<td>1</td>
<td>0.394737</td>
<td>0.4</td>
<td>0.263158</td>
<td>0.2</td>
<td>1478.687038</td>
<td>1492.866048</td>
<td>1.061763</td>
<td>1.260223</td>
<td>4.981818</td>
<td>7.527273</td>
<td>12.000000</td>
<td>9.945455</td>
<td>1.018182</td>
<td>0.509091</td>
<td>0.509091</td>
<td>0.509091</td>
<td>0.000000</td>
<td>0.000000</td>
<td>11.945455</td>
<td>8.018182</td>
<td>6.490909</td>
<td>2.981818</td>
<td>1.000000</td>
<td>2.509091</td>
<td>1.9090</td>
<td>1.9455</td>
<td>2.0510</td>
<td>1.6735</td>
<td>-0.1375</td>
<td>Middlesbrough</td>
<td>0.394737</td>
<td>0.4</td>
<td>0.263158</td>
<td>0.2</td>
<td>1492.866048</td>
<td>1478.687038</td>
<td>1.12994</td>
<td>1.279873</td>
<td>2.545455</td>
<td>5.509091</td>
<td>13.545455</td>
<td>13.436364</td>
<td>1.018182</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.0</td>
<td>0.490909</td>
<td>17.018182</td>
<td>8.072727</td>
<td>7.509091</td>
<td>2.509091</td>
<td>3.0</td>
<td>1.490909</td>
<td>1.9395</td>
<td>1.9095</td>
<td>2.0035</td>
<td>1.7155</td>
<td>0.3875</td>
<td>5.132983</td>
<td>5.260851</td>
<td>3.341048</td>
<td>4.289788</td>
<td>3.502318</td>
<td>4.168935</td>
<td>2.332815</td>
<td>3.216457</td>
<td>3.934396</td>
<td>4.522205</td>
<td>away</td>
<td>2.75</td>
<td>3.2</td>
<td>2.50</td>
</tr>
<tr>
<td>21</td>
<td>2005-08-23</td>
<td>22</td>
<td>Portsmouth</td>
<td>0506</td>
<td>1</td>
<td>0.447368</td>
<td>0.4</td>
<td>0.263158</td>
<td>0.4</td>
<td>1405.968416</td>
<td>1489.229314</td>
<td>1.147101</td>
<td>1.503051</td>
<td>2.509091</td>
<td>4.963636</td>
<td>21.981818</td>
<td>16.054545</td>
<td>2.000000</td>
<td>0.509091</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>8.454545</td>
<td>10.490909</td>
<td>3.963636</td>
<td>4.454545</td>
<td>3.018182</td>
<td>1.527273</td>
<td>1.8965</td>
<td>1.9690</td>
<td>2.0040</td>
<td>1.7005</td>
<td>0.2500</td>
<td>Aston Villa</td>
<td>0.447368</td>
<td>0.4</td>
<td>0.263158</td>
<td>0.4</td>
<td>1489.229314</td>
<td>1405.968416</td>
<td>1.17516</td>
<td>1.263229</td>
<td>9.527273</td>
<td>7.000000</td>
<td>14.472727</td>
<td>17.563636</td>
<td>1.490909</td>
<td>0.981818</td>
<td>0.981818</td>
<td>0.981818</td>
<td>0.0</td>
<td>0.000000</td>
<td>15.545455</td>
<td>3.000000</td>
<td>9.054545</td>
<td>2.509091</td>
<td>2.0</td>
<td>0.509091</td>
<td>1.8565</td>
<td>1.9770</td>
<td>1.8505</td>
<td>1.8485</td>
<td>0.7125</td>
<td>3.738614</td>
<td>3.878659</td>
<td>4.494368</td>
<td>4.954673</td>
<td>2.884262</td>
<td>4.065926</td>
<td>3.746642</td>
<td>5.372543</td>
<td>3.743410</td>
<td>4.365456</td>
<td>draw</td>
<td>2.75</td>
<td>3.2</td>
<td>2.50</td>
</tr>
<tr>
<td>22</td>
<td>2005-08-23</td>
<td>23</td>
<td>Sunderland</td>
<td>0506</td>
<td>1</td>
<td>0.236842</td>
<td>0.0</td>
<td>0.236842</td>
<td>0.4</td>
<td>1277.888970</td>
<td>1552.291880</td>
<td>0.650176</td>
<td>1.543716</td>
<td>5.000000</td>
<td>5.000000</td>
<td>12.418182</td>
<td>17.545455</td>
<td>1.981818</td>
<td>0.490909</td>
<td>1.000000</td>
<td>0.490909</td>
<td>0.490909</td>
<td>0.509091</td>
<td>14.509091</td>
<td>6.909091</td>
<td>5.018182</td>
<td>3.927273</td>
<td>1.018182</td>
<td>2.509091</td>
<td>1.8520</td>
<td>1.9915</td>
<td>1.8535</td>
<td>1.8500</td>
<td>0.7125</td>
<td>Man City</td>
<td>0.236842</td>
<td>0.0</td>
<td>0.236842</td>
<td>0.4</td>
<td>1552.291880</td>
<td>1277.888970</td>
<td>1.28875</td>
<td>1.287367</td>
<td>7.527273</td>
<td>3.509091</td>
<td>8.963636</td>
<td>12.490909</td>
<td>0.509091</td>
<td>1.018182</td>
<td>0.509091</td>
<td>0.509091</td>
<td>0.0</td>
<td>0.000000</td>
<td>10.963636</td>
<td>11.945455</td>
<td>2.490909</td>
<td>6.981818</td>
<td>3.0</td>
<td>1.490909</td>
<td>1.8150</td>
<td>2.0395</td>
<td>2.0060</td>
<td>1.7095</td>
<td>-0.2000</td>
<td>0.706318</td>
<td>3.750792</td>
<td>1.476812</td>
<td>1.070209</td>
<td>2.634096</td>
<td>4.455890</td>
<td>0.777605</td>
<td>4.913050</td>
<td>1.499427</td>
<td>3.151477</td>
<td>away</td>
<td>2.50</td>
<td>3.2</td>
<td>2.75</td>
</tr>
</tbody>
</table>
<p>We now have a features DataFrame ready, with all the feature columns beginning with the "f_". In the next section, we will walk through the modelling process to try and find the best type of model to use.</p>
<hr />
<h1 id="03-model-building-hyperparameter-tuning">03. Model Building &amp; Hyperparameter Tuning</h1>
<p>Welcome to the third part of this Machine Learning Walkthrough. This tutorial will focus on the model building process, including how to tune hyperparameters. In the next tutorial, we will create weekly predictions based on the model we have created here.</p>
<p>Specifically, this tutorial will cover a few things:</p>
<ol>
<li>Choosing which Machine Learning algorithm to use from a variety of choices</li>
<li>Hyperparameter Tuning</li>
<li>Overfitting/Underfitting</li>
</ol>
<hr />
<h2 id="choosing-an-algorithm">Choosing an Algorithm</h2>
<p>The best way to decide on specific algorithm to use, is to try them all! To do this, we will define a function which we first used in our AFL Predictions tutorial. This will iterate over a number of algorithms and give us a good indication of which algorithms are suited for this dataset and exercise.</p>
<p>Let's first use grab the features we created in the last tutorial. This may take a minute or two to run.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1">## Import libraries</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="kn">from</span> <span class="nn">data_preparation_functions</span> <span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">plt</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="kn">import</span> <span class="nn">warnings</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">linear_model</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">discriminant_analysis</span><span class="p">,</span> <span class="n">naive_bayes</span><span class="p">,</span> <span class="n">ensemble</span><span class="p">,</span> <span class="n">gaussian_process</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">log_loss</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="n">features</span> <span class="o">=</span> <span class="n">create_feature_df</span><span class="p">()</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>    <span class="n">Creating</span> <span class="nb">all</span> <span class="n">games</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>    <span class="n">Creating</span> <span class="n">stats</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>    <span class="n">Creating</span> <span class="n">odds</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>    <span class="n">Creating</span> <span class="n">market</span> <span class="n">values</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>    <span class="n">Filling</span> <span class="n">NAs</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>    <span class="n">Merging</span> <span class="n">stats</span><span class="p">,</span> <span class="n">odds</span> <span class="ow">and</span> <span class="n">market</span> <span class="n">values</span> <span class="n">into</span> <span class="n">one</span> <span class="n">features</span> <span class="n">DataFrame</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a>    <span class="n">Complete</span><span class="o">.</span>
</code></pre></div>
<p>To start our modelling process, we need to make a training set, a test set and a holdout set. As we are using cross validation, we will make our training set all of the seasons up until 2017/18, and we will use the 2017/18 season as the test set.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="n">feature_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;f_&quot;</span><span class="p">)]</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="n">betting_features</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span> <span class="c1"># Initiate a label encoder to transform the labels &#39;away&#39;, &#39;draw&#39;, &#39;home&#39; to 0, 1, 2</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="c1"># Grab all seasons except for 17/18 to use CV with</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="n">all_x</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">season</span> <span class="o">!=</span> <span class="s1">&#39;1718&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">feature_list</span><span class="p">]</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="n">all_y</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">season</span> <span class="o">!=</span> <span class="s1">&#39;1718&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">]</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="n">all_y</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">all_y</span><span class="p">)</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="c1"># Create our training vector as the seasons except 16/17 and 17/18</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="n">train_x</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">features</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;1617&#39;</span><span class="p">,</span> <span class="s1">&#39;1718&#39;</span><span class="p">]),</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">feature_list</span><span class="p">]</span>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="n">train_y</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">features</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;1617&#39;</span><span class="p">,</span> <span class="s1">&#39;1718&#39;</span><span class="p">]),</span> <span class="s1">&#39;result&#39;</span><span class="p">])</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="c1"># Create our holdout vectors as the 16/17 season</span>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="n">holdout_x</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="s1">&#39;1617&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">feature_list</span><span class="p">]</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a><span class="n">holdout_y</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="s1">&#39;1617&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">])</span>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="c1"># Create our test vectors as the 17/18 season</span>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="n">test_x</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="s1">&#39;1718&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;gameId&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">feature_list</span><span class="p">]</span>
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="n">test_y</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">features</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="s1">&#39;1718&#39;</span><span class="p">,</span> <span class="s1">&#39;result&#39;</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1"># Create a list of standard classifiers</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="n">classifiers</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>    <span class="c1">#GLM</span>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a>    <span class="n">linear_model</span><span class="o">.</span><span class="n">LogisticRegressionCV</span><span class="p">(),</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>    <span class="c1">#Navies Bayes</span>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a>    <span class="n">naive_bayes</span><span class="o">.</span><span class="n">BernoulliNB</span><span class="p">(),</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a>    <span class="n">naive_bayes</span><span class="o">.</span><span class="n">GaussianNB</span><span class="p">(),</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a>    <span class="c1">#Discriminant Analysis</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>    <span class="n">discriminant_analysis</span><span class="o">.</span><span class="n">LinearDiscriminantAnalysis</span><span class="p">(),</span>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a>    <span class="n">discriminant_analysis</span><span class="o">.</span><span class="n">QuadraticDiscriminantAnalysis</span><span class="p">(),</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a>    <span class="c1">#Ensemble Methods</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a>    <span class="n">ensemble</span><span class="o">.</span><span class="n">AdaBoostClassifier</span><span class="p">(),</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a>    <span class="n">ensemble</span><span class="o">.</span><span class="n">BaggingClassifier</span><span class="p">(),</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a>    <span class="n">ensemble</span><span class="o">.</span><span class="n">ExtraTreesClassifier</span><span class="p">(),</span>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a>    <span class="n">ensemble</span><span class="o">.</span><span class="n">GradientBoostingClassifier</span><span class="p">(),</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a>    <span class="n">ensemble</span><span class="o">.</span><span class="n">RandomForestClassifier</span><span class="p">(),</span>
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a>
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a>    <span class="c1">#Gaussian Processes</span>
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a>    <span class="n">gaussian_process</span><span class="o">.</span><span class="n">GaussianProcessClassifier</span><span class="p">(),</span>
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a>
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a>    <span class="c1">#xgboost: http://xgboost.readthedocs.io/en/latest/model.html</span>
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="c1">#     xgb.XGBClassifier()    </span>
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">def</span> <span class="nf">find_best_algorithms</span><span class="p">(</span><span class="n">classifier_list</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>    <span class="c1"># This function is adapted from https://www.kaggle.com/yassineghouzam/titanic-top-4-with-ensemble-modeling</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>    <span class="c1"># Cross validate model with Kfold stratified cross validation</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    <span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>    <span class="c1"># Grab the cross validation scores for each algorithm</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>    <span class="n">cv_results</span> <span class="o">=</span> <span class="p">[</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">classifier</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s2">&quot;neg_log_loss&quot;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="n">kfold</span><span class="p">)</span> <span class="k">for</span> <span class="n">classifier</span> <span class="ow">in</span> <span class="n">classifier_list</span><span class="p">]</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a>    <span class="n">cv_means</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv_result</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">cv_result</span> <span class="ow">in</span> <span class="n">cv_results</span><span class="p">]</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a>    <span class="n">cv_std</span> <span class="o">=</span> <span class="p">[</span><span class="n">cv_result</span><span class="o">.</span><span class="n">std</span><span class="p">()</span> <span class="k">for</span> <span class="n">cv_result</span> <span class="ow">in</span> <span class="n">cv_results</span><span class="p">]</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a>    <span class="n">algorithm_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">alg</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="n">classifiers</span><span class="p">]</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>    <span class="c1"># Create a DataFrame of all the CV results</span>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a>    <span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a>        <span class="s2">&quot;Mean Log Loss&quot;</span><span class="p">:</span> <span class="n">cv_means</span><span class="p">,</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a>        <span class="s2">&quot;Log Loss Std&quot;</span><span class="p">:</span> <span class="n">cv_std</span><span class="p">,</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>        <span class="s2">&quot;Algorithm&quot;</span><span class="p">:</span> <span class="n">algorithm_names</span>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a>    <span class="p">})</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;Mean Log Loss&#39;</span><span class="p">)</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a>    <span class="k">return</span> <span class="n">cv_results</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="n">algorithm_results</span> <span class="o">=</span> <span class="n">find_best_algorithms</span><span class="p">(</span><span class="n">classifiers</span><span class="p">,</span> <span class="n">all_x</span><span class="p">,</span> <span class="n">all_y</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="n">algorithm_results</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Mean Log Loss</th>
<th>Log Loss Std</th>
<th>Algorithm</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0.966540</td>
<td>0.020347</td>
<td>LogisticRegressionCV</td>
</tr>
<tr>
<td>3</td>
<td>0.986679</td>
<td>0.015601</td>
<td>LinearDiscriminantAnalysis</td>
</tr>
<tr>
<td>1</td>
<td>1.015197</td>
<td>0.017466</td>
<td>BernoulliNB</td>
</tr>
<tr>
<td>10</td>
<td>1.098612</td>
<td>0.000000</td>
<td>GaussianProcessClassifier</td>
</tr>
<tr>
<td>5</td>
<td>1.101281</td>
<td>0.044383</td>
<td>AdaBoostClassifier</td>
</tr>
<tr>
<td>8</td>
<td>1.137778</td>
<td>0.153391</td>
<td>GradientBoostingClassifier</td>
</tr>
<tr>
<td>7</td>
<td>2.093981</td>
<td>0.284831</td>
<td>ExtraTreesClassifier</td>
</tr>
<tr>
<td>9</td>
<td>2.095088</td>
<td>0.130367</td>
<td>RandomForestClassifier</td>
</tr>
<tr>
<td>6</td>
<td>2.120571</td>
<td>0.503132</td>
<td>BaggingClassifier</td>
</tr>
<tr>
<td>4</td>
<td>4.065796</td>
<td>1.370119</td>
<td>QuadraticDiscriminantAnalysis</td>
</tr>
<tr>
<td>2</td>
<td>5.284171</td>
<td>0.826991</td>
<td>GaussianNB</td>
</tr>
</tbody>
</table>
<p>We can see that LogisticRegression seems to perform the best out of all the algorithms, and some algorithms have a very high log loss. This is most likely due to overfitting. It would definitely be useful to condense our features down to reduce the dimensionality of the dataset.</p>
<hr />
<h2 id="hyperparameter-tuning">Hyperparameter Tuning</h2>
<p>For now, however, we will use logistic regression. Let's first try and tune a logistic regression model with cross validation. To do this, we will use <a href="https://en.wikipedia.org/wiki/Hyperparameter_optimization">grid search</a>. Grid search essentially tries out each combination of values and finds the model with the lowest error metric, which in our case is log loss. 'C' in logistic regression determines the amount of regularization. Lower values increase regularization.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="c1"># Define our parameters to run a grid search over</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="n">lr_grid</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>    <span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a>    <span class="s2">&quot;solver&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;newton-cg&quot;</span><span class="p">,</span> <span class="s2">&quot;lbfgs&quot;</span><span class="p">,</span> <span class="s2">&quot;liblinear&quot;</span><span class="p">]</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a><span class="p">}</span>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="n">kfold</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">LogisticRegression</span><span class="p">(),</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">lr_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">kfold</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s1">&#39;neg_log_loss&#39;</span><span class="p">)</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">all_x</span><span class="p">,</span> <span class="n">all_y</span><span class="p">)</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best log loss: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_score_</span> <span class="o">*-</span><span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-49-12" name="__codelineno-49-12" href="#__codelineno-49-12"></a><span class="n">best_lr_params</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_params_</span>
<a id="__codelineno-49-13" name="__codelineno-49-13" href="#__codelineno-49-13"></a>
<a id="__codelineno-49-14" name="__codelineno-49-14" href="#__codelineno-49-14"></a>  <span class="n">Best</span> <span class="n">log</span> <span class="n">loss</span><span class="p">:</span> <span class="mf">0.9669551970849734</span>
</code></pre></div>
<hr />
<h2 id="defining-a-baseline">Defining a Baseline</h2>
<p>We should also define a baseline, as we don't really know if our log loss is good or bad. Randomly assigning a 1/3 chance to each selection yields a log loss of log3 = 1.09. However, what we are really interested in, is how our model performs relative to the odds. So let's find the log loss of the odds.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="c1"># Finding the log loss of the odds</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="n">log_loss</span><span class="p">(</span><span class="n">all_y</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">all_x</span><span class="p">[[</span><span class="s1">&#39;f_awayOdds&#39;</span><span class="p">,</span> <span class="s1">&#39;f_drawOdds&#39;</span><span class="p">,</span> <span class="s1">&#39;f_homeOdds&#39;</span><span class="p">]])</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a>  <span class="mf">0.9590114943474463</span>
</code></pre></div>
<p>This is good news: our algorithm almost beats the bookies in terms of log loss. It would be great if we could beat this result.</p>
<hr />
<h2 id="analysing-the-errors-made">Analysing the Errors Made</h2>
<p>Now that we have a logistic regression model tuned, let's see what type of errors it made. To do this we will look at the confusion matrix produced when we predict our holdout set.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="o">**</span><span class="n">best_lr_params</span><span class="p">)</span> <span class="c1"># Instantiate the model</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span> <span class="c1"># Fit our model</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="n">lr_predict</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">holdout_x</span><span class="p">)</span> <span class="c1"># Predict the holdout values</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="c1"># Create a confusion matrix</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="n">c_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">holdout_y</span><span class="p">,</span> <span class="n">lr_predict</span><span class="p">),</span> <span class="n">columns</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">classes_</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">le</span><span class="o">.</span><span class="n">classes_</span><span class="p">)</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a> <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a> <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">))</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="n">c_matrix</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Predicted</th>
<th>away</th>
<th>draw</th>
<th>home</th>
</tr>
</thead>
<tbody>
<tr>
<td>Actual</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>away</td>
<td>77</td>
<td>0</td>
<td>32</td>
</tr>
<tr>
<td>draw</td>
<td>26</td>
<td>3</td>
<td>55</td>
</tr>
<tr>
<td>home</td>
<td>33</td>
<td>7</td>
<td>147</td>
</tr>
</tbody>
</table>
<p>As we can see, when we predicted 'away' as the result, we correctly predicted 79 / 109 results, a hit rate of 70.6%. However, when we look at our draw hit rate, we only predicted 6 / 84 correctly, meaning we only had a hit rate of around 8.3%. For a more in depth analysis of our predictions, please skip to the Analysing Predictions &amp; Staking Strategies section of the tutorial.</p>
<p>Before we move on, however, let's use our model to predict the 17/18 season and compare how we went with the odds.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="c1"># Get test predictions</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="n">test_lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="o">**</span><span class="n">best_lr_params</span><span class="p">)</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="n">test_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">all_x</span><span class="p">,</span> <span class="n">all_y</span><span class="p">)</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="n">test_predictions_probs</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<a id="__codelineno-53-6" name="__codelineno-53-6" href="#__codelineno-53-6"></a><span class="n">test_predictions</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_x</span><span class="p">)</span>
<a id="__codelineno-53-7" name="__codelineno-53-7" href="#__codelineno-53-7"></a>
<a id="__codelineno-53-8" name="__codelineno-53-8" href="#__codelineno-53-8"></a><span class="n">test_ll</span> <span class="o">=</span> <span class="n">log_loss</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="n">test_predictions_probs</span><span class="p">)</span>
<a id="__codelineno-53-9" name="__codelineno-53-9" href="#__codelineno-53-9"></a><span class="n">test_accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_predictions</span> <span class="o">==</span> <span class="n">test_y</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-53-10" name="__codelineno-53-10" href="#__codelineno-53-10"></a>
<a id="__codelineno-53-11" name="__codelineno-53-11" href="#__codelineno-53-11"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Our predictions for the 2017/18 season have a log loss of: </span><span class="si">{0:.5f}</span><span class="s2"> and an accuracy of: </span><span class="si">{1:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">test_ll</span><span class="p">,</span> <span class="n">test_accuracy</span><span class="p">))</span>
</code></pre></div>
    Our predictions for the 2017/18 season have a log loss of: 0.95767 and an accuracy of: 0.56</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="c1"># Get accuracy and log loss based on the odds</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="n">odds_ll</span> <span class="o">=</span> <span class="n">log_loss</span><span class="p">(</span><span class="n">test_y</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">test_x</span><span class="p">[[</span><span class="s1">&#39;f_awayOdds&#39;</span><span class="p">,</span> <span class="s1">&#39;f_drawOdds&#39;</span><span class="p">,</span> <span class="s1">&#39;f_homeOdds&#39;</span><span class="p">]])</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="n">odds_predictions</span> <span class="o">=</span> <span class="n">test_x</span><span class="p">[[</span><span class="s1">&#39;f_awayOdds&#39;</span><span class="p">,</span> <span class="s1">&#39;f_drawOdds&#39;</span><span class="p">,</span> <span class="s1">&#39;f_homeOdds&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()[</span><span class="mi">2</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="n">odds_accuracy</span> <span class="o">=</span> <span class="p">(</span><span class="n">odds_predictions</span> <span class="o">==</span> <span class="n">le</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">test_y</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Odds predictions for the 2017/18 season have a log loss of: </span><span class="si">{0:.5f}</span><span class="s2"> and an accuracy of: </span><span class="si">{1:.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">odds_ll</span><span class="p">,</span> <span class="n">odds_accuracy</span><span class="p">))</span>
</code></pre></div>
    Odds predictions for the 2017/18 season have a log loss of: 0.94635 and an accuracy of: 0.545</p>
<hr />
<h2 id="results">Results</h2>
<p>There we have it! The odds predicted 54.5% of EPL games correctly in the 2017/18 season, whilst our model predicted 54% correctly. This is a decent result for the first iteration of our model. In future iterations, we could wait a certain number of matches each season and calculate EMAs for on those first n games. This may help the issue of players switching clubs and teams becoming relatively stronger/weaker compared to previous seasons.</p>
<hr />
<h1 id="04-weekly-predictions">04. Weekly Predictions</h1>
<p>Welcome to the final part of this Machine Learning Walkthrough. This tutorial will be a walk through of creating weekly EPL predictions from the basic logistic regression model we built in the previous tutorial. We will then analyse our predictions and create staking strategies in the next tutorial.</p>
<p>Specifically, this tutorial will cover a few things:</p>
<ol>
<li>Obtaining Weekly Odds / Game Info Using Betfair's API</li>
<li>Data Wrangling This Week's Game Info Into Our Feature Set</li>
</ol>
<hr />
<h2 id="obtaining-weekly-odds-game-info-using-betfairs-api">Obtaining Weekly Odds / Game Info Using Betfair's API</h2>
<p>The first thing we need to do to create weekly predictions is get both the games being played this week, as well as match odds from Betfair to be used as features.</p>
<p>To make this process easier, I have created a csv file with the fixture for the 2018/19 season. Let's load that now.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="c1">## Import libraries</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="kn">from</span> <span class="nn">weekly_prediction_functions</span> <span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="kn">from</span> <span class="nn">data_preparation_functions</span> <span class="kn">import</span> <span class="o">*</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">log_loss</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="kn">import</span> <span class="nn">warnings</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a><span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="n">fixture</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/fixture.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>              <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">)))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="n">fixture</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>Time (AEST)</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>Venue</th>
<th>TV</th>
<th>Year</th>
<th>round</th>
<th>season</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2018-08-11</td>
<td>5:00 AM</td>
<td>Man United</td>
<td>Leicester</td>
<td>Old Trafford, Manchester</td>
<td>Optus, Fox Sports (delay)</td>
<td>2018</td>
<td>1</td>
<td>1819</td>
</tr>
<tr>
<td>1</td>
<td>2018-08-11</td>
<td>9:30 PM</td>
<td>Newcastle</td>
<td>Tottenham</td>
<td>St.James’ Park, Newcastle</td>
<td>Optus, SBS</td>
<td>2018</td>
<td>1</td>
<td>1819</td>
</tr>
<tr>
<td>2</td>
<td>2018-08-12</td>
<td>12:00 AM</td>
<td>Bournemouth</td>
<td>Cardiff</td>
<td>Vitality Stadium, Bournemouth</td>
<td>Optus</td>
<td>2018</td>
<td>1</td>
<td>1819</td>
</tr>
<tr>
<td>3</td>
<td>2018-08-12</td>
<td>12:00 AM</td>
<td>Fulham</td>
<td>Crystal Palace</td>
<td>Craven Cottage, London</td>
<td>Optus</td>
<td>2018</td>
<td>1</td>
<td>1819</td>
</tr>
<tr>
<td>4</td>
<td>2018-08-12</td>
<td>12:00 AM</td>
<td>Huddersfield</td>
<td>Chelsea</td>
<td>John Smith’s Stadium, Huddersfield</td>
<td>Optus, Fox Sports (delay)</td>
<td>2018</td>
<td>1</td>
<td>1819</td>
</tr>
</tbody>
</table>
<p>Now we are going to connect to the API and retrieve game level information for the next week. To do this, we will use an R script. If you are not familiar with R, don't worry, it is relatively simple to read through. For this, we will run the script weekly_game_info_puller.R. Go ahead and run that script now.</p>
<p>Note that for this step, you will require a Betfair API App Key. If you don't have one, visit <a href="../../api/apiappkey">this page and follow the instructions</a>.</p>
<p>I will upload an updated weekly file, so you can follow along regardless of if you have an App Key or not. Let's load that file in now.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="n">game_info</span> <span class="o">=</span> <span class="n">create_game_info_df</span><span class="p">(</span><span class="s2">&quot;data/weekly_game_info.csv&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="n">game_info</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>AwayTeam</th>
<th>HomeTeam</th>
<th>awaySelectionId</th>
<th>drawSelectionId</th>
<th>homeSelectionId</th>
<th>draw</th>
<th>marketId</th>
<th>marketStartTime</th>
<th>totalMatched</th>
<th>eventId</th>
<th>eventName</th>
<th>homeOdds</th>
<th>drawOdds</th>
<th>awayOdds</th>
<th>competitionId</th>
<th>Date</th>
<th>localMarketStartTime</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Arsenal</td>
<td>Cardiff</td>
<td>1096</td>
<td>58805</td>
<td>79343</td>
<td>The Draw</td>
<td>1.146897152</td>
<td>2018-09-02 12:30:00</td>
<td>30123.595116</td>
<td>28852020</td>
<td>Cardiff v Arsenal</td>
<td>7.00</td>
<td>4.3</td>
<td>1.62</td>
<td>10932509</td>
<td>2018-09-02</td>
<td>Sun September  2, 10:30PM</td>
</tr>
<tr>
<td>1</td>
<td>Bournemouth</td>
<td>Chelsea</td>
<td>1141</td>
<td>58805</td>
<td>55190</td>
<td>The Draw</td>
<td>1.146875421</td>
<td>2018-09-01 14:00:00</td>
<td>30821.329656</td>
<td>28851426</td>
<td>Chelsea v Bournemouth</td>
<td>1.32</td>
<td>6.8</td>
<td>12.00</td>
<td>10932509</td>
<td>2018-09-01</td>
<td>Sun September  2, 12:00AM</td>
</tr>
<tr>
<td>2</td>
<td>Fulham</td>
<td>Brighton</td>
<td>56764</td>
<td>58805</td>
<td>18567</td>
<td>The Draw</td>
<td>1.146875746</td>
<td>2018-09-01 14:00:00</td>
<td>16594.833096</td>
<td>28851429</td>
<td>Brighton v Fulham</td>
<td>2.36</td>
<td>3.5</td>
<td>3.50</td>
<td>10932509</td>
<td>2018-09-01</td>
<td>Sun September  2, 12:00AM</td>
</tr>
</tbody>
</table>
<p>Finally, we will use the API to grab the weekly odds. This R script is also provided, but I have also included the weekly odds csv for convenience.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="n">odds</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/weekly_epl_odds.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a>           <span class="o">.</span><span class="n">replace</span><span class="p">({</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a>                <span class="s1">&#39;Man Utd&#39;</span><span class="p">:</span> <span class="s1">&#39;Man United&#39;</span><span class="p">,</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>                <span class="s1">&#39;C Palace&#39;</span><span class="p">:</span> <span class="s1">&#39;Crystal Palace&#39;</span><span class="p">}))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="n">odds</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>f_homeOdds</th>
<th>f_drawOdds</th>
<th>f_awayOdds</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>Leicester</td>
<td>Liverpool</td>
<td>7.80</td>
<td>5.1</td>
<td>1.48</td>
</tr>
<tr>
<td>1</td>
<td>Brighton</td>
<td>Fulham</td>
<td>2.36</td>
<td>3.5</td>
<td>3.50</td>
</tr>
<tr>
<td>2</td>
<td>Everton</td>
<td>Huddersfield</td>
<td>1.54</td>
<td>4.4</td>
<td>8.20</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="data-wrangling-this-weeks-game-info-into-our-feature-set">Data Wrangling This Week's Game Info Into Our Feature Set</h2>
<p>Now we have the arduous task of wrangling all of this info into a feature set that we can use to predict this week's games. Luckily our functions we created earlier should work if we just append the non-features to our main dataframe.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="n">df</span> <span class="o">=</span> <span class="n">create_df</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>AC</th>
<th>AF</th>
<th>AR</th>
<th>AS</th>
<th>AST</th>
<th>AY</th>
<th>AwayTeam</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Date</th>
<th>Day</th>
<th>Div</th>
<th>FTAG</th>
<th>FTHG</th>
<th>FTR</th>
<th>HC</th>
<th>HF</th>
<th>HR</th>
<th>HS</th>
<th>HST</th>
<th>HTAG</th>
<th>HTHG</th>
<th>HTR</th>
<th>HY</th>
<th>HomeTeam</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>Referee</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>season</th>
<th>gameId</th>
<th>homeWin</th>
<th>awayWin</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>6.0</td>
<td>14.0</td>
<td>1.0</td>
<td>11.0</td>
<td>5.0</td>
<td>1.0</td>
<td>Blackburn</td>
<td>2.75</td>
<td>3.20</td>
<td>2.50</td>
<td>2.90</td>
<td>3.30</td>
<td>2.20</td>
<td>55.0</td>
<td>20.0</td>
<td>0.00</td>
<td>1.71</td>
<td>2.02</td>
<td>2.74</td>
<td>2.04</td>
<td>1.82</td>
<td>3.16</td>
<td>2.40</td>
<td>1.80</td>
<td>2.25</td>
<td>2.90</td>
<td>2.08</td>
<td>1.86</td>
<td>3.35</td>
<td>2.60</td>
<td>35.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>1.0</td>
<td>3.0</td>
<td>H</td>
<td>2.0</td>
<td>11.0</td>
<td>0.0</td>
<td>13.0</td>
<td>5.0</td>
<td>1.0</td>
<td>0.0</td>
<td>A</td>
<td>0.0</td>
<td>West Ham</td>
<td>2.7</td>
<td>3.0</td>
<td>2.3</td>
<td>2.75</td>
<td>3.00</td>
<td>2.38</td>
<td>8</td>
<td>A Wiley</td>
<td>2.75</td>
<td>3.25</td>
<td>2.40</td>
<td>2005</td>
<td>0506</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>home</td>
</tr>
<tr>
<td>1</td>
<td>8.0</td>
<td>16.0</td>
<td>0.0</td>
<td>13.0</td>
<td>6.0</td>
<td>2.0</td>
<td>Bolton</td>
<td>3.00</td>
<td>3.25</td>
<td>2.30</td>
<td>3.15</td>
<td>3.25</td>
<td>2.10</td>
<td>56.0</td>
<td>22.0</td>
<td>-0.25</td>
<td>1.70</td>
<td>2.01</td>
<td>3.05</td>
<td>1.84</td>
<td>2.01</td>
<td>3.16</td>
<td>2.20</td>
<td>1.87</td>
<td>2.20</td>
<td>3.40</td>
<td>1.92</td>
<td>2.10</td>
<td>3.30</td>
<td>2.40</td>
<td>36.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>2.0</td>
<td>2.0</td>
<td>D</td>
<td>7.0</td>
<td>14.0</td>
<td>0.0</td>
<td>3.0</td>
<td>2.0</td>
<td>2.0</td>
<td>2.0</td>
<td>D</td>
<td>0.0</td>
<td>Aston Villa</td>
<td>3.1</td>
<td>3.0</td>
<td>2.1</td>
<td>3.20</td>
<td>3.00</td>
<td>2.10</td>
<td>8</td>
<td>M Riley</td>
<td>3.10</td>
<td>3.25</td>
<td>2.20</td>
<td>2005</td>
<td>0506</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>draw</td>
</tr>
<tr>
<td>2</td>
<td>6.0</td>
<td>14.0</td>
<td>0.0</td>
<td>12.0</td>
<td>5.0</td>
<td>1.0</td>
<td>Man United</td>
<td>1.72</td>
<td>3.40</td>
<td>5.00</td>
<td>1.75</td>
<td>3.35</td>
<td>4.35</td>
<td>56.0</td>
<td>23.0</td>
<td>0.75</td>
<td>1.79</td>
<td>1.93</td>
<td>1.69</td>
<td>1.86</td>
<td>2.00</td>
<td>3.36</td>
<td>4.69</td>
<td>1.87</td>
<td>2.10</td>
<td>1.80</td>
<td>1.93</td>
<td>2.05</td>
<td>3.70</td>
<td>5.65</td>
<td>36.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>2.0</td>
<td>0.0</td>
<td>A</td>
<td>8.0</td>
<td>15.0</td>
<td>0.0</td>
<td>10.0</td>
<td>5.0</td>
<td>1.0</td>
<td>0.0</td>
<td>A</td>
<td>3.0</td>
<td>Everton</td>
<td>1.8</td>
<td>3.1</td>
<td>3.8</td>
<td>1.83</td>
<td>3.20</td>
<td>3.75</td>
<td>8</td>
<td>G Poll</td>
<td>1.80</td>
<td>3.30</td>
<td>4.50</td>
<td>2005</td>
<td>0506</td>
<td>3</td>
<td>0</td>
<td>1</td>
<td>away</td>
</tr>
<tr>
<td>3</td>
<td>6.0</td>
<td>13.0</td>
<td>0.0</td>
<td>7.0</td>
<td>4.0</td>
<td>2.0</td>
<td>Birmingham</td>
<td>2.87</td>
<td>3.25</td>
<td>2.37</td>
<td>2.80</td>
<td>3.20</td>
<td>2.30</td>
<td>56.0</td>
<td>21.0</td>
<td>0.00</td>
<td>1.69</td>
<td>2.04</td>
<td>2.87</td>
<td>2.05</td>
<td>1.81</td>
<td>3.16</td>
<td>2.31</td>
<td>1.77</td>
<td>2.24</td>
<td>3.05</td>
<td>2.11</td>
<td>1.85</td>
<td>3.30</td>
<td>2.60</td>
<td>36.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>6.0</td>
<td>12.0</td>
<td>0.0</td>
<td>15.0</td>
<td>7.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>1.0</td>
<td>Fulham</td>
<td>2.9</td>
<td>3.0</td>
<td>2.2</td>
<td>2.88</td>
<td>3.00</td>
<td>2.25</td>
<td>8</td>
<td>R Styles</td>
<td>2.80</td>
<td>3.25</td>
<td>2.35</td>
<td>2005</td>
<td>0506</td>
<td>4</td>
<td>0</td>
<td>0</td>
<td>draw</td>
</tr>
<tr>
<td>4</td>
<td>6.0</td>
<td>11.0</td>
<td>0.0</td>
<td>13.0</td>
<td>3.0</td>
<td>3.0</td>
<td>West Brom</td>
<td>5.00</td>
<td>3.40</td>
<td>1.72</td>
<td>4.80</td>
<td>3.45</td>
<td>1.65</td>
<td>55.0</td>
<td>23.0</td>
<td>-0.75</td>
<td>1.77</td>
<td>1.94</td>
<td>4.79</td>
<td>1.76</td>
<td>2.10</td>
<td>3.38</td>
<td>1.69</td>
<td>1.90</td>
<td>2.10</td>
<td>5.60</td>
<td>1.83</td>
<td>2.19</td>
<td>3.63</td>
<td>1.80</td>
<td>36.0</td>
<td>2005-08-13</td>
<td>13</td>
<td>E0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>3.0</td>
<td>13.0</td>
<td>0.0</td>
<td>15.0</td>
<td>8.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>2.0</td>
<td>Man City</td>
<td>4.2</td>
<td>3.2</td>
<td>1.7</td>
<td>4.50</td>
<td>3.25</td>
<td>1.67</td>
<td>8</td>
<td>C Foy</td>
<td>5.00</td>
<td>3.25</td>
<td>1.75</td>
<td>2005</td>
<td>0506</td>
<td>5</td>
<td>0</td>
<td>0</td>
<td>draw</td>
</tr>
</tbody>
</table>
<p>Now we need to specify which game week we would like to predict. We will then filter the fixture for this game week and append this info to the main DataFrame</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="n">round_to_predict</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Which game week would you like to predict? Please input next week&#39;s Game Week</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Which game week would you like to predict? Please input next week&#39;s Game Week
4
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="n">future_predictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">fixture</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fixture</span><span class="p">[</span><span class="s1">&#39;round&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">round_to_predict</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">]]</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a>                             <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">,</span> <span class="n">odds</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">])</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a>                             <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a>                                 <span class="s1">&#39;f_homeOdds&#39;</span><span class="p">:</span> <span class="s1">&#39;B365H&#39;</span><span class="p">,</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a>                                 <span class="s1">&#39;f_awayOdds&#39;</span><span class="p">:</span> <span class="s1">&#39;B365A&#39;</span><span class="p">,</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>                                 <span class="s1">&#39;f_drawOdds&#39;</span><span class="p">:</span> <span class="s1">&#39;B365D&#39;</span><span class="p">})</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a>                             <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">season</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">season</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="n">df_including_future_games</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/epl_data.csv&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;season&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>                <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">Date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="p">))</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a>                <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">thresh</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># Drop cols with NAs</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>                <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Drop rows with NAs</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a>                <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a>                <span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future_predictions</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>                <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>                <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">gameId</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>                            <span class="n">Year</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">Date</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>                            <span class="n">homeWin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a>                            <span class="n">awayWin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a>                            <span class="n">result</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="s1">&#39;home&#39;</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">&gt;</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="p">(</span><span class="s1">&#39;draw&#39;</span> <span class="k">if</span> <span class="n">row</span><span class="o">.</span><span class="n">FTHG</span> <span class="o">==</span> <span class="n">row</span><span class="o">.</span><span class="n">FTAG</span> <span class="k">else</span> <span class="s1">&#39;away&#39;</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="n">df_including_future_games</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>AC</th>
<th>AF</th>
<th>AR</th>
<th>AS</th>
<th>AST</th>
<th>AY</th>
<th>AwayTeam</th>
<th>B365A</th>
<th>B365D</th>
<th>B365H</th>
<th>BWA</th>
<th>BWD</th>
<th>BWH</th>
<th>Bb1X2</th>
<th>BbAH</th>
<th>BbAHh</th>
<th>BbAv&lt;2.5</th>
<th>BbAv&gt;2.5</th>
<th>BbAvA</th>
<th>BbAvAHA</th>
<th>BbAvAHH</th>
<th>BbAvD</th>
<th>BbAvH</th>
<th>BbMx&lt;2.5</th>
<th>BbMx&gt;2.5</th>
<th>BbMxA</th>
<th>BbMxAHA</th>
<th>BbMxAHH</th>
<th>BbMxD</th>
<th>BbMxH</th>
<th>BbOU</th>
<th>Date</th>
<th>Day</th>
<th>Div</th>
<th>FTAG</th>
<th>FTHG</th>
<th>FTR</th>
<th>HC</th>
<th>HF</th>
<th>HR</th>
<th>HS</th>
<th>HST</th>
<th>HTAG</th>
<th>HTHG</th>
<th>HTR</th>
<th>HY</th>
<th>HomeTeam</th>
<th>IWA</th>
<th>IWD</th>
<th>IWH</th>
<th>LBA</th>
<th>LBD</th>
<th>LBH</th>
<th>Month</th>
<th>Referee</th>
<th>VCA</th>
<th>VCD</th>
<th>VCH</th>
<th>Year</th>
<th>season</th>
<th>gameId</th>
<th>homeWin</th>
<th>awayWin</th>
<th>result</th>
</tr>
</thead>
<tbody>
<tr>
<td>4952</td>
<td>4.0</td>
<td>8.0</td>
<td>0.0</td>
<td>12.0</td>
<td>2.0</td>
<td>1.0</td>
<td>Burnley</td>
<td>4.33</td>
<td>3.40</td>
<td>2.00</td>
<td>4.0</td>
<td>3.3</td>
<td>2.00</td>
<td>39.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.65</td>
<td>2.22</td>
<td>4.14</td>
<td>2.22</td>
<td>1.69</td>
<td>3.36</td>
<td>1.98</td>
<td>1.72</td>
<td>2.31</td>
<td>4.5</td>
<td>2.32</td>
<td>1.74</td>
<td>3.57</td>
<td>2.04</td>
<td>36.0</td>
<td>2018-08-26</td>
<td>26.0</td>
<td>E0</td>
<td>2.0</td>
<td>4.0</td>
<td>H</td>
<td>6.0</td>
<td>11.0</td>
<td>0.0</td>
<td>25.0</td>
<td>12.0</td>
<td>2.0</td>
<td>3.0</td>
<td>H</td>
<td>2.0</td>
<td>Fulham</td>
<td>4.10</td>
<td>3.35</td>
<td>1.97</td>
<td>3.90</td>
<td>3.2</td>
<td>2.00</td>
<td>8.0</td>
<td>D Coote</td>
<td>4.33</td>
<td>3.4</td>
<td>2.0</td>
<td>2018</td>
<td>1819</td>
<td>4953</td>
<td>1</td>
<td>0</td>
<td>home</td>
</tr>
<tr>
<td>4953</td>
<td>2.0</td>
<td>16.0</td>
<td>0.0</td>
<td>9.0</td>
<td>5.0</td>
<td>4.0</td>
<td>Tottenham</td>
<td>2.90</td>
<td>3.30</td>
<td>2.62</td>
<td>2.9</td>
<td>3.2</td>
<td>2.55</td>
<td>42.0</td>
<td>20.0</td>
<td>-0.25</td>
<td>1.79</td>
<td>2.03</td>
<td>2.86</td>
<td>1.72</td>
<td>2.18</td>
<td>3.27</td>
<td>2.56</td>
<td>1.84</td>
<td>2.10</td>
<td>3.0</td>
<td>1.76</td>
<td>2.25</td>
<td>3.40</td>
<td>2.67</td>
<td>40.0</td>
<td>2018-08-27</td>
<td>27.0</td>
<td>E0</td>
<td>3.0</td>
<td>0.0</td>
<td>A</td>
<td>5.0</td>
<td>11.0</td>
<td>0.0</td>
<td>23.0</td>
<td>5.0</td>
<td>0.0</td>
<td>0.0</td>
<td>D</td>
<td>2.0</td>
<td>Man United</td>
<td>2.75</td>
<td>3.25</td>
<td>2.60</td>
<td>2.75</td>
<td>3.2</td>
<td>2.55</td>
<td>8.0</td>
<td>C Pawson</td>
<td>2.90</td>
<td>3.3</td>
<td>2.6</td>
<td>2018</td>
<td>1819</td>
<td>4954</td>
<td>0</td>
<td>1</td>
<td>away</td>
</tr>
<tr>
<td>4954</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Liverpool</td>
<td>1.48</td>
<td>5.10</td>
<td>7.80</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-01</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Leicester</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4955</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4955</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Fulham</td>
<td>3.50</td>
<td>3.50</td>
<td>2.36</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Brighton</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4956</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4956</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Man United</td>
<td>1.70</td>
<td>3.90</td>
<td>6.60</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Burnley</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4957</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4957</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Bournemouth</td>
<td>12.00</td>
<td>6.80</td>
<td>1.32</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Chelsea</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4958</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4958</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Southampton</td>
<td>4.50</td>
<td>3.55</td>
<td>2.04</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Crystal Palace</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4959</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4959</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Huddersfield</td>
<td>8.20</td>
<td>4.40</td>
<td>1.54</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Everton</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4960</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4960</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Wolves</td>
<td>2.98</td>
<td>3.50</td>
<td>2.62</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>West Ham</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4961</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4961</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Newcastle</td>
<td>32.00</td>
<td>12.50</td>
<td>1.12</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Man City</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4962</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4962</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Arsenal</td>
<td>1.62</td>
<td>4.30</td>
<td>7.00</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-02</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Cardiff</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4963</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
<tr>
<td>4963</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Tottenham</td>
<td>1.68</td>
<td>4.30</td>
<td>5.90</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018-09-03</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>Watford</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>NaN</td>
<td>2018</td>
<td>1819</td>
<td>4964</td>
<td>0</td>
<td>0</td>
<td>away</td>
</tr>
</tbody>
</table>
<p>As we can see, what we have done is appended the Game information to our main DataFrame. The rest of the info is left as NAs, but this will be filled when we created our rolling average features. This is a 'hacky' type of way to complete this task, but works well as we can use the same functions that we created in the previous tutorials on this DataFrame. We now need to add the odds from our odds DataFrame, then we can just run our create features functions as usual.</p>
<hr />
<h2 id="predicting-next-gameweeks-results">Predicting Next Gameweek's Results</h2>
<p>Now that we have our feature DataFrame, all we need to do is split the feature DataFrame up into a training set and next week's games, then use the model we tuned in the last tutorial to create predictions!</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="n">features</span> <span class="o">=</span> <span class="n">create_feature_df</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df_including_future_games</span><span class="p">)</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>    <span class="n">Creating</span> <span class="nb">all</span> <span class="n">games</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>    <span class="n">Creating</span> <span class="n">stats</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a>    <span class="n">Creating</span> <span class="n">odds</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>    <span class="n">Creating</span> <span class="n">market</span> <span class="n">values</span> <span class="n">feature</span> <span class="n">DataFrame</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a>    <span class="n">Filling</span> <span class="n">NAs</span>
<a id="__codelineno-68-8" name="__codelineno-68-8" href="#__codelineno-68-8"></a>    <span class="n">Merging</span> <span class="n">stats</span><span class="p">,</span> <span class="n">odds</span> <span class="ow">and</span> <span class="n">market</span> <span class="n">values</span> <span class="n">into</span> <span class="n">one</span> <span class="n">features</span> <span class="n">DataFrame</span>
<a id="__codelineno-68-9" name="__codelineno-68-9" href="#__codelineno-68-9"></a>    <span class="n">Complete</span><span class="o">.</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="c1"># Create a feature DataFrame for this week&#39;s games.</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="n">production_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">future_predictions</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="c1"># Create a training DataFrame</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="n">training_df</span> <span class="o">=</span> <span class="n">features</span><span class="p">[</span><span class="o">~</span><span class="n">features</span><span class="o">.</span><span class="n">gameId</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">production_df</span><span class="o">.</span><span class="n">gameId</span><span class="p">)]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="n">feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">training_df</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;f_&#39;</span><span class="p">)]</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="n">le</span> <span class="o">=</span> <span class="n">LabelEncoder</span><span class="p">()</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="n">train_y</span> <span class="o">=</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">training_df</span><span class="o">.</span><span class="n">result</span><span class="p">)</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="n">train_x</span> <span class="o">=</span> <span class="n">training_df</span><span class="p">[</span><span class="n">feature_names</span><span class="p">]</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="n">lr</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">solver</span><span class="o">=</span><span class="s1">&#39;liblinear&#39;</span><span class="p">)</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="n">lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="n">predicted_probs</span> <span class="o">=</span> <span class="n">lr</span><span class="o">.</span><span class="n">predict_proba</span><span class="p">(</span><span class="n">production_df</span><span class="p">[</span><span class="n">feature_names</span><span class="p">])</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="n">predicted_odds</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">predicted_probs</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="c1"># Assign the modelled odds to our predictions df</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="n">predictions_df</span> <span class="o">=</span> <span class="p">(</span><span class="n">production_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;HomeTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;AwayTeam&#39;</span><span class="p">,</span> <span class="s1">&#39;B365H&#39;</span><span class="p">,</span> <span class="s1">&#39;B365D&#39;</span><span class="p">,</span> <span class="s1">&#39;B365A&#39;</span><span class="p">]]</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a>                               <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">homeModelledOdds</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predicted_odds</span><span class="p">],</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>                                      <span class="n">drawModelledOdds</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predicted_odds</span><span class="p">],</span>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a>                                      <span class="n">awayModelledOdds</span><span class="o">=</span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">predicted_odds</span><span class="p">])</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a>                               <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a>                                   <span class="s1">&#39;B365H&#39;</span><span class="p">:</span> <span class="s1">&#39;BetfairHomeOdds&#39;</span><span class="p">,</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a>                                   <span class="s1">&#39;B365D&#39;</span><span class="p">:</span> <span class="s1">&#39;BetfairDrawOdds&#39;</span><span class="p">,</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>                                   <span class="s1">&#39;B365A&#39;</span><span class="p">:</span> <span class="s1">&#39;BetfairAwayOdds&#39;</span><span class="p">}))</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="n">predictions_df</span>
</code></pre></div>
<table>
<thead>
<tr>
<th></th>
<th>Date</th>
<th>HomeTeam</th>
<th>AwayTeam</th>
<th>BetfairHomeOdds</th>
<th>BetfairDrawOdds</th>
<th>BetfairAwayOdds</th>
<th>homeModelledOdds</th>
<th>drawModelledOdds</th>
<th>awayModelledOdds</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2018-09-01</td>
<td>Leicester</td>
<td>Liverpool</td>
<td>7.80</td>
<td>5.10</td>
<td>1.48</td>
<td>5.747661</td>
<td>5.249857</td>
<td>1.573478</td>
</tr>
<tr>
<td>1</td>
<td>2018-09-02</td>
<td>Brighton</td>
<td>Fulham</td>
<td>2.36</td>
<td>3.50</td>
<td>3.50</td>
<td>2.183193</td>
<td>3.803120</td>
<td>3.584057</td>
</tr>
<tr>
<td>2</td>
<td>2018-09-02</td>
<td>Burnley</td>
<td>Man United</td>
<td>6.60</td>
<td>3.90</td>
<td>1.70</td>
<td>5.282620</td>
<td>4.497194</td>
<td>1.699700</td>
</tr>
<tr>
<td>3</td>
<td>2018-09-02</td>
<td>Chelsea</td>
<td>Bournemouth</td>
<td>1.32</td>
<td>6.80</td>
<td>12.00</td>
<td>1.308366</td>
<td>6.079068</td>
<td>14.047070</td>
</tr>
<tr>
<td>4</td>
<td>2018-09-02</td>
<td>Crystal Palace</td>
<td>Southampton</td>
<td>2.04</td>
<td>3.55</td>
<td>4.50</td>
<td>2.202871</td>
<td>4.213695</td>
<td>3.239122</td>
</tr>
<tr>
<td>5</td>
<td>2018-09-02</td>
<td>Everton</td>
<td>Huddersfield</td>
<td>1.54</td>
<td>4.40</td>
<td>8.20</td>
<td>1.641222</td>
<td>3.759249</td>
<td>8.020055</td>
</tr>
<tr>
<td>6</td>
<td>2018-09-02</td>
<td>West Ham</td>
<td>Wolves</td>
<td>2.62</td>
<td>3.50</td>
<td>2.98</td>
<td>1.999816</td>
<td>4.000456</td>
<td>4.000279</td>
</tr>
<tr>
<td>7</td>
<td>2018-09-02</td>
<td>Man City</td>
<td>Newcastle</td>
<td>1.12</td>
<td>12.50</td>
<td>32.00</td>
<td>1.043103</td>
<td>29.427939</td>
<td>136.231983</td>
</tr>
<tr>
<td>8</td>
<td>2018-09-02</td>
<td>Cardiff</td>
<td>Arsenal</td>
<td>7.00</td>
<td>4.30</td>
<td>1.62</td>
<td>6.256929</td>
<td>4.893445</td>
<td>1.572767</td>
</tr>
<tr>
<td>9</td>
<td>2018-09-03</td>
<td>Watford</td>
<td>Tottenham</td>
<td>5.90</td>
<td>4.30</td>
<td>1.68</td>
<td>5.643663</td>
<td>4.338926</td>
<td>1.688224</td>
</tr>
</tbody>
</table>
<p>Above are the predictions for this Gameweek's matches. </p>
<hr />
<h3 id="disclaimer">Disclaimer</h3>
<p>Note that whilst models and automated strategies are fun and rewarding to create, we can't promise that your model or betting strategy will be profitable, and we make no representations in relation to the code shared or information on this page. If you're using this code or implementing your own strategies, you do so entirely at your own risk and you are responsible for any winnings/losses incurred. Under no circumstances will Betfair be liable for any loss or damage you suffer.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="footer.title">
        
          
          <a href="../soccerModellingTutorialPython/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Soccer modelling (Python)" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Soccer modelling (Python)
              </div>
            </div>
          </a>
        
        
          
          <a href="../soccerModellingELO2022WorldCup/" class="md-footer__link md-footer__link--next" aria-label="Next: Soccer modelling (R) - 2022 FIFA World Cup" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Soccer modelling (R) - 2022 FIFA World Cup
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-copyright">
  
  
</div>
        
          <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/Betfair_Aus" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/company/betfair-australia" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://facebook.com/betfairaustralia" target="_blank" rel="noopener" title="facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/user/betfairaus" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/betfair-datascientists" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
        
      </div>

      <div class="bf-footer">
          <div class="bf-footer-inner">
              <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
              <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its <a class='inner-link' href="https://www.betfair.com.au/info/responsible-gambling/">Responsible Gambling Code of Conduct</a> and for South
              Australian residents by the <a class='inner-link' href="https://www.betfair.com.au/info/pdf/SA-GCoP.pdf">South Australian Responsible Gambling Code of Practice.</a></p>
              <p class="bf-dark">BetStop is the Australian National Self-Exclusion Register. For more information, please visit <a class="inner-link" href="https://betstop.gov.au">https://betstop.gov.au</a><br /> <div class="full-screen"> <p style="font-family: Arial, sans-serif; font-size: 1.2rem; font-weight: bold; text-align: center;">What are you really gambling with&#63</p> <p style="font-family: Arial, sans-serif; font-size: 0.8rem; font-weight: bold; text-align: center;">For free and confidential support call 1800 858 858 or visit <a href="http://www.gamblinghelponline.org.au" style="color: black; text-decoration: underline;">gamblinghelponline.org.au</a></p> </div> </p>
              <ul class="bf-links">
                <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
                <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
                <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
                <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
                <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
              </ul>
          </div>
      </div>
    </div>

    <script src="https://js.adsrvr.org/up_loader.1.1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        ttd_dom_ready( function() {
            if (typeof TTDUniversalPixelApi === 'function') {
                var universalPixelApi = new TTDUniversalPixelApi();
                universalPixelApi.init("y12d1ir", ["8ml4f17"], "https://insight.adsrvr.org/track/up");
            }
        });
    </script>

</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../js/scripts.js"></script>
      
    
  </body>
</html>