
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/howToBuildASoccerBotPartII/">
      
      
        <link rel="prev" href="../howToBuildASoccerBotPartI/">
      
      
        <link rel="next" href="../howToBuildASoccerBotPartIII/">
      
      
      <link rel="icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.5">
    
    
      
        <title>How To Build A Soccer Bot P2 - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/betfair.css">
    
      <link rel="stylesheet" href="../../css/buttons_and_animations.css">
    
      <link rel="stylesheet" href="../../css/fonts.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","UA-125973915-1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","UA-125973915-1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=UA-125973915-1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-build-a-betfair-soccer-bot-part-2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      
  
  <header class="md-header" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="header.title">
      <a href="../.." title="The Automation Hub" class="md-header__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
        
  <img src="../../img/logo.svg" alt="logo">

      </a>
      <label class="md-header__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              The Automation Hub
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">
              
                How To Build A Soccer Bot P2
              
            </span>
          </div>
        </div>
      </div>

      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
              </label>
            
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
              </label>
            
          
        </form>
      
      

      
     
      <div class="bf-nav">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#"
          xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26" />
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z" />
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>

      

    </nav>
    
  </header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../data/dataListing/" class="md-tabs__link">
          
  
  Data

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../wagering/betfairHowTo/" class="md-tabs__link">
          
  
  Wagering

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api/apiResources/" class="md-tabs__link">
          
  
  API

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../brownlowDatathon/" class="md-tabs__link">
          
  
  Modelling

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tutorials/How_to_Automate_1/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../mentalGame/intro/" class="md-tabs__link">
          
  
  Mental Game

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../contactUs/test/" class="md-tabs__link">
          
  
  Contact Us

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Automation Hub" class="md-nav__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
      
  <img src="../../img/logo.svg" alt="logo">

    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/dataListing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSV Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../data/usingHistoricDataSite/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Historic Data Site
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Wagering
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Wagering
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/betfairHowTo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betfair How-To
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/bettingGlossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betting Glossary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/stakingMethods/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Staking Methods and Bankroll Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/valueAndOdds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Value and Odds
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/commission/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Commission and other charges
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/hubPredictionsModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hub Predictions Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/2ndPlaceVoid/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashback 2nd Markets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/exactaQuinella/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Exactas & Quinella
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiResources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiappkey/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to access the Betfair API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiRtutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API tutorial in R
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiPythontutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API tutorial in Python
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Modelling
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Modelling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../brownlowDatathon/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Brownlow Medal Datathon
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToModel/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro to modelling
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataSources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pricing Data Sources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cloudOrLocalMachine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud or Local
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../monteCarloSimulations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monte Carlo Simulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AFL
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            AFL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLPlayerDisposalsTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Player Disposal Lines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLPlayerDisposalsFlumine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Betting Player Disposal Markets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modellingTheBrownlowMedal/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How does a Data Scientist model the Brownlow?
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7" >
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    AFL (Archive)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            AFL (Archive)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AFLmodellingPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AFL modelling walk through in Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../brownlowModelTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modelling the Brownlow Medal in Python
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Greyhounds
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Greyhounds
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../topazTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound Topaz API (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_9" >
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Greyhounds (Archive)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            Greyhounds (Archive)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fasttrackTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound FastTrack API (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../greyhoundModellingPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Greyhound modelling (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_10" checked>
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Soccer
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            Soccer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToBuildASoccerBotPartI/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Build A Soccer Bot P1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    How To Build A Soccer Bot P2
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    How To Build A Soccer Bot P2
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#creating-rated-prices" class="md-nav__link">
    <span class="md-ellipsis">
      Creating Rated Prices
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flumine-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Flumine Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flumine Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#unzipping-the-files" class="md-nav__link">
    <span class="md-ellipsis">
      Unzipping The Files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-the-simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Running the Simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    <span class="md-ellipsis">
      Conclusion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disclaimer" class="md-nav__link">
    <span class="md-ellipsis">
      Disclaimer
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToBuildASoccerBotPartIII/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How To Build A Soccer Bot P3
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_11" >
        
          
          <label class="md-nav__link" for="__nav_5_11" id="__nav_5_11_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Soccer (Archive)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_11">
            <span class="md-nav__icon md-icon"></span>
            Soccer (Archive)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingTutorialPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../EPLmlPython/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    EPL Machine Learning (Python)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingELO2022WorldCup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling (R) - 2022 FIFA World Cup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerEloTutorialR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Elo soccer tutorial (R)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingTutorialR/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Soccer modelling (R)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_12" >
        
          
          <label class="md-nav__link" for="__nav_5_12" id="__nav_5_12_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Tennis (Archive)
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_12">
            <span class="md-nav__icon md-icon"></span>
            Tennis (Archive)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../howToModelTheAusOpen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to model the Australian Open
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenRTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aus Open R Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenPythonTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Aus Open Python Tutorial
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_3/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Automate 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/resultsLoggingTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flumine Results to CSV Files
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/flumineSimulations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flumine Simulations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/processingTarFiles101/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Take away the pain! Processing TAR Files 101
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/jsonToCsvRevisited/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JSON to CSV | Revisited
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/backtestingRatingsTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Back testing ratings in Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/automatedBettingAnglesTutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Automated betting angles in Python
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingMarketMovements/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Do they know? Analysing Betfair market formation & market movements
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingBSP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wisdom of the crowd? Analysing & understanding BSP
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Mental Game
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Mental Game
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/roleOfEmotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/mapYourEmotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 2
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/handlingBadVariance/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 3
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/winbyBeingGreatatLosing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 4
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/correctingyouremotions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/responsibleGambling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 6
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/InchwormConcept/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 7
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/HighExpectations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 8
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/TappingYourIntuition/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Part 9
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Contact Us
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Contact Us
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contactUs/test/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Meet the Team
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="how-to-build-a-betfair-soccer-bot-part-2">How To Build A Betfair Soccer Bot Part 2</h1>
<p>This is a continuation of the tutorial - <a href="../howToBuildASoccerBotPartI/">How To Build A Betfair Soccer Bot Part 1</a></p>
<p><strong>"I've trained a model, but how can I use it to bet with?"</strong></p>
<p>This is an example of what we predicted in the previous tutorial</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>{date_home&#39;:&#39;2022-08-13&#39;,
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>&#39;match_id&#39;:&#39;221827&#39;,
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>&#39;name_home&#39;:&#39;Arsenal&#39;,
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>&#39;name_away&#39;:&#39;Leicester&#39;,
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>&#39;goalsScored_home&#39;:&#39;4&#39;,
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>&#39;goalsScored_away&#39;:&#39;2&#39;,
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>&#39;halfTimeGoalsScored_home&#39;:&#39;2&#39;,
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>&#39;halfTimeGoalsScored_away&#39;:&#39;0&#39;,
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>&#39;home_0_x_away_0&#39;:&#39;0.0615&#39;,
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>&#39;home_0_x_away_1&#39;:&#39;0.0573&#39;,
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>&#39;home_0_x_away_2&#39;:&#39;0.0256&#39;,
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>&#39;home_0_x_away_3&#39;:&#39;0.0092&#39;,
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>&#39;home_0_x_away_4&#39;:&#39;0.0016&#39;,
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>&#39;home_0_x_away_5&#39;:&#39;0.0004&#39;,
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>&#39;home_0_x_away_6&#39;:&#39;0.0003&#39;,
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>&#39;home_0_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>&#39;home_1_x_away_0&#39;:&#39;0.1152&#39;,
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>&#39;home_1_x_away_1&#39;:&#39;0.1074&#39;,
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>&#39;home_1_x_away_2&#39;:&#39;0.0479&#39;,
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>&#39;home_1_x_away_3&#39;:&#39;0.0172&#39;,
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>&#39;home_1_x_away_4&#39;:&#39;0.003&#39;,
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a>&#39;home_1_x_away_5&#39;:&#39;0.0008&#39;,
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>&#39;home_1_x_away_6&#39;:&#39;0.0006&#39;,
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>&#39;home_1_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>&#39;home_2_x_away_0&#39;:&#39;0.1132&#39;,
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>&#39;home_2_x_away_1&#39;:&#39;0.1054&#39;,
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a>&#39;home_2_x_away_2&#39;:&#39;0.0471&#39;,
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>&#39;home_2_x_away_3&#39;:&#39;0.0169&#39;,
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>&#39;home_2_x_away_4&#39;:&#39;0.0029&#39;,
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>&#39;home_2_x_away_5&#39;:&#39;0.0008&#39;,
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>&#39;home_2_x_away_6&#39;:&#39;0.0006&#39;,
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>&#39;home_2_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a>&#39;home_3_x_away_0&#39;:&#39;0.0545&#39;,
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a>&#39;home_3_x_away_1&#39;:&#39;0.0508&#39;,
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a>&#39;home_3_x_away_2&#39;:&#39;0.0227&#39;,
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a>&#39;home_3_x_away_3&#39;:&#39;0.0081&#39;,
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a>&#39;home_3_x_away_4&#39;:&#39;0.0014&#39;,
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a>&#39;home_3_x_away_5&#39;:&#39;0.0004&#39;,
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a>&#39;home_3_x_away_6&#39;:&#39;0.0003&#39;,
<a id="__codelineno-0-40" name="__codelineno-0-40" href="#__codelineno-0-40"></a>&#39;home_3_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-41" name="__codelineno-0-41" href="#__codelineno-0-41"></a>&#39;home_4_x_away_0&#39;:&#39;0.0388&#39;,
<a id="__codelineno-0-42" name="__codelineno-0-42" href="#__codelineno-0-42"></a>&#39;home_4_x_away_1&#39;:&#39;0.0362&#39;,
<a id="__codelineno-0-43" name="__codelineno-0-43" href="#__codelineno-0-43"></a>&#39;home_4_x_away_2&#39;:&#39;0.0161&#39;,
<a id="__codelineno-0-44" name="__codelineno-0-44" href="#__codelineno-0-44"></a>&#39;home_4_x_away_3&#39;:&#39;0.0058&#39;,
<a id="__codelineno-0-45" name="__codelineno-0-45" href="#__codelineno-0-45"></a>&#39;home_4_x_away_4&#39;:&#39;0.001&#39;,
<a id="__codelineno-0-46" name="__codelineno-0-46" href="#__codelineno-0-46"></a>&#39;home_4_x_away_5&#39;:&#39;0.0003&#39;,
<a id="__codelineno-0-47" name="__codelineno-0-47" href="#__codelineno-0-47"></a>&#39;home_4_x_away_6&#39;:&#39;0.0002&#39;,
<a id="__codelineno-0-48" name="__codelineno-0-48" href="#__codelineno-0-48"></a>&#39;home_4_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-49" name="__codelineno-0-49" href="#__codelineno-0-49"></a>&#39;home_5_x_away_0&#39;:&#39;0.0083&#39;,
<a id="__codelineno-0-50" name="__codelineno-0-50" href="#__codelineno-0-50"></a>&#39;home_5_x_away_1&#39;:&#39;0.0077&#39;,
<a id="__codelineno-0-51" name="__codelineno-0-51" href="#__codelineno-0-51"></a>&#39;home_5_x_away_2&#39;:&#39;0.0034&#39;,
<a id="__codelineno-0-52" name="__codelineno-0-52" href="#__codelineno-0-52"></a>&#39;home_5_x_away_3&#39;:&#39;0.0012&#39;,
<a id="__codelineno-0-53" name="__codelineno-0-53" href="#__codelineno-0-53"></a>&#39;home_5_x_away_4&#39;:&#39;0.0002&#39;,
<a id="__codelineno-0-54" name="__codelineno-0-54" href="#__codelineno-0-54"></a>&#39;home_5_x_away_5&#39;:&#39;0.0001&#39;,
<a id="__codelineno-0-55" name="__codelineno-0-55" href="#__codelineno-0-55"></a>&#39;home_5_x_away_6&#39;:&#39;0&#39;,
<a id="__codelineno-0-56" name="__codelineno-0-56" href="#__codelineno-0-56"></a>&#39;home_5_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-57" name="__codelineno-0-57" href="#__codelineno-0-57"></a>&#39;home_6_x_away_0&#39;:&#39;0.0024&#39;,
<a id="__codelineno-0-58" name="__codelineno-0-58" href="#__codelineno-0-58"></a>&#39;home_6_x_away_1&#39;:&#39;0.0022&#39;,
<a id="__codelineno-0-59" name="__codelineno-0-59" href="#__codelineno-0-59"></a>&#39;home_6_x_away_2&#39;:&#39;0.001&#39;,
<a id="__codelineno-0-60" name="__codelineno-0-60" href="#__codelineno-0-60"></a>&#39;home_6_x_away_3&#39;:&#39;0.0004&#39;,
<a id="__codelineno-0-61" name="__codelineno-0-61" href="#__codelineno-0-61"></a>&#39;home_6_x_away_4&#39;:&#39;0.0001&#39;,
<a id="__codelineno-0-62" name="__codelineno-0-62" href="#__codelineno-0-62"></a>&#39;home_6_x_away_5&#39;:&#39;0&#39;,
<a id="__codelineno-0-63" name="__codelineno-0-63" href="#__codelineno-0-63"></a>&#39;home_6_x_away_6&#39;:&#39;0&#39;,
<a id="__codelineno-0-64" name="__codelineno-0-64" href="#__codelineno-0-64"></a>&#39;home_6_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-65" name="__codelineno-0-65" href="#__codelineno-0-65"></a>&#39;home_7_x_away_0&#39;:&#39;0.0004&#39;,
<a id="__codelineno-0-66" name="__codelineno-0-66" href="#__codelineno-0-66"></a>&#39;home_7_x_away_1&#39;:&#39;0.0004&#39;,
<a id="__codelineno-0-67" name="__codelineno-0-67" href="#__codelineno-0-67"></a>&#39;home_7_x_away_2&#39;:&#39;0.0002&#39;,
<a id="__codelineno-0-68" name="__codelineno-0-68" href="#__codelineno-0-68"></a>&#39;home_7_x_away_3&#39;:&#39;0.0001&#39;,
<a id="__codelineno-0-69" name="__codelineno-0-69" href="#__codelineno-0-69"></a>&#39;home_7_x_away_4&#39;:&#39;0&#39;,
<a id="__codelineno-0-70" name="__codelineno-0-70" href="#__codelineno-0-70"></a>&#39;home_7_x_away_5&#39;:&#39;0&#39;,
<a id="__codelineno-0-71" name="__codelineno-0-71" href="#__codelineno-0-71"></a>&#39;home_7_x_away_6&#39;:&#39;0&#39;,
<a id="__codelineno-0-72" name="__codelineno-0-72" href="#__codelineno-0-72"></a>&#39;home_7_x_away_7&#39;:&#39;0&#39;,
<a id="__codelineno-0-73" name="__codelineno-0-73" href="#__codelineno-0-73"></a>&#39;home_0_ht_x_away_0_ht&#39;:&#39;0.311&#39;,
<a id="__codelineno-0-74" name="__codelineno-0-74" href="#__codelineno-0-74"></a>&#39;home_0_ht_x_away_1_ht&#39;:&#39;0.115&#39;,
<a id="__codelineno-0-75" name="__codelineno-0-75" href="#__codelineno-0-75"></a>&#39;home_0_ht_x_away_2_ht&#39;:&#39;0.0213&#39;,
<a id="__codelineno-0-76" name="__codelineno-0-76" href="#__codelineno-0-76"></a>&#39;home_0_ht_x_away_3_ht&#39;:&#39;0.0115&#39;,
<a id="__codelineno-0-77" name="__codelineno-0-77" href="#__codelineno-0-77"></a>&#39;home_0_ht_x_away_4_ht&#39;:&#39;0.0002&#39;,
<a id="__codelineno-0-78" name="__codelineno-0-78" href="#__codelineno-0-78"></a>&#39;home_0_ht_x_away_5_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-79" name="__codelineno-0-79" href="#__codelineno-0-79"></a>&#39;home_1_ht_x_away_0_ht&#39;:&#39;0.2309&#39;,
<a id="__codelineno-0-80" name="__codelineno-0-80" href="#__codelineno-0-80"></a>&#39;home_1_ht_x_away_1_ht&#39;:&#39;0.0854&#39;,
<a id="__codelineno-0-81" name="__codelineno-0-81" href="#__codelineno-0-81"></a>&#39;home_1_ht_x_away_2_ht&#39;:&#39;0.0158&#39;,
<a id="__codelineno-0-82" name="__codelineno-0-82" href="#__codelineno-0-82"></a>&#39;home_1_ht_x_away_3_ht&#39;:&#39;0.0085&#39;,
<a id="__codelineno-0-83" name="__codelineno-0-83" href="#__codelineno-0-83"></a>&#39;home_1_ht_x_away_4_ht&#39;:&#39;0.0002&#39;,
<a id="__codelineno-0-84" name="__codelineno-0-84" href="#__codelineno-0-84"></a>&#39;home_1_ht_x_away_5_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-85" name="__codelineno-0-85" href="#__codelineno-0-85"></a>&#39;home_2_ht_x_away_0_ht&#39;:&#39;0.1158&#39;,
<a id="__codelineno-0-86" name="__codelineno-0-86" href="#__codelineno-0-86"></a>&#39;home_2_ht_x_away_1_ht&#39;:&#39;0.0428&#39;,
<a id="__codelineno-0-87" name="__codelineno-0-87" href="#__codelineno-0-87"></a>&#39;home_2_ht_x_away_2_ht&#39;:&#39;0.0079&#39;,
<a id="__codelineno-0-88" name="__codelineno-0-88" href="#__codelineno-0-88"></a>&#39;home_2_ht_x_away_3_ht&#39;:&#39;0.0043&#39;,
<a id="__codelineno-0-89" name="__codelineno-0-89" href="#__codelineno-0-89"></a>&#39;home_2_ht_x_away_4_ht&#39;:&#39;0.0001&#39;,
<a id="__codelineno-0-90" name="__codelineno-0-90" href="#__codelineno-0-90"></a>&#39;home_2_ht_x_away_5_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-91" name="__codelineno-0-91" href="#__codelineno-0-91"></a>&#39;home_3_ht_x_away_0_ht&#39;:&#39;0.0174&#39;,
<a id="__codelineno-0-92" name="__codelineno-0-92" href="#__codelineno-0-92"></a>&#39;home_3_ht_x_away_1_ht&#39;:&#39;0.0064&#39;,
<a id="__codelineno-0-93" name="__codelineno-0-93" href="#__codelineno-0-93"></a>&#39;home_3_ht_x_away_2_ht&#39;:&#39;0.0012&#39;,
<a id="__codelineno-0-94" name="__codelineno-0-94" href="#__codelineno-0-94"></a>&#39;home_3_ht_x_away_3_ht&#39;:&#39;0.0006&#39;,
<a id="__codelineno-0-95" name="__codelineno-0-95" href="#__codelineno-0-95"></a>&#39;home_3_ht_x_away_4_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-96" name="__codelineno-0-96" href="#__codelineno-0-96"></a>&#39;home_3_ht_x_away_5_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-97" name="__codelineno-0-97" href="#__codelineno-0-97"></a>&#39;home_4_ht_x_away_0_ht&#39;:&#39;0.0023&#39;,
<a id="__codelineno-0-98" name="__codelineno-0-98" href="#__codelineno-0-98"></a>&#39;home_4_ht_x_away_1_ht&#39;:&#39;0.0009&#39;,
<a id="__codelineno-0-99" name="__codelineno-0-99" href="#__codelineno-0-99"></a>&#39;home_4_ht_x_away_2_ht&#39;:&#39;0.0002&#39;,
<a id="__codelineno-0-100" name="__codelineno-0-100" href="#__codelineno-0-100"></a>&#39;home_4_ht_x_away_3_ht&#39;:&#39;0.0001&#39;,
<a id="__codelineno-0-101" name="__codelineno-0-101" href="#__codelineno-0-101"></a>&#39;home_4_ht_x_away_4_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-102" name="__codelineno-0-102" href="#__codelineno-0-102"></a>&#39;home_4_ht_x_away_5_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-103" name="__codelineno-0-103" href="#__codelineno-0-103"></a>&#39;home_5_ht_x_away_0_ht&#39;:&#39;0.0001&#39;,
<a id="__codelineno-0-104" name="__codelineno-0-104" href="#__codelineno-0-104"></a>&#39;home_5_ht_x_away_1_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-105" name="__codelineno-0-105" href="#__codelineno-0-105"></a>&#39;home_5_ht_x_away_2_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-106" name="__codelineno-0-106" href="#__codelineno-0-106"></a>&#39;home_5_ht_x_away_3_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-107" name="__codelineno-0-107" href="#__codelineno-0-107"></a>&#39;home_5_ht_x_away_4_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-108" name="__codelineno-0-108" href="#__codelineno-0-108"></a>&#39;home_5_ht_x_away_5_ht&#39;:&#39;0&#39;,
<a id="__codelineno-0-109" name="__codelineno-0-109" href="#__codelineno-0-109"></a>}
</code></pre></div>
<p>While we might directly be able to use these values for Correct Score markets, they're overall not that useful for other markets. We could certainly manually figure them out for upcoming matches but to run a back test on two seasons worth of data, we certainly don't want to be doing this manually for 748 matches. So let's run through how we turn this into something more useful!</p>
<h2 id="creating-rated-prices">Creating Rated Prices</h2>
<p>Now that we've trained our model and calculated the probability for each unique scoreline possible for both full-time and half-time outcomes, we'll need to do some additional processing to be able to use these probabilities to bet into the Betfair markets. The next code block will take our model outputs and create rated prices for a selection of markets from the exchange. </p>
<p>This isn't an exhaustive list but it gives an idea of the type of calculation required to transition between modelling and betting.</p>
<hr />
<p>The next block of code assumes that all required modules have already been imported</p>
<p><div class="highlight"><span class="filename">Define our markets</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_model_predictions</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>    <span class="c1"># List of indices representing the number of goals for which we want to calculate the probability</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="n">full_time_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="c1"># 0,1,2,3,4,5,6,7</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="n">half_time_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="c1"># 0,1,2,3,4,5</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="sd">    The below code will calculate probabilities for each individual market and selection for most markets related to goals scored/conceded</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="sd">    The new column name takes the format that matches the exchange &#39;marketName_selectionName&#39;</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>    <span class="c1"># Both Teams To Score</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Both Teams To Score?_Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Both Teams To Score?_No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Both Teams To Score?_Yes&#39;</span><span class="p">]</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>    <span class="c1"># Match Odds</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>
<a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>    <span class="c1"># Draw No Bet - This is equivalent to match odds normalised after removal of the Draw probability (In the event of a draw, the market is voided)</span>
<a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Draw No Bet_Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">])</span>
<a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Draw No Bet_Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">])</span>
<a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
<a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="c1"># Double Chance - This is a 2 winner market and has a market percentage of 200%</span>
<a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Double Chance_Home Or Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span>
<a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Double Chance_Home Or Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span>
<a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Double Chance_Draw Or Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span>
<a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a>    <span class="c1"># Match Odds &amp; Both Teams to Score</span>
<a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Both Teams To Score_Home/Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Both Teams To Score_Home/No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Both Teams To Score_Draw/Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Both Teams To Score_Draw/No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Both Teams To Score_Away/Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Both Teams To Score_Away/No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
<a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>    <span class="c1"># Correct Score</span>
<a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_0 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-40" name="__codelineno-1-40" href="#__codelineno-1-40"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_0 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_1&#39;</span><span class="p">]</span>
<a id="__codelineno-1-41" name="__codelineno-1-41" href="#__codelineno-1-41"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_0 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_2&#39;</span><span class="p">]</span>
<a id="__codelineno-1-42" name="__codelineno-1-42" href="#__codelineno-1-42"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_0 - 3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_3&#39;</span><span class="p">]</span>
<a id="__codelineno-1-43" name="__codelineno-1-43" href="#__codelineno-1-43"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_1 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-44" name="__codelineno-1-44" href="#__codelineno-1-44"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_1 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_x_away_1&#39;</span><span class="p">]</span>
<a id="__codelineno-1-45" name="__codelineno-1-45" href="#__codelineno-1-45"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_1 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_x_away_2&#39;</span><span class="p">]</span>
<a id="__codelineno-1-46" name="__codelineno-1-46" href="#__codelineno-1-46"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_1 - 3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_x_away_3&#39;</span><span class="p">]</span>
<a id="__codelineno-1-47" name="__codelineno-1-47" href="#__codelineno-1-47"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_2 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-48" name="__codelineno-1-48" href="#__codelineno-1-48"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_2 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_x_away_1&#39;</span><span class="p">]</span>
<a id="__codelineno-1-49" name="__codelineno-1-49" href="#__codelineno-1-49"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_2 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_x_away_2&#39;</span><span class="p">]</span>
<a id="__codelineno-1-50" name="__codelineno-1-50" href="#__codelineno-1-50"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_2 - 3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_x_away_3&#39;</span><span class="p">]</span>
<a id="__codelineno-1-51" name="__codelineno-1-51" href="#__codelineno-1-51"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_3 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_3_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-52" name="__codelineno-1-52" href="#__codelineno-1-52"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_3 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_3_x_away_1&#39;</span><span class="p">]</span> 
<a id="__codelineno-1-53" name="__codelineno-1-53" href="#__codelineno-1-53"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_3 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_3_x_away_2&#39;</span><span class="p">]</span>
<a id="__codelineno-1-54" name="__codelineno-1-54" href="#__codelineno-1-54"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_3 - 3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_3_x_away_3&#39;</span><span class="p">]</span>
<a id="__codelineno-1-55" name="__codelineno-1-55" href="#__codelineno-1-55"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_Any Other Home Win&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-56" name="__codelineno-1-56" href="#__codelineno-1-56"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_Any Other Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-57" name="__codelineno-1-57" href="#__codelineno-1-57"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Correct Score_Any Other Away Win&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-58" name="__codelineno-1-58" href="#__codelineno-1-58"></a>
<a id="__codelineno-1-59" name="__codelineno-1-59" href="#__codelineno-1-59"></a>    <span class="c1"># Over/Under 5.5 Goals</span>
<a id="__codelineno-1-60" name="__codelineno-1-60" href="#__codelineno-1-60"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 5.5 Goals_Over 5.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">5.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-61" name="__codelineno-1-61" href="#__codelineno-1-61"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 5.5 Goals_Under 5.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 5.5 Goals_Over 5.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-62" name="__codelineno-1-62" href="#__codelineno-1-62"></a>
<a id="__codelineno-1-63" name="__codelineno-1-63" href="#__codelineno-1-63"></a>    <span class="c1"># Over/Under 4.5 Goals</span>
<a id="__codelineno-1-64" name="__codelineno-1-64" href="#__codelineno-1-64"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 4.5 Goals_Over 4.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">4.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-65" name="__codelineno-1-65" href="#__codelineno-1-65"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 4.5 Goals_Under 4.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 4.5 Goals_Over 4.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-66" name="__codelineno-1-66" href="#__codelineno-1-66"></a>
<a id="__codelineno-1-67" name="__codelineno-1-67" href="#__codelineno-1-67"></a>    <span class="c1"># Over/Under 3.5 Goals</span>
<a id="__codelineno-1-68" name="__codelineno-1-68" href="#__codelineno-1-68"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 3.5 Goals_Over 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">3.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-69" name="__codelineno-1-69" href="#__codelineno-1-69"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 3.5 Goals_Under 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 3.5 Goals_Over 3.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-70" name="__codelineno-1-70" href="#__codelineno-1-70"></a>
<a id="__codelineno-1-71" name="__codelineno-1-71" href="#__codelineno-1-71"></a>    <span class="c1"># Over/Under 2.5 Goals</span>
<a id="__codelineno-1-72" name="__codelineno-1-72" href="#__codelineno-1-72"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 2.5 Goals_Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-73" name="__codelineno-1-73" href="#__codelineno-1-73"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 2.5 Goals_Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 2.5 Goals_Over 2.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-74" name="__codelineno-1-74" href="#__codelineno-1-74"></a>
<a id="__codelineno-1-75" name="__codelineno-1-75" href="#__codelineno-1-75"></a>    <span class="c1"># Over/Under 1.5 Goals</span>
<a id="__codelineno-1-76" name="__codelineno-1-76" href="#__codelineno-1-76"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 1.5 Goals_Over 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-77" name="__codelineno-1-77" href="#__codelineno-1-77"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 1.5 Goals_Under 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 1.5 Goals_Over 1.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-78" name="__codelineno-1-78" href="#__codelineno-1-78"></a>
<a id="__codelineno-1-79" name="__codelineno-1-79" href="#__codelineno-1-79"></a>    <span class="c1"># Over/Under 0.5 Goals</span>
<a id="__codelineno-1-80" name="__codelineno-1-80" href="#__codelineno-1-80"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 0.5 Goals_Under 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-81" name="__codelineno-1-81" href="#__codelineno-1-81"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Over/Under 0.5 Goals_Over 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_x_away_0&#39;</span><span class="p">]</span>
<a id="__codelineno-1-82" name="__codelineno-1-82" href="#__codelineno-1-82"></a>
<a id="__codelineno-1-83" name="__codelineno-1-83" href="#__codelineno-1-83"></a>    <span class="c1"># Home Over/Under 0.5 Goals</span>
<a id="__codelineno-1-84" name="__codelineno-1-84" href="#__codelineno-1-84"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Over/Under 0.5 Goals_Over 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-85" name="__codelineno-1-85" href="#__codelineno-1-85"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Over/Under 0.5 Goals_Under 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-86" name="__codelineno-1-86" href="#__codelineno-1-86"></a>
<a id="__codelineno-1-87" name="__codelineno-1-87" href="#__codelineno-1-87"></a>    <span class="c1"># Home Over/Under 1.5 Goals</span>
<a id="__codelineno-1-88" name="__codelineno-1-88" href="#__codelineno-1-88"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Over/Under 1.5 Goals_Over 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-89" name="__codelineno-1-89" href="#__codelineno-1-89"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Over/Under 1.5 Goals_Under 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-90" name="__codelineno-1-90" href="#__codelineno-1-90"></a>
<a id="__codelineno-1-91" name="__codelineno-1-91" href="#__codelineno-1-91"></a>    <span class="c1"># Home Over/Under 2.5 Goals</span>
<a id="__codelineno-1-92" name="__codelineno-1-92" href="#__codelineno-1-92"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Over/Under 2.5 Goals_Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-93" name="__codelineno-1-93" href="#__codelineno-1-93"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Over/Under 2.5 Goals_Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mf">2.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-94" name="__codelineno-1-94" href="#__codelineno-1-94"></a>
<a id="__codelineno-1-95" name="__codelineno-1-95" href="#__codelineno-1-95"></a>    <span class="c1"># Away Over/Under 0.5 Goals</span>
<a id="__codelineno-1-96" name="__codelineno-1-96" href="#__codelineno-1-96"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Over/Under 0.5 Goals_Over 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-97" name="__codelineno-1-97" href="#__codelineno-1-97"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Over/Under 0.5 Goals_Under 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-98" name="__codelineno-1-98" href="#__codelineno-1-98"></a>
<a id="__codelineno-1-99" name="__codelineno-1-99" href="#__codelineno-1-99"></a>    <span class="c1"># Away Over/Under 1.5 Goals</span>
<a id="__codelineno-1-100" name="__codelineno-1-100" href="#__codelineno-1-100"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Over/Under 1.5 Goals_Over 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-101" name="__codelineno-1-101" href="#__codelineno-1-101"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Over/Under 1.5 Goals_Under 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mf">1.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-102" name="__codelineno-1-102" href="#__codelineno-1-102"></a>
<a id="__codelineno-1-103" name="__codelineno-1-103" href="#__codelineno-1-103"></a>    <span class="c1"># Away Over/Under 2.5 Goals</span>
<a id="__codelineno-1-104" name="__codelineno-1-104" href="#__codelineno-1-104"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Over/Under 2.5 Goals_Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-105" name="__codelineno-1-105" href="#__codelineno-1-105"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Over/Under 2.5 Goals_Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mf">2.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-106" name="__codelineno-1-106" href="#__codelineno-1-106"></a>
<a id="__codelineno-1-107" name="__codelineno-1-107" href="#__codelineno-1-107"></a>    <span class="c1"># Match Odds &amp; O/U 2.5 Goals</span>
<a id="__codelineno-1-108" name="__codelineno-1-108" href="#__codelineno-1-108"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 2.5 Goals_Home/Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-109" name="__codelineno-1-109" href="#__codelineno-1-109"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 2.5 Goals_Home/Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-110" name="__codelineno-1-110" href="#__codelineno-1-110"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 2.5 Goals_Draw/Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-111" name="__codelineno-1-111" href="#__codelineno-1-111"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 2.5 Goals_Draw/Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-112" name="__codelineno-1-112" href="#__codelineno-1-112"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 2.5 Goals_Away/Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-113" name="__codelineno-1-113" href="#__codelineno-1-113"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 2.5 Goals_Away/Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-114" name="__codelineno-1-114" href="#__codelineno-1-114"></a>
<a id="__codelineno-1-115" name="__codelineno-1-115" href="#__codelineno-1-115"></a>    <span class="c1"># Match Odds &amp; O/U 3.5 Goals</span>
<a id="__codelineno-1-116" name="__codelineno-1-116" href="#__codelineno-1-116"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 3.5 Goals_Home/Over 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-117" name="__codelineno-1-117" href="#__codelineno-1-117"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 3.5 Goals_Home/Under 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-118" name="__codelineno-1-118" href="#__codelineno-1-118"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 3.5 Goals_Draw/Over 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-119" name="__codelineno-1-119" href="#__codelineno-1-119"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 3.5 Goals_Draw/Under 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span>  <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-120" name="__codelineno-1-120" href="#__codelineno-1-120"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 3.5 Goals_Away/Over 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-121" name="__codelineno-1-121" href="#__codelineno-1-121"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds And Over/Under 3.5 Goals_Away/Under 3.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">3.5</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-122" name="__codelineno-1-122" href="#__codelineno-1-122"></a>
<a id="__codelineno-1-123" name="__codelineno-1-123" href="#__codelineno-1-123"></a>    <span class="c1"># Home Win To Nil</span>
<a id="__codelineno-1-124" name="__codelineno-1-124" href="#__codelineno-1-124"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Win To Nil_Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-125" name="__codelineno-1-125" href="#__codelineno-1-125"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Win To Nil_No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home Win To Nil_Yes&#39;</span><span class="p">]</span>
<a id="__codelineno-1-126" name="__codelineno-1-126" href="#__codelineno-1-126"></a>
<a id="__codelineno-1-127" name="__codelineno-1-127" href="#__codelineno-1-127"></a>    <span class="c1"># Away Win To Nil</span>
<a id="__codelineno-1-128" name="__codelineno-1-128" href="#__codelineno-1-128"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Win To Nil_Yes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-129" name="__codelineno-1-129" href="#__codelineno-1-129"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Win To Nil_No&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away Win To Nil_Yes&#39;</span><span class="p">]</span>
<a id="__codelineno-1-130" name="__codelineno-1-130" href="#__codelineno-1-130"></a>
<a id="__codelineno-1-131" name="__codelineno-1-131" href="#__codelineno-1-131"></a>    <span class="c1"># Home +1</span>
<a id="__codelineno-1-132" name="__codelineno-1-132" href="#__codelineno-1-132"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +1_Home +1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-133" name="__codelineno-1-133" href="#__codelineno-1-133"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +1_Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-134" name="__codelineno-1-134" href="#__codelineno-1-134"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +1_Away -1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-135" name="__codelineno-1-135" href="#__codelineno-1-135"></a>
<a id="__codelineno-1-136" name="__codelineno-1-136" href="#__codelineno-1-136"></a>    <span class="c1"># Away +1</span>
<a id="__codelineno-1-137" name="__codelineno-1-137" href="#__codelineno-1-137"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +1_Away +1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-138" name="__codelineno-1-138" href="#__codelineno-1-138"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +1_Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-139" name="__codelineno-1-139" href="#__codelineno-1-139"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +1_Home -1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-140" name="__codelineno-1-140" href="#__codelineno-1-140"></a>
<a id="__codelineno-1-141" name="__codelineno-1-141" href="#__codelineno-1-141"></a>    <span class="c1"># Home +2</span>
<a id="__codelineno-1-142" name="__codelineno-1-142" href="#__codelineno-1-142"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +2_Home +2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-143" name="__codelineno-1-143" href="#__codelineno-1-143"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +2_Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-144" name="__codelineno-1-144" href="#__codelineno-1-144"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +2_Away -2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-145" name="__codelineno-1-145" href="#__codelineno-1-145"></a>
<a id="__codelineno-1-146" name="__codelineno-1-146" href="#__codelineno-1-146"></a>    <span class="c1"># Away +2</span>
<a id="__codelineno-1-147" name="__codelineno-1-147" href="#__codelineno-1-147"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +2_Away +2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-148" name="__codelineno-1-148" href="#__codelineno-1-148"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +2_Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-149" name="__codelineno-1-149" href="#__codelineno-1-149"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +2_Home -2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-150" name="__codelineno-1-150" href="#__codelineno-1-150"></a>
<a id="__codelineno-1-151" name="__codelineno-1-151" href="#__codelineno-1-151"></a>    <span class="c1"># Home +3</span>
<a id="__codelineno-1-152" name="__codelineno-1-152" href="#__codelineno-1-152"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +3_Home +3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-153" name="__codelineno-1-153" href="#__codelineno-1-153"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +3_Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-154" name="__codelineno-1-154" href="#__codelineno-1-154"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Home +3_Away -3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-155" name="__codelineno-1-155" href="#__codelineno-1-155"></a>
<a id="__codelineno-1-156" name="__codelineno-1-156" href="#__codelineno-1-156"></a>    <span class="c1"># Away +3</span>
<a id="__codelineno-1-157" name="__codelineno-1-157" href="#__codelineno-1-157"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +3_Away +3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-158" name="__codelineno-1-158" href="#__codelineno-1-158"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +3_Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">==</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-159" name="__codelineno-1-159" href="#__codelineno-1-159"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Away +3_Home -3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">full_time_indices</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-160" name="__codelineno-1-160" href="#__codelineno-1-160"></a>
<a id="__codelineno-1-161" name="__codelineno-1-161" href="#__codelineno-1-161"></a>    <span class="c1"># Half Time Result</span>
<a id="__codelineno-1-162" name="__codelineno-1-162" href="#__codelineno-1-162"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_ht&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-163" name="__codelineno-1-163" href="#__codelineno-1-163"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_The Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht_x_away_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">half_time_indices</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-164" name="__codelineno-1-164" href="#__codelineno-1-164"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_ht&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-165" name="__codelineno-1-165" href="#__codelineno-1-165"></a>
<a id="__codelineno-1-166" name="__codelineno-1-166" href="#__codelineno-1-166"></a>    <span class="c1"># Half Time / Full Time</span>
<a id="__codelineno-1-167" name="__codelineno-1-167" href="#__codelineno-1-167"></a>    <span class="c1"># This is a simplication as the half time result and full time result are not independent. This market may require separate modelling</span>
<a id="__codelineno-1-168" name="__codelineno-1-168" href="#__codelineno-1-168"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Home/Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Home&#39;</span><span class="p">]</span>
<a id="__codelineno-1-169" name="__codelineno-1-169" href="#__codelineno-1-169"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Home/Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Home&#39;</span><span class="p">]</span>
<a id="__codelineno-1-170" name="__codelineno-1-170" href="#__codelineno-1-170"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Home/Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Home&#39;</span><span class="p">]</span>
<a id="__codelineno-1-171" name="__codelineno-1-171" href="#__codelineno-1-171"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Draw/Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_The Draw&#39;</span><span class="p">]</span>
<a id="__codelineno-1-172" name="__codelineno-1-172" href="#__codelineno-1-172"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Draw/Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_The Draw&#39;</span><span class="p">]</span>
<a id="__codelineno-1-173" name="__codelineno-1-173" href="#__codelineno-1-173"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Draw/Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_The Draw&#39;</span><span class="p">]</span>
<a id="__codelineno-1-174" name="__codelineno-1-174" href="#__codelineno-1-174"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Away/Home&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Home&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Away&#39;</span><span class="p">]</span>
<a id="__codelineno-1-175" name="__codelineno-1-175" href="#__codelineno-1-175"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Away/Draw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_The Draw&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Away&#39;</span><span class="p">]</span>
<a id="__codelineno-1-176" name="__codelineno-1-176" href="#__codelineno-1-176"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time/Full Time_Away/Away&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Match Odds_Away&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time_Away&#39;</span><span class="p">]</span>
<a id="__codelineno-1-177" name="__codelineno-1-177" href="#__codelineno-1-177"></a>
<a id="__codelineno-1-178" name="__codelineno-1-178" href="#__codelineno-1-178"></a>    <span class="c1"># First Half Over/Under 2.5 Goals</span>
<a id="__codelineno-1-179" name="__codelineno-1-179" href="#__codelineno-1-179"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 2.5_Over 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_ht&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">2.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-180" name="__codelineno-1-180" href="#__codelineno-1-180"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 2.5_Under 2.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 2.5_Over 2.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-181" name="__codelineno-1-181" href="#__codelineno-1-181"></a>
<a id="__codelineno-1-182" name="__codelineno-1-182" href="#__codelineno-1-182"></a>    <span class="c1"># First Half Over/Under 1.5 Goals</span>
<a id="__codelineno-1-183" name="__codelineno-1-183" href="#__codelineno-1-183"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 1.5_Over 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_ht&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-184" name="__codelineno-1-184" href="#__codelineno-1-184"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 1.5_Under 1.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 1.5_Over 1.5 Goals&#39;</span><span class="p">]</span>
<a id="__codelineno-1-185" name="__codelineno-1-185" href="#__codelineno-1-185"></a>
<a id="__codelineno-1-186" name="__codelineno-1-186" href="#__codelineno-1-186"></a>    <span class="c1"># First Half Over/Under 0.5 Goals</span>
<a id="__codelineno-1-187" name="__codelineno-1-187" href="#__codelineno-1-187"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 0.5_Under 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_ht_x_away_0_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-188" name="__codelineno-1-188" href="#__codelineno-1-188"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;First Half Goals 0.5_Over 0.5 Goals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_ht_x_away_0_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-189" name="__codelineno-1-189" href="#__codelineno-1-189"></a>
<a id="__codelineno-1-190" name="__codelineno-1-190" href="#__codelineno-1-190"></a>    <span class="c1"># Half Time Score</span>
<a id="__codelineno-1-191" name="__codelineno-1-191" href="#__codelineno-1-191"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_0 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_ht_x_away_0_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-192" name="__codelineno-1-192" href="#__codelineno-1-192"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_0 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_ht_x_away_1_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-193" name="__codelineno-1-193" href="#__codelineno-1-193"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_0 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_0_ht_x_away_2_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-194" name="__codelineno-1-194" href="#__codelineno-1-194"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_1 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_ht_x_away_0_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-195" name="__codelineno-1-195" href="#__codelineno-1-195"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_1 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_ht_x_away_1_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-196" name="__codelineno-1-196" href="#__codelineno-1-196"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_1 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_1_ht_x_away_2_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-197" name="__codelineno-1-197" href="#__codelineno-1-197"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_2 - 0&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_ht_x_away_0_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-198" name="__codelineno-1-198" href="#__codelineno-1-198"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_2 - 1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_ht_x_away_1_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-199" name="__codelineno-1-199" href="#__codelineno-1-199"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_2 - 2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;home_2_ht_x_away_2_ht&#39;</span><span class="p">]</span>
<a id="__codelineno-1-200" name="__codelineno-1-200" href="#__codelineno-1-200"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Half Time Score_Any Unquoted &#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;home_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">_ht_x_away_</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">_ht&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">half_time_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-201" name="__codelineno-1-201" href="#__codelineno-1-201"></a>
<a id="__codelineno-1-202" name="__codelineno-1-202" href="#__codelineno-1-202"></a>    <span class="c1"># Reshape the dataframe to keep only required columns for our simulations</span>
<a id="__codelineno-1-203" name="__codelineno-1-203" href="#__codelineno-1-203"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">new_column_names</span><span class="p">)</span>
<a id="__codelineno-1-204" name="__codelineno-1-204" href="#__codelineno-1-204"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;match_id&#39;</span><span class="p">,</span><span class="s1">&#39;goalsScored_home&#39;</span><span class="p">,</span><span class="s1">&#39;goalsScored_away&#39;</span><span class="p">,</span><span class="s1">&#39;halfTimeGoalsScored_home&#39;</span><span class="p">,</span><span class="s1">&#39;halfTimeGoalsScored_away&#39;</span><span class="p">])</span>
<a id="__codelineno-1-205" name="__codelineno-1-205" href="#__codelineno-1-205"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;date_home&#39;</span><span class="p">:</span><span class="s1">&#39;event_date&#39;</span><span class="p">})</span>
<a id="__codelineno-1-206" name="__codelineno-1-206" href="#__codelineno-1-206"></a>    <span class="n">df</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;fixture&#39;</span><span class="p">,</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;name_home&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; v &#39;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;name_away&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">))</span>
<a id="__codelineno-1-207" name="__codelineno-1-207" href="#__codelineno-1-207"></a>
<a id="__codelineno-1-208" name="__codelineno-1-208" href="#__codelineno-1-208"></a>    <span class="c1"># Create a rated price for each column, and ensuring that each rating is in the range valid for the exchange (1.01-1000)</span>
<a id="__codelineno-1-209" name="__codelineno-1-209" href="#__codelineno-1-209"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-1-210" name="__codelineno-1-210" href="#__codelineno-1-210"></a>        <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;event_date&#39;</span><span class="p">,</span><span class="s1">&#39;name_home&#39;</span><span class="p">,</span><span class="s1">&#39;name_away&#39;</span><span class="p">,</span><span class="s1">&#39;fixture&#39;</span><span class="p">]:</span>
<a id="__codelineno-1-211" name="__codelineno-1-211" href="#__codelineno-1-211"></a>            <span class="c1"># Avoid division by zero by replacing zeroes with 0.001 before taking the reciprocal</span>
<a id="__codelineno-1-212" name="__codelineno-1-212" href="#__codelineno-1-212"></a>            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">)</span>
<a id="__codelineno-1-213" name="__codelineno-1-213" href="#__codelineno-1-213"></a>            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># Round to 2 decimal places</span>
<a id="__codelineno-1-214" name="__codelineno-1-214" href="#__codelineno-1-214"></a>            <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lower</span><span class="o">=</span><span class="mf">1.01</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span> <span class="c1"># Restrict rated prices to exchange min/max prices</span>
<a id="__codelineno-1-215" name="__codelineno-1-215" href="#__codelineno-1-215"></a>
<a id="__codelineno-1-216" name="__codelineno-1-216" href="#__codelineno-1-216"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-1-217" name="__codelineno-1-217" href="#__codelineno-1-217"></a><span class="sd">    The below code block is to transform the dataframe from one row per match to having one row per market/selection</span>
<a id="__codelineno-1-218" name="__codelineno-1-218" href="#__codelineno-1-218"></a>
<a id="__codelineno-1-219" name="__codelineno-1-219" href="#__codelineno-1-219"></a><span class="sd">    Pre-Transformation Shape: 144 columns x 727 rows</span>
<a id="__codelineno-1-220" name="__codelineno-1-220" href="#__codelineno-1-220"></a><span class="sd">    Post-Transformation Shape: 5 columns x 92,202 rows</span>
<a id="__codelineno-1-221" name="__codelineno-1-221" href="#__codelineno-1-221"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-1-222" name="__codelineno-1-222" href="#__codelineno-1-222"></a>    <span class="c1"># Initialize an empty list to store the sub-DataFrames</span>
<a id="__codelineno-1-223" name="__codelineno-1-223" href="#__codelineno-1-223"></a>    <span class="n">sub_dfs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-1-224" name="__codelineno-1-224" href="#__codelineno-1-224"></a>
<a id="__codelineno-1-225" name="__codelineno-1-225" href="#__codelineno-1-225"></a>    <span class="c1"># Get the list of columns excluding the first four</span>
<a id="__codelineno-1-226" name="__codelineno-1-226" href="#__codelineno-1-226"></a>    <span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<a id="__codelineno-1-227" name="__codelineno-1-227" href="#__codelineno-1-227"></a>
<a id="__codelineno-1-228" name="__codelineno-1-228" href="#__codelineno-1-228"></a>    <span class="c1"># Loop through each column</span>
<a id="__codelineno-1-229" name="__codelineno-1-229" href="#__codelineno-1-229"></a>    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">columns</span><span class="p">:</span>
<a id="__codelineno-1-230" name="__codelineno-1-230" href="#__codelineno-1-230"></a>        <span class="c1"># Create a sub-DataFrame with the first four columns and the current column</span>
<a id="__codelineno-1-231" name="__codelineno-1-231" href="#__codelineno-1-231"></a>        <span class="n">sub_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-1-232" name="__codelineno-1-232" href="#__codelineno-1-232"></a>        <span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;rated_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
<a id="__codelineno-1-233" name="__codelineno-1-233" href="#__codelineno-1-233"></a>        <span class="c1"># Extract market_name and runner_name from the column name</span>
<a id="__codelineno-1-234" name="__codelineno-1-234" href="#__codelineno-1-234"></a>        <span class="n">market_name</span><span class="p">,</span> <span class="n">runner_name</span> <span class="o">=</span> <span class="n">col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-235" name="__codelineno-1-235" href="#__codelineno-1-235"></a>        <span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;market_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_name</span>
<a id="__codelineno-1-236" name="__codelineno-1-236" href="#__codelineno-1-236"></a>        <span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;runner_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runner_name</span>
<a id="__codelineno-1-237" name="__codelineno-1-237" href="#__codelineno-1-237"></a>
<a id="__codelineno-1-238" name="__codelineno-1-238" href="#__codelineno-1-238"></a>        <span class="c1"># Define a function to replace &#39;Home&#39; and &#39;Away&#39; only if &#39;Any Other&#39; is not in the string</span>
<a id="__codelineno-1-239" name="__codelineno-1-239" href="#__codelineno-1-239"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">replace_names</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">home_name</span><span class="p">,</span> <span class="n">away_name</span><span class="p">):</span>
<a id="__codelineno-1-240" name="__codelineno-1-240" href="#__codelineno-1-240"></a>            <span class="k">if</span> <span class="s1">&#39;Any Other&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span> <span class="ow">and</span> <span class="s1">&#39; Or &#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
<a id="__codelineno-1-241" name="__codelineno-1-241" href="#__codelineno-1-241"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Home&#39;</span><span class="p">,</span> <span class="n">home_name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Away&#39;</span><span class="p">,</span> <span class="n">away_name</span><span class="p">)</span>
<a id="__codelineno-1-242" name="__codelineno-1-242" href="#__codelineno-1-242"></a>            <span class="k">return</span> <span class="n">value</span>
<a id="__codelineno-1-243" name="__codelineno-1-243" href="#__codelineno-1-243"></a>
<a id="__codelineno-1-244" name="__codelineno-1-244" href="#__codelineno-1-244"></a>        <span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;market_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">replace_names</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;market_name&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name_home&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name_away&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-245" name="__codelineno-1-245" href="#__codelineno-1-245"></a>        <span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;runner_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">replace_names</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;runner_name&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name_home&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;name_away&#39;</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-1-246" name="__codelineno-1-246" href="#__codelineno-1-246"></a>
<a id="__codelineno-1-247" name="__codelineno-1-247" href="#__codelineno-1-247"></a>        <span class="c1"># Add the sub-DataFrame to the list</span>
<a id="__codelineno-1-248" name="__codelineno-1-248" href="#__codelineno-1-248"></a>        <span class="n">sub_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_df</span><span class="p">)</span>
<a id="__codelineno-1-249" name="__codelineno-1-249" href="#__codelineno-1-249"></a>
<a id="__codelineno-1-250" name="__codelineno-1-250" href="#__codelineno-1-250"></a>    <span class="c1"># Concatenate all sub-DataFrames</span>
<a id="__codelineno-1-251" name="__codelineno-1-251" href="#__codelineno-1-251"></a>    <span class="n">final_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">sub_dfs</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-1-252" name="__codelineno-1-252" href="#__codelineno-1-252"></a>    <span class="n">final_df</span> <span class="o">=</span> <span class="n">final_df</span><span class="p">[[</span><span class="s1">&#39;event_date&#39;</span><span class="p">,</span><span class="s1">&#39;fixture&#39;</span><span class="p">,</span><span class="s1">&#39;market_name&#39;</span><span class="p">,</span><span class="s1">&#39;runner_name&#39;</span><span class="p">,</span><span class="s1">&#39;rated_price&#39;</span><span class="p">]]</span>
<a id="__codelineno-1-253" name="__codelineno-1-253" href="#__codelineno-1-253"></a>
<a id="__codelineno-1-254" name="__codelineno-1-254" href="#__codelineno-1-254"></a>    <span class="k">return</span> <span class="n">final_df</span>
<a id="__codelineno-1-255" name="__codelineno-1-255" href="#__codelineno-1-255"></a>
<a id="__codelineno-1-256" name="__codelineno-1-256" href="#__codelineno-1-256"></a><span class="n">models</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">,</span><span class="s1">&#39;LGBMClassifier&#39;</span><span class="p">,</span><span class="s1">&#39;KNeighborsClassifier&#39;</span><span class="p">,</span><span class="s1">&#39;RandomForestClassifier&#39;</span><span class="p">,</span><span class="s1">&#39;LogisticsRegression&#39;</span><span class="p">,</span><span class="s1">&#39;GradientBoostingClassifier&#39;</span><span class="p">]</span>
<a id="__codelineno-1-257" name="__codelineno-1-257" href="#__codelineno-1-257"></a>
<a id="__codelineno-1-258" name="__codelineno-1-258" href="#__codelineno-1-258"></a><span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
<a id="__codelineno-1-259" name="__codelineno-1-259" href="#__codelineno-1-259"></a>
<a id="__codelineno-1-260" name="__codelineno-1-260" href="#__codelineno-1-260"></a>    <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_model_results.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-1-261" name="__codelineno-1-261" href="#__codelineno-1-261"></a>    <span class="n">final_df</span> <span class="o">=</span> <span class="n">process_model_predictions</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<a id="__codelineno-1-262" name="__codelineno-1-262" href="#__codelineno-1-262"></a>    <span class="c1"># Write our predictions to a csv file for our simulations</span>
<a id="__codelineno-1-263" name="__codelineno-1-263" href="#__codelineno-1-263"></a>    <span class="n">final_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_model_results_processed.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
Following this we've applied the models to our test set (on which we'll run our simulations) and then generated rated prices for a (non-exhaustive) list of popular markets present on English Premier League matches. </p>
<p>Player markets are not modelled here due to the nature of the dataset but this method could be applied to Cards, Corners and Shots as these fields are all present in our training data. </p>
<p>There are a subset of markets which are only loaded in-play if required (e.g. Over/Under 10.5 Goals) which have been excluded. Markets like Over/Under 8.5 Goals exist but usually contain very little liquidity unless the goal count approaches that value (i.e. scores are unusually high and most volume will come in-play).</p>
<p>Now our model outputs for Arsenal v Leicester look like:</p>
<table>
<thead>
<tr>
<th>event_date</th>
<th>fixture</th>
<th>market_name</th>
<th>runner_name</th>
<th>rated_price</th>
</tr>
</thead>
<tbody>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Both Teams To Score?</td>
<td>Yes</td>
<td>1.96</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Both Teams To Score?</td>
<td>No</td>
<td>2.05</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds</td>
<td>Arsenal</td>
<td>1.7</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds</td>
<td>The Draw</td>
<td>4.44</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds</td>
<td>Leicester</td>
<td>5.32</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Draw No Bet</td>
<td>Arsenal</td>
<td>1.32</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Draw No Bet</td>
<td>Leicester</td>
<td>4.12</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Double Chance</td>
<td>Home Or Away</td>
<td>1.29</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Double Chance</td>
<td>Home Or Draw</td>
<td>1.23</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Double Chance</td>
<td>Draw Or Away</td>
<td>2.42</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Both Teams To Score</td>
<td>Arsenal/Yes</td>
<td>3.33</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Both Teams To Score</td>
<td>Arsenal/No</td>
<td>3.49</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Both Teams To Score</td>
<td>Draw/Yes</td>
<td>8.69</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Both Teams To Score</td>
<td>Draw/No</td>
<td>9.08</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Both Teams To Score</td>
<td>Leicester/Yes</td>
<td>10.41</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Both Teams To Score</td>
<td>Leicester/No</td>
<td>10.88</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>0 - 0</td>
<td>16.25</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>0 - 1</td>
<td>17.44</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>0 - 2</td>
<td>39.08</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>0 - 3</td>
<td>108.73</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>1 - 0</td>
<td>8.68</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>1 - 1</td>
<td>9.31</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>1 - 2</td>
<td>20.87</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>1 - 3</td>
<td>58.06</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>2 - 0</td>
<td>8.84</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>2 - 1</td>
<td>9.48</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>2 - 2</td>
<td>21.25</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>2 - 3</td>
<td>59.13</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>3 - 0</td>
<td>18.34</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>3 - 1</td>
<td>19.69</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>3 - 2</td>
<td>44.11</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>3 - 3</td>
<td>122.74</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>Any Other Home Win</td>
<td>8</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>Any Other Draw</td>
<td>928.52</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Correct Score</td>
<td>Any Other Away Win</td>
<td>72.27</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 5.5 Goals</td>
<td>Over 5.5 Goals</td>
<td>16.73</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 5.5 Goals</td>
<td>Under 5.5 Goals</td>
<td>1.06</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 4.5 Goals</td>
<td>Over 4.5 Goals</td>
<td>6.79</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 4.5 Goals</td>
<td>Under 4.5 Goals</td>
<td>1.17</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 3.5 Goals</td>
<td>Over 3.5 Goals</td>
<td>3.3</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 3.5 Goals</td>
<td>Under 3.5 Goals</td>
<td>1.43</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 2.5 Goals</td>
<td>Over 2.5 Goals</td>
<td>1.92</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 2.5 Goals</td>
<td>Under 2.5 Goals</td>
<td>2.08</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 1.5 Goals</td>
<td>Over 1.5 Goals</td>
<td>1.31</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 1.5 Goals</td>
<td>Under 1.5 Goals</td>
<td>4.27</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 0.5 Goals</td>
<td>Under 0.5 Goals</td>
<td>16.25</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Over/Under 0.5 Goals</td>
<td>Over 0.5 Goals</td>
<td>1.07</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Over/Under 0.5 Goals</td>
<td>Over 0.5 Goals</td>
<td>1.18</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Over/Under 0.5 Goals</td>
<td>Under 0.5 Goals</td>
<td>6.41</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Over/Under 1.5 Goals</td>
<td>Over 1.5 Goals</td>
<td>1.81</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Over/Under 1.5 Goals</td>
<td>Under 1.5 Goals</td>
<td>2.23</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Over/Under 2.5 Goals</td>
<td>Over 2.5 Goals</td>
<td>3.78</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Over/Under 2.5 Goals</td>
<td>Under 2.5 Goals</td>
<td>1.36</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Over/Under 0.5 Goals</td>
<td>Over 0.5 Goals</td>
<td>1.65</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Over/Under 0.5 Goals</td>
<td>Under 0.5 Goals</td>
<td>2.54</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Over/Under 1.5 Goals</td>
<td>Over 1.5 Goals</td>
<td>4.2</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Over/Under 1.5 Goals</td>
<td>Under 1.5 Goals</td>
<td>1.31</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Over/Under 2.5 Goals</td>
<td>Over 2.5 Goals</td>
<td>13.48</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Over/Under 2.5 Goals</td>
<td>Under 2.5 Goals</td>
<td>1.08</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 2.5 Goals</td>
<td>Arsenal/Over 2.5 Goals</td>
<td>3.28</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 2.5 Goals</td>
<td>Arsenal/Under 2.5 Goals</td>
<td>3.55</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 2.5 Goals</td>
<td>Draw/Over 2.5 Goals</td>
<td>8.54</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 2.5 Goals</td>
<td>Draw/Under 2.5 Goals</td>
<td>9.25</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 2.5 Goals</td>
<td>Leicester/Over 2.5 Goals</td>
<td>10.23</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 2.5 Goals</td>
<td>Leicester/Under 2.5 Goals</td>
<td>11.07</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 3.5 Goals</td>
<td>Arsenal/Over 3.5 Goals</td>
<td>5.63</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 3.5 Goals</td>
<td>Arsenal/Under 3.5 Goals</td>
<td>2.44</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 3.5 Goals</td>
<td>Draw/Over 3.5 Goals</td>
<td>14.67</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 3.5 Goals</td>
<td>Draw/Under 3.5 Goals</td>
<td>6.37</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 3.5 Goals</td>
<td>Leicester/Over 3.5 Goals</td>
<td>17.57</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Match Odds And Over/Under 3.5 Goals</td>
<td>Leicester/Under 3.5 Goals</td>
<td>7.63</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Win To Nil</td>
<td>Yes</td>
<td>3</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal Win To Nil</td>
<td>No</td>
<td>1.5</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Win To Nil</td>
<td>Yes</td>
<td>10.58</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester Win To Nil</td>
<td>No</td>
<td>1.1</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +1</td>
<td>Arsenal +1</td>
<td>1.23</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +1</td>
<td>Draw</td>
<td>8.07</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +1</td>
<td>Leicester -1</td>
<td>15.6</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +1</td>
<td>Leicester +1</td>
<td>2.42</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +1</td>
<td>Draw</td>
<td>4.01</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +1</td>
<td>Arsenal -1</td>
<td>2.96</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +2</td>
<td>Arsenal +2</td>
<td>1.07</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +2</td>
<td>Draw</td>
<td>21.58</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +2</td>
<td>Leicester -2</td>
<td>56.26</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +2</td>
<td>Leicester +2</td>
<td>1.51</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +2</td>
<td>Draw</td>
<td>5.51</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +2</td>
<td>Arsenal -2</td>
<td>6.41</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +3</td>
<td>Arsenal +3</td>
<td>1.02</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +3</td>
<td>Draw</td>
<td>75.29</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Arsenal +3</td>
<td>Leicester -3</td>
<td>222.5</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +3</td>
<td>Leicester +3</td>
<td>1.18</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +3</td>
<td>Draw</td>
<td>10.58</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Leicester +3</td>
<td>Arsenal -3</td>
<td>16.25</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time</td>
<td>Arsenal</td>
<td>2.39</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time</td>
<td>The Draw</td>
<td>2.47</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time</td>
<td>Leicester</td>
<td>5.65</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Arsenal/Arsenal</td>
<td>4.08</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Arsenal/Draw</td>
<td>10.62</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Arsenal/Leicester</td>
<td>12.72</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Draw/Arsenal</td>
<td>4.21</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Draw/Draw</td>
<td>10.97</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Draw/Leicester</td>
<td>13.13</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Leicester/Arsenal</td>
<td>9.63</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Leicester/Draw</td>
<td>25.1</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time/Full Time</td>
<td>Leicester/Leicester</td>
<td>30.07</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>First Half Goals 2.5</td>
<td>Over 2.5 Goals</td>
<td>8.29</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>First Half Goals 2.5</td>
<td>Under 2.5 Goals</td>
<td>1.14</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>First Half Goals 1.5</td>
<td>Over 1.5 Goals</td>
<td>2.91</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>First Half Goals 1.5</td>
<td>Under 1.5 Goals</td>
<td>1.52</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>First Half Goals 0.5</td>
<td>Under 0.5 Goals</td>
<td>3.22</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>First Half Goals 0.5</td>
<td>Over 0.5 Goals</td>
<td>1.45</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>0 - 0</td>
<td>3.22</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>0 - 1</td>
<td>8.7</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>0 - 2</td>
<td>46.97</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>1 - 0</td>
<td>4.33</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>1 - 1</td>
<td>11.72</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>1 - 2</td>
<td>63.26</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>2 - 0</td>
<td>8.63</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>2 - 1</td>
<td>23.36</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>2 - 2</td>
<td>126.13</td>
</tr>
<tr>
<td>13/08/2022</td>
<td>Arsenal v Leicester</td>
<td>Half Time Score</td>
<td>Any Unquoted</td>
<td>18.5</td>
</tr>
</tbody>
</table>
<h2 id="flumine-simulation">Flumine Simulation</h2>
<p>Our next step is to take our results and run simulations on the Betfair Historical Stream Files. These files have a cost associated with them (Australia and New Zealand customers should reach out to us at automation@betfair.com.au to discuss options). We'll use Flumine and its simulation mode to run these tests as these tend to be accurate, and will also help us to test out our string matching against the exchange markets, as this is key to being able to place live bets. </p>
<p>It's important to note that the historic files do not contain cross-matching volume (also called virtual bets) or information from the market catalogue. So just be aware that live behaviour may not necessarily reflect the simulations. Runner information is contained within market_book.market_definition.runners so runner names will be available in the files.</p>
<h3 id="unzipping-the-files">Unzipping The Files</h3>
<p>Flumine requires the tar files to be unzipped to run the simulations so we'll iterate over the tar files to extract only the markets we need before commencing the simulation.</p>
<p>We'll quickly process our tar files using our super fast <strong>Rust</strong>-driven tutorial: <a href="https://betfair-datascientists.github.io/tutorials/jsonToCsvRevisited/">JSON to CSV Revisited</a></p>
<p>By doing so we've created a csv file where we can easily pick out the markets we want to use. (You can skip this step and use the flumine process of check_market_book to filter out unwanted markets)</p>
<ul>
<li><a href="../assets/EPL_Markets.csv">EPL Market CSV File</a></li>
</ul>
<div class="admonition info">
<p class="admonition-title">Market Ids</p>
<p>Market ids in the stream files are denoted by "1.XXXXXXXXX", however in the provided csv file we have removed the "1.".</p>
<p>In excel we do this using the formula: (marketId - 1) * 1000000000</p>
<p>We do this because excel likes to truncate trailing zeros on decimal numbers. The python line is provided below</p>
</div>
<div class="highlight"><span class="filename">Remove '1.' from market_id in Python</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">df</span><span class="p">[</span><span class="s1">&#39;MARKET_ID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;MARKET_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)[:</span><span class="mi">9</span><span class="p">])</span>
</code></pre></div>
<div class="highlight"><span class="filename">Unzip Historic Stream Files</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">tarfile</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">bz2</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="sd">Here we will specify the folder where we are storing our stream files and where we want to extract the files to</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="sd">The code will check if the output folder exists, and will create one if it does not.</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="sd">It will then check the folder and delete any files in the folder that are not tar or csv files</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="sd">This deletion is to clear any previously extracted stream files and will be much faster than manually deleting them</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="c1"># Specify the directory where your stream files are stored and where you want to extract the files</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="n">source_folder</span> <span class="o">=</span> <span class="s1">&#39;DIRECTORY OF DOWNLOADED FILES&#39;</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="n">output_folder</span> <span class="o">=</span> <span class="s1">&#39;DIRECTORY TO OUTPUT DECOMPRESSED STREAM FILES&#39;</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="c1"># Ensure the output folder exists</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="c1"># Get a list of all files in the directory</span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="n">files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">))</span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="c1"># Loop through the files and delete if they are not tar/csv files</span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tar&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">):</span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a>            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Deleted: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Error deleting </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="sd">The following section will iterate over all files in your folder, so the options to optimize are:</span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a>
<a id="__codelineno-3-37" name="__codelineno-3-37" href="#__codelineno-3-37"></a><span class="sd">    - Move the files you don&#39;t want to process to another folder</span>
<a id="__codelineno-3-38" name="__codelineno-3-38" href="#__codelineno-3-38"></a><span class="sd">    - Copy the files you do want to process to a new folder</span>
<a id="__codelineno-3-39" name="__codelineno-3-39" href="#__codelineno-3-39"></a><span class="sd">    - Use string matching to remove unwanted files from the tar_files list</span>
<a id="__codelineno-3-40" name="__codelineno-3-40" href="#__codelineno-3-40"></a><span class="sd">    - Manually specify each file by typing out a list</span>
<a id="__codelineno-3-41" name="__codelineno-3-41" href="#__codelineno-3-41"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-3-42" name="__codelineno-3-42" href="#__codelineno-3-42"></a>
<a id="__codelineno-3-43" name="__codelineno-3-43" href="#__codelineno-3-43"></a><span class="c1"># Iterate over all .tar files in the source folder</span>
<a id="__codelineno-3-44" name="__codelineno-3-44" href="#__codelineno-3-44"></a><span class="n">tar_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_folder</span><span class="p">,</span> <span class="s1">&#39;*.tar&#39;</span><span class="p">))</span>
<a id="__codelineno-3-45" name="__codelineno-3-45" href="#__codelineno-3-45"></a>
<a id="__codelineno-3-46" name="__codelineno-3-46" href="#__codelineno-3-46"></a><span class="k">def</span><span class="w"> </span><span class="nf">retrieve_betfair_markets</span><span class="p">():</span>
<a id="__codelineno-3-47" name="__codelineno-3-47" href="#__codelineno-3-47"></a>    <span class="n">markets</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;EPL_Markets.csv&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;MARKET_ID&#39;</span> <span class="p">:</span> <span class="nb">str</span><span class="p">})</span>
<a id="__codelineno-3-48" name="__codelineno-3-48" href="#__codelineno-3-48"></a>
<a id="__codelineno-3-49" name="__codelineno-3-49" href="#__codelineno-3-49"></a>    <span class="n">markets</span> <span class="o">=</span> <span class="n">markets</span><span class="p">[</span><span class="s1">&#39;MARKET_ID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-3-50" name="__codelineno-3-50" href="#__codelineno-3-50"></a>
<a id="__codelineno-3-51" name="__codelineno-3-51" href="#__codelineno-3-51"></a>    <span class="k">return</span> <span class="n">markets</span>
<a id="__codelineno-3-52" name="__codelineno-3-52" href="#__codelineno-3-52"></a>
<a id="__codelineno-3-53" name="__codelineno-3-53" href="#__codelineno-3-53"></a><span class="n">markets</span> <span class="o">=</span> <span class="n">retrieve_betfair_markets</span><span class="p">()</span>
<a id="__codelineno-3-54" name="__codelineno-3-54" href="#__codelineno-3-54"></a>
<a id="__codelineno-3-55" name="__codelineno-3-55" href="#__codelineno-3-55"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-3-56" name="__codelineno-3-56" href="#__codelineno-3-56"></a><span class="sd">The next code block here will iterate over each stream file and check if the market_id is in the list of our win market ids</span>
<a id="__codelineno-3-57" name="__codelineno-3-57" href="#__codelineno-3-57"></a><span class="sd">Only the win markets will be extracted to the folder.</span>
<a id="__codelineno-3-58" name="__codelineno-3-58" href="#__codelineno-3-58"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-3-59" name="__codelineno-3-59" href="#__codelineno-3-59"></a>
<a id="__codelineno-3-60" name="__codelineno-3-60" href="#__codelineno-3-60"></a><span class="k">for</span> <span class="n">tar_path</span> <span class="ow">in</span> <span class="n">tar_files</span><span class="p">:</span>
<a id="__codelineno-3-61" name="__codelineno-3-61" href="#__codelineno-3-61"></a>
<a id="__codelineno-3-62" name="__codelineno-3-62" href="#__codelineno-3-62"></a>    <span class="k">with</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tar_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tar</span><span class="p">:</span>
<a id="__codelineno-3-63" name="__codelineno-3-63" href="#__codelineno-3-63"></a>        <span class="c1"># Iterate over each file in the tar archive</span>
<a id="__codelineno-3-64" name="__codelineno-3-64" href="#__codelineno-3-64"></a>        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">tar</span><span class="o">.</span><span class="n">getmembers</span><span class="p">():</span>
<a id="__codelineno-3-65" name="__codelineno-3-65" href="#__codelineno-3-65"></a>            <span class="k">if</span> <span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.bz2&#39;</span><span class="p">):</span>
<a id="__codelineno-3-66" name="__codelineno-3-66" href="#__codelineno-3-66"></a>                <span class="c1"># Extract the .bz2 file to a temporary location</span>
<a id="__codelineno-3-67" name="__codelineno-3-67" href="#__codelineno-3-67"></a>                <span class="n">extracted_bz2_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
<a id="__codelineno-3-68" name="__codelineno-3-68" href="#__codelineno-3-68"></a>
<a id="__codelineno-3-69" name="__codelineno-3-69" href="#__codelineno-3-69"></a>                <span class="c1"># Determine the final output path by removing the .bz2 extension</span>
<a id="__codelineno-3-70" name="__codelineno-3-70" href="#__codelineno-3-70"></a>                <span class="n">final_output_path</span> <span class="o">=</span> <span class="n">extracted_bz2_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-3-71" name="__codelineno-3-71" href="#__codelineno-3-71"></a>                <span class="n">market_id</span> <span class="o">=</span> <span class="n">extracted_bz2_path</span><span class="p">[</span><span class="o">-</span><span class="mi">13</span><span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
<a id="__codelineno-3-72" name="__codelineno-3-72" href="#__codelineno-3-72"></a>
<a id="__codelineno-3-73" name="__codelineno-3-73" href="#__codelineno-3-73"></a>                <span class="k">if</span> <span class="n">market_id</span> <span class="ow">in</span> <span class="n">markets</span><span class="p">:</span>
<a id="__codelineno-3-74" name="__codelineno-3-74" href="#__codelineno-3-74"></a>
<a id="__codelineno-3-75" name="__codelineno-3-75" href="#__codelineno-3-75"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-3-76" name="__codelineno-3-76" href="#__codelineno-3-76"></a>                        <span class="k">with</span> <span class="n">tar</span><span class="o">.</span><span class="n">extractfile</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="k">as</span> <span class="n">extracted_file</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">extracted_bz2_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_bz2_file</span><span class="p">:</span>
<a id="__codelineno-3-77" name="__codelineno-3-77" href="#__codelineno-3-77"></a>                            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">extracted_file</span><span class="p">,</span> <span class="n">temp_bz2_file</span><span class="p">)</span>
<a id="__codelineno-3-78" name="__codelineno-3-78" href="#__codelineno-3-78"></a>
<a id="__codelineno-3-79" name="__codelineno-3-79" href="#__codelineno-3-79"></a>                        <span class="c1"># Extract the .bz2 file to the final destination</span>
<a id="__codelineno-3-80" name="__codelineno-3-80" href="#__codelineno-3-80"></a>                        <span class="k">with</span> <span class="n">bz2</span><span class="o">.</span><span class="n">BZ2File</span><span class="p">(</span><span class="n">extracted_bz2_path</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">bz2_file</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="n">final_output_path</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
<a id="__codelineno-3-81" name="__codelineno-3-81" href="#__codelineno-3-81"></a>                            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfileobj</span><span class="p">(</span><span class="n">bz2_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span>
<a id="__codelineno-3-82" name="__codelineno-3-82" href="#__codelineno-3-82"></a>
<a id="__codelineno-3-83" name="__codelineno-3-83" href="#__codelineno-3-83"></a>                        <span class="c1"># Remove the temporary .bz2 file</span>
<a id="__codelineno-3-84" name="__codelineno-3-84" href="#__codelineno-3-84"></a>                        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">extracted_bz2_path</span><span class="p">)</span>
<a id="__codelineno-3-85" name="__codelineno-3-85" href="#__codelineno-3-85"></a>
<a id="__codelineno-3-86" name="__codelineno-3-86" href="#__codelineno-3-86"></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extracted </span><span class="si">{</span><span class="n">member</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">final_output_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<a id="__codelineno-3-87" name="__codelineno-3-87" href="#__codelineno-3-87"></a>                    <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
<a id="__codelineno-3-88" name="__codelineno-3-88" href="#__codelineno-3-88"></a>                        <span class="k">pass</span>
</code></pre></div>
<h3 id="running-the-simulation">Running the Simulation</h3>
<p>Now that we've unzipped the files, we'll need to run the simulations on the files.</p>
<p><strong>Just a word of warning</strong>: This is not a fast process to run over two years of EPL data. It took my machine with 4 CPUs about 5 hours to pass over this data.
For ~27,000 markets this equated to about 1.6 seconds per market, which is quite reasonable. </p>
<p>The advice here is to use the check_market_book function to not process markets that you're not interested in (e.g. OVER/UNDER_8.5_GOALS, SHOTS_ON_TARGET).</p>
<p>There's a code snippet included after the simulation code that enables you to delete markets that you've already processed so the entire process doesn't need to be restarted if it crashes or needs to be paused.</p>
<div class="highlight"><span class="filename">Import modules and set-up logging</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="c1"># Import libraries</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pythonjsonlogger</span><span class="w"> </span><span class="kn">import</span> <span class="n">jsonlogger</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine</span><span class="w"> </span><span class="kn">import</span> <span class="n">FlumineSimulation</span><span class="p">,</span> <span class="n">BaseStrategy</span><span class="p">,</span> <span class="n">clients</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.order.trade</span><span class="w"> </span><span class="kn">import</span> <span class="n">Trade</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.order.order</span><span class="w"> </span><span class="kn">import</span> <span class="n">LimitOrder</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.order.ordertype</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderTypes</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.markets.market</span><span class="w"> </span><span class="kn">import</span> <span class="n">Market</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.controls.loggingcontrols</span><span class="w"> </span><span class="kn">import</span> <span class="n">LoggingControl</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="kn">from</span><span class="w"> </span><span class="nn">betfairlightweight.resources</span><span class="w"> </span><span class="kn">import</span> <span class="n">MarketBook</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pythonjsonlogger</span><span class="w"> </span><span class="kn">import</span> <span class="n">jsonlogger</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="kn">from</span><span class="w"> </span><span class="nn">concurrent</span><span class="w"> </span><span class="kn">import</span> <span class="n">futures</span> 
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flumine.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">price_ticks_away</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="kn">from</span><span class="w"> </span><span class="nn">multiprocessing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="c1"># Create a global lock</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="n">file_write_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="c1"># Create custom logger</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">()</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="c1"># Remove existing handlers to avoid duplicates</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="n">logger</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="c1"># Set up JSON formatter for the log file</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="n">log_handler</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">FileHandler</span><span class="p">(</span><span class="n">destination</span><span class="o">+</span><span class="s1">&#39;process_logs.log&#39;</span><span class="p">)</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="n">custom_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%(asctime)s</span><span class="s2"> </span><span class="si">%(levelname)s</span><span class="s2"> </span><span class="si">%(message)s</span><span class="s2">&quot;</span>
<a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="n">formatter</span> <span class="o">=</span> <span class="n">jsonlogger</span><span class="o">.</span><span class="n">JsonFormatter</span><span class="p">(</span><span class="n">custom_format</span><span class="p">)</span>
<a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="n">formatter</span><span class="o">.</span><span class="n">converter</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">gmtime</span>  <span class="c1"># Optional: Use UTC/GMT time for logs</span>
<a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="n">log_handler</span><span class="o">.</span><span class="n">setFormatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">log_handler</span><span class="p">)</span>
<a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a>
<a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="c1"># Ensure logs are only written to the file</span>
<a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="n">logger</span><span class="o">.</span><span class="n">propagate</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a>
<a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="c1"># Specify the folder where the unzipped stream files are stored</span>
<a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="n">source_folder</span> <span class="o">=</span> <span class="n">output_folder</span>
<a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a>
<a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="sd">This code file is designed to iterate over the folder with the previously unzipped stream files</span>
<a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="sd">and place simulated bets on selections at 10 minutes before kick-off</span>
<a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a>
<a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="sd">We will speed this process up using multi-threading</span>
<a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a>
<a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="c1"># Function to split our list into chunks</span>
<a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a><span class="k">def</span><span class="w"> </span><span class="nf">split_list</span><span class="p">(</span><span class="n">lst</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
<a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">),</span> <span class="n">chunk_size</span><span class="p">):</span>
<a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a>        <span class="k">yield</span> <span class="n">lst</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">chunk_size</span><span class="p">]</span>
<a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a>
<a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a><span class="c1"># Function to process the runner_book to gather each selection_id</span>
<a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_runner_books</span><span class="p">(</span><span class="n">runner_books</span><span class="p">):</span>
<a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a>    <span class="n">selection_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">runner_book</span><span class="o">.</span><span class="n">selection_id</span> <span class="k">for</span> <span class="n">runner_book</span> <span class="ow">in</span> <span class="n">runner_books</span><span class="p">]</span>
<a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a>
<a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
<a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a>        <span class="s1">&#39;selection_id&#39;</span><span class="p">:</span> <span class="n">selection_ids</span><span class="p">,</span>
<a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a>    <span class="p">})</span>
<a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a>    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;selection_id&#39;</span><span class="p">)</span>
<a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a>
<a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="c1"># Function to process the runner catalogue to gather all selection names</span>
<a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_runner_catalogue</span><span class="p">(</span><span class="n">market_book</span><span class="p">:</span> <span class="n">MarketBook</span><span class="p">):</span>
<a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a>
<a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a>    <span class="n">runners_df</span> <span class="o">=</span> <span class="n">process_runner_books</span><span class="p">(</span><span class="n">market_book</span><span class="o">.</span><span class="n">runners</span><span class="p">)</span>
<a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>
<a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a>    <span class="k">for</span> <span class="n">runner</span> <span class="ow">in</span> <span class="n">market_book</span><span class="o">.</span><span class="n">runners</span><span class="p">:</span>
<a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a>        <span class="n">runner_name</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">rd</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">runners</span> <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">selection_id</span> <span class="o">==</span> <span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
<a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a>        <span class="c1"># rstrip() removes any trailing white spaces</span>
<a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a>        <span class="n">runners_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span> <span class="s1">&#39;runner_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runner_name</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a>
<a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a>    <span class="k">return</span> <span class="n">runners_df</span>
<a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a>
<a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="c1"># Defining our flumine class</span>
<a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="k">class</span><span class="w"> </span><span class="nc">SoccerSimulation</span><span class="p">(</span><span class="n">BaseStrategy</span><span class="p">):</span>
<a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a>
<a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a><span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="sd">    The __init__ function defines what the strategy should do when it first fires</span>
<a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="sd">    We define our external dataframe where we have loaded our rated prices</span>
<a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="sd">    It is essential that we tie the dataframe to the class using a self definition</span>
<a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="sd">    We also define an empty list to use later</span>
<a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="sd">    &#39;&#39;&#39;</span>
<a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a>
<a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">processed_selection_ids</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_df_pruned</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruned_soccer_df</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a>
<a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a>        <span class="c1"># Read the model results CSV for the current model</span>
<a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">soccer_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
<a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a>            <span class="n">destination</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s1">_model_results_processed.csv&#39;</span><span class="p">,</span>
<a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a>            <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;event_date&#39;</span><span class="p">],</span>
<a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a>            <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>        <span class="p">)</span>
<a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a>
<a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">check_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">:</span> <span class="n">Market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">:</span> <span class="n">MarketBook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a><span class="sd">        process_market_book only executed if this returns True.</span>
<a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="sd">        if True is not returned then the framework will skip to the next market</span>
<a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a>        <span class="c1"># This check skips markets for the ring-fenced Italian and Spanish exchanges</span>
<a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a>        <span class="k">if</span> <span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">regulators</span> <span class="o">!=</span> <span class="p">[</span><span class="s2">&quot;MR_INT&quot;</span><span class="p">]:</span>
<a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a>            <span class="k">return</span> <span class="kc">False</span>
<a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>        <span class="k">if</span> <span class="n">market_book</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;CLOSED&quot;</span> <span class="ow">and</span> <span class="n">market_book</span><span class="o">.</span><span class="n">inplay</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
<a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a>            <span class="k">return</span> <span class="kc">True</span>
<a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a>
<a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">prune_soccer_df</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market_name</span><span class="p">,</span> <span class="n">event_date</span><span class="p">,</span> <span class="n">fixture</span><span class="p">):</span>
<a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
<a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a>        <span class="n">event_date</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">event_date</span><span class="p">)</span>
<a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a>
<a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_pruned_soccer_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">soccer_df</span><span class="p">[</span>
<a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soccer_df</span><span class="p">[</span><span class="s1">&#39;fixture&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">fixture</span><span class="p">)</span>
<a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soccer_df</span><span class="p">[</span><span class="s1">&#39;event_date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">event_date</span><span class="p">)</span>
<a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a>            <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">soccer_df</span><span class="p">[</span><span class="s1">&#39;market_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">market_name</span><span class="p">)</span>
<a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a>        <span class="p">]</span>
<a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a>
<a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pruned_soccer_df</span>
<a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a>
<a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">process_market_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">market</span><span class="p">:</span> <span class="n">Market</span><span class="p">,</span> <span class="n">market_book</span><span class="p">:</span> <span class="n">MarketBook</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a>
<a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a>        <span class="c1"># Create a dataframe with all the selection_ids and runner_names from the market</span>
<a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a>        <span class="n">runners_df</span> <span class="o">=</span> <span class="n">process_runner_catalogue</span><span class="p">(</span><span class="n">market_book</span><span class="p">)</span>
<a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a>        <span class="c1"># Define the event name as the fixture name e.g. Aston Villa v Chelsea</span>
<a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a>        <span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;fixture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">event_name</span>
<a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a>        <span class="c1"># Define the market name and ensure each word is capitalised</span>
<a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a>        <span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;market_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
<a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a>        <span class="c1"># Extract market_type</span>
<a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a>        <span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;market_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">market_type</span>
<a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a>        <span class="c1"># Extract the date from the market_time</span>
<a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a>        <span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;event_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">market_time</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a>        <span class="c1"># Ensure the event_date is datetime format</span>
<a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a>        <span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;event_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;event_date&#39;</span><span class="p">])</span>
<a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a>        <span class="c1"># Preserve the index as a column before merging</span>
<a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a>        <span class="n">runners_df</span><span class="p">[</span><span class="s1">&#39;selection_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">runners_df</span><span class="o">.</span><span class="n">index</span>
<a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a>
<a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a><span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a><span class="sd">        Flumine keeps track of the market_time as it moves through the market. When doing this merge,</span>
<a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a><span class="sd">        it will use the market_time at the point of the merge. There is some strange behaviour in the</span>
<a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a><span class="sd">        historic stream files where the market_time will change to a different date and then back to</span>
<a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a><span class="sd">        the original date back again. By using the counter we&#39;re able to ensure that we always have a</span>
<a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a><span class="sd">        rated price to bet with by retrying until we have a pruned ratings dataframe that isn&#39;t empty</span>
<a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a><span class="sd">        &#39;&#39;&#39;</span>
<a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a>        <span class="c1"># Merge the market info with our ratings dataframe</span>
<a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_df_pruned</span><span class="p">:</span>
<a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a>            <span class="n">retry_count</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a>            <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a>            <span class="k">while</span> <span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">max_retries</span><span class="p">:</span>
<a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a>                <span class="c1"># Attempt to prune the soccer dataframe</span>
<a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_pruned_soccer_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prune_soccer_df</span><span class="p">(</span>
<a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a>                    <span class="n">market_name</span><span class="o">=</span><span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span>
<a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a>                    <span class="n">event_date</span><span class="o">=</span><span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">market_time</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
<a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a>                    <span class="n">fixture</span><span class="o">=</span><span class="n">market_book</span><span class="o">.</span><span class="n">market_definition</span><span class="o">.</span><span class="n">event_name</span><span class="p">,</span>
<a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a>                <span class="p">)</span>
<a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a>
<a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a>                <span class="c1"># Check if the dataframe is not empty</span>
<a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pruned_soccer_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a>                    <span class="c1"># If successful, mark the flag and break out of the loop</span>
<a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_is_main_df_pruned</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a>                    <span class="n">retry_count</span> <span class="o">=</span> <span class="n">max_retries</span>
<a id="__codelineno-4-166" name="__codelineno-4-166" href="#__codelineno-4-166"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-167" name="__codelineno-4-167" href="#__codelineno-4-167"></a>                    <span class="c1"># Increment the retry counter and try again</span>
<a id="__codelineno-4-168" name="__codelineno-4-168" href="#__codelineno-4-168"></a>                    <span class="n">retry_count</span> <span class="o">+=</span> <span class="mi">1</span>
<a id="__codelineno-4-169" name="__codelineno-4-169" href="#__codelineno-4-169"></a>
<a id="__codelineno-4-170" name="__codelineno-4-170" href="#__codelineno-4-170"></a>        <span class="n">market_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span>
<a id="__codelineno-4-171" name="__codelineno-4-171" href="#__codelineno-4-171"></a>            <span class="n">runners_df</span><span class="p">,</span>
<a id="__codelineno-4-172" name="__codelineno-4-172" href="#__codelineno-4-172"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_pruned_soccer_df</span><span class="p">,</span>
<a id="__codelineno-4-173" name="__codelineno-4-173" href="#__codelineno-4-173"></a>            <span class="n">how</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
<a id="__codelineno-4-174" name="__codelineno-4-174" href="#__codelineno-4-174"></a>            <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;event_date&quot;</span><span class="p">,</span> <span class="s2">&quot;fixture&quot;</span><span class="p">,</span> <span class="s2">&quot;market_name&quot;</span><span class="p">,</span> <span class="s2">&quot;runner_name&quot;</span><span class="p">],</span>
<a id="__codelineno-4-175" name="__codelineno-4-175" href="#__codelineno-4-175"></a>        <span class="p">)</span>
<a id="__codelineno-4-176" name="__codelineno-4-176" href="#__codelineno-4-176"></a>        <span class="c1"># Set the index as the selection_id for order placement</span>
<a id="__codelineno-4-177" name="__codelineno-4-177" href="#__codelineno-4-177"></a>        <span class="n">market_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;selection_id&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-178" name="__codelineno-4-178" href="#__codelineno-4-178"></a>
<a id="__codelineno-4-179" name="__codelineno-4-179" href="#__codelineno-4-179"></a>        <span class="k">if</span> <span class="nb">round</span><span class="p">(</span><span class="n">market</span><span class="o">.</span><span class="n">seconds_to_start</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">600</span><span class="p">:</span>
<a id="__codelineno-4-180" name="__codelineno-4-180" href="#__codelineno-4-180"></a>
<a id="__codelineno-4-181" name="__codelineno-4-181" href="#__codelineno-4-181"></a>            <span class="c1"># Loop over each runner in the market</span>
<a id="__codelineno-4-182" name="__codelineno-4-182" href="#__codelineno-4-182"></a>            <span class="k">for</span> <span class="n">runner</span> <span class="ow">in</span> <span class="n">market_book</span><span class="o">.</span><span class="n">runners</span><span class="p">:</span>
<a id="__codelineno-4-183" name="__codelineno-4-183" href="#__codelineno-4-183"></a>                <span class="c1"># Check runner isn&#39;t scratched and that first layer of back/lay prices exists</span>
<a id="__codelineno-4-184" name="__codelineno-4-184" href="#__codelineno-4-184"></a>                <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">runner</span><span class="o">.</span><span class="n">ex</span><span class="o">.</span><span class="n">available_to_back</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">runner</span><span class="o">.</span><span class="n">ex</span><span class="o">.</span><span class="n">available_to_lay</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-4-185" name="__codelineno-4-185" href="#__codelineno-4-185"></a>                    <span class="n">runner_name</span> <span class="o">=</span> <span class="n">market_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span> <span class="s1">&#39;runner_name&#39;</span><span class="p">]</span>
<a id="__codelineno-4-186" name="__codelineno-4-186" href="#__codelineno-4-186"></a>                    <span class="n">event_name</span> <span class="o">=</span> <span class="n">market_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span> <span class="s1">&#39;fixture&#39;</span><span class="p">]</span>
<a id="__codelineno-4-187" name="__codelineno-4-187" href="#__codelineno-4-187"></a>                    <span class="n">market_type</span> <span class="o">=</span> <span class="n">market_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span> <span class="s1">&#39;market_type&#39;</span><span class="p">]</span>
<a id="__codelineno-4-188" name="__codelineno-4-188" href="#__codelineno-4-188"></a>                    <span class="n">market_name</span> <span class="o">=</span> <span class="n">market_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span> <span class="s1">&#39;market_name&#39;</span><span class="p">]</span>
<a id="__codelineno-4-189" name="__codelineno-4-189" href="#__codelineno-4-189"></a>                    <span class="n">rated_price</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">market_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span> <span class="s1">&#39;rated_price&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-190" name="__codelineno-4-190" href="#__codelineno-4-190"></a>
<a id="__codelineno-4-191" name="__codelineno-4-191" href="#__codelineno-4-191"></a>                    <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">processed_selection_ids</span> <span class="ow">and</span> <span class="n">rated_price</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-4-192" name="__codelineno-4-192" href="#__codelineno-4-192"></a>                        <span class="c1"># Create our ordered dictionary to store our order notes</span>
<a id="__codelineno-4-193" name="__codelineno-4-193" href="#__codelineno-4-193"></a>                        <span class="n">notes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
<a id="__codelineno-4-194" name="__codelineno-4-194" href="#__codelineno-4-194"></a>                        <span class="c1"># Write our order notes - adding these notes is time-consuming but is helpful for troubleshooting string matching issues</span>
<a id="__codelineno-4-195" name="__codelineno-4-195" href="#__codelineno-4-195"></a>                        <span class="n">notes</span><span class="p">[</span><span class="s2">&quot;fixture&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;fixture:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_name</span><span class="p">)</span>
<a id="__codelineno-4-196" name="__codelineno-4-196" href="#__codelineno-4-196"></a>                        <span class="n">notes</span><span class="p">[</span><span class="s2">&quot;market_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;market_type:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">market_type</span><span class="p">)</span>
<a id="__codelineno-4-197" name="__codelineno-4-197" href="#__codelineno-4-197"></a>                        <span class="n">notes</span><span class="p">[</span><span class="s2">&quot;market&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;market:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">market_name</span><span class="p">)</span>
<a id="__codelineno-4-198" name="__codelineno-4-198" href="#__codelineno-4-198"></a>                        <span class="n">notes</span><span class="p">[</span><span class="s2">&quot;runner_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;selection:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">runner_name</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; - &#39;</span><span class="p">,</span><span class="s1">&#39;&amp;&#39;</span><span class="p">)</span>
<a id="__codelineno-4-199" name="__codelineno-4-199" href="#__codelineno-4-199"></a>                        <span class="n">notes</span><span class="p">[</span><span class="s2">&quot;rated_price&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;rated_price:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rated_price</span><span class="p">)</span>
<a id="__codelineno-4-200" name="__codelineno-4-200" href="#__codelineno-4-200"></a>
<a id="__codelineno-4-201" name="__codelineno-4-201" href="#__codelineno-4-201"></a>                        <span class="n">trade</span> <span class="o">=</span> <span class="n">Trade</span><span class="p">(</span>
<a id="__codelineno-4-202" name="__codelineno-4-202" href="#__codelineno-4-202"></a>                            <span class="n">market_id</span><span class="o">=</span><span class="n">market_book</span><span class="o">.</span><span class="n">market_id</span><span class="p">,</span>
<a id="__codelineno-4-203" name="__codelineno-4-203" href="#__codelineno-4-203"></a>                            <span class="n">selection_id</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span>
<a id="__codelineno-4-204" name="__codelineno-4-204" href="#__codelineno-4-204"></a>                            <span class="n">handicap</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">handicap</span><span class="p">,</span>
<a id="__codelineno-4-205" name="__codelineno-4-205" href="#__codelineno-4-205"></a>                            <span class="n">notes</span><span class="o">=</span><span class="n">notes</span><span class="p">,</span>
<a id="__codelineno-4-206" name="__codelineno-4-206" href="#__codelineno-4-206"></a>                            <span class="n">strategy</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-4-207" name="__codelineno-4-207" href="#__codelineno-4-207"></a>                        <span class="p">)</span>
<a id="__codelineno-4-208" name="__codelineno-4-208" href="#__codelineno-4-208"></a>                        <span class="n">order</span> <span class="o">=</span> <span class="n">trade</span><span class="o">.</span><span class="n">create_order</span><span class="p">(</span>
<a id="__codelineno-4-209" name="__codelineno-4-209" href="#__codelineno-4-209"></a>                            <span class="n">side</span><span class="o">=</span><span class="s2">&quot;LAY&quot;</span><span class="p">,</span>
<a id="__codelineno-4-210" name="__codelineno-4-210" href="#__codelineno-4-210"></a>                            <span class="n">order_type</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span>
<a id="__codelineno-4-211" name="__codelineno-4-211" href="#__codelineno-4-211"></a>                                <span class="n">price</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">ex</span><span class="o">.</span><span class="n">available_to_lay</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
<a id="__codelineno-4-212" name="__codelineno-4-212" href="#__codelineno-4-212"></a>                                <span class="n">size</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">/</span> <span class="n">rated_price</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-4-213" name="__codelineno-4-213" href="#__codelineno-4-213"></a>                                <span class="n">persistence_type</span><span class="o">=</span><span class="s2">&quot;LAPSE&quot;</span><span class="p">,</span>
<a id="__codelineno-4-214" name="__codelineno-4-214" href="#__codelineno-4-214"></a>                            <span class="p">)</span>
<a id="__codelineno-4-215" name="__codelineno-4-215" href="#__codelineno-4-215"></a>                        <span class="p">)</span>
<a id="__codelineno-4-216" name="__codelineno-4-216" href="#__codelineno-4-216"></a>                        <span class="n">market</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-4-217" name="__codelineno-4-217" href="#__codelineno-4-217"></a>
<a id="__codelineno-4-218" name="__codelineno-4-218" href="#__codelineno-4-218"></a>                        <span class="n">order</span> <span class="o">=</span> <span class="n">trade</span><span class="o">.</span><span class="n">create_order</span><span class="p">(</span>
<a id="__codelineno-4-219" name="__codelineno-4-219" href="#__codelineno-4-219"></a>                            <span class="n">side</span><span class="o">=</span><span class="s2">&quot;BACK&quot;</span><span class="p">,</span>
<a id="__codelineno-4-220" name="__codelineno-4-220" href="#__codelineno-4-220"></a>                            <span class="n">order_type</span><span class="o">=</span><span class="n">LimitOrder</span><span class="p">(</span>
<a id="__codelineno-4-221" name="__codelineno-4-221" href="#__codelineno-4-221"></a>                                <span class="n">price</span><span class="o">=</span><span class="n">runner</span><span class="o">.</span><span class="n">ex</span><span class="o">.</span><span class="n">available_to_back</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">],</span>
<a id="__codelineno-4-222" name="__codelineno-4-222" href="#__codelineno-4-222"></a>                                <span class="n">size</span><span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="mi">100</span> <span class="o">/</span> <span class="n">rated_price</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-4-223" name="__codelineno-4-223" href="#__codelineno-4-223"></a>                                <span class="n">persistence_type</span><span class="o">=</span><span class="s2">&quot;LAPSE&quot;</span><span class="p">,</span>
<a id="__codelineno-4-224" name="__codelineno-4-224" href="#__codelineno-4-224"></a>                            <span class="p">)</span>
<a id="__codelineno-4-225" name="__codelineno-4-225" href="#__codelineno-4-225"></a>                        <span class="p">)</span>
<a id="__codelineno-4-226" name="__codelineno-4-226" href="#__codelineno-4-226"></a>                        <span class="n">market</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
<a id="__codelineno-4-227" name="__codelineno-4-227" href="#__codelineno-4-227"></a>                        <span class="c1"># Add the selection to the list to ensure that we don&#39;t bet on it again.</span>
<a id="__codelineno-4-228" name="__codelineno-4-228" href="#__codelineno-4-228"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">processed_selection_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">runner</span><span class="o">.</span><span class="n">selection_id</span><span class="p">)</span>
<a id="__codelineno-4-229" name="__codelineno-4-229" href="#__codelineno-4-229"></a>
<a id="__codelineno-4-230" name="__codelineno-4-230" href="#__codelineno-4-230"></a><span class="c1"># Fields we want to log in our simulations</span>
<a id="__codelineno-4-231" name="__codelineno-4-231" href="#__codelineno-4-231"></a><span class="n">FIELDNAMES</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-4-232" name="__codelineno-4-232" href="#__codelineno-4-232"></a>    <span class="s2">&quot;bet_id&quot;</span><span class="p">,</span>
<a id="__codelineno-4-233" name="__codelineno-4-233" href="#__codelineno-4-233"></a>    <span class="s2">&quot;strategy_name&quot;</span><span class="p">,</span>
<a id="__codelineno-4-234" name="__codelineno-4-234" href="#__codelineno-4-234"></a>    <span class="s2">&quot;market_id&quot;</span><span class="p">,</span>
<a id="__codelineno-4-235" name="__codelineno-4-235" href="#__codelineno-4-235"></a>    <span class="s2">&quot;selection_id&quot;</span><span class="p">,</span>
<a id="__codelineno-4-236" name="__codelineno-4-236" href="#__codelineno-4-236"></a>    <span class="s2">&quot;trade_id&quot;</span><span class="p">,</span>
<a id="__codelineno-4-237" name="__codelineno-4-237" href="#__codelineno-4-237"></a>    <span class="s2">&quot;date_time_placed&quot;</span><span class="p">,</span>
<a id="__codelineno-4-238" name="__codelineno-4-238" href="#__codelineno-4-238"></a>    <span class="s2">&quot;price&quot;</span><span class="p">,</span>
<a id="__codelineno-4-239" name="__codelineno-4-239" href="#__codelineno-4-239"></a>    <span class="s2">&quot;price_matched&quot;</span><span class="p">,</span>
<a id="__codelineno-4-240" name="__codelineno-4-240" href="#__codelineno-4-240"></a>    <span class="s2">&quot;size&quot;</span><span class="p">,</span>
<a id="__codelineno-4-241" name="__codelineno-4-241" href="#__codelineno-4-241"></a>    <span class="s2">&quot;size_matched&quot;</span><span class="p">,</span>
<a id="__codelineno-4-242" name="__codelineno-4-242" href="#__codelineno-4-242"></a>    <span class="s2">&quot;profit&quot;</span><span class="p">,</span>
<a id="__codelineno-4-243" name="__codelineno-4-243" href="#__codelineno-4-243"></a>    <span class="s2">&quot;side&quot;</span><span class="p">,</span>
<a id="__codelineno-4-244" name="__codelineno-4-244" href="#__codelineno-4-244"></a>    <span class="s2">&quot;elapsed_seconds_executable&quot;</span><span class="p">,</span>
<a id="__codelineno-4-245" name="__codelineno-4-245" href="#__codelineno-4-245"></a>    <span class="s2">&quot;order_status&quot;</span><span class="p">,</span>
<a id="__codelineno-4-246" name="__codelineno-4-246" href="#__codelineno-4-246"></a>    <span class="s2">&quot;market_note&quot;</span><span class="p">,</span>
<a id="__codelineno-4-247" name="__codelineno-4-247" href="#__codelineno-4-247"></a>    <span class="s2">&quot;trade_notes&quot;</span><span class="p">,</span>
<a id="__codelineno-4-248" name="__codelineno-4-248" href="#__codelineno-4-248"></a>    <span class="s2">&quot;order_notes&quot;</span><span class="p">,</span>
<a id="__codelineno-4-249" name="__codelineno-4-249" href="#__codelineno-4-249"></a><span class="p">]</span>
<a id="__codelineno-4-250" name="__codelineno-4-250" href="#__codelineno-4-250"></a>
<a id="__codelineno-4-251" name="__codelineno-4-251" href="#__codelineno-4-251"></a><span class="c1"># Class to define logging class and output results to csv files</span>
<a id="__codelineno-4-252" name="__codelineno-4-252" href="#__codelineno-4-252"></a><span class="k">class</span><span class="w"> </span><span class="nc">BacktestLoggingControl</span><span class="p">(</span><span class="n">LoggingControl</span><span class="p">):</span>
<a id="__codelineno-4-253" name="__codelineno-4-253" href="#__codelineno-4-253"></a>    <span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;BACKTEST_LOGGING_CONTROL&quot;</span>
<a id="__codelineno-4-254" name="__codelineno-4-254" href="#__codelineno-4-254"></a>
<a id="__codelineno-4-255" name="__codelineno-4-255" href="#__codelineno-4-255"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-4-256" name="__codelineno-4-256" href="#__codelineno-4-256"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
<a id="__codelineno-4-257" name="__codelineno-4-257" href="#__codelineno-4-257"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-4-258" name="__codelineno-4-258" href="#__codelineno-4-258"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_setup</span><span class="p">()</span>
<a id="__codelineno-4-259" name="__codelineno-4-259" href="#__codelineno-4-259"></a>
<a id="__codelineno-4-260" name="__codelineno-4-260" href="#__codelineno-4-260"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_setup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-4-261" name="__codelineno-4-261" href="#__codelineno-4-261"></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;soccer_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">):</span>
<a id="__codelineno-4-262" name="__codelineno-4-262" href="#__codelineno-4-262"></a>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Results file exists&quot;</span><span class="p">)</span>
<a id="__codelineno-4-263" name="__codelineno-4-263" href="#__codelineno-4-263"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-264" name="__codelineno-4-264" href="#__codelineno-4-264"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">destination</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;soccer_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
<a id="__codelineno-4-265" name="__codelineno-4-265" href="#__codelineno-4-265"></a>                <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">FIELDNAMES</span><span class="p">)</span>
<a id="__codelineno-4-266" name="__codelineno-4-266" href="#__codelineno-4-266"></a>                <span class="n">csv_writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
<a id="__codelineno-4-267" name="__codelineno-4-267" href="#__codelineno-4-267"></a>
<a id="__codelineno-4-268" name="__codelineno-4-268" href="#__codelineno-4-268"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_process_cleared_orders_meta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
<a id="__codelineno-4-269" name="__codelineno-4-269" href="#__codelineno-4-269"></a>        <span class="n">orders</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">event</span>
<a id="__codelineno-4-270" name="__codelineno-4-270" href="#__codelineno-4-270"></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">destination</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;soccer_simulation_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">.csv&quot;</span>
<a id="__codelineno-4-271" name="__codelineno-4-271" href="#__codelineno-4-271"></a>
<a id="__codelineno-4-272" name="__codelineno-4-272" href="#__codelineno-4-272"></a>        <span class="c1"># Locking around the file write operation</span>
<a id="__codelineno-4-273" name="__codelineno-4-273" href="#__codelineno-4-273"></a>        <span class="k">with</span> <span class="n">file_write_lock</span><span class="p">:</span>
<a id="__codelineno-4-274" name="__codelineno-4-274" href="#__codelineno-4-274"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;a&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">m</span><span class="p">:</span>
<a id="__codelineno-4-275" name="__codelineno-4-275" href="#__codelineno-4-275"></a>                <span class="n">csv_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s2">&quot;,&quot;</span><span class="p">,</span> <span class="n">fieldnames</span><span class="o">=</span><span class="n">FIELDNAMES</span><span class="p">)</span>
<a id="__codelineno-4-276" name="__codelineno-4-276" href="#__codelineno-4-276"></a>                <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">orders</span><span class="p">:</span>
<a id="__codelineno-4-277" name="__codelineno-4-277" href="#__codelineno-4-277"></a>                    <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="o">.</span><span class="n">ORDER_TYPE</span> <span class="o">==</span> <span class="n">OrderTypes</span><span class="o">.</span><span class="n">LIMIT</span><span class="p">:</span>
<a id="__codelineno-4-278" name="__codelineno-4-278" href="#__codelineno-4-278"></a>                        <span class="n">size</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-4-279" name="__codelineno-4-279" href="#__codelineno-4-279"></a>                    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-4-280" name="__codelineno-4-280" href="#__codelineno-4-280"></a>                        <span class="n">size</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="o">.</span><span class="n">liability</span>
<a id="__codelineno-4-281" name="__codelineno-4-281" href="#__codelineno-4-281"></a>                    <span class="n">price</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="o">.</span><span class="n">ORDER_TYPE</span> <span class="o">==</span> <span class="n">OrderTypes</span><span class="o">.</span><span class="n">MARKET_ON_CLOSE</span> <span class="k">else</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="o">.</span><span class="n">price</span>
<a id="__codelineno-4-282" name="__codelineno-4-282" href="#__codelineno-4-282"></a>
<a id="__codelineno-4-283" name="__codelineno-4-283" href="#__codelineno-4-283"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-284" name="__codelineno-4-284" href="#__codelineno-4-284"></a>                        <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-4-285" name="__codelineno-4-285" href="#__codelineno-4-285"></a>                            <span class="s2">&quot;bet_id&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">bet_id</span><span class="p">,</span>
<a id="__codelineno-4-286" name="__codelineno-4-286" href="#__codelineno-4-286"></a>                            <span class="s2">&quot;strategy_name&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">trade</span><span class="o">.</span><span class="n">strategy</span><span class="p">,</span>
<a id="__codelineno-4-287" name="__codelineno-4-287" href="#__codelineno-4-287"></a>                            <span class="s2">&quot;market_id&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">market_id</span><span class="p">,</span>
<a id="__codelineno-4-288" name="__codelineno-4-288" href="#__codelineno-4-288"></a>                            <span class="s2">&quot;selection_id&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">selection_id</span><span class="p">,</span>
<a id="__codelineno-4-289" name="__codelineno-4-289" href="#__codelineno-4-289"></a>                            <span class="s2">&quot;trade_id&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">trade</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-4-290" name="__codelineno-4-290" href="#__codelineno-4-290"></a>                            <span class="s2">&quot;date_time_placed&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">responses</span><span class="o">.</span><span class="n">date_time_placed</span><span class="p">,</span>
<a id="__codelineno-4-291" name="__codelineno-4-291" href="#__codelineno-4-291"></a>                            <span class="s2">&quot;price&quot;</span><span class="p">:</span> <span class="n">price</span><span class="p">,</span>
<a id="__codelineno-4-292" name="__codelineno-4-292" href="#__codelineno-4-292"></a>                            <span class="s2">&quot;price_matched&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">average_price_matched</span><span class="p">,</span>
<a id="__codelineno-4-293" name="__codelineno-4-293" href="#__codelineno-4-293"></a>                            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">size</span><span class="p">,</span>
<a id="__codelineno-4-294" name="__codelineno-4-294" href="#__codelineno-4-294"></a>                            <span class="s2">&quot;size_matched&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">size_matched</span><span class="p">,</span>
<a id="__codelineno-4-295" name="__codelineno-4-295" href="#__codelineno-4-295"></a>                            <span class="s2">&quot;profit&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">simulated</span><span class="o">.</span><span class="n">profit</span><span class="p">,</span>
<a id="__codelineno-4-296" name="__codelineno-4-296" href="#__codelineno-4-296"></a>                            <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">side</span><span class="p">,</span>
<a id="__codelineno-4-297" name="__codelineno-4-297" href="#__codelineno-4-297"></a>                            <span class="s2">&quot;elapsed_seconds_executable&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">elapsed_seconds_executable</span><span class="p">,</span>
<a id="__codelineno-4-298" name="__codelineno-4-298" href="#__codelineno-4-298"></a>                            <span class="s2">&quot;order_status&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-4-299" name="__codelineno-4-299" href="#__codelineno-4-299"></a>                            <span class="s2">&quot;market_note&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">trade</span><span class="o">.</span><span class="n">market_notes</span><span class="p">,</span>
<a id="__codelineno-4-300" name="__codelineno-4-300" href="#__codelineno-4-300"></a>                            <span class="s2">&quot;trade_notes&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">trade</span><span class="o">.</span><span class="n">notes_str</span><span class="p">,</span>
<a id="__codelineno-4-301" name="__codelineno-4-301" href="#__codelineno-4-301"></a>                            <span class="s2">&quot;order_notes&quot;</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">notes_str</span><span class="p">,</span>
<a id="__codelineno-4-302" name="__codelineno-4-302" href="#__codelineno-4-302"></a>                        <span class="p">}</span>
<a id="__codelineno-4-303" name="__codelineno-4-303" href="#__codelineno-4-303"></a>                        <span class="n">csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">order_data</span><span class="p">)</span>
<a id="__codelineno-4-304" name="__codelineno-4-304" href="#__codelineno-4-304"></a>                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-4-305" name="__codelineno-4-305" href="#__codelineno-4-305"></a>                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;_process_cleared_orders_meta: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">})</span>
<a id="__codelineno-4-306" name="__codelineno-4-306" href="#__codelineno-4-306"></a>
<a id="__codelineno-4-307" name="__codelineno-4-307" href="#__codelineno-4-307"></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Orders updated&quot;</span><span class="p">,</span> <span class="n">extra</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;order_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">orders</span><span class="p">)})</span>
<a id="__codelineno-4-308" name="__codelineno-4-308" href="#__codelineno-4-308"></a>
<a id="__codelineno-4-309" name="__codelineno-4-309" href="#__codelineno-4-309"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_process</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>  
<a id="__codelineno-4-310" name="__codelineno-4-310" href="#__codelineno-4-310"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-311" name="__codelineno-4-311" href="#__codelineno-4-311"></a>        <span class="c1"># Set Flumine to simulation mode</span>
<a id="__codelineno-4-312" name="__codelineno-4-312" href="#__codelineno-4-312"></a>        <span class="n">client</span> <span class="o">=</span> <span class="n">clients</span><span class="o">.</span><span class="n">SimulatedClient</span><span class="p">(</span><span class="n">min_bet_validation</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-313" name="__codelineno-4-313" href="#__codelineno-4-313"></a>        <span class="n">framework</span> <span class="o">=</span> <span class="n">FlumineSimulation</span><span class="p">(</span><span class="n">client</span><span class="o">=</span><span class="n">client</span><span class="p">)</span>
<a id="__codelineno-4-314" name="__codelineno-4-314" href="#__codelineno-4-314"></a>
<a id="__codelineno-4-315" name="__codelineno-4-315" href="#__codelineno-4-315"></a>        <span class="c1"># Set parameters for our strategy</span>
<a id="__codelineno-4-316" name="__codelineno-4-316" href="#__codelineno-4-316"></a>        <span class="n">strategy</span> <span class="o">=</span> <span class="n">SoccerSimulation</span><span class="p">(</span>
<a id="__codelineno-4-317" name="__codelineno-4-317" href="#__codelineno-4-317"></a>            <span class="n">market_filter</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-4-318" name="__codelineno-4-318" href="#__codelineno-4-318"></a>                <span class="s2">&quot;markets&quot;</span><span class="p">:</span> <span class="n">chunk</span><span class="p">,</span>  
<a id="__codelineno-4-319" name="__codelineno-4-319" href="#__codelineno-4-319"></a>                <span class="s2">&quot;listener_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;inplay&quot;</span><span class="p">:</span><span class="kc">False</span><span class="p">,</span><span class="s2">&quot;seconds_to_start&quot;</span><span class="p">:</span> <span class="mi">660</span><span class="p">},</span>  
<a id="__codelineno-4-320" name="__codelineno-4-320" href="#__codelineno-4-320"></a>            <span class="p">},</span>
<a id="__codelineno-4-321" name="__codelineno-4-321" href="#__codelineno-4-321"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">,</span>
<a id="__codelineno-4-322" name="__codelineno-4-322" href="#__codelineno-4-322"></a>            <span class="n">max_order_exposure</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-4-323" name="__codelineno-4-323" href="#__codelineno-4-323"></a>            <span class="n">max_selection_exposure</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
<a id="__codelineno-4-324" name="__codelineno-4-324" href="#__codelineno-4-324"></a>            <span class="n">max_live_trade_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-4-325" name="__codelineno-4-325" href="#__codelineno-4-325"></a>            <span class="n">max_trade_count</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-4-326" name="__codelineno-4-326" href="#__codelineno-4-326"></a>        <span class="p">)</span>
<a id="__codelineno-4-327" name="__codelineno-4-327" href="#__codelineno-4-327"></a>        <span class="c1"># Run our strategy on the simulated market</span>
<a id="__codelineno-4-328" name="__codelineno-4-328" href="#__codelineno-4-328"></a>        <span class="n">framework</span><span class="o">.</span><span class="n">add_strategy</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
<a id="__codelineno-4-329" name="__codelineno-4-329" href="#__codelineno-4-329"></a>        <span class="n">framework</span><span class="o">.</span><span class="n">add_logging_control</span><span class="p">(</span><span class="n">BacktestLoggingControl</span><span class="p">(</span><span class="n">model</span><span class="p">))</span>
<a id="__codelineno-4-330" name="__codelineno-4-330" href="#__codelineno-4-330"></a>        <span class="n">framework</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="__codelineno-4-331" name="__codelineno-4-331" href="#__codelineno-4-331"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-4-332" name="__codelineno-4-332" href="#__codelineno-4-332"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in run_process: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-333" name="__codelineno-4-333" href="#__codelineno-4-333"></a>
<a id="__codelineno-4-334" name="__codelineno-4-334" href="#__codelineno-4-334"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_csv_file</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
<a id="__codelineno-4-335" name="__codelineno-4-335" href="#__codelineno-4-335"></a>
<a id="__codelineno-4-336" name="__codelineno-4-336" href="#__codelineno-4-336"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">destination</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;soccer_simulation_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>
<a id="__codelineno-4-337" name="__codelineno-4-337" href="#__codelineno-4-337"></a>
<a id="__codelineno-4-338" name="__codelineno-4-338" href="#__codelineno-4-338"></a>    <span class="c1"># Process market_id column</span>
<a id="__codelineno-4-339" name="__codelineno-4-339" href="#__codelineno-4-339"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;1.&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
<a id="__codelineno-4-340" name="__codelineno-4-340" href="#__codelineno-4-340"></a>
<a id="__codelineno-4-341" name="__codelineno-4-341" href="#__codelineno-4-341"></a>    <span class="c1"># Split trade_notes column into three new columns</span>
<a id="__codelineno-4-342" name="__codelineno-4-342" href="#__codelineno-4-342"></a>    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;fixture&#39;</span><span class="p">,</span><span class="s1">&#39;market_type&#39;</span><span class="p">,</span><span class="s1">&#39;market&#39;</span><span class="p">,</span><span class="s1">&#39;selection&#39;</span><span class="p">,</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_rated_price&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;trade_notes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-4-343" name="__codelineno-4-343" href="#__codelineno-4-343"></a>
<a id="__codelineno-4-344" name="__codelineno-4-344" href="#__codelineno-4-344"></a>    <span class="c1"># Remove column names from the strings in each row</span>
<a id="__codelineno-4-345" name="__codelineno-4-345" href="#__codelineno-4-345"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fixture&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;fixture&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;fixture:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-346" name="__codelineno-4-346" href="#__codelineno-4-346"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market_type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;market_type:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-347" name="__codelineno-4-347" href="#__codelineno-4-347"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;market:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-348" name="__codelineno-4-348" href="#__codelineno-4-348"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;selection&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;selection:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-349" name="__codelineno-4-349" href="#__codelineno-4-349"></a>    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_rated_price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_rated_price&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;rated_price:&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-4-350" name="__codelineno-4-350" href="#__codelineno-4-350"></a>    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_implied_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;price_matched&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_rated_price&#39;</span><span class="p">]</span>
<a id="__codelineno-4-351" name="__codelineno-4-351" href="#__codelineno-4-351"></a>
<a id="__codelineno-4-352" name="__codelineno-4-352" href="#__codelineno-4-352"></a>    <span class="c1"># Modify the date parsing line to handle errors</span>
<a id="__codelineno-4-353" name="__codelineno-4-353" href="#__codelineno-4-353"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date_time_placed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date_time_placed&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<a id="__codelineno-4-354" name="__codelineno-4-354" href="#__codelineno-4-354"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date_time_placed&#39;</span><span class="p">])</span>
<a id="__codelineno-4-355" name="__codelineno-4-355" href="#__codelineno-4-355"></a>    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date_time_placed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date_time_placed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">tz_localize</span><span class="p">(</span><span class="s1">&#39;UTC&#39;</span><span class="p">,</span> <span class="n">ambiguous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">-%m-%Y %H:%M:%S&#39;</span><span class="p">)</span>
<a id="__codelineno-4-356" name="__codelineno-4-356" href="#__codelineno-4-356"></a>
<a id="__codelineno-4-357" name="__codelineno-4-357" href="#__codelineno-4-357"></a>    <span class="c1"># Select relevant columns</span>
<a id="__codelineno-4-358" name="__codelineno-4-358" href="#__codelineno-4-358"></a>    <span class="n">columns_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;date_time_placed&#39;</span><span class="p">,</span> <span class="s1">&#39;fixture&#39;</span><span class="p">,</span> <span class="s1">&#39;market_id&#39;</span><span class="p">,</span><span class="s1">&#39;market_type&#39;</span><span class="p">,</span><span class="s1">&#39;market&#39;</span><span class="p">,</span> <span class="s1">&#39;selection_id&#39;</span><span class="p">,</span> <span class="s1">&#39;selection&#39;</span><span class="p">,</span> <span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_rated_price&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_implied_value&#39;</span><span class="p">,</span> <span class="s1">&#39;price_matched&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span> <span class="s1">&#39;size_matched&#39;</span><span class="p">,</span> <span class="s1">&#39;profit&#39;</span><span class="p">]</span>
<a id="__codelineno-4-359" name="__codelineno-4-359" href="#__codelineno-4-359"></a>    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns_to_keep</span><span class="p">]</span>
<a id="__codelineno-4-360" name="__codelineno-4-360" href="#__codelineno-4-360"></a>
<a id="__codelineno-4-361" name="__codelineno-4-361" href="#__codelineno-4-361"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">destination</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;soccer_simulation_</span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s1">_processed.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-4-362" name="__codelineno-4-362" href="#__codelineno-4-362"></a>
<a id="__codelineno-4-363" name="__codelineno-4-363" href="#__codelineno-4-363"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_model</span><span class="p">(</span><span class="n">model</span><span class="p">):</span>
<a id="__codelineno-4-364" name="__codelineno-4-364" href="#__codelineno-4-364"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing model: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-365" name="__codelineno-4-365" href="#__codelineno-4-365"></a>
<a id="__codelineno-4-366" name="__codelineno-4-366" href="#__codelineno-4-366"></a>    <span class="n">data_folder</span> <span class="o">=</span> <span class="n">source_folder</span>
<a id="__codelineno-4-367" name="__codelineno-4-367" href="#__codelineno-4-367"></a>    <span class="n">data_files</span> <span class="o">=</span> <span class="p">[</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_folder</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span> <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">data_folder</span><span class="p">)]</span>
<a id="__codelineno-4-368" name="__codelineno-4-368" href="#__codelineno-4-368"></a>
<a id="__codelineno-4-369" name="__codelineno-4-369" href="#__codelineno-4-369"></a>    <span class="n">chunks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">split_list</span><span class="p">(</span><span class="n">data_files</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>  <span class="c1"># Split data into chunks of 1000 files</span>
<a id="__codelineno-4-370" name="__codelineno-4-370" href="#__codelineno-4-370"></a>
<a id="__codelineno-4-371" name="__codelineno-4-371" href="#__codelineno-4-371"></a>    <span class="c1"># Iterate over each chunk</span>
<a id="__codelineno-4-372" name="__codelineno-4-372" href="#__codelineno-4-372"></a>    <span class="k">for</span> <span class="n">chunk_index</span><span class="p">,</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tqdm</span><span class="p">(</span><span class="n">chunks</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Chunks Progress&quot;</span><span class="p">)):</span>
<a id="__codelineno-4-373" name="__codelineno-4-373" href="#__codelineno-4-373"></a>        <span class="n">processes</span> <span class="o">=</span> <span class="mi">4</span>  <span class="c1"># Number of processes</span>
<a id="__codelineno-4-374" name="__codelineno-4-374" href="#__codelineno-4-374"></a>        <span class="n">markets_per_process</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Number of markets each process should handle</span>
<a id="__codelineno-4-375" name="__codelineno-4-375" href="#__codelineno-4-375"></a>
<a id="__codelineno-4-376" name="__codelineno-4-376" href="#__codelineno-4-376"></a>        <span class="c1"># Create a list to store futures for tracking process completion</span>
<a id="__codelineno-4-377" name="__codelineno-4-377" href="#__codelineno-4-377"></a>        <span class="n">_process_jobs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-4-378" name="__codelineno-4-378" href="#__codelineno-4-378"></a>
<a id="__codelineno-4-379" name="__codelineno-4-379" href="#__codelineno-4-379"></a>        <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">processes</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
<a id="__codelineno-4-380" name="__codelineno-4-380" href="#__codelineno-4-380"></a>            <span class="k">for</span> <span class="n">market_subset</span> <span class="ow">in</span> <span class="n">split_list</span><span class="p">(</span><span class="n">chunk</span><span class="p">,</span> <span class="n">markets_per_process</span><span class="p">):</span>
<a id="__codelineno-4-381" name="__codelineno-4-381" href="#__codelineno-4-381"></a>                <span class="c1"># Submit jobs to executor</span>
<a id="__codelineno-4-382" name="__codelineno-4-382" href="#__codelineno-4-382"></a>                <span class="n">_process_jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">run_process</span><span class="p">,</span> <span class="n">market_subset</span><span class="p">,</span> <span class="n">model</span><span class="p">))</span>
<a id="__codelineno-4-383" name="__codelineno-4-383" href="#__codelineno-4-383"></a>
<a id="__codelineno-4-384" name="__codelineno-4-384" href="#__codelineno-4-384"></a>            <span class="c1"># Ensure each job completes and handle any potential errors</span>
<a id="__codelineno-4-385" name="__codelineno-4-385" href="#__codelineno-4-385"></a>            <span class="k">for</span> <span class="n">job</span> <span class="ow">in</span> <span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">_process_jobs</span><span class="p">):</span>
<a id="__codelineno-4-386" name="__codelineno-4-386" href="#__codelineno-4-386"></a>                <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-4-387" name="__codelineno-4-387" href="#__codelineno-4-387"></a>                    <span class="n">job</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>  <span class="c1"># Trigger any exceptions raised</span>
<a id="__codelineno-4-388" name="__codelineno-4-388" href="#__codelineno-4-388"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<a id="__codelineno-4-389" name="__codelineno-4-389" href="#__codelineno-4-389"></a>                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error processing chunk </span><span class="si">{</span><span class="n">chunk_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> for model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-390" name="__codelineno-4-390" href="#__codelineno-4-390"></a>
<a id="__codelineno-4-391" name="__codelineno-4-391" href="#__codelineno-4-391"></a>        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed processing chunk </span><span class="si">{</span><span class="n">chunk_index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> for model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-392" name="__codelineno-4-392" href="#__codelineno-4-392"></a>
<a id="__codelineno-4-393" name="__codelineno-4-393" href="#__codelineno-4-393"></a>    <span class="c1"># Once done, process the final CSV</span>
<a id="__codelineno-4-394" name="__codelineno-4-394" href="#__codelineno-4-394"></a>    <span class="n">process_csv_file</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<a id="__codelineno-4-395" name="__codelineno-4-395" href="#__codelineno-4-395"></a>    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Completed processing for model </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-4-396" name="__codelineno-4-396" href="#__codelineno-4-396"></a>
<a id="__codelineno-4-397" name="__codelineno-4-397" href="#__codelineno-4-397"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<a id="__codelineno-4-398" name="__codelineno-4-398" href="#__codelineno-4-398"></a>    <span class="n">process_model</span><span class="p">(</span><span class="s1">&#39;ensemble&#39;</span><span class="p">)</span>
<a id="__codelineno-4-399" name="__codelineno-4-399" href="#__codelineno-4-399"></a>    <span class="c1"># You can substitute any model here that you want to run e.g. &#39;LogisticsRegression&#39;</span>
</code></pre></div>
<div class="highlight"><span class="filename">Delete Processed Markets</span><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="sd">If the market processing is stopped for any reason, use the below code to delete any markets that have</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="sd">already been processed so you don&#39;t have to re-process them</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="sd">&#39;&#39;&#39;</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a><span class="c1"># Load the CSV file and extract unique values from the &#39;market_id&#39; column</span>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">csv_file</span> <span class="o">=</span> <span class="n">destination</span><span class="o">+</span><span class="s1">&#39;soccer_simulation_ensemble.csv&#39;</span> 
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">csv_file</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;market_id&#39;</span><span class="p">:</span><span class="s1">&#39;str&#39;</span><span class="p">})</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="n">market_ids</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;market_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="c1"># Define the folder to iterate over</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="n">folder_path</span> <span class="o">=</span> <span class="s1">&#39;FOLDER WHERE THE DECOMPRESSED STREAM FILES ARE STORED&#39;</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="c1"># Iterate over files in the folder</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder_path</span><span class="p">):</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>    <span class="c1"># Check if the filename contains a market_id</span>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>    <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_path</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>    <span class="c1"># If the filename (without extension) is in the market_ids list, print it</span>
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>    <span class="k">if</span> <span class="n">filename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">market_ids</span><span class="p">:</span>
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> has not been processed.&quot;</span><span class="p">)</span>
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>        <span class="c1"># If not, delete the file</span>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> is in the list, deleting...&quot;</span><span class="p">)</span>
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div>
<h3 id="conclusion">Conclusion</h3>
<p>In this tutorial we've taken our previously trained model, processed the model outputs into rated prices for the exchange markets, unzipped some historical files and run simulations using our rated prices!
In Part III we'll take our simulation output to decide what we can use to bet into future markets!</p>
<h3 id="disclaimer">Disclaimer</h3>
<p>Note that whilst models and automated strategies are fun and rewarding to create, we can't promise that your model or betting strategy will be profitable, and we make no representations in relation to the code shared or information on this page. If you're using this code or implementing your own strategies, you do so entirely at your own risk and you are responsible for any winnings/losses incurred. Under no circumstances will Betfair be liable for any loss or damage you suffer.</p>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="footer.title">
        
          
          <a href="../howToBuildASoccerBotPartI/" class="md-footer__link md-footer__link--prev" aria-label="Previous: How To Build A Soccer Bot P1" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                How To Build A Soccer Bot P1
              </div>
            </div>
          </a>
        
        
          
          <a href="../howToBuildASoccerBotPartIII/" class="md-footer__link md-footer__link--next" aria-label="Next: How To Build A Soccer Bot P3" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                How To Build A Soccer Bot P3
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-copyright">
  
  
</div>
        
          <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/Betfair_Aus" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/company/betfair-australia" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5m282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://facebook.com/betfairaustralia" target="_blank" rel="noopener" title="facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256c0 120 82.7 220.8 194.2 248.5V334.2h-52.8V256h52.8v-33.7c0-87.1 39.4-127.5 125-127.5 16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287v175.9C413.8 494.8 512 386.9 512 256"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://youtube.com/user/betfairaus" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305m-317.51 213.508V175.185l142.739 81.205z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/betfair-datascientists" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
        
      </div>

      <div class="bf-footer">
          <div class="bf-footer-inner">
              <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
              <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its <a class='inner-link' href="https://www.betfair.com.au/info/responsible-gambling/">Responsible Gambling Code of Conduct</a> and for South
              Australian residents by the <a class='inner-link' href="https://www.betfair.com.au/info/pdf/SA-GCoP.pdf">South Australian Responsible Gambling Code of Practice.</a></p>
              <!-- BetStop block in white box -->
              <div class="full-screen">
                  <p style="font-family: Arial, sans-serif; font-size: 1.2rem; font-weight: bold; text-align: center;">
                    BetStop is the Australian National Self-Exclusion Register. For more information, please visit 
                    <a href="https://betstop.gov.au" style="font-family: Arial, sans-serif; font-size: 1.2rem; font-weight: bold; color: black; text-decoration: none;">
                      https://betstop.gov.au
                    </a>
                  </p>
              </div>
              <br />
              <!-- RG footer block -->
              <div class="full-screen"> <p style="font-family: Arial, sans-serif; font-size: 1.2rem; font-weight: bold; text-align: center;">Imagine what you could be buying instead.</p> <p style="font-family: Arial, sans-serif; font-size: 0.8rem; font-weight: bold; text-align: center;">For free and confidential support call 1800 858 858 or visit <a href="http://www.gamblinghelponline.org.au" style="color: black; text-decoration: underline;">gamblinghelponline.org.au</a></p> </div>
              <ul class="bf-links">
                <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
                <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
                <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
                <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
                <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
              </ul>
          </div>
      </div>
    </div>

    <script src="https://js.adsrvr.org/up_loader.1.1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        ttd_dom_ready( function() {
            if (typeof TTDUniversalPixelApi === 'function') {
                var universalPixelApi = new TTDUniversalPixelApi();
                universalPixelApi.init("y12d1ir", ["8ml4f17"], "https://insight.adsrvr.org/track/up");
            }
        });
    </script>

</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
        <script src="../../js/scripts.js"></script>
      
    
  </body>
</html>