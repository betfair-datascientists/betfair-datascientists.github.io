
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <meta name="author" content="Ash Walls">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/soccerModellingELO2022WorldCup/">
      
      <link rel="icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.7">
    
    
      
        <title>World Cup 2022 Elo Rating System Tutorial - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/betfair.css">
    
      <link rel="stylesheet" href="../../css/buttons_and_animations.css">
    
      <link rel="stylesheet" href="../../css/fonts.css">
    
      <link rel="stylesheet" href="../../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-125973915-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      
  
  <header class="md-header" data-md-component="header">
    <nav class="md-header__inner md-grid" aria-label="Header">
      <a href="../.." title="The Automation Hub" class="md-header__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
        
  <img src="../../img/logo.svg" alt="logo">

      </a>
      <label class="md-header__button md-icon" for="__drawer">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
      </label>
      <div class="md-header__title" data-md-component="header-title">
        <div class="md-header__ellipsis">
          <div class="md-header__topic">
            <span class="md-ellipsis">
              The Automation Hub
            </span>
          </div>
          <div class="md-header__topic" data-md-component="header-topic">
            <span class="md-ellipsis">
              
                World Cup 2022 Elo Rating System Tutorial
              
            </span>
          </div>
        </div>
      </div>

      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="betfair" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="amber" data-md-color-accent="orange"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
        </form>
      
      

      
        <label class="md-header__button md-icon" for="__search">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
     
      <div class="bf-nav">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#"
          xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26" />
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z" />
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>

      

    </nav>
    
  </header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../wagering/stakingMethods/" class="md-tabs__link">
        Wagering
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../api/apiResources/" class="md-tabs__link">
        API
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../howToModel/" class="md-tabs__link md-tabs__link--active">
        Modelling
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../automation/GoldenRulesofAutomation/" class="md-tabs__link">
        Automation
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../tutorials/How_to_Automate_1/" class="md-tabs__link">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../mentalGame/intro/" class="md-tabs__link">
        Mental Game
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../contactUs/test/" class="md-tabs__link">
        Contact Us
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="The Automation Hub" class="md-nav__button md-logo" aria-label="The Automation Hub" data-md-component="logo">
      
  <img src="../../img/logo.svg" alt="logo">

    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Wagering
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Wagering" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Wagering
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/stakingMethods/" class="md-nav__link">
        Staking Methods and Bankroll Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/valueAndOdds/" class="md-nav__link">
        Value and Odds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wagering/commission/" class="md-nav__link">
        Commission and other charges
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiResources/" class="md-nav__link">
        API resources
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiappkey/" class="md-nav__link">
        How to access the Betfair API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiRtutorial/" class="md-nav__link">
        API tutorial in R
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../api/apiPythontutorial/" class="md-nav__link">
        API tutorial in Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Modelling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelling" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Modelling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../howToModel/" class="md-nav__link">
        Intro to modelling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dataSources/" class="md-nav__link">
        Pricing Data Sources
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Racing
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Racing" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Racing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../fasttrackTutorial/" class="md-nav__link">
        Greyhound form FastTrack API
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../greyhoundModellingPython/" class="md-nav__link">
        Greyhound modelling in Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" type="checkbox" id="__nav_4_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_4">
          Soccer
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Soccer" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Soccer
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Soccer modelling tutorial in R for 2022 FIFA World Cup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Soccer modelling tutorial in R for 2022 FIFA World Cup
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#what-are-elo-rating-systems" class="md-nav__link">
    What are Elo Rating Systems?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#how-can-i-build-an-elo-rating-system-for-international-football-and-the-world-cup" class="md-nav__link">
    How can I build an Elo Rating System for International Football and the World Cup?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#importing-and-manipulating-data" class="md-nav__link">
    Importing and Manipulating Data
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#emulating-the-world-football-elo-ratings-model" class="md-nav__link">
    Emulating the World Football Elo Ratings Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-the-elo-model" class="md-nav__link">
    Running the Elo Model
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-elo-model-to-predict-world-cup-results" class="md-nav__link">
    Using the Elo Model to Predict World Cup Results
  </a>
  
    <nav class="md-nav" aria-label="Using the Elo Model to Predict World Cup Results">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#accounting-for-draws" class="md-nav__link">
    Accounting for Draws
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#visualising-elo-ratings-through-time" class="md-nav__link">
    Visualising Elo Ratings Through Time
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#making-predictions" class="md-nav__link">
    Making Predictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#disclaimer" class="md-nav__link">
    Disclaimer
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#complete-code" class="md-nav__link">
    Complete Code
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../soccerModellingTutorialPython/" class="md-nav__link">
        Soccer modelling tutorial in Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../EPLmlPython/" class="md-nav__link">
        EPL ML walk through in Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4_5" type="checkbox" id="__nav_4_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_5">
          AFL
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="AFL" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          AFL
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AFLmodellingPython/" class="md-nav__link">
        AFL modelling walk through in Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../brownlowModelTutorial/" class="md-nav__link">
        Modelling the Brownlow Medal in Python
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4_6" type="checkbox" id="__nav_4_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_6">
          Tennis
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tennis" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_6">
          <span class="md-nav__icon md-icon"></span>
          Tennis
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../howToModelTheAusOpen/" class="md-nav__link">
        How to model the Australian Open
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenRTutorial/" class="md-nav__link">
        Aus Open R Tutorial
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../AusOpenPythonTutorial/" class="md-nav__link">
        Aus Open Python Tutorial
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Automation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Automation" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Automation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GoldenRulesofAutomation/" class="md-nav__link">
        Golden rules of automation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/overview/" class="md-nav__link">
        Tools Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_3" type="checkbox" id="__nav_5_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_3">
          Bet Angel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bet Angel" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          Bet Angel
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngel/betAngel/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelbeginners/" class="md-nav__link">
        Beginner's guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelintermediate/" class="md-nav__link">
        Intermediate guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngeladvanced/" class="md-nav__link">
        Advanced guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelRatingsAutomation/" class="md-nav__link">
        Ratings auto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelMarketFavouriteAutomation/" class="md-nav__link">
        Market fav auto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelTippingAutomation/" class="md-nav__link">
        Tipping auto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelSimultaneousMarkets/" class="md-nav__link">
        Simultaneous markets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betAngelKellyStake/" class="md-nav__link">
        Kelly criterion staking
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_4" type="checkbox" id="__nav_5_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_4">
          Gruss Betting Assistant
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Gruss Betting Assistant" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          Gruss Betting Assistant
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/Gruss/Gruss/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GrussSettingupbasicmarketview/" class="md-nav__link">
        Setup basic market view and one click betting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussRatingsAutomation/" class="md-nav__link">
        Ratings auto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussMarketFavouriteAutomation/" class="md-nav__link">
        Market fav auto
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grusslSimultaneousMarkets/" class="md-nav__link">
        Simultaneous markets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/grussKellyStake/" class="md-nav__link">
        Kelly criterion staking
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_5" type="checkbox" id="__nav_5_5" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_5">
          Cymatic Trader
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cymatic Trader" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          Cymatic Trader
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/CymaticTrader/CymaticTrader/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/cymaticTraderRatingsAutomation/" class="md-nav__link">
        Ratings auto
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_6" type="checkbox" id="__nav_5_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_6">
          Geeks Toy
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Geeks Toy" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_6">
          <span class="md-nav__icon md-icon"></span>
          Geeks Toy
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GeeksToyinstallationandsetup/" class="md-nav__link">
        Installation and setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/GeeksToybasicmarketviewstakingandoneclickbetting/" class="md-nav__link">
        Setup basic market view and one click betting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/geeksToyRefreshSettings/" class="md-nav__link">
        Optimising refresh settings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_5_7" type="checkbox" id="__nav_5_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_5_7">
          Bet Jet Pro
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bet Jet Pro" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_7">
          <span class="md-nav__icon md-icon"></span>
          Bet Jet Pro
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../automation/betJetOverview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_1/" class="md-nav__link">
        How to Automate 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_2/" class="md-nav__link">
        How to Automate 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_3/" class="md-nav__link">
        How to Automate 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_4/" class="md-nav__link">
        How to Automate 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/How_to_Automate_5/" class="md-nav__link">
        How to Automate 5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/processingTarFiles101/" class="md-nav__link">
        Take away the pain! Processing TAR Files 101
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/jsonToCsvRevisited/" class="md-nav__link">
        JSON to CSV | Revisited
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/backtestingRatingsTutorial/" class="md-nav__link">
        Back testing ratings in Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/automatedBettingAnglesTutorial/" class="md-nav__link">
        Automated betting angles in Python
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingMarketMovements/" class="md-nav__link">
        Do they know? Analysing Betfair market formation & market movements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/analysingAndPredictingBSP/" class="md-nav__link">
        Wisdom of the crowd? Analysing & understanding BSP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Mental Game
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Mental Game" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Mental Game
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/intro/" class="md-nav__link">
        Intro
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/roleOfEmotions/" class="md-nav__link">
        Part 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/mapYourEmotions/" class="md-nav__link">
        Part 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/handlingBadVariance/" class="md-nav__link">
        Part 3
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/winbyBeingGreatatLosing/" class="md-nav__link">
        Part 4
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/correctingyouremotions/" class="md-nav__link">
        Part 5
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/responsibleGambling/" class="md-nav__link">
        Part 6
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/InchwormConcept/" class="md-nav__link">
        Part 7
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/HighExpectations/" class="md-nav__link">
        Part 8
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../mentalGame/TappingYourIntuition/" class="md-nav__link">
        Part 9
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Contact Us
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contact Us" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Contact Us
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../contactUs/test/" class="md-nav__link">
        Meet the Team
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Soccer modelling tutorial in R for 2022 FIFA World Cup</h1>

<h2 id="introduction">Introduction</h2>
<p>The 2022 FIFA World Cup is nearly upon us - 64 matches of top shelf international football between 32 qualifying nations from around the globe in what is sure to be a spectacle of the best footballing nations from around the globe.</p>
<p>One of the reasons we're excited for this year's World Cup is that the tournament provides a unique opportunity for us analytical types to try our hand at modelling international football over an extended run of matches in a high-exposure environment where we know betting market liquidity will be strong. While international football fixtures will often see teams field sub-full-strength sides for friendly matches and minor fixtures, the World Cup sees teams roll out full strength (or near enough to) line-ups, meaning we as fans are treated to the absolute best each competing country has to offer - this factor makes the World Cup an even more exciting prospect for predictive modelling.</p>
<p>Just to make things even better, Betfair are hosting another Datathon to celebrate the 2022 FIFA World Cup! Betfair's Datathons are a series of data modelling competitions run for major sporting tournaments which aim to provide a platform for both aspiring and seasoned data modellers to test their wares at applying their predictive modelling nous in the sporting context.</p>
<p>You can find out more about the 2022 World Cup Datathon and register your interest <a href="/modelling/soccerWorldCup2022Datathon/">here</a>.</p>
<p>Building your own predictive model is a very rewarding and fun exercise, not to mention there is prize money for top performers. While there are many ways to go about creating predictive models, this tutorial aims to give readers a gentle introduction into one of the simpler approaches - <strong>Elo Rating Systems</strong>.</p>
<h2 id="what-are-elo-rating-systems">What are Elo Rating Systems?</h2>
<p><a href="https://en.wikipedia.org/wiki/Elo_rating_system">Elo models</a> (or Elo rating systems) are an approach to statistical learning which see every player or team in a league, competition or code given a dynamic numeric rating which indicates the given player or team's relative ability. From here, we are then able to use these ratings to construct win/loss probabilities for given match-ups between teams using <a href="https://en.wikipedia.org/wiki/Elo_rating_system#Mathematical_details">a simple formula</a> which takes the difference between the two teams' ratings and outputs the probability of each team winning or losing the match.</p>
<p>Originally devised by their namesake Arpad Elo for the purpose of ranking chess players in the 1960s, Elo rating systems have become a common fixture in the wider world of sport, including in football. You may have seen examples of Elo rating systems for international football already without knowing it - <a href="https://www.fifa.com/fifa-world-ranking/men?dateId=id13792">FIFA's own international team ratings</a> are a form of Elo ratings, as are the widely followed <a href="https://www.eloratings.net">World Footall Elo Ratings</a> which will serve as somewhat of a guide for how we go about building the Elo rating system within this tutorial.</p>
<h2 id="how-can-i-build-an-elo-rating-system-for-international-football-and-the-world-cup">How can I build an Elo Rating System for International Football and the World Cup?</h2>
<p>Building an Elo rating system for international football really only requires one thing - an expansive and complete (or as near as possible) history of international match results which can be used to train/develop our ratings. Where other forms of modelling may need detailed statistics to create an informative and accurate model (e.g. time in possession, shots, passing %, corners etc.), one of the great things about Elo modelling is that in it's most simplistic form it really only needs to know three things in order to run:</p>
<ul>
<li>Each match's competing teams</li>
<li>The result, i.e. the winner, loser or whether it was a draw</li>
<li>The final score</li>
</ul>
<p>Only requiring these basic details makes Elo modelling a very popular choice for international football as there are fairly limited resources for detailed in-match statistics, and even fewer that are free to the public. Fortunately, there are extensive data sets of basic match results for international football out there for free on the internet if you know where to find them! <a href="https://www.kaggle.com/datasets/martj42/international-football-results-from-1872-to-2017?resource=download">This data set from Kaggle</a> which covers just about every single international football fixtures since 1872 will serve as the training data set for both this tutorial as well as the 2022 World Cup Datathon.</p>
<p>Let's get into building our Elo model - this tutorial uses <a href="https://www.r-project.org">R</a>, however Python and other similar programming languages are just as capable of implementing Elo-style approaches.</p>
<h2 id="importing-and-manipulating-data">Importing and Manipulating Data</h2>
<p>Start off by installing the packages we'll need. <code>tidyverse</code> will be used for basic data reading and manipulation, <code>formattable</code> is a useful package for working with different data formats, <code>lubridate</code> for dates, <code>showtext</code> for importing fonts for visualisations, while the <code>elo</code> package does most of the heavy lifting here relating to the inner workings of the Elo rating system itself.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>packages &lt;- c(&quot;tidyverse&quot;, &quot;elo&quot;, &quot;formattable&quot;, &quot;lubridate&quot;, &quot;showtext&quot;)
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>install.packages(setdiff(packages, rownames(installed.packages())))
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>library(tidyverse)
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>library(formattable)
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>library(elo)
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>library(lubridate)
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>library(showtext)
</code></pre></div>
<p>Once the required packages are installed and loaded into our R environment we can import the historic match results data. In this case I've downloaded the <a href="https://www.kaggle.com/datasets/martj42/international-football-results-from-1872-to-2017?resource=download">Kaggle data set</a> to my local machine so that I can read it in as a CSV - you should be able to do the same using a free Kaggle account. Alternatively this is the same data set you'll receive through participating in the <a href="/modelling/soccerWorldCup2022Datathon/">Betfair World Cup Datathon</a>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>match_results &lt;- read_csv(&quot;results.csv&quot;)
</code></pre></div>
<p>Let's get an idea of what's included in the data set:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>match_results %&gt;% glimpse
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>## Rows: 44,060
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>## Columns: 9
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>## $ date       &lt;date&gt; 1872-11-30, 1873-03-08, 1874-03-07, 1875-03-06, 1876-03-04
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>## $ home_team  &lt;chr&gt; &quot;Scotland&quot;, &quot;England&quot;, &quot;Scotland&quot;, &quot;England&quot;, &quot;Scotland&quot;, &quot;
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>## $ away_team  &lt;chr&gt; &quot;England&quot;, &quot;Scotland&quot;, &quot;England&quot;, &quot;Scotland&quot;, &quot;England&quot;, &quot;W
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a>## $ home_score &lt;dbl&gt; 0, 4, 2, 2, 3, 4, 1, 0, 7, 9, 2, 5, 0, 5, 2, 5, 0, 1, 1, 0,
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a>## $ away_score &lt;dbl&gt; 0, 2, 1, 2, 0, 0, 3, 2, 2, 0, 1, 4, 3, 4, 3, 1, 1, 6, 5, 13
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a>## $ tournament &lt;chr&gt; &quot;Friendly&quot;, &quot;Friendly&quot;, &quot;Friendly&quot;, &quot;Friendly&quot;, &quot;Friendly&quot;,
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a>## $ city       &lt;chr&gt; &quot;Glasgow&quot;, &quot;London&quot;, &quot;Glasgow&quot;, &quot;London&quot;, &quot;Glasgow&quot;, &quot;Glasg
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a>## $ country    &lt;chr&gt; &quot;Scotland&quot;, &quot;England&quot;, &quot;Scotland&quot;, &quot;England&quot;, &quot;Scotland&quot;, &quot;
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a>## $ neutral    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL
</code></pre></div>
<p>The data contains information regarding who played, when and where the match took place, each team's score and where applicable, the tournament during which the match took place.</p>
<p>To run an Elo model, we'll need to add a couple more features to our data set, namely an indicator for each match's outcome as well as the final margin. The historic data also has a couple of different naming conventions for some nations which we should now address.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>match_results_wrangled &lt;- match_results %&gt;% 
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>  # Rename United States and South Korea to USA and Korea Republic respectively to reflect current naming. We need to do this to both &#39;home_team&#39; and &#39;away_team&#39; columns
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>  mutate(home_team = case_when(home_team == &quot;United States&quot; ~ &quot;USA&quot;,
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a>                               home_team == &quot;South Korea&quot; ~ &quot;Korea Republic&quot;,
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>                               TRUE ~ home_team),
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>         away_team = case_when(away_team == &quot;United States&quot; ~ &quot;USA&quot;,
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>                               away_team == &quot;South Korea&quot; ~ &quot;Korea Republic&quot;,
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a>                               TRUE ~ away_team),
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a>         # Add a new column for match result from both the home team and away team&#39;s perspectives. 1 = Win, 0.5 = Draw, 0 = Loss.
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>         home_result = case_when(home_score &gt; away_score ~ 1,
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>                                 home_score &lt; away_score ~ 0,
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a>                                 home_score == away_score ~ 0.5),
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a>         away_result = case_when(home_score &lt; away_score ~ 1,
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a>                                 home_score &gt; away_score ~ 0,
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a>                                 home_score == away_score ~ 0.5),
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>         # Add a margin feature
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a>         margin = abs(home_score - away_score)) %&gt;% 
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a>  # If there are any matches missing score data, we don&#39;t want to use them for our Elo model - drop any data where we are missing a match margin
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a>  drop_na(margin)
</code></pre></div>
<h2 id="emulating-the-world-football-elo-ratings-model">Emulating the World Football Elo Ratings Model</h2>
<p>Having now wrangled our data into a usable format, we could now in theory jump straight into running our Elo model over the data using the <code>elo</code> package, but before we do that there are a few other things we should first consider.
To build the most accurate model possible, we would need to trial-and-error at tweaking the model's parameters and inputs. What K value should we use? How much do we account for home ground advantage? Should any consideration be given to how much a team wins or loses a match by in adjusting their Elo rating?</p>
<p>You can read about these nuanced inputs into Elo Rating Systems and others <a href="https://medium.com/purple-theory/what-is-elo-rating-c4eb7a9061e0">here</a> - for simplicity however, we will be aiming to emulate the ratings system adopted for the well-renowned <a href="https://www.eloratings.net/about">World Football Elo Ratings</a>.</p>
<p>As of the 2022 World Cup, World Football Elo Ratings uses the following input parameters into it's Elo model:</p>
<ul>
<li>K (a weighting factor which determines how many rating points teams can gain or lose from a single match) is variable based on the significance of the tournament. K is first defined by the following: 60 for World Cup finals, 50 for continental championship finals and major intercontinental tournaments, 40 for World Cup and continental qualifiers and major tournaments, 30 for all other tournaments and finally, 20 for friendly matches.</li>
<li>K then undergoes an adjustment for the match goal difference - K is multipled by 1.5 for matches decided by two goals, 1.75 where decided by 3 goals, or by the rule 1.75 + (N-3)/8 where decided by four or more goals, with N indicating the margin.</li>
<li>Teams playing at home also get a 100-point Elo ratings boost when calculating win/loss probabilities (as well as being factored into ratings adjustments).</li>
</ul>
<p>Let's now add features to our data set to allow for these factors to be included in our Elo model.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>final_dataset &lt;- match_results_wrangled %&gt;% 
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  # Add a column to show 100 where there is a home ground advantage or 0 when played at a neutral venue. Our Elo model will call on this column for HGA.
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>  mutate(hga = 100*!neutral,
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>         # Allocate each tournament within the data to a K-weighting according to the above definition. Note that this section is quite open to interpretation.
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a>         tournament_weight = case_when(tournament == &quot;FIFA World Cup&quot; ~ 60,
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a>                                       tournament %in% c(&quot;Confederations Cup&quot;, &quot;African Cup of Nations&quot;, &quot;Copa Amrica&quot;, 
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>                                                     &quot;UEFA Euro&quot;, &quot;AFC Asian Cup&quot;) ~ 50,
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a>                                       str_detect(tolower(tournament), &quot;qualification&quot;) ~ 40,
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a>                                       str_detect(tolower(tournament), &quot; cup&quot;) ~ 40,
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a>                                       tournament %in% c(&quot;UEFA Nations League&quot;, &quot;CONCACAF Nations League&quot;) ~ 40,
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a>                                       tournament == &quot;Friendly&quot; ~ 20,
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>                                       TRUE ~ 30),
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
<a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a>         # Use our &#39;margin&#39; feature to create the goal difference K-multiplier.
<a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>         goal_diff_multiplier = case_when(margin &lt;= 1 ~ 1,
<a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a>                                          margin == 2 ~ 1.5,
<a id="__codelineno-5-19" name="__codelineno-5-19" href="#__codelineno-5-19"></a>                                          margin == 3 ~ 1.75, 
<a id="__codelineno-5-20" name="__codelineno-5-20" href="#__codelineno-5-20"></a>                                          margin &gt;= 4 ~ 1.75 + (margin-3)/8),
<a id="__codelineno-5-21" name="__codelineno-5-21" href="#__codelineno-5-21"></a>
<a id="__codelineno-5-22" name="__codelineno-5-22" href="#__codelineno-5-22"></a>         # Combine the tournament weight and goal difference features to obtain our final K value for each match.
<a id="__codelineno-5-23" name="__codelineno-5-23" href="#__codelineno-5-23"></a>         k = tournament_weight*goal_diff_multiplier,
<a id="__codelineno-5-24" name="__codelineno-5-24" href="#__codelineno-5-24"></a>
<a id="__codelineno-5-25" name="__codelineno-5-25" href="#__codelineno-5-25"></a>         # Also add a &#39;match_id&#39; feaature to identify each match by number - we&#39;ll use this later.
<a id="__codelineno-5-26" name="__codelineno-5-26" href="#__codelineno-5-26"></a>         match_id = row_number()) %&gt;% 
<a id="__codelineno-5-27" name="__codelineno-5-27" href="#__codelineno-5-27"></a>  relocate(match_id)
</code></pre></div>
<h2 id="running-the-elo-model">Running the Elo Model</h2>
<p>Our data is now ready to be run through the Elo model. This involves using the <code>elo.run()</code> function from the <code>elo</code> package, which then runs through each match in the historic data set, running and updating each team's Elo rating as it goes. By the end, we should have an Elo rating for each team as of the most recent international football match.</p>
<p>Using the <code>formula</code> argument to <code>elo.run()</code> we can include for the nuances of the World Football Elo Ratings system. Use <code>adjust()</code> to include the home ground advantage factor, and <code>k()</code> to allow for our variable k-value.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>elo_model &lt;- elo.run(data = final_dataset,
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>                     formula = home_result ~ adjust(home_team, hga) + away_team + k(k))
</code></pre></div>
<p>The Elo model is stored as <code>elo_model</code>, which we can then call on to see the model's final ratings, as below:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>final_elos &lt;- final.elos(elo_model) %&gt;% 
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  enframe(name = &quot;team&quot;, value = &quot;elo&quot;) %&gt;% 
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  arrange(desc(elo))
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a># See the top 10 rated nations
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>final_elos %&gt;% slice_head(n = 10)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>## # A tibble: 10  2
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>##    team          elo
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>##    &lt;chr&gt;       &lt;dbl&gt;
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>##  1 Brazil      2226.
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>##  2 Argentina   2194.
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>##  3 Spain       2091.
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>##  4 Netherlands 2083.
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>##  5 Belgium     2077.
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>##  6 Portugal    2049.
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>##  7 Italy       2045.
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>##  8 France      2042.
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>##  9 Denmark     2014.
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>## 10 Germany     2008.
</code></pre></div>
<p>To gain a better understanding of how our final Elo ratings are distributed, we can visualise all team ratings in a histogram.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a># Load Google fonts from https://fonts.google.com/
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>font_add_google(name = &quot;Poor Story&quot;, family = &quot;poor_story&quot;)
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a>showtext_auto()
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a># Visualise final Elo ratings
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>final_elos %&gt;% 
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a>  ggplot(aes(x = elo)) +
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a>  geom_histogram(binwidth = 100, fill = &quot;#ffb80c&quot;, color = &quot;white&quot;) +
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>  theme_minimal() +
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>  labs(x = &quot;Elo Rating&quot;,
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a>       y = &quot;# of Teams&quot;,
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a>       title = &quot;Distribution of Final Elo Ratings&quot;) +
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a>  theme(panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>        plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>        text = element_text(color = &quot;black&quot;, family = &quot;poor_story&quot;),
<a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a>        axis.text = element_text(color = &quot;black&quot;, size = 14),
<a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a>        plot.title = element_text(color = &quot;black&quot;, size = 24, hjust = 0.5),
<a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>        axis.title = element_text(family = &quot;poor_story&quot;, size = 16),
<a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>        plot.margin = unit(c(1,1,1,1), &quot;cm&quot;))
</code></pre></div>
<img alt="png" src="../img/DIST_ELO.png" /></p>
<p>We can see that the final Elo ratings are somewhat normally distributed, ranging from below 1000 at the bottom end up to above 2000 for the absolute best teams as we saw above. In line with most Elo models, teams start with an intial Elo rating of 1500 which is also approximately at the centre of the distribution of teams' final Elo ratings.</p>
<p>Since we are only aiming to recreate an existing rating system here, this tutorial won't go too far into testing the Elo model's accuracy, but be aware that the <code>elo</code> package also includes some helpful helper functions for model evaluation, including Brier scores.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>brier(elo_model)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>## [1] 0.1419991
</code></pre></div>
<h2 id="using-the-elo-model-to-predict-world-cup-results">Using the Elo Model to Predict World Cup Results</h2>
<p>Now that we have our Elo model and final team ratings, we can turn our attention toward future matches and making predictions using our ratings. Maintaining our focus on the 2022 World Cup, <a href="/modelling/assets/dummy_submission_file.csv">a CSV including all group stage fixtures as well as all possible knockout stage match-ups can be downloaded here</a>. Note that this file is also what will be used for 2022 World Cup Datathon submissions.</p>
<p>Start off by reading in the file.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>world_cup_matchups &lt;- read_csv(&quot;dummy_submission_file.csv&quot;)
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>world_cup_matchups %&gt;% glimpse
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>## Rows: 544
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>## Columns: 6
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>## $ home_team      &lt;chr&gt; &quot;Qatar&quot;, &quot;Senegal&quot;, &quot;Qatar&quot;, &quot;Netherlands&quot;, &quot;Ecuador&quot;, 
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>## $ away_team      &lt;chr&gt; &quot;Ecuador&quot;, &quot;Netherlands&quot;, &quot;Senegal&quot;, &quot;Ecuador&quot;, &quot;Senega
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>## $ stage          &lt;chr&gt; &quot;Group&quot;, &quot;Group&quot;, &quot;Group&quot;, &quot;Group&quot;, &quot;Group&quot;, &quot;Group&quot;, &quot;
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>## $ home_team_prob &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>## $ draw_prob      &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>## $ away_team_prob &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,
</code></pre></div>
<p>We have information relating to the teams playing and the stage of the World Cup tournament during which the match will be played - now all we need to do is fill in the "home_team_prob", "draw_prob" and "away_team_prob" columns with the relevant probabilities using predictions based on our Elo ratings.</p>
<h3 id="accounting-for-draws">Accounting for Draws</h3>
<p>Here is where things get a touch messy - Elo systems were originally devised to accommodate for two-player games of chess where winning or losing were the only two outcomes possible. For the group stage of the World Cup, drawn matches are also a possible outcome which means we need to accommodate for this in our predictions.</p>
<p>While there is no particularly obvious way to go about this, we can make do by using our historical match data to see how often teams draw for various Elo rating matchups. For example, at what rate does a team with a 400 Elo-point advantage draw with their opponent? In this instance, a 400 point advantage would see the better ranked team have a 91% chance of winning, but we would need to adjust that probability to include for a third possible outcome - the draw.</p>
<p>Let's find the draw rates for various differentials in win probability.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a># Start by taking our Elo model, wrangling the match-by-match rating updates within the stored model and joining to our historic data set.
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>elo_results &lt;- elo_model %&gt;% 
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>  as_tibble() %&gt;% 
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>  mutate(match_id = row_number()) %&gt;% 
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a>  select(match_id, 
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a>         home_update = update.A,
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a>         away_update = update.B,
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>         home_elo = elo.A,
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a>         away_elo = elo.B) %&gt;% 
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a>  # Join onto our historic data set using the match_id columns we created as a join key
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a>  right_join(final_dataset, by = &quot;match_id&quot;)
</code></pre></div>
<p>We can now find the home and away win probabilities for each historic match and bucket them into groups at 5% increments according to how close the home and away win probabilities were. E.g. a team with a 90% chance to win coming up against a team with a 10% chance to win would have a 80% differential in win probability.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>draw_rates &lt;- elo_results %&gt;%
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>  mutate(home_elo_pre_match = home_elo - home_update,
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>         away_elo_pre_match = away_elo - away_update,
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>         home_prob = elo.prob(home_elo_pre_match, away_elo_pre_match),
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>         away_prob = 1 - home_prob,
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a>         prob_diff = abs(home_prob - away_prob),
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a>         prob_diff_bucket = round(20*prob_diff)/20) %&gt;% # Bucket into 20 groups at 5% increments between 0% and 100%
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>  filter(year(date) &gt;= 2005) %&gt;%  # Filter down to the past 15 years to only bucket matches once some fairly decent Elo ratings have been established
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a>  group_by(prob_diff_bucket) %&gt;%
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a>  summarise(draw_rate = sum(home_result == 0.5)/n())
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a>draw_rates %&gt;% slice_head(n = 10)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>## # A tibble: 10  2
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>##    prob_diff_bucket draw_rate
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>##               &lt;dbl&gt;     &lt;dbl&gt;
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>##  1             0        0.320
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>##  2             0.05     0.296
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>##  3             0.1      0.289
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a>##  4             0.15     0.271
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>##  5             0.2      0.285
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>##  6             0.25     0.256
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a>##  7             0.3      0.273
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>##  8             0.35     0.270
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>##  9             0.4      0.276
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a>## 10             0.45     0.240
</code></pre></div>
<p>We can visualise the draw rates for win probability differentials to get a better idea of how often draws happen in various scenarios.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>draw_rates %&gt;%
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>  mutate(draw_rate = percent(draw_rate, digits = 0),
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>         prob_diff_bucket = percent(prob_diff_bucket, digits = 0)) %&gt;%
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>  ggplot(aes(x = prob_diff_bucket, y = draw_rate)) +
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>  geom_col(fill = &quot;#ffb80c&quot;) +
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>  geom_text(aes(label = draw_rate, y = draw_rate + 0.01), 
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>            size = 3.5, family = &quot;poor_story&quot;) +
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a>  theme_minimal() +
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a>  scale_y_continuous(labels = scales::percent) +
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>  scale_x_continuous(labels = scales::percent, breaks = scales::pretty_breaks()) +
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a>  labs(y = &quot;Historic Draw Rate&quot;, 
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a>       x = &quot;Difference in Win Probability Between Home &amp; Away Sides&quot;,
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>       title = &quot;Draw Frequency by Heaviness of Favouritism&quot;) +
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a>  theme(panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>        plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a>        text = element_text(color = &quot;black&quot;, family = &quot;poor_story&quot;),
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a>        axis.text = element_text(color = &quot;black&quot;, size = 12),
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a>        plot.title = element_text(color = &quot;black&quot;, size = 24, hjust = 0.5),
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a>        axis.title = element_text(family = &quot;poor_story&quot;, size = 16),
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a>        plot.margin = unit(c(1,1,1,1), &quot;cm&quot;))
</code></pre></div>
<img alt="png" src="../img/DRAW_FREQ.png" /></p>
<p>We can see that draws happen in more than 30% of matches where there has been a ~0% difference in win probability between the two sides (i.e. it was very close to a 50-50 match-up) - this is the highest draw rate, as one would expect. The draw rate falls away from there, to the point where only 3.5% of matches with a 95% win probability differential end in draws.
Applying these draw rates to our group stage fixture predictions should allow for our Elo model to overcome the three-outcome nature of football.</p>
<h3 id="visualising-elo-ratings-through-time">Visualising Elo Ratings Through Time</h3>
<p>Something we can do to help us better understand how the Elo model develops final team ratings is to visualise how a team's rating has developed over time. We know that the rating system dictates that all teams start with an initial rating of 1500, so we should expect to see teams move upward or down from there as a starting point depending on their fortunes. </p>
<p>Let's look at how Australia's Elo rating has changed through time.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>elo_results %&gt;% 
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>  select(match_id, date, home_team, home_elo) %&gt;% rename(team = home_team, elo = home_elo) %&gt;% 
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>  bind_rows(elo_results %&gt;% select(match_id, date, away_team, away_elo) %&gt;% rename(team = away_team, elo = away_elo)) %&gt;% 
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>  arrange(match_id) %&gt;% 
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>  filter(team == &quot;Australia&quot;) %&gt;% 
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>  ggplot(aes(x = date, y = elo, group = 1)) +
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a>  geom_hline(yintercept = 1500, linetype = &quot;dashed&quot;, color = &quot;black&quot;) +
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a>  geom_line(color = &quot;#ffb80c&quot;, size = 1) +
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a>  theme_minimal() +
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a>  labs(x = &quot;Year&quot;, y = &quot;Elo Rating&quot;,
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a>       title = &quot;Australia&#39;s Historic Elo Rating&quot;) + 
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a>  theme(panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a>        plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-18-14" name="__codelineno-18-14" href="#__codelineno-18-14"></a>        text = element_text(color = &quot;black&quot;, family = &quot;poor_story&quot;),
<a id="__codelineno-18-15" name="__codelineno-18-15" href="#__codelineno-18-15"></a>        axis.text = element_text(color = &quot;black&quot;, size = 12),
<a id="__codelineno-18-16" name="__codelineno-18-16" href="#__codelineno-18-16"></a>        plot.title = element_text(color = &quot;black&quot;, size = 24, hjust = 0.5),
<a id="__codelineno-18-17" name="__codelineno-18-17" href="#__codelineno-18-17"></a>        axis.title = element_text(family = &quot;poor_story&quot;, size = 16),
<a id="__codelineno-18-18" name="__codelineno-18-18" href="#__codelineno-18-18"></a>        plot.margin = unit(c(1,1,1,1), &quot;cm&quot;))
</code></pre></div>
<img alt="png" src="../img/AUS_ELO_RATING.png" /></p>
<p>After a slow few decades initially with very few matches played, the Socceroos' Elo eventuall reached a peak rating of 1954 in June of 2001 (after a win against New Zealand) and has now settled back in the low-1800s range as of late 2022.</p>
<h3 id="making-predictions">Making Predictions</h3>
<p>Time to get back to making predictions - again using the <code>elo</code> package, the <code>elo.calc()</code> function can be used here to find the probability that a team with rating X will beat a team with rating Y.
From there we can overlay our draw rates and adjust as necessary to ensure all outcomes sum to equal 100%.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>world_cup_predictions &lt;- world_cup_matchups %&gt;%
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>  # Join on final home and away team Elo ratings ahead of calculating win probabilities
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>  left_join(final_elos %&gt;% rename(home_elo = elo), by = c(&quot;home_team&quot; = &quot;team&quot;)) %&gt;%
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>  left_join(final_elos %&gt;% rename(away_elo = elo), by = c(&quot;away_team&quot; = &quot;team&quot;)) %&gt;%
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>  # Calculate win probabilities
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>  mutate(home_team_prob = elo.prob(home_elo, away_elo),
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>         away_team_prob = elo.prob(away_elo, home_elo),
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a>         # Just as we did with finding draw rates, group each match into probability differential buckets so that we can apply the correct draw rate
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>         prob_diff = abs(home_team_prob - away_team_prob),
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a>         prob_diff_bucket = round(20*prob_diff)/20) %&gt;%
<a id="__codelineno-19-13" name="__codelineno-19-13" href="#__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14" href="#__codelineno-19-14"></a>  # Join on our draw rates data frame - this essentially gives us the historic draw rate for the given match-up&#39;s probability split
<a id="__codelineno-19-15" name="__codelineno-19-15" href="#__codelineno-19-15"></a>  left_join(draw_rates, by = &quot;prob_diff_bucket&quot;) %&gt;%
<a id="__codelineno-19-16" name="__codelineno-19-16" href="#__codelineno-19-16"></a>
<a id="__codelineno-19-17" name="__codelineno-19-17" href="#__codelineno-19-17"></a>  # update the draw_prob column accordingly for group stage matches. Set draw_prob to 0 for knockout matches where draws aren&#39;t possible.
<a id="__codelineno-19-18" name="__codelineno-19-18" href="#__codelineno-19-18"></a>  mutate(draw_prob = case_when(stage == &quot;Group&quot; ~ draw_rate,
<a id="__codelineno-19-19" name="__codelineno-19-19" href="#__codelineno-19-19"></a>                               stage == &quot;Knockout&quot; ~ 0),
<a id="__codelineno-19-20" name="__codelineno-19-20" href="#__codelineno-19-20"></a>
<a id="__codelineno-19-21" name="__codelineno-19-21" href="#__codelineno-19-21"></a>         # Adjust home_team_prob and away_team_prob columns proportionally to allow for draw probability
<a id="__codelineno-19-22" name="__codelineno-19-22" href="#__codelineno-19-22"></a>         home_team_prob = home_team_prob * (1 - draw_prob),
<a id="__codelineno-19-23" name="__codelineno-19-23" href="#__codelineno-19-23"></a>         away_team_prob = away_team_prob * (1 - draw_prob)) %&gt;%
<a id="__codelineno-19-24" name="__codelineno-19-24" href="#__codelineno-19-24"></a>
<a id="__codelineno-19-25" name="__codelineno-19-25" href="#__codelineno-19-25"></a>  # Remove redundant columns
<a id="__codelineno-19-26" name="__codelineno-19-26" href="#__codelineno-19-26"></a>  select(home_team:away_team_prob)
<a id="__codelineno-19-27" name="__codelineno-19-27" href="#__codelineno-19-27"></a>
<a id="__codelineno-19-28" name="__codelineno-19-28" href="#__codelineno-19-28"></a># View 5 group stage matches and 5 knockout matches
<a id="__codelineno-19-29" name="__codelineno-19-29" href="#__codelineno-19-29"></a>world_cup_predictions %&gt;% group_by(stage) %&gt;% slice_head(n = 5)
<a id="__codelineno-19-30" name="__codelineno-19-30" href="#__codelineno-19-30"></a>
<a id="__codelineno-19-31" name="__codelineno-19-31" href="#__codelineno-19-31"></a>model_name = &quot;Elo_Tutorial&quot;
<a id="__codelineno-19-32" name="__codelineno-19-32" href="#__codelineno-19-32"></a>file_name=paste(model_name,&quot;_submission_file.csv&quot;,sep=&quot;&quot;)
<a id="__codelineno-19-33" name="__codelineno-19-33" href="#__codelineno-19-33"></a>write.csv(world_cup_predictions,file_name)
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>## # A tibble: 10  6
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>## # Groups:   stage [2]
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>##    home_team   away_team   stage    home_team_prob draw_prob away_team_prob
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>##    &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>##  1 Qatar       Ecuador     Group             0.209     0.276          0.515
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>##  2 Senegal     Netherlands Group             0.155     0.213          0.632
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>##  3 Qatar       Senegal     Group             0.276     0.256          0.468
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>##  4 Netherlands Ecuador     Group             0.560     0.240          0.199
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>##  5 Ecuador     Senegal     Group             0.424     0.285          0.291
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a>##  6 Qatar       Senegal     Knockout          0.371     0              0.629
<a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a>##  7 Qatar       Netherlands Knockout          0.126     0              0.874
<a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a>##  8 Qatar       Ecuador     Knockout          0.289     0              0.711
<a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a>##  9 Qatar       England     Knockout          0.218     0              0.782
<a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a>## 10 Qatar       USA         Knockout          0.321     0              0.679
</code></pre></div>
<p>And there you have it - we've successfully created a model for predicting future match outcomes for the 2022 FIFA World Cup!</p>
<p>We hope you've found this tutorial useful - if you have any questions regarding predictive data modelling please reach out to <a href="mailto:automation@betfair.com.au">automation@betfair.com.au</a>.</p>
<p>Good luck in the <a href="/modelling/soccerWorldCup2022Datathon/">Datathon</a>!</p>
<hr />
<h3 id="disclaimer">Disclaimer</h3>
<p>Note that whilst models and automated strategies are fun and rewarding to create, we can't promise that your model or betting strategy will be profitable, and we make no representations in relation to the code shared or information on this page. If you're using this code or implementing your own strategies, you do so entirely at your own risk and you are responsible for any winnings/losses incurred. Under no circumstances will Betfair be liable for any loss or damage you suffer.</p>
<h2 id="complete-code">Complete Code</h2>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a>packages &lt;- c(&quot;tidyverse&quot;, &quot;elo&quot;, &quot;formattable&quot;, &quot;lubridate&quot;, &quot;showtext&quot;)
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>install.packages(setdiff(packages, rownames(installed.packages())))
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>library(tidyverse)
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a>library(formattable)
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>library(elo)
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a>library(lubridate)
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>library(showtext)
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>match_results &lt;- read_csv(&quot;results.csv&quot;)
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>match_results %&gt;% glimpse
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>match_results_wrangled &lt;- match_results %&gt;% 
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a>  # Rename United States and South Korea to USA and Korea Republic respectively to reflect current naming. We need to do this to both &#39;home_team&#39; and &#39;away_team&#39; columns
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>  mutate(home_team = case_when(home_team == &quot;United States&quot; ~ &quot;USA&quot;,
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>                               home_team == &quot;South Korea&quot; ~ &quot;Korea Republic&quot;,
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>                               TRUE ~ home_team),
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>         away_team = case_when(away_team == &quot;United States&quot; ~ &quot;USA&quot;,
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a>                               away_team == &quot;South Korea&quot; ~ &quot;Korea Republic&quot;,
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a>                               TRUE ~ away_team),
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a>         # Add a new column for match result from both the home team and away team&#39;s perspectives. 1 = Win, 0.5 = Draw, 0 = Loss.
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>         home_result = case_when(home_score &gt; away_score ~ 1,
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a>                                 home_score &lt; away_score ~ 0,
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a>                                 home_score == away_score ~ 0.5),
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a>         away_result = case_when(home_score &lt; away_score ~ 1,
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a>                                 home_score &gt; away_score ~ 0,
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a>                                 home_score == away_score ~ 0.5),
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>         # Add a margin feature
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a>         margin = abs(home_score - away_score)) %&gt;% 
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a>  # If there are any matches missing score data, we don&#39;t want to use them for our Elo model - drop any data where we are missing a match margin
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a>  drop_na(margin)
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a>final_dataset &lt;- match_results_wrangled %&gt;% 
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a>  # Add a column to show 100 where there is a home ground advantage or 0 when played at a neutral venue. Our Elo model will call on this column for HGA.
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a>  mutate(hga = 100*!neutral,
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a>         # Allocate each tournament within the data to a K-weighting according to the above definition. Note that this section is quite open to interpretation.
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>         tournament_weight = case_when(tournament == &quot;FIFA World Cup&quot; ~ 60,
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a>                                       tournament %in% c(&quot;Confederations Cup&quot;, &quot;African Cup of Nations&quot;, &quot;Copa Amrica&quot;, 
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a>                                                         &quot;UEFA Euro&quot;, &quot;AFC Asian Cup&quot;) ~ 50,
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a>                                       str_detect(tolower(tournament), &quot;qualification&quot;) ~ 40,
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a>                                       str_detect(tolower(tournament), &quot; cup&quot;) ~ 40,
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a>                                       tournament %in% c(&quot;UEFA Nations League&quot;, &quot;CONCACAF Nations League&quot;) ~ 40,
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a>                                       tournament == &quot;Friendly&quot; ~ 20,
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a>                                       TRUE ~ 30),
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a>         # Use our &#39;margin&#39; feature to create the goal difference K-multiplier.
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a>         goal_diff_multiplier = case_when(margin &lt;= 1 ~ 1,
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a>                                          margin == 2 ~ 1.5,
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a>                                          margin == 3 ~ 1.75, 
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a>                                          margin &gt;= 4 ~ 1.75 + (margin-3)/8),
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a>         # Combine the tournament weight and goal difference features to obtain our final K value for each match.
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a>         k = tournament_weight*goal_diff_multiplier,
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a>         # Also add a &#39;match_id&#39; feaature to identify each match by number - we&#39;ll use this later.
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a>         match_id = row_number()) %&gt;% 
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a>  relocate(match_id)
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a>elo_model &lt;- elo.run(data = final_dataset,
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a>                     formula = home_result ~ adjust(home_team, hga) + away_team + k(k))
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a>final_elos &lt;- final.elos(elo_model) %&gt;% 
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a>  enframe(name = &quot;team&quot;, value = &quot;elo&quot;) %&gt;% 
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a>  arrange(desc(elo))
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a># See the top 10 rated nations
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a>final_elos %&gt;% slice_head(n = 10)
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a># Load Google fonts from https://fonts.google.com/
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a>font_add_google(name = &quot;Poor Story&quot;, family = &quot;poor_story&quot;)
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a>showtext_auto()
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a># Visualise final Elo ratings
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a>final_elos %&gt;% 
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a>  ggplot(aes(x = elo)) +
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a>  geom_histogram(binwidth = 100, fill = &quot;#ffb80c&quot;, color = &quot;white&quot;) +
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a>  theme_minimal() +
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a>  labs(x = &quot;Elo Rating&quot;,
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a>       y = &quot;# of Teams&quot;,
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a>       title = &quot;Distribution of Final Elo Ratings&quot;) +
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a>  theme(panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a>        plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a>        text = element_text(color = &quot;black&quot;, family = &quot;poor_story&quot;),
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a>        axis.text = element_text(color = &quot;black&quot;, size = 14),
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a>        plot.title = element_text(color = &quot;black&quot;, size = 24, hjust = 0.5),
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a>        axis.title = element_text(family = &quot;poor_story&quot;, size = 16),
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a>        plot.margin = unit(c(1,1,1,1), &quot;cm&quot;))
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a>
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a>brier(elo_model)
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a>world_cup_matchups &lt;- read_csv(&quot;dummy_submission_file.csv&quot;)
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a>
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a>world_cup_matchups %&gt;% glimpse
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a>
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a># Start by taking our Elo model, wrangling the match-by-match rating updates within the stored model and joining to our historic data set.
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a>elo_results &lt;- elo_model %&gt;% 
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a>  as_tibble() %&gt;% 
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a>  mutate(match_id = row_number()) %&gt;% 
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a>  select(match_id, 
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a>         home_update = update.A,
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a>         away_update = update.B,
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a>         home_elo = elo.A,
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a>         away_elo = elo.B) %&gt;% 
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a>
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a>  # Join onto our historic data set using the match_id columns we created as a join key
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a>  right_join(final_dataset, by = &quot;match_id&quot;)
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a>draw_rates &lt;- elo_results %&gt;%
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a>  mutate(home_elo_pre_match = home_elo - home_update,
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a>         away_elo_pre_match = away_elo - away_update,
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a>         home_prob = elo.prob(home_elo_pre_match, away_elo_pre_match),
<a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a>         away_prob = 1 - home_prob,
<a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a>         prob_diff = abs(home_prob - away_prob),
<a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a>         prob_diff_bucket = round(20*prob_diff)/20) %&gt;% # Bucket into 20 groups at 5% increments between 0% and 100%
<a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a>  filter(year(date) &gt;= 2005) %&gt;%  # Filter down to the past 15 years to only bucket matches once some fairly decent Elo ratings have been established
<a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a>  group_by(prob_diff_bucket) %&gt;%
<a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a>  summarise(draw_rate = sum(home_result == 0.5)/n())
<a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a>
<a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a>draw_rates %&gt;% slice_head(n = 10)
<a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a>
<a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a>draw_rates %&gt;%
<a id="__codelineno-21-122" name="__codelineno-21-122" href="#__codelineno-21-122"></a>  mutate(draw_rate = percent(draw_rate, digits = 0),
<a id="__codelineno-21-123" name="__codelineno-21-123" href="#__codelineno-21-123"></a>         prob_diff_bucket = percent(prob_diff_bucket, digits = 0)) %&gt;%
<a id="__codelineno-21-124" name="__codelineno-21-124" href="#__codelineno-21-124"></a>  ggplot(aes(x = prob_diff_bucket, y = draw_rate)) +
<a id="__codelineno-21-125" name="__codelineno-21-125" href="#__codelineno-21-125"></a>  geom_col(fill = &quot;#ffb80c&quot;) +
<a id="__codelineno-21-126" name="__codelineno-21-126" href="#__codelineno-21-126"></a>  geom_text(aes(label = draw_rate, y = draw_rate + 0.01), 
<a id="__codelineno-21-127" name="__codelineno-21-127" href="#__codelineno-21-127"></a>            size = 3.5, family = &quot;poor_story&quot;) +
<a id="__codelineno-21-128" name="__codelineno-21-128" href="#__codelineno-21-128"></a>  theme_minimal() +
<a id="__codelineno-21-129" name="__codelineno-21-129" href="#__codelineno-21-129"></a>  scale_y_continuous(labels = scales::percent) +
<a id="__codelineno-21-130" name="__codelineno-21-130" href="#__codelineno-21-130"></a>  scale_x_continuous(labels = scales::percent, breaks = scales::pretty_breaks()) +
<a id="__codelineno-21-131" name="__codelineno-21-131" href="#__codelineno-21-131"></a>  labs(y = &quot;Historic Draw Rate&quot;, 
<a id="__codelineno-21-132" name="__codelineno-21-132" href="#__codelineno-21-132"></a>       x = &quot;Difference in Win Probability Between Home &amp; Away Sides&quot;,
<a id="__codelineno-21-133" name="__codelineno-21-133" href="#__codelineno-21-133"></a>       title = &quot;Draw Frequency by Heaviness of Favouritism&quot;) +
<a id="__codelineno-21-134" name="__codelineno-21-134" href="#__codelineno-21-134"></a>  theme(panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-21-135" name="__codelineno-21-135" href="#__codelineno-21-135"></a>        plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-21-136" name="__codelineno-21-136" href="#__codelineno-21-136"></a>        text = element_text(color = &quot;black&quot;, family = &quot;poor_story&quot;),
<a id="__codelineno-21-137" name="__codelineno-21-137" href="#__codelineno-21-137"></a>        axis.text = element_text(color = &quot;black&quot;, size = 12),
<a id="__codelineno-21-138" name="__codelineno-21-138" href="#__codelineno-21-138"></a>        plot.title = element_text(color = &quot;black&quot;, size = 24, hjust = 0.5),
<a id="__codelineno-21-139" name="__codelineno-21-139" href="#__codelineno-21-139"></a>        axis.title = element_text(family = &quot;poor_story&quot;, size = 16),
<a id="__codelineno-21-140" name="__codelineno-21-140" href="#__codelineno-21-140"></a>        plot.margin = unit(c(1,1,1,1), &quot;cm&quot;))
<a id="__codelineno-21-141" name="__codelineno-21-141" href="#__codelineno-21-141"></a>
<a id="__codelineno-21-142" name="__codelineno-21-142" href="#__codelineno-21-142"></a>elo_results %&gt;% 
<a id="__codelineno-21-143" name="__codelineno-21-143" href="#__codelineno-21-143"></a>  select(match_id, date, home_team, home_elo) %&gt;% rename(team = home_team, elo = home_elo) %&gt;% 
<a id="__codelineno-21-144" name="__codelineno-21-144" href="#__codelineno-21-144"></a>  bind_rows(elo_results %&gt;% select(match_id, date, away_team, away_elo) %&gt;% rename(team = away_team, elo = away_elo)) %&gt;% 
<a id="__codelineno-21-145" name="__codelineno-21-145" href="#__codelineno-21-145"></a>  arrange(match_id) %&gt;% 
<a id="__codelineno-21-146" name="__codelineno-21-146" href="#__codelineno-21-146"></a>  filter(team == &quot;Australia&quot;) %&gt;% 
<a id="__codelineno-21-147" name="__codelineno-21-147" href="#__codelineno-21-147"></a>  ggplot(aes(x = date, y = elo, group = 1)) +
<a id="__codelineno-21-148" name="__codelineno-21-148" href="#__codelineno-21-148"></a>  geom_hline(yintercept = 1500, linetype = &quot;dashed&quot;, color = &quot;black&quot;) +
<a id="__codelineno-21-149" name="__codelineno-21-149" href="#__codelineno-21-149"></a>  geom_line(color = &quot;#ffb80c&quot;, size = 1) +
<a id="__codelineno-21-150" name="__codelineno-21-150" href="#__codelineno-21-150"></a>  theme_minimal() +
<a id="__codelineno-21-151" name="__codelineno-21-151" href="#__codelineno-21-151"></a>  labs(x = &quot;Year&quot;, y = &quot;Elo Rating&quot;,
<a id="__codelineno-21-152" name="__codelineno-21-152" href="#__codelineno-21-152"></a>       title = &quot;Australia&#39;s Historic Elo Rating&quot;) + 
<a id="__codelineno-21-153" name="__codelineno-21-153" href="#__codelineno-21-153"></a>  theme(panel.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-21-154" name="__codelineno-21-154" href="#__codelineno-21-154"></a>        plot.background = element_rect(fill = &quot;transparent&quot;, colour = NA),
<a id="__codelineno-21-155" name="__codelineno-21-155" href="#__codelineno-21-155"></a>        text = element_text(color = &quot;black&quot;, family = &quot;poor_story&quot;),
<a id="__codelineno-21-156" name="__codelineno-21-156" href="#__codelineno-21-156"></a>        axis.text = element_text(color = &quot;black&quot;, size = 12),
<a id="__codelineno-21-157" name="__codelineno-21-157" href="#__codelineno-21-157"></a>        plot.title = element_text(color = &quot;black&quot;, size = 24, hjust = 0.5),
<a id="__codelineno-21-158" name="__codelineno-21-158" href="#__codelineno-21-158"></a>        axis.title = element_text(family = &quot;poor_story&quot;, size = 16),
<a id="__codelineno-21-159" name="__codelineno-21-159" href="#__codelineno-21-159"></a>        plot.margin = unit(c(1,1,1,1), &quot;cm&quot;))
<a id="__codelineno-21-160" name="__codelineno-21-160" href="#__codelineno-21-160"></a>
<a id="__codelineno-21-161" name="__codelineno-21-161" href="#__codelineno-21-161"></a>world_cup_predictions &lt;- world_cup_matchups %&gt;%
<a id="__codelineno-21-162" name="__codelineno-21-162" href="#__codelineno-21-162"></a>  # Join on final home and away team Elo ratings ahead of calculating win probabilities
<a id="__codelineno-21-163" name="__codelineno-21-163" href="#__codelineno-21-163"></a>  left_join(final_elos %&gt;% rename(home_elo = elo), by = c(&quot;home_team&quot; = &quot;team&quot;)) %&gt;%
<a id="__codelineno-21-164" name="__codelineno-21-164" href="#__codelineno-21-164"></a>  left_join(final_elos %&gt;% rename(away_elo = elo), by = c(&quot;away_team&quot; = &quot;team&quot;)) %&gt;%
<a id="__codelineno-21-165" name="__codelineno-21-165" href="#__codelineno-21-165"></a>
<a id="__codelineno-21-166" name="__codelineno-21-166" href="#__codelineno-21-166"></a>  # Calculate win probabilities
<a id="__codelineno-21-167" name="__codelineno-21-167" href="#__codelineno-21-167"></a>  mutate(home_team_prob = elo.prob(home_elo, away_elo),
<a id="__codelineno-21-168" name="__codelineno-21-168" href="#__codelineno-21-168"></a>         away_team_prob = elo.prob(away_elo, home_elo),
<a id="__codelineno-21-169" name="__codelineno-21-169" href="#__codelineno-21-169"></a>
<a id="__codelineno-21-170" name="__codelineno-21-170" href="#__codelineno-21-170"></a>         # Just as we did with finding draw rates, group each match into probability differential buckets so that we can apply the correct draw rate
<a id="__codelineno-21-171" name="__codelineno-21-171" href="#__codelineno-21-171"></a>         prob_diff = abs(home_team_prob - away_team_prob),
<a id="__codelineno-21-172" name="__codelineno-21-172" href="#__codelineno-21-172"></a>         prob_diff_bucket = round(20*prob_diff)/20) %&gt;%
<a id="__codelineno-21-173" name="__codelineno-21-173" href="#__codelineno-21-173"></a>
<a id="__codelineno-21-174" name="__codelineno-21-174" href="#__codelineno-21-174"></a>  # Join on our draw rates data frame - this essentially gives us the historic draw rate for the given match-up&#39;s probability split
<a id="__codelineno-21-175" name="__codelineno-21-175" href="#__codelineno-21-175"></a>  left_join(draw_rates, by = &quot;prob_diff_bucket&quot;) %&gt;%
<a id="__codelineno-21-176" name="__codelineno-21-176" href="#__codelineno-21-176"></a>
<a id="__codelineno-21-177" name="__codelineno-21-177" href="#__codelineno-21-177"></a>  # update the draw_prob column accordingly for group stage matches. Set draw_prob to 0 for knockout matches where draws aren&#39;t possible.
<a id="__codelineno-21-178" name="__codelineno-21-178" href="#__codelineno-21-178"></a>  mutate(draw_prob = case_when(stage == &quot;Group&quot; ~ draw_rate,
<a id="__codelineno-21-179" name="__codelineno-21-179" href="#__codelineno-21-179"></a>                               stage == &quot;Knockout&quot; ~ 0),
<a id="__codelineno-21-180" name="__codelineno-21-180" href="#__codelineno-21-180"></a>
<a id="__codelineno-21-181" name="__codelineno-21-181" href="#__codelineno-21-181"></a>         # Adjust home_team_prob and away_team_prob columns proportionally to allow for draw probability
<a id="__codelineno-21-182" name="__codelineno-21-182" href="#__codelineno-21-182"></a>         home_team_prob = home_team_prob * (1 - draw_prob),
<a id="__codelineno-21-183" name="__codelineno-21-183" href="#__codelineno-21-183"></a>         away_team_prob = away_team_prob * (1 - draw_prob)) %&gt;%
<a id="__codelineno-21-184" name="__codelineno-21-184" href="#__codelineno-21-184"></a>
<a id="__codelineno-21-185" name="__codelineno-21-185" href="#__codelineno-21-185"></a>  # Remove redundant columns
<a id="__codelineno-21-186" name="__codelineno-21-186" href="#__codelineno-21-186"></a>  select(home_team:away_team_prob)
<a id="__codelineno-21-187" name="__codelineno-21-187" href="#__codelineno-21-187"></a>
<a id="__codelineno-21-188" name="__codelineno-21-188" href="#__codelineno-21-188"></a># View 5 group stage matches and 5 knockout matches
<a id="__codelineno-21-189" name="__codelineno-21-189" href="#__codelineno-21-189"></a>world_cup_predictions %&gt;% group_by(stage) %&gt;% slice_head(n = 5)
<a id="__codelineno-21-190" name="__codelineno-21-190" href="#__codelineno-21-190"></a>model_name = &quot;Elo_Tutorial&quot;
<a id="__codelineno-21-191" name="__codelineno-21-191" href="#__codelineno-21-191"></a>file_name=paste(model_name,&quot;_submission_file.csv&quot;,sep=&quot;&quot;)
<a id="__codelineno-21-192" name="__codelineno-21-192" href="#__codelineno-21-192"></a>write.csv(world_cup_predictions,file_name)
</code></pre></div>


  




                
              </article>
            </div>
          
          
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
    
      <nav class="md-footer__inner md-grid" aria-label="Footer">
        
          
          <a href="../greyhoundModellingPython/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Greyhound modelling in Python" rel="prev">
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Previous
                </span>
                Greyhound modelling in Python
              </div>
            </div>
          </a>
        
        
          
          <a href="../soccerModellingTutorialPython/" class="md-footer__link md-footer__link--next" aria-label="Next: Soccer modelling tutorial in Python" rel="next">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                Soccer modelling tutorial in Python
              </div>
            </div>
            <div class="md-footer__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
    <div class="md-footer-meta md-typeset">
      <div class="md-footer-meta__inner md-grid">
        <div class="md-copyright">
  
  
</div>
        
          <div class="md-social">
  
    
    
      
      
    
    <a href="https://twitter.com/Betfair_Aus" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://linkedin.com/company/betfair-australia" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://facebook.com/betfairaustralia" target="_blank" rel="noopener" title="facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://youtube.com/user/betfairaus" target="_blank" rel="noopener" title="youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/betfair-datascientists" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
        
      </div>

      <div class="bf-footer">
          <div class="bf-footer-inner">
              <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
              <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its <a class='inner-link' href="https://www.betfair.com.au/info/responsible-gambling/">Responsible Gambling Code of Conduct</a> and for South
              Australian residents by the <a class='inner-link' href="https://www.betfair.com.au/info/pdf/SA-GCoP.pdf">South Australian Responsible Gambling Code of Practice.</a><br /> <div class="full-screen"> <p style="font-family: Arial, sans-serif; font-size: 1.2rem; font-weight: bold;text-align: center;">Think. Is this a bet you really want to place?</p> <p style="font-family: Arial, sans-serif; font-size: 0.8rem; font-weight: bold;text-align: center;">For free and confidential support call 1800 858 858 or visit <a href="http://www.gamblinghelponline.org.au" style="color: black; text-decoration: underline;">www.gamblinghelponline.org.au</a></p> </div> </p>
          
              <ul class="bf-links">
                <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
                <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
                <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
                <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
                <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
              </ul>
          </div>
      </div>
    </div>

    <script src="https://js.adsrvr.org/up_loader.1.1.0.js" type="text/javascript"></script>
    <script type="text/javascript">
        ttd_dom_ready( function() {
            if (typeof TTDUniversalPixelApi === 'function') {
                var universalPixelApi = new TTDUniversalPixelApi();
                universalPixelApi.init("y12d1ir", ["8ml4f17"], "https://insight.adsrvr.org/track/up");
            }
        });
    </script>

</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["toc.integrate", "navigation.instant", "navigation.tabs", "navigation.top", "navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8492ddcf.min.js"></script>
      
        <script src="../../js/scripts.js"></script>
      
    
  </body>
</html>