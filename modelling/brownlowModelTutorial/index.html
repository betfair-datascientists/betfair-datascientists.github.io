



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation, guides and articles on creating, developing and implementing automated betting strategies, using data analysis to inform betting models and how to interact with the Betfair API.">
      
      
        <link rel="canonical" href="https://betfair-datascientists.github.io/modelling/brownlowModelTutorial/">
      
      
        <meta name="author" content="Betfair Data Scientists">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../img/BetfairFavicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>Modelling the Brownlow Medal - The Automation Hub</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.9a8eeed6.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    <link rel="stylesheet" href="../../assets/fonts/clarke-regular.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../../#modelling-the-brownlow" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-header-nav__button md-logo">
          
            <img src="../../img/logo.svg" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                The Automation Hub
              </span>
              <span class="md-header-nav__topic">
                Modelling the Brownlow Medal
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      <div class="bf-nav md-flex__cell">
        <a class="bf-hidable" href="https://www.betfair.com.au/exchange/plus/"><svg class="exchangeLogo" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 38.775 4.59" width="24" height="17">
          <path class="st1" d="m 160.3,-136.95 v 26"/>
          <g transform="translate(18.8,-137.15)">
            <path d="m 2.2901089,126.53441 v 5.20093 H -3.3107216 L 7.4888397,144.33446 18.2884,131.73534 h -5.598633 v -5.20093 z m -8.6000974,8.10132 -10.8017585,12.59913 h 5.60083 v 5.2998 h 10.3996581 v -5.2998 h 5.6008306 z"/>
          </g>
        </svg><span> Exchange</span></a>
        <a href="https://www.betfair.com.au/hub/">Hub</a>
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../.." title="Home" class="md-tabs__link">
          Home
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../thirdPartyTools/overview/" title="Tutorials" class="md-tabs__link">
          Tutorials
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../api/apiappkey/" title="API" class="md-tabs__link">
          API
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../historicData/dataSources/" title="Historic Data" class="md-tabs__link">
          Historic Data
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../howToModel/" title="Modelling" class="md-tabs__link md-tabs__link--active">
          Modelling
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://betfair-datascientists.github.io" title="The Automation Hub" class="md-nav__button md-logo">
      
        <img src="../../img/logo.svg" width="48" height="48">
      
    </a>
    The Automation Hub
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Home
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Home
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="The Automation Hub" class="md-nav__link">
      The Automation Hub
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Tutorials
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Tutorials
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/overview/" title="Tools Overview" class="md-nav__link">
      Tools Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-2" type="checkbox" id="nav-2-2">
    
    <label class="md-nav__link" for="nav-2-2">
      Third Party tools
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-2">
        Third Party tools
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngel/betAngel/" title="Bet Angel" class="md-nav__link">
      Bet Angel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/Gruss/Gruss/" title="Gruss Betting Assistant" class="md-nav__link">
      Gruss Betting Assistant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/CymaticTrader/CymaticTrader/" title="Cymatic Trader" class="md-nav__link">
      Cymatic Trader
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/BfBotManager/BfBotManager/" title="BF Bot Manager" class="md-nav__link">
      BF Bot Manager
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/MarketFeeder/MarketFeeder/" title="MarketFeeder Pro" class="md-nav__link">
      MarketFeeder Pro
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/bfexplorer/bfexplorer/" title="Bfexplorer" class="md-nav__link">
      Bfexplorer
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-3" type="checkbox" id="nav-2-3">
    
    <label class="md-nav__link" for="nav-2-3">
      Ratings / Tipping Automations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-3">
        Ratings / Tipping Automations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelRatingsAutomation/" title="Bet Angel - Ratings automation" class="md-nav__link">
      Bet Angel - Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/BetAngelMultipleMarketRatings/" title="Bet Angel - Multiple market ratings" class="md-nav__link">
      Bet Angel - Multiple market ratings
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelTippingAutomation/" title="Bet Angel - Tipping automation" class="md-nav__link">
      Bet Angel - Tipping automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grussRatingsAutomation/" title="Gruss - Ratings automation" class="md-nav__link">
      Gruss - Ratings automation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/cymaticTraderRatingsAutomation/" title="Cymatic - Trader Ratings automation" class="md-nav__link">
      Cymatic - Trader Ratings automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-4" type="checkbox" id="nav-2-4">
    
    <label class="md-nav__link" for="nav-2-4">
      Market Favourite Automations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-4">
        Market Favourite Automations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelMarketFavouriteAutomation/" title="Bet Angel - Market favourite automation" class="md-nav__link">
      Bet Angel - Market favourite automation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-5" type="checkbox" id="nav-2-5">
    
    <label class="md-nav__link" for="nav-2-5">
      Automating Simultaneous Markets
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-5">
        Automating Simultaneous Markets
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/betAngelSimultaneousMarkets/" title="Bet Angel - simultaneous markets" class="md-nav__link">
      Bet Angel - simultaneous markets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/grusslSimultaneousMarkets/" title="Gruss - simultaneous markets" class="md-nav__link">
      Gruss - simultaneous markets
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2-6" type="checkbox" id="nav-2-6">
    
    <label class="md-nav__link" for="nav-2-6">
      Staking Strategies
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-2-6">
        Staking Strategies
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/BfBotManagerAutomation/" title="BF Bot Manager - Double or Bust" class="md-nav__link">
      BF Bot Manager - Double or Bust
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../thirdPartyTools/MarketFeeder2_6Staking/" title="Market Feeder - Pro 2-6 Staking" class="md-nav__link">
      Market Feeder - Pro 2-6 Staking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      API
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiappkey/" title="How to access the Betfair API" class="md-nav__link">
      How to access the Betfair API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiRtutorial/" title="API tutorials in R" class="md-nav__link">
      API tutorials in R
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../api/apiPythontutorial/" title="API tutorial in Python" class="md-nav__link">
      API tutorial in Python
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Historic Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Historic Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/dataSources/" title="Historic Data Sources" class="md-nav__link">
      Historic Data Sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../historicData/usingHistoricDataSite/" title="Downloading from the Historic Data site" class="md-nav__link">
      Downloading from the Historic Data site
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Modelling
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Modelling
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModel/" title="Intro to modelling" class="md-nav__link">
      Intro to modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../howToModelTheAusOpen/" title="How to model the Australian Open" class="md-nav__link">
      How to model the Australian Open
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenRTutorial/" title="Aus Open R Tutorial" class="md-nav__link">
      Aus Open R Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AusOpenPythonTutorial/" title="Aus Open Python Tutorial" class="md-nav__link">
      Aus Open Python Tutorial
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart1/" title="EPL 01. Data acquisition & exploration" class="md-nav__link">
      EPL 01. Data acquisition & exploration
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart2/" title="EPL 02. Data preparation & feature engineering" class="md-nav__link">
      EPL 02. Data preparation & feature engineering
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart3/" title="EPL 03. Model building & hyperparameter tuning" class="md-nav__link">
      EPL 03. Model building & hyperparameter tuning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../EPLmodelPart4/" title="EPL 04. Weekly predictions" class="md-nav__link">
      EPL 04. Weekly predictions
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart1/" title="AFL 01. Data cleaning" class="md-nav__link">
      AFL 01. Data cleaning
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart2/" title="AFL 02. Feature creation" class="md-nav__link">
      AFL 02. Feature creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart3/" title="AFL 03. Modelling" class="md-nav__link">
      AFL 03. Modelling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../AFLmodelPart4/" title="AFL 04. Weekly predictions" class="md-nav__link">
      AFL 04. Weekly predictions
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Modelling the Brownlow Medal
      </label>
    
    <a href="./" title="Modelling the Brownlow Medal" class="md-nav__link md-nav__link--active">
      Modelling the Brownlow Medal
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#eda-read-in-the-data" title="EDA - Read in the data" class="md-nav__link">
    EDA - Read in the data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploring-votes-if-a-bag-is-kicked-5-goals" title="Exploring votes if a bag is kicked (5+ goals)" class="md-nav__link">
    Exploring votes if a bag is kicked (5+ goals)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-votes-if-the-player-has-30-possies-2-goals" title="Exploring votes if the player has 30+ possies &amp; 2+ goals" class="md-nav__link">
    Exploring votes if the player has 30+ possies &amp; 2+ goals
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-is-player-captain-feature" title="Create Is Player Captain Feature" class="md-nav__link">
    Create Is Player Captain Feature
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#eda-read-in-the-data" title="EDA - Read in the data" class="md-nav__link">
    EDA - Read in the data
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#exploring-votes-if-a-bag-is-kicked-5-goals" title="Exploring votes if a bag is kicked (5+ goals)" class="md-nav__link">
    Exploring votes if a bag is kicked (5+ goals)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#exploring-votes-if-the-player-has-30-possies-2-goals" title="Exploring votes if the player has 30+ possies &amp; 2+ goals" class="md-nav__link">
    Exploring votes if the player has 30+ possies &amp; 2+ goals
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-is-player-captain-feature" title="Create Is Player Captain Feature" class="md-nav__link">
    Create Is Player Captain Feature
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="modelling-the-brownlow">Modelling the Brownlow<a class="headerlink" href="#modelling-the-brownlow" title="Permanent link">&para;</a></h1>
<p>This walkthrough will provide a brief, yet effective tutorial on how to model the Brownlow medal. We will use data from 2010 to 2018, which includes Supercoach points and other useful stats.</p>
<p>The output will be the number of votes predicted for each player in each match, and we will aggregate these to create aggregates for each team and for the whole competition. No doubt we'll have Mitchell right up the top, and if we don't, then we know we've done something wrong!</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Import modules libraries</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">pandas</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">pd</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">h2o</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">h2o.automl</span> <span style="color: #008000; font-weight: bold">import</span> H2OAutoML
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">numpy</span> <span style="color: #008000; font-weight: bold">as</span> <span style="color: #0000FF; font-weight: bold">np</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">sklearn.preprocessing</span> <span style="color: #008000; font-weight: bold">import</span> StandardScaler
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">os</span>
<span style="color: #008000; font-weight: bold">import</span> <span style="color: #0000FF; font-weight: bold">pickle</span>

<span style="color: #408080; font-style: italic"># Change notebook settings</span>
pd<span style="color: #666666">.</span>options<span style="color: #666666">.</span>display<span style="color: #666666">.</span>max_columns <span style="color: #666666">=</span> <span style="color: #008000">None</span>
pd<span style="color: #666666">.</span>options<span style="color: #666666">.</span>display<span style="color: #666666">.</span>max_rows <span style="color: #666666">=</span> <span style="color: #666666">300</span>
<span style="color: #008000; font-weight: bold">from</span> <span style="color: #0000FF; font-weight: bold">IPython.core.interactiveshell</span> <span style="color: #008000; font-weight: bold">import</span> InteractiveShell
InteractiveShell<span style="color: #666666">.</span>ast_node_interactivity <span style="color: #666666">=</span> <span style="color: #BA2121">&quot;all&quot;</span>
</pre></div>

<hr />
<h2 id="eda-read-in-the-data">EDA - Read in the data<a class="headerlink" href="#eda-read-in-the-data" title="Permanent link">&para;</a></h2>
<p>I have collated this data using the fitzRoy R package and merging the afltables dataset with the footywire dataset, so that we can Supercoach and other advanced stats with Brownlow votes. Let's read in the data and have a sneak peak at what it looks like.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>brownlow_data <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&#39;data/afl_brownlow_data.csv&#39;</span>)

brownlow_data<span style="color: #666666">.</span>tail(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>season</th>
<th>round</th>
<th>venue</th>
<th>ID</th>
<th>match_id</th>
<th>player</th>
<th>jumper_no</th>
<th>team</th>
<th>opposition</th>
<th>status</th>
<th>team_score</th>
<th>opposition_score</th>
<th>margin</th>
<th>brownlow_votes</th>
<th>CP</th>
<th>UP</th>
<th>ED</th>
<th>DE</th>
<th>CM</th>
<th>GA</th>
<th>MI5</th>
<th>one_perc</th>
<th>BO</th>
<th>TOG</th>
<th>K</th>
<th>HB</th>
<th>D</th>
<th>M</th>
<th>G</th>
<th>B</th>
<th>T</th>
<th>HO</th>
<th>I50</th>
<th>CL</th>
<th>CG</th>
<th>R50</th>
<th>FF</th>
<th>FA</th>
<th>AF</th>
<th>SC</th>
</tr>
</thead>
<tbody>
<tr>
<td>76585</td>
<td>2018-08-26</td>
<td>2018</td>
<td>23</td>
<td>Etihad Stadium</td>
<td>12312</td>
<td>9708.0</td>
<td>M Wood</td>
<td>32</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>Away</td>
<td>117</td>
<td>94</td>
<td>23</td>
<td>NaN</td>
<td>0</td>
<td>3</td>
<td>2</td>
<td>66.7</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>34</td>
<td>3</td>
<td>0</td>
<td>3</td>
<td>3</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>24</td>
<td>25</td>
</tr>
<tr>
<td>76586</td>
<td>2018-08-26</td>
<td>2018</td>
<td>23</td>
<td>Etihad Stadium</td>
<td>11755</td>
<td>9708.0</td>
<td>S Wright</td>
<td>19</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>Away</td>
<td>117</td>
<td>94</td>
<td>23</td>
<td>NaN</td>
<td>10</td>
<td>17</td>
<td>22</td>
<td>75.9</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>83</td>
<td>16</td>
<td>13</td>
<td>29</td>
<td>8</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>3</td>
<td>0</td>
<td>4</td>
<td>4</td>
<td>1</td>
<td>0</td>
<td>107</td>
<td>96</td>
</tr>
<tr>
<td>76587</td>
<td>2018-08-26</td>
<td>2018</td>
<td>23</td>
<td>Etihad Stadium</td>
<td>11724</td>
<td>9708.0</td>
<td>J Ziebell</td>
<td>7</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>Away</td>
<td>117</td>
<td>94</td>
<td>23</td>
<td>NaN</td>
<td>9</td>
<td>8</td>
<td>11</td>
<td>73.3</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>4</td>
<td>0</td>
<td>94</td>
<td>12</td>
<td>3</td>
<td>15</td>
<td>6</td>
<td>3</td>
<td>1</td>
<td>2</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>0</td>
<td>89</td>
<td>109</td>
</tr>
</tbody>
</table>
<p>It looks like we've got about 76,000 rows of data and have stats like hitouts, clangers, effective disposals etc. Let's explore some certain scenarios. Using my domain knowledge of footy, I can hypothesise that if a player kicks 5 goals, he is pretty likely to poll votes. Similarly, if a player gets 30 possessions and 2+ goals, he is also probably likely to poll votes. Let's have a look at the mean votes for players for both of these situations. </p>
<h3 id="exploring-votes-if-a-bag-is-kicked-5-goals">Exploring votes if a bag is kicked (5+ goals)<a class="headerlink" href="#exploring-votes-if-a-bag-is-kicked-5-goals" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;G &gt;= 5&#39;</span>)<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;season&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean()
<span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&quot;Mean votes is a player has kicked a bag:&quot;</span>, brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;G &gt;= 5&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean())

    season
    <span style="color: #666666">2010</span>    <span style="color: #666666">1.420455</span>
    <span style="color: #666666">2011</span>    <span style="color: #666666">1.313433</span>
    <span style="color: #666666">2012</span>    <span style="color: #666666">1.413333</span>
    <span style="color: #666666">2013</span>    <span style="color: #666666">1.253731</span>
    <span style="color: #666666">2014</span>    <span style="color: #666666">1.915254</span>
    <span style="color: #666666">2015</span>    <span style="color: #666666">1.765625</span>
    <span style="color: #666666">2016</span>    <span style="color: #666666">1.788732</span>
    <span style="color: #666666">2017</span>    <span style="color: #666666">2.098361</span>
    <span style="color: #666666">2018</span>    <span style="color: #666666">0.000000</span>
    Name: brownlow_votes, dtype: float64

    Mean votes <span style="color: #AA22FF; font-weight: bold">is</span> a player has kicked a bag: <span style="color: #666666">1.4708818635607321</span>
</pre></div>

<h3 id="exploring-votes-if-the-player-has-30-possies-2-goals">Exploring votes if the player has 30+ possies &amp; 2+ goals<a class="headerlink" href="#exploring-votes-if-the-player-has-30-possies-2-goals" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;G &gt;= 2 and D &gt;= 30&#39;</span>)<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;season&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean()
<span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&quot;Mean votes if a player has 30 possies and kicks 2+ goals:&quot;</span>, brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;G &gt;= 2 and D &gt;= 30&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean())

    season
    <span style="color: #666666">2010</span>    <span style="color: #666666">1.826923</span>
    <span style="color: #666666">2011</span>    <span style="color: #666666">1.756410</span>
    <span style="color: #666666">2012</span>    <span style="color: #666666">2.118421</span>
    <span style="color: #666666">2013</span>    <span style="color: #666666">2.000000</span>
    <span style="color: #666666">2014</span>    <span style="color: #666666">2.253731</span>
    <span style="color: #666666">2015</span>    <span style="color: #666666">2.047619</span>
    <span style="color: #666666">2016</span>    <span style="color: #666666">2.103448</span>
    <span style="color: #666666">2017</span>    <span style="color: #666666">2.050000</span>
    <span style="color: #666666">2018</span>    <span style="color: #666666">0.000000</span>
    Name: brownlow_votes, dtype: float64

    Mean votes <span style="color: #008000; font-weight: bold">if</span> a player has <span style="color: #666666">30</span> possies <span style="color: #AA22FF; font-weight: bold">and</span> kicks <span style="color: #666666">2+</span> goals: <span style="color: #666666">1.8741379310344828</span>
</pre></div>

<p>As suspected, the average votes for these two situations is 1.87! That's huge. Let's get an idea of the average votes for each player. It should be around 6/44, as there are always 6 votes per match and around 44 players per match.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>brownlow_data<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean()
    <span style="color: #666666">0.12347341475121326</span>
</pre></div>

<p>So the average vote is 0.12. Let's see how this changes is the player is a captain. I have collected data on if players are captains from wikipedia and collated it into a csv. Let's load this in and create a "Is the player captain" feature, then check the average votes for captains.</p>
<h3 id="create-is-player-captain-feature">Create Is Player Captain Feature<a class="headerlink" href="#create-is-player-captain-feature" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>captains <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&#39;data/captains.csv&#39;</span>)<span style="color: #666666">.</span>set_index(<span style="color: #BA2121">&#39;player&#39;</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">is_captain_for_that_season</span>(captains_df, player, year):

    <span style="color: #008000; font-weight: bold">if</span> player <span style="color: #AA22FF; font-weight: bold">in</span> captains_df<span style="color: #666666">.</span>index:
        <span style="color: #408080; font-style: italic"># Get years they were captain</span>
        seasons <span style="color: #666666">=</span> captains_df<span style="color: #666666">.</span>loc[player]<span style="color: #666666">.</span>season<span style="color: #666666">.</span>split(<span style="color: #BA2121">&#39;-&#39;</span>)
        <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">len</span>(seasons) <span style="color: #666666">==</span> <span style="color: #666666">1</span>:
            seasons_captain <span style="color: #666666">=</span> <span style="color: #008000">list</span>(<span style="color: #008000">map</span>(<span style="color: #008000">int</span>, seasons))
        <span style="color: #008000; font-weight: bold">elif</span> <span style="color: #008000">len</span>(seasons) <span style="color: #666666">==</span> <span style="color: #666666">2</span>:
            <span style="color: #008000; font-weight: bold">if</span> seasons[<span style="color: #666666">1</span>] <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;&#39;</span>:
                seasons_captain <span style="color: #666666">=</span> <span style="color: #008000">list</span>(<span style="color: #008000">range</span>(<span style="color: #008000">int</span>(seasons[<span style="color: #666666">0</span>]), <span style="color: #666666">2019</span>))
            <span style="color: #008000; font-weight: bold">else</span>:
                seasons_captain <span style="color: #666666">=</span> <span style="color: #008000">list</span>(<span style="color: #008000">range</span>(<span style="color: #008000">int</span>(seasons[<span style="color: #666666">0</span>]), <span style="color: #008000">int</span>(seasons[<span style="color: #666666">1</span>]) <span style="color: #666666">+</span> <span style="color: #666666">1</span>))

        <span style="color: #008000; font-weight: bold">if</span> year <span style="color: #AA22FF; font-weight: bold">in</span> seasons_captain:
            <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">1</span>
    <span style="color: #008000; font-weight: bold">return</span> <span style="color: #666666">0</span>

brownlow_data[<span style="color: #BA2121">&#39;is_captain&#39;</span>] <span style="color: #666666">=</span> brownlow_data<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> x: is_captain_for_that_season(captains, x<span style="color: #666666">.</span>player, x<span style="color: #666666">.</span>season), axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;is_captain == 1&#39;</span>)<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;season&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean()
<span style="color: #008000; font-weight: bold">print</span>(<span style="color: #BA2121">&quot;Mean votes if a player is captain:&quot;</span>, brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;is_captain == 1&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>mean())

    season
    <span style="color: #666666">2010</span>    <span style="color: #666666">0.408497</span>
    <span style="color: #666666">2011</span>    <span style="color: #666666">0.429936</span>
    <span style="color: #666666">2012</span>    <span style="color: #666666">0.274194</span>
    <span style="color: #666666">2013</span>    <span style="color: #666666">0.438725</span>
    <span style="color: #666666">2014</span>    <span style="color: #666666">0.519663</span>
    <span style="color: #666666">2015</span>    <span style="color: #666666">0.447222</span>
    <span style="color: #666666">2016</span>    <span style="color: #666666">0.347826</span>
    <span style="color: #666666">2017</span>    <span style="color: #666666">0.425806</span>
    <span style="color: #666666">2018</span>    <span style="color: #666666">0.000000</span>
    Name: brownlow_votes, dtype: float64

    Mean votes <span style="color: #008000; font-weight: bold">if</span> a player <span style="color: #AA22FF; font-weight: bold">is</span> captain: <span style="color: #666666">0.36661698956780925</span>
</pre></div>

<p>This is significantly higher than if they aren't captain. What would be interesting is to look at the average difference in votes between when they were captain and when they weren't, to try and find if there is a 'captain bias' in brownlow votes. Go ahead and try. For now, we're going to move onto feature creation</p>
<hr />
<h1 id="feature-creation">Feature Creation<a class="headerlink" href="#feature-creation" title="Permanent link">&para;</a></h1>
<p>Let's make a range of features, including:</p>
<ul>
<li>Ratios of each statistic per game</li>
<li>If the player is a captain</li>
<li>If they kicked a bag (&#8536;+)</li>
<li>If they kicked 2 and had 30+ possies</li>
</ul>
<p>First we will make features of ratios. What is important is not how many of a certain stat a player has, but how much of that stat a player has <em>relative</em> to everyone else in the same match. It doesn't matter if Dusty Martin has 31 possessions if Tom Mitchell has had 50 - Mitchell is probably more likely to poll (assuming all else is equal). So rather than using the actual number of possessions for example, we can divide these possessions by the total amount of possessions in the game. To do this we'll use pandas groupby and transform methods.</p>
<h3 id="create-ratios-as-features">Create Ratios As Features<a class="headerlink" href="#create-ratios-as-features" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #666666">%%</span>time

<span style="color: #408080; font-style: italic"># Get a list of stats of which to create ratios for</span>
ratio_cols <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;CP&#39;</span>, <span style="color: #BA2121">&#39;UP&#39;</span>, <span style="color: #BA2121">&#39;ED&#39;</span>, <span style="color: #BA2121">&#39;DE&#39;</span>, <span style="color: #BA2121">&#39;CM&#39;</span>, <span style="color: #BA2121">&#39;GA&#39;</span>, <span style="color: #BA2121">&#39;MI5&#39;</span>, <span style="color: #BA2121">&#39;one_perc&#39;</span>, <span style="color: #BA2121">&#39;BO&#39;</span>, <span style="color: #BA2121">&#39;TOG&#39;</span>, 
               <span style="color: #BA2121">&#39;K&#39;</span>, <span style="color: #BA2121">&#39;HB&#39;</span>, <span style="color: #BA2121">&#39;D&#39;</span>, <span style="color: #BA2121">&#39;M&#39;</span>, <span style="color: #BA2121">&#39;G&#39;</span>, <span style="color: #BA2121">&#39;B&#39;</span>, <span style="color: #BA2121">&#39;T&#39;</span>, <span style="color: #BA2121">&#39;HO&#39;</span>, <span style="color: #BA2121">&#39;I50&#39;</span>, <span style="color: #BA2121">&#39;CL&#39;</span>, <span style="color: #BA2121">&#39;CG&#39;</span>, <span style="color: #BA2121">&#39;R50&#39;</span>, 
               <span style="color: #BA2121">&#39;FF&#39;</span>, <span style="color: #BA2121">&#39;FA&#39;</span>, <span style="color: #BA2121">&#39;AF&#39;</span>, <span style="color: #BA2121">&#39;SC&#39;</span>]

<span style="color: #408080; font-style: italic"># Create a ratios df</span>
ratios <span style="color: #666666">=</span> (brownlow_data<span style="color: #666666">.</span>copy()
          <span style="color: #666666">.</span>loc[:, [<span style="color: #BA2121">&#39;match_id&#39;</span>] <span style="color: #666666">+</span> ratio_cols]
          <span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;match_id&#39;</span>)
          <span style="color: #666666">.</span>transform(<span style="color: #008000; font-weight: bold">lambda</span> x: x <span style="color: #666666">/</span> x<span style="color: #666666">.</span>sum()))

feature_cols <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>, <span style="color: #BA2121">&#39;round&#39;</span>, <span style="color: #BA2121">&#39;venue&#39;</span>, <span style="color: #BA2121">&#39;ID&#39;</span>, <span style="color: #BA2121">&#39;match_id&#39;</span>, <span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;jumper_no&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, 
                <span style="color: #BA2121">&#39;opposition&#39;</span>, <span style="color: #BA2121">&#39;status&#39;</span>, <span style="color: #BA2121">&#39;team_score&#39;</span>, <span style="color: #BA2121">&#39;opposition_score&#39;</span>, <span style="color: #BA2121">&#39;margin&#39;</span>, <span style="color: #BA2121">&#39;brownlow_votes&#39;</span>]

<span style="color: #408080; font-style: italic"># Create a features df - join the ratios to this df</span>
features <span style="color: #666666">=</span> (brownlow_data[feature_cols]<span style="color: #666666">.</span>copy()
               <span style="color: #666666">.</span>join(ratios))

    Wall time: <span style="color: #666666">11.3</span> s
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features<span style="color: #666666">.</span>head()
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>season</th>
<th>round</th>
<th>venue</th>
<th>ID</th>
<th>match_id</th>
<th>player</th>
<th>jumper_no</th>
<th>team</th>
<th>opposition</th>
<th>status</th>
<th>team_score</th>
<th>opposition_score</th>
<th>margin</th>
<th>brownlow_votes</th>
<th>CP</th>
<th>UP</th>
<th>ED</th>
<th>DE</th>
<th>CM</th>
<th>GA</th>
<th>MI5</th>
<th>one_perc</th>
<th>BO</th>
<th>TOG</th>
<th>K</th>
<th>HB</th>
<th>D</th>
<th>M</th>
<th>G</th>
<th>B</th>
<th>T</th>
<th>HO</th>
<th>I50</th>
<th>CL</th>
<th>CG</th>
<th>R50</th>
<th>FF</th>
<th>FA</th>
<th>AF</th>
<th>SC</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2010-03-28</td>
<td>2010</td>
<td>1</td>
<td>Domain Stadium</td>
<td>11807</td>
<td>5096.0</td>
<td>T Armstrong</td>
<td>38</td>
<td>Adelaide</td>
<td>Fremantle</td>
<td>Away</td>
<td>62</td>
<td>118</td>
<td>-56</td>
<td>0.0</td>
<td>0.013393</td>
<td>0.016304</td>
<td>0.015517</td>
<td>0.025529</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.013333</td>
<td>0.000000</td>
<td>0.020516</td>
<td>0.013441</td>
<td>0.014599</td>
<td>0.014049</td>
<td>0.022599</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.011494</td>
<td>0.000000</td>
<td>0.036145</td>
<td>0.018868</td>
<td>0.000000</td>
<td>0.037037</td>
<td>0.011568</td>
<td>0.005456</td>
</tr>
<tr>
<td>1</td>
<td>2010-03-28</td>
<td>2010</td>
<td>1</td>
<td>Domain Stadium</td>
<td>3968</td>
<td>5096.0</td>
<td>N Bock</td>
<td>44</td>
<td>Adelaide</td>
<td>Fremantle</td>
<td>Away</td>
<td>62</td>
<td>118</td>
<td>-56</td>
<td>0.0</td>
<td>0.008929</td>
<td>0.025362</td>
<td>0.022414</td>
<td>0.023875</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.080000</td>
<td>0.000000</td>
<td>0.027169</td>
<td>0.032258</td>
<td>0.012165</td>
<td>0.021711</td>
<td>0.016949</td>
<td>0.038462</td>
<td>0.000000</td>
<td>0.026549</td>
<td>0.029851</td>
<td>0.022989</td>
<td>0.000000</td>
<td>0.024096</td>
<td>0.018868</td>
<td>0.037037</td>
<td>0.000000</td>
<td>0.024422</td>
<td>0.021825</td>
</tr>
<tr>
<td>2</td>
<td>2010-03-28</td>
<td>2010</td>
<td>1</td>
<td>Domain Stadium</td>
<td>11712</td>
<td>5096.0</td>
<td>M Cook</td>
<td>8</td>
<td>Adelaide</td>
<td>Fremantle</td>
<td>Away</td>
<td>62</td>
<td>118</td>
<td>-56</td>
<td>0.0</td>
<td>0.035714</td>
<td>0.025362</td>
<td>0.031034</td>
<td>0.026746</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.013333</td>
<td>0.034483</td>
<td>0.021625</td>
<td>0.021505</td>
<td>0.031630</td>
<td>0.026820</td>
<td>0.022599</td>
<td>0.000000</td>
<td>0.045455</td>
<td>0.008850</td>
<td>0.014925</td>
<td>0.011494</td>
<td>0.028986</td>
<td>0.048193</td>
<td>0.056604</td>
<td>0.000000</td>
<td>0.037037</td>
<td>0.020887</td>
<td>0.019703</td>
</tr>
<tr>
<td>3</td>
<td>2010-03-28</td>
<td>2010</td>
<td>1</td>
<td>Domain Stadium</td>
<td>11700</td>
<td>5096.0</td>
<td>P Dangerfield</td>
<td>32</td>
<td>Adelaide</td>
<td>Fremantle</td>
<td>Away</td>
<td>62</td>
<td>118</td>
<td>-56</td>
<td>0.0</td>
<td>0.049107</td>
<td>0.016304</td>
<td>0.017241</td>
<td>0.015605</td>
<td>0.0</td>
<td>0.0</td>
<td>0.04</td>
<td>0.026667</td>
<td>0.172414</td>
<td>0.022734</td>
<td>0.021505</td>
<td>0.029197</td>
<td>0.025543</td>
<td>0.016949</td>
<td>0.038462</td>
<td>0.090909</td>
<td>0.026549</td>
<td>0.000000</td>
<td>0.022989</td>
<td>0.072464</td>
<td>0.024096</td>
<td>0.018868</td>
<td>0.074074</td>
<td>0.037037</td>
<td>0.024422</td>
<td>0.028190</td>
</tr>
<tr>
<td>4</td>
<td>2010-03-28</td>
<td>2010</td>
<td>1</td>
<td>Domain Stadium</td>
<td>85</td>
<td>5096.0</td>
<td>M Doughty</td>
<td>11</td>
<td>Adelaide</td>
<td>Fremantle</td>
<td>Away</td>
<td>62</td>
<td>118</td>
<td>-56</td>
<td>0.0</td>
<td>0.017857</td>
<td>0.021739</td>
<td>0.025862</td>
<td>0.027526</td>
<td>0.0</td>
<td>0.0</td>
<td>0.00</td>
<td>0.053333</td>
<td>0.000000</td>
<td>0.025229</td>
<td>0.010753</td>
<td>0.031630</td>
<td>0.021711</td>
<td>0.016949</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.026549</td>
<td>0.000000</td>
<td>0.011494</td>
<td>0.000000</td>
<td>0.036145</td>
<td>0.037736</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.018959</td>
<td>0.018490</td>
</tr>
</tbody>
</table>
<h3 id="kicked-a-bag-feature">Kicked A Bag Feature<a class="headerlink" href="#kicked-a-bag-feature" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features[<span style="color: #BA2121">&#39;kicked_a_bag&#39;</span>] <span style="color: #666666">=</span> brownlow_data<span style="color: #666666">.</span>G<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> x: <span style="color: #666666">1</span> <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">&gt;=</span> <span style="color: #666666">5</span> <span style="color: #008000; font-weight: bold">else</span> <span style="color: #666666">0</span>)
</pre></div>

<h3 id="is-captain-feature">Is Captain Feature<a class="headerlink" href="#is-captain-feature" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features[<span style="color: #BA2121">&#39;is_captain&#39;</span>] <span style="color: #666666">=</span> features<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> x: is_captain_for_that_season(captains, x<span style="color: #666666">.</span>player, x<span style="color: #666666">.</span>season), axis<span style="color: #666666">=</span><span style="color: #BA2121">&#39;columns&#39;</span>)
</pre></div>

<h3 id="won-the-game-feature">Won the Game Feature<a class="headerlink" href="#won-the-game-feature" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features[<span style="color: #BA2121">&#39;team_won&#39;</span>] <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where(features<span style="color: #666666">.</span>margin <span style="color: #666666">&gt;</span> <span style="color: #666666">0</span>, <span style="color: #666666">1</span>, <span style="color: #666666">0</span>)
</pre></div>

<h3 id="30-2-goals-feature">30+ &amp; 2+ Goals Feature<a class="headerlink" href="#30-2-goals-feature" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features[<span style="color: #BA2121">&#39;got_30_possies_2_goals&#39;</span>] <span style="color: #666666">=</span> np<span style="color: #666666">.</span>where((brownlow_data<span style="color: #666666">.</span>G <span style="color: #666666">&gt;=</span> <span style="color: #666666">2</span>) <span style="color: #666666">&amp;</span> (brownlow_data<span style="color: #666666">.</span>D <span style="color: #666666">&gt;=</span> <span style="color: #666666">30</span>), <span style="color: #666666">1</span>, <span style="color: #666666">0</span>)
</pre></div>

<h3 id="previous-top-10-finish-feature">Previous Top 10 Finish Feature<a class="headerlink" href="#previous-top-10-finish-feature" title="Permanent link">&para;</a></h3>
<p>I have a strong feeling that past performance may be a predictor of future performance in the brownlow. For example, last year Dusty Martin won the Brownlow. The umpires may have a bias towards Dusty this year because he is known to be on their radar as being a good player. Let's create a feature which is categorical and is 1 if the player has previously finished in the top 10. Let's create a function for this and then apply it to the afltables dataset, which has data back to 1897. We will then create a lookup table for the top 10 for each season and merge this table with our current features df.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>afltables <span style="color: #666666">=</span> pd<span style="color: #666666">.</span>read_csv(<span style="color: #BA2121">&#39;data/afltables_stats.csv&#39;</span>)<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;Season &gt;= 2000&#39;</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">replace_special_characters</span>(name):
    name <span style="color: #666666">=</span> name<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&quot;&#39;&quot;</span>, <span style="color: #BA2121">&quot;&quot;</span>)<span style="color: #666666">.</span>replace(<span style="color: #BA2121">&quot;-&quot;</span>, <span style="color: #BA2121">&quot; &quot;</span>)<span style="color: #666666">.</span>lower()
    name_split <span style="color: #666666">=</span> name<span style="color: #666666">.</span>split()

    <span style="color: #008000; font-weight: bold">if</span> <span style="color: #008000">len</span>(name_split) <span style="color: #666666">&gt;</span> <span style="color: #666666">2</span>:
        first_name <span style="color: #666666">=</span> name_split[<span style="color: #666666">0</span>]
        last_name <span style="color: #666666">=</span> name_split[<span style="color: #666666">-1</span>]
        name <span style="color: #666666">=</span> first_name <span style="color: #666666">+</span> <span style="color: #BA2121">&#39; &#39;</span> <span style="color: #666666">+</span> last_name

    name_split_2 <span style="color: #666666">=</span> name<span style="color: #666666">.</span>split()
    name <span style="color: #666666">=</span> name_split_2[<span style="color: #666666">0</span>][<span style="color: #666666">0</span>] <span style="color: #666666">+</span> <span style="color: #BA2121">&#39; &#39;</span> <span style="color: #666666">+</span> name_split_2[<span style="color: #666666">1</span>]
    <span style="color: #008000; font-weight: bold">return</span> name<span style="color: #666666">.</span>title()

afltables <span style="color: #666666">=</span> (afltables<span style="color: #666666">.</span>assign(player<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df[<span style="color: #BA2121">&#39;First.name&#39;</span>] <span style="color: #666666">+</span> <span style="color: #BA2121">&#39; &#39;</span> <span style="color: #666666">+</span> df<span style="color: #666666">.</span>Surname)
                <span style="color: #666666">.</span>assign(player<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>player<span style="color: #666666">.</span>apply(replace_special_characters))
                <span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{<span style="color: #BA2121">&#39;Brownlow.Votes&#39;</span>: <span style="color: #BA2121">&#39;brownlow_votes&#39;</span>, <span style="color: #BA2121">&#39;Season&#39;</span>: <span style="color: #BA2121">&#39;season&#39;</span>, <span style="color: #BA2121">&#39;Playing.for&#39;</span>: <span style="color: #BA2121">&#39;team&#39;</span>}))
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic">### Create Top 10 rank look up table</span>

brownlow_votes_yearly <span style="color: #666666">=</span> (afltables<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;season&#39;</span>, <span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>], as_index<span style="color: #666666">=</span><span style="color: #008000">False</span>)
                                  <span style="color: #666666">.</span>brownlow_votes
                                  <span style="color: #666666">.</span>sum())

brownlow_votes_yearly[<span style="color: #BA2121">&#39;yearly_rank&#39;</span>] <span style="color: #666666">=</span> (brownlow_votes_yearly<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;season&#39;</span>)
                                                             <span style="color: #666666">.</span>brownlow_votes
                                                             <span style="color: #666666">.</span>rank(method<span style="color: #666666">=</span><span style="color: #BA2121">&#39;max&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>))

<span style="color: #408080; font-style: italic"># Filter to only get a dataframe since 2000 and only the top 10 players from each season</span>
brownlow_votes_top_10 <span style="color: #666666">=</span> brownlow_votes_yearly<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;yearly_rank &lt; 11 &amp; season &gt;= 2000&#39;</span>)

brownlow_votes_top_10<span style="color: #666666">.</span>head(<span style="color: #666666">3</span>)

<span style="color: #008000; font-weight: bold">def</span> <span style="color: #0000FF">how_many_times_top_10</span>(top_10_df, player, year):
    times <span style="color: #666666">=</span> <span style="color: #008000">len</span>(top_10_df[(top_10_df<span style="color: #666666">.</span>player <span style="color: #666666">==</span> player) <span style="color: #666666">&amp;</span> (top_10_df<span style="color: #666666">.</span>season <span style="color: #666666">&lt;</span> year)])
    <span style="color: #008000; font-weight: bold">return</span> times

features[<span style="color: #BA2121">&#39;times_in_top_10&#39;</span>] <span style="color: #666666">=</span> features<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> x: how_many_times_top_10(brownlow_votes_top_10, x<span style="color: #666666">.</span>player, x<span style="color: #666666">.</span>season), axis<span style="color: #666666">=1</span>) 
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>season</th>
<th>player</th>
<th>team</th>
<th>brownlow_votes</th>
<th>yearly_rank</th>
</tr>
</thead>
<tbody>
<tr>
<td>27</td>
<td>2000.0</td>
<td>A Koutoufides</td>
<td>Carlton</td>
<td>19.0</td>
<td>4.0</td>
</tr>
<tr>
<td>36</td>
<td>2000.0</td>
<td>A Mcleod</td>
<td>Adelaide</td>
<td>20.0</td>
<td>3.0</td>
</tr>
<tr>
<td>105</td>
<td>2000.0</td>
<td>B Ratten</td>
<td>Carlton</td>
<td>18.0</td>
<td>6.0</td>
</tr>
</tbody>
</table>
<h3 id="average-brownlow-votes-per-game-last-season-feature">Average Brownlow Votes Per Game Last Season Feature<a class="headerlink" href="#average-brownlow-votes-per-game-last-season-feature" title="Permanent link">&para;</a></h3>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Create a brownlow votes lookup table</span>
brownlow_votes_lookup_table <span style="color: #666666">=</span> (brownlow_data<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>], as_index<span style="color: #666666">=</span><span style="color: #008000">False</span>)
                                    <span style="color: #666666">.</span>brownlow_votes
                                    <span style="color: #666666">.</span>mean()
                                    <span style="color: #666666">.</span>assign(next_season<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>season <span style="color: #666666">+</span> <span style="color: #666666">1</span>)
                                    <span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{
                                        <span style="color: #BA2121">&#39;brownlow_votes&#39;</span>: <span style="color: #BA2121">&#39;ave_votes_last_season&#39;</span>
                                    }))

<span style="color: #408080; font-style: italic"># Have a look at Cripps to check if it&#39;s working</span>
brownlow_votes_lookup_table[brownlow_votes_lookup_table<span style="color: #666666">.</span>player <span style="color: #666666">==</span> <span style="color: #BA2121">&#39;P Cripps&#39;</span>]

<span style="color: #408080; font-style: italic"># Merge it to our features df</span>
features_with_votes_last_season <span style="color: #666666">=</span> (pd<span style="color: #666666">.</span>merge(features, brownlow_votes_lookup_table<span style="color: #666666">.</span>drop(columns<span style="color: #666666">=</span><span style="color: #BA2121">&#39;season&#39;</span>),

                                             left_on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>], 
                                             right_on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;next_season&#39;</span>],
                                             how<span style="color: #666666">=</span><span style="color: #BA2121">&#39;left&#39;</span>)
                                  <span style="color: #666666">.</span>drop(columns<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;next_season&#39;</span>])
                                  <span style="color: #666666">.</span>fillna(<span style="color: #666666">0</span>))
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>player</th>
<th>team</th>
<th>season</th>
<th>ave_votes_last_season</th>
<th>next_season</th>
</tr>
</thead>
<tbody>
<tr>
<td>4377</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>2014</td>
<td>0.000000</td>
<td>2015</td>
</tr>
<tr>
<td>4378</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>2015</td>
<td>0.300000</td>
<td>2016</td>
</tr>
<tr>
<td>4379</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>2016</td>
<td>0.857143</td>
<td>2017</td>
</tr>
<tr>
<td>4380</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>2017</td>
<td>0.333333</td>
<td>2018</td>
</tr>
<tr>
<td>4381</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>2018</td>
<td>0.000000</td>
<td>2019</td>
</tr>
</tbody>
</table>
<h3 id="historic-performance-relative-to-model-feature">Historic Performance Relative To Model Feature<a class="headerlink" href="#historic-performance-relative-to-model-feature" title="Permanent link">&para;</a></h3>
<p>It is well known that some players are good Brownlow performers. For whatever reason, they always poll much better than their stats may suggest. Lance Franklin and Bontempelli are probably in this category. Perhaps these players have an X-factor that Machine Learning models struggle to pick up on. To get around this, let's create a feature which looks at the player's performance relative to the model's prediction. To do this, we'll need to train and predict 7 different models - from 2011 to 2017.</p>
<p>To create a model for each season, we will use h2o's AutoML. If you're new to h2o, please read about it <a href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html">here.</a> It can be used in both R and Python.</p>
<p>The metric we will use for loss in Mean Absolute Error (MAE).</p>
<p>As we are using regression, some values are negative. We will convert these negative values to 0 as it doesn't make sense to poll negative brownlow votes. Similarly, some matches won't predict exactly 6 votes, so we will scale these predictions so that we predict exactly 6 votes for each match.</p>
<p>So that you don't have to train these models yourself, I have saved the models and we will load them in. If you are keen to train the models yourself, simply uncomment out the code below and run the cell. To bulk uncomment, highlight the rows and press ctrl + '/'</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>h2o<span style="color: #666666">.</span>init()

<span style="color: #408080; font-style: italic"># Uncomment the code below if you want to train the models yourself - otherwise, we will load them in the load cell from disk</span>

<span style="color: #408080; font-style: italic">## Join to our features df</span>

<span style="color: #408080; font-style: italic"># aml_yearly_model_objects = {}</span>
<span style="color: #408080; font-style: italic"># yearly_predictions_dfs = {}</span>

<span style="color: #408080; font-style: italic"># feature_cols = [&#39;margin&#39;, &#39;CP&#39;, &#39;UP&#39;, &#39;ED&#39;, &#39;DE&#39;,</span>
<span style="color: #408080; font-style: italic">#        &#39;CM&#39;, &#39;GA&#39;, &#39;MI5&#39;, &#39;one_perc&#39;, &#39;BO&#39;, &#39;TOG&#39;, &#39;K&#39;, &#39;HB&#39;, &#39;D&#39;, &#39;M&#39;, &#39;G&#39;,</span>
<span style="color: #408080; font-style: italic">#        &#39;B&#39;, &#39;T&#39;, &#39;HO&#39;, &#39;I50&#39;, &#39;CL&#39;, &#39;CG&#39;, &#39;R50&#39;, &#39;FF&#39;, &#39;FA&#39;, &#39;AF&#39;, &#39;SC&#39;]</span>

<span style="color: #408080; font-style: italic"># for year in range(2011, 2018):</span>
<span style="color: #408080; font-style: italic">#     # Filter the data to only include past data</span>
<span style="color: #408080; font-style: italic">#     train_historic = brownlow_data[brownlow_data.season &lt; year].copy()</span>

<span style="color: #408080; font-style: italic">#     # Convert to an h2o frame</span>
<span style="color: #408080; font-style: italic">#     train_h2o_historic = h2o.H2OFrame(train_historic)</span>

<span style="color: #408080; font-style: italic">#     # Create an AutoML object</span>
<span style="color: #408080; font-style: italic">#     aml = H2OAutoML(max_runtime_secs=30,</span>
<span style="color: #408080; font-style: italic">#                    balance_classes=True,</span>
<span style="color: #408080; font-style: italic">#                    seed=42)</span>

<span style="color: #408080; font-style: italic">#     # Train the model</span>
<span style="color: #408080; font-style: italic">#     aml.train(y=&#39;brownlow_votes&#39;, x=feature_cols, training_frame=train_h2o_historic)</span>

<span style="color: #408080; font-style: italic">#     # save the model</span>
<span style="color: #408080; font-style: italic">#     model_path = h2o.save_model(model=aml.leader, path=&quot;models&quot;, force=True)</span>

<span style="color: #408080; font-style: italic">#     # Get model id</span>
<span style="color: #408080; font-style: italic">#     model_name = aml.leaderboard[0, &#39;model_id&#39;]</span>

<span style="color: #408080; font-style: italic">#     # Rename the model on disk</span>
<span style="color: #408080; font-style: italic">#     os.rename(f&#39;models/{model_name}&#39;, f&#39;models/yearly_model_{year}&#39;)</span>

<span style="color: #408080; font-style: italic">#     # Append the best model to a list</span>
<span style="color: #408080; font-style: italic">#     aml_yearly_model_objects[year] = aml.leader</span>

<span style="color: #408080; font-style: italic">#     # Make predictions on test set for that year</span>
<span style="color: #408080; font-style: italic">#     test_historic = brownlow_data[brownlow_data.season == year].copy()</span>
<span style="color: #408080; font-style: italic">#     test_h2o_historic = h2o.H2OFrame(test_historic)</span>

<span style="color: #408080; font-style: italic">#     preds = aml.predict(test_h2o_historic).as_data_frame()</span>
<span style="color: #408080; font-style: italic">#     test_historic[&#39;predicted_votes&#39;] = preds.values</span>

<span style="color: #408080; font-style: italic">#     # Convert negative predictions to 0</span>
<span style="color: #408080; font-style: italic">#     test_historic[&#39;predicted_votes_neg_to_0&#39;] = test_historic.predicted_votes.apply(lambda x: 0 if x &lt; 0 else x)</span>

<span style="color: #408080; font-style: italic">#     # Create a total match votes column - which calculates the number of votes predicted in each game when the predictions </span>
<span style="color: #408080; font-style: italic">#     # are unscaled</span>
<span style="color: #408080; font-style: italic">#     test_historic[&#39;unscaled_match_votes&#39;] = test_historic.groupby(&#39;match_id&#39;).predicted_votes_neg_to_0.transform(&#39;sum&#39;)</span>

<span style="color: #408080; font-style: italic">#     # Scale predictions</span>
<span style="color: #408080; font-style: italic">#     test_historic[&#39;predicted_votes_scaled&#39;] = test_historic.predicted_votes_neg_to_0 / test_historic.unscaled_match_votes * 6</span>

<span style="color: #408080; font-style: italic">#     # Aggregate the predictions</span>
<span style="color: #408080; font-style: italic">#     test_grouped = (test_historic.groupby([&#39;player&#39;, &#39;team&#39;], as_index=False)</span>
<span style="color: #408080; font-style: italic">#                                  .sum()</span>
<span style="color: #408080; font-style: italic">#                                  .sort_values(by=&#39;brownlow_votes&#39;, ascending=False)</span>
<span style="color: #408080; font-style: italic">#                                  .assign(mae=lambda df: abs(df.predicted_votes_scaled - df.brownlow_votes)))</span>

<span style="color: #408080; font-style: italic">#     test_grouped[&#39;error&#39;] = test_grouped.predicted_votes_scaled - test_grouped.brownlow_votes</span>
<span style="color: #408080; font-style: italic">#     test_grouped[&#39;next_year&#39;] = year + 1</span>

<span style="color: #408080; font-style: italic">#     # Add this years predictions df to a dictionary to use later</span>
<span style="color: #408080; font-style: italic">#     yearly_predictions_dfs[year] = test_grouped</span>

<span style="color: #408080; font-style: italic"># preds_errors = None</span>

<span style="color: #408080; font-style: italic"># for key, value in yearly_predictions_dfs.items():</span>
<span style="color: #408080; font-style: italic">#     if preds_errors is None:</span>
<span style="color: #408080; font-style: italic">#         preds_errors = value[[&#39;player&#39;, &#39;season&#39;, &#39;next_year&#39;, &#39;brownlow_votes&#39;, &#39;predicted_votes_scaled&#39;, &#39;error&#39;]]</span>
<span style="color: #408080; font-style: italic">#     else:</span>
<span style="color: #408080; font-style: italic">#         preds_errors = preds_errors.append(value[[&#39;player&#39;, &#39;season&#39;, &#39;next_year&#39;, &#39;brownlow_votes&#39;, &#39;predicted_votes_scaled&#39;, &#39;error&#39;]], sort=True)</span>

<span style="color: #408080; font-style: italic"># with open(&#39;data/prediction_errors_df.pickle&#39;, &#39;wb&#39;) as handle:</span>
<span style="color: #408080; font-style: italic">#     pickle.dump(yearly_predicted_errors, handle)</span>
</pre></div>

<p>Checking whether there is an H2O instance running at <a href="http://localhost:54321">http://localhost:54321</a>. connected.   </p>
<table>
<thead>
<tr>
<th>H2O cluster uptime:</th>
<th>1 hour 28 mins</th>
</tr>
</thead>
<tbody>
<tr>
<td>H2O cluster timezone:</td>
<td>Australia/Hobart</td>
</tr>
<tr>
<td>H2O data parsing timezone:</td>
<td>UTC</td>
</tr>
<tr>
<td>H2O cluster version:</td>
<td>3.20.0.4</td>
</tr>
<tr>
<td>H2O cluster version age:</td>
<td>1 month and 18 days</td>
</tr>
<tr>
<td>H2O cluster name:</td>
<td>H2O_from_python_WardJ_tt2ak5</td>
</tr>
<tr>
<td>H2O cluster total nodes:</td>
<td>1</td>
</tr>
<tr>
<td>H2O cluster free memory:</td>
<td>7.018 Gb</td>
</tr>
<tr>
<td>H2O cluster total cores:</td>
<td>4</td>
</tr>
<tr>
<td>H2O cluster allowed cores:</td>
<td>4</td>
</tr>
<tr>
<td>H2O cluster status:</td>
<td>locked, healthy</td>
</tr>
<tr>
<td>H2O connection url:</td>
<td><a href="http://localhost:54321">http://localhost:54321</a></td>
</tr>
<tr>
<td>H2O connection proxy:</td>
<td>None</td>
</tr>
<tr>
<td>H2O internal security:</td>
<td>False</td>
</tr>
<tr>
<td>H2O API Extensions:</td>
<td>Algos, AutoML, Core V3, Core V4</td>
</tr>
<tr>
<td>Python version:</td>
<td>3.6.4 final</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Load predictions error df    </span>
<span style="color: #008000; font-weight: bold">with</span> <span style="color: #008000">open</span>(<span style="color: #BA2121">&#39;data/prediction_errors_df.pickle&#39;</span>, <span style="color: #BA2121">&#39;rb&#39;</span>) <span style="color: #008000; font-weight: bold">as</span> handle:
    preds_errors <span style="color: #666666">=</span> pickle<span style="color: #666666">.</span>load(handle)

<span style="color: #408080; font-style: italic"># Look at last years predictions</span>
preds_errors<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;next_year == 2018&#39;</span>)<span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;brownlow_votes&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)<span style="color: #666666">.</span>head(<span style="color: #666666">20</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>brownlow_votes</th>
<th>error</th>
<th>next_year</th>
<th>player</th>
<th>predicted_votes_scaled</th>
<th>season</th>
</tr>
</thead>
<tbody>
<tr>
<td>139</td>
<td>36.0</td>
<td>-4.915157</td>
<td>2018</td>
<td>D Martin</td>
<td>31.084843</td>
<td>44374</td>
</tr>
<tr>
<td>486</td>
<td>33.0</td>
<td>-4.413780</td>
<td>2018</td>
<td>P Dangerfield</td>
<td>28.586220</td>
<td>42357</td>
</tr>
<tr>
<td>619</td>
<td>25.0</td>
<td>0.072223</td>
<td>2018</td>
<td>T Mitchell</td>
<td>25.072223</td>
<td>44374</td>
</tr>
<tr>
<td>279</td>
<td>23.0</td>
<td>-9.296209</td>
<td>2018</td>
<td>J Kennedy</td>
<td>13.703791</td>
<td>38323</td>
</tr>
<tr>
<td>376</td>
<td>22.0</td>
<td>-7.621336</td>
<td>2018</td>
<td>L Franklin</td>
<td>14.378664</td>
<td>44374</td>
</tr>
<tr>
<td>278</td>
<td>21.0</td>
<td>-3.016176</td>
<td>2018</td>
<td>J Kelly</td>
<td>17.983824</td>
<td>42357</td>
</tr>
<tr>
<td>519</td>
<td>20.0</td>
<td>-4.182915</td>
<td>2018</td>
<td>R Sloane</td>
<td>15.817085</td>
<td>44374</td>
</tr>
<tr>
<td>410</td>
<td>19.0</td>
<td>-7.740142</td>
<td>2018</td>
<td>M Bontempelli</td>
<td>11.259858</td>
<td>44374</td>
</tr>
<tr>
<td>483</td>
<td>18.0</td>
<td>-4.522835</td>
<td>2018</td>
<td>O Wines</td>
<td>13.477165</td>
<td>44374</td>
</tr>
<tr>
<td>121</td>
<td>17.0</td>
<td>-4.446749</td>
<td>2018</td>
<td>D Beams</td>
<td>12.553251</td>
<td>38323</td>
</tr>
<tr>
<td>390</td>
<td>16.0</td>
<td>-3.620094</td>
<td>2018</td>
<td>L Parker</td>
<td>12.379906</td>
<td>44374</td>
</tr>
<tr>
<td>561</td>
<td>15.0</td>
<td>-5.846506</td>
<td>2018</td>
<td>S Pendlebury</td>
<td>9.153494</td>
<td>32272</td>
</tr>
<tr>
<td>463</td>
<td>15.0</td>
<td>-4.402600</td>
<td>2018</td>
<td>N Fyfe</td>
<td>10.597400</td>
<td>42357</td>
</tr>
<tr>
<td>42</td>
<td>15.0</td>
<td>-4.787914</td>
<td>2018</td>
<td>B Ebert</td>
<td>10.212086</td>
<td>44374</td>
</tr>
<tr>
<td>651</td>
<td>15.0</td>
<td>0.824510</td>
<td>2018</td>
<td>Z Merrett</td>
<td>15.824510</td>
<td>42357</td>
</tr>
<tr>
<td>578</td>
<td>14.0</td>
<td>2.300607</td>
<td>2018</td>
<td>T Adams</td>
<td>16.300607</td>
<td>44374</td>
</tr>
<tr>
<td>34</td>
<td>14.0</td>
<td>-5.796604</td>
<td>2018</td>
<td>B Brown</td>
<td>8.203396</td>
<td>44374</td>
</tr>
<tr>
<td>172</td>
<td>14.0</td>
<td>-1.650752</td>
<td>2018</td>
<td>D Zorko</td>
<td>12.349248</td>
<td>42357</td>
</tr>
<tr>
<td>184</td>
<td>14.0</td>
<td>-1.233663</td>
<td>2018</td>
<td>G Ablett</td>
<td>12.766337</td>
<td>28238</td>
</tr>
<tr>
<td>389</td>
<td>14.0</td>
<td>-2.099613</td>
<td>2018</td>
<td>L Neale</td>
<td>11.900387</td>
<td>42357</td>
</tr>
</tbody>
</table>
<p>Look at that! A simply Machine Learning ensemble model, using AutoML predicted last year's winner! That's impressive. As we can see it also predicted Bontempelli would only score 11.26, when he actually scored 19 - a huge discrepency. Let's use this as a feature.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features_with_historic_perf_relative_to_model <span style="color: #666666">=</span> \
    (features_with_votes_last_season<span style="color: #666666">.</span>pipe(pd<span style="color: #666666">.</span>merge, preds_errors[[<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;next_year&#39;</span>, <span style="color: #BA2121">&#39;error&#39;</span>]],
                                          left_on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;season&#39;</span>],
                                          right_on<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;next_year&#39;</span>],
                                          how<span style="color: #666666">=</span><span style="color: #BA2121">&#39;left&#39;</span>)
                                     <span style="color: #666666">.</span>fillna(<span style="color: #666666">0</span>)
                                     <span style="color: #666666">.</span>rename(columns<span style="color: #666666">=</span>{<span style="color: #BA2121">&#39;error&#39;</span>: <span style="color: #BA2121">&#39;error_last_season&#39;</span>})
                                     <span style="color: #666666">.</span>drop_duplicates(subset<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;round&#39;</span>, <span style="color: #BA2121">&#39;SC&#39;</span>]))
</pre></div>

<hr />
<h2 id="filtering-the-data-to-only-include-the-top-20-sc-for-each-match">Filtering the data to only include the top 20 SC for each match<a class="headerlink" href="#filtering-the-data-to-only-include-the-top-20-sc-for-each-match" title="Permanent link">&para;</a></h2>
<p>Logically, it is extremely unlikely that a player will poll votes if their Supercoach score is not in the top 20 players. By eliminating the other 20+ players, we can reduce the noise in the data, as we are almost certain the players won't poll from the bottom half. Let's explore how many players poll if they're not in the top 20, and then filter our df if this number is not significant.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Find number of players who vote when in top 15 SC</span>

brownlow_data[<span style="color: #BA2121">&#39;SC_rank_match&#39;</span>] <span style="color: #666666">=</span> brownlow_data<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;match_id&#39;</span>)<span style="color: #666666">.</span>SC<span style="color: #666666">.</span>rank(method<span style="color: #666666">=</span><span style="color: #BA2121">&#39;max&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)

brownlow_data<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;SC_rank_match &gt; 20 and season &gt; 2014&#39;</span>)<span style="color: #666666">.</span>brownlow_votes<span style="color: #666666">.</span>value_counts()

    <span style="color: #666666">0.0</span>    <span style="color: #666666">18330</span>
    <span style="color: #666666">1.0</span>       <span style="color: #666666">14</span>
    <span style="color: #666666">2.0</span>        <span style="color: #666666">8</span>
    <span style="color: #666666">3.0</span>        <span style="color: #666666">2</span>
    Name: brownlow_votes, dtype: int64
</pre></div>

<p>Since 2014, there have only been 24 players who have voted and not been in the top 20 SC.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>features_with_sc_rank <span style="color: #666666">=</span> features_with_historic_perf_relative_to_model<span style="color: #666666">.</span>copy()

features_with_sc_rank[<span style="color: #BA2121">&#39;SC_rank_match&#39;</span>] <span style="color: #666666">=</span> features_with_sc_rank<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;match_id&#39;</span>)<span style="color: #666666">.</span>SC<span style="color: #666666">.</span>rank(method<span style="color: #666666">=</span><span style="color: #BA2121">&#39;max&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)

<span style="color: #408080; font-style: italic"># Filter out rows with a SC rank of below 20</span>
features_with_sc_rank_filtered <span style="color: #666666">=</span> features_with_sc_rank<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;SC_rank_match &lt;= 20&#39;</span>)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Filter out 2010 and 2011 as we used these seasons to create historic model performance features</span>
features_last_before_train <span style="color: #666666">=</span> features_with_sc_rank_filtered<span style="color: #666666">.</span>query(<span style="color: #BA2121">&#39;season != 2010 and season != 2011&#39;</span>)<span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>)

features_last_before_train<span style="color: #666666">.</span>head(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>season</th>
<th>round</th>
<th>venue</th>
<th>ID</th>
<th>match_id</th>
<th>player</th>
<th>jumper_no</th>
<th>team</th>
<th>opposition</th>
<th>status</th>
<th>team_score</th>
<th>opposition_score</th>
<th>margin</th>
<th>brownlow_votes</th>
<th>CP</th>
<th>UP</th>
<th>ED</th>
<th>DE</th>
<th>CM</th>
<th>GA</th>
<th>MI5</th>
<th>one_perc</th>
<th>BO</th>
<th>TOG</th>
<th>K</th>
<th>HB</th>
<th>D</th>
<th>M</th>
<th>G</th>
<th>B</th>
<th>T</th>
<th>HO</th>
<th>I50</th>
<th>CL</th>
<th>CG</th>
<th>R50</th>
<th>FF</th>
<th>FA</th>
<th>AF</th>
<th>SC</th>
<th>kicked_a_bag</th>
<th>is_captain</th>
<th>team_won</th>
<th>got_30_possies_2_goals</th>
<th>times_in_top_10</th>
<th>ave_votes_last_season</th>
<th>next_year</th>
<th>error_last_season</th>
<th>SC_rank_match</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>2012-03-31</td>
<td>2012</td>
<td>1</td>
<td>Metricon Stadium</td>
<td>11985</td>
<td>5347.0</td>
<td>I Callinan</td>
<td>37</td>
<td>Adelaide</td>
<td>Gold Coast</td>
<td>Away</td>
<td>137</td>
<td>68</td>
<td>69</td>
<td>0.0</td>
<td>0.031359</td>
<td>0.018947</td>
<td>0.016071</td>
<td>0.015745</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.12</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.023333</td>
<td>0.031674</td>
<td>0.012270</td>
<td>0.023438</td>
<td>0.026042</td>
<td>0.068966</td>
<td>0.217391</td>
<td>0.041322</td>
<td>0.0</td>
<td>0.017241</td>
<td>0.013699</td>
<td>0.042553</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.032258</td>
<td>0.030593</td>
<td>0.026962</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
<td>2012.0</td>
<td>0.042048</td>
<td>14.0</td>
</tr>
<tr>
<td>1</td>
<td>2012-03-31</td>
<td>2012</td>
<td>1</td>
<td>Metricon Stadium</td>
<td>11700</td>
<td>5347.0</td>
<td>P Dangerfield</td>
<td>32</td>
<td>Adelaide</td>
<td>Gold Coast</td>
<td>Away</td>
<td>137</td>
<td>68</td>
<td>69</td>
<td>0.0</td>
<td>0.048780</td>
<td>0.023158</td>
<td>0.037500</td>
<td>0.026451</td>
<td>0.0</td>
<td>0.000000</td>
<td>0.04</td>
<td>0.009804</td>
<td>0.090909</td>
<td>0.025556</td>
<td>0.029412</td>
<td>0.036810</td>
<td>0.032552</td>
<td>0.015625</td>
<td>0.068966</td>
<td>0.000000</td>
<td>0.016529</td>
<td>0.0</td>
<td>0.051724</td>
<td>0.123288</td>
<td>0.042553</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.032258</td>
<td>0.027503</td>
<td>0.028173</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0.333333</td>
<td>2012.0</td>
<td>-2.983636</td>
<td>12.0</td>
</tr>
<tr>
<td>2</td>
<td>2012-03-31</td>
<td>2012</td>
<td>1</td>
<td>Metricon Stadium</td>
<td>2381</td>
<td>5347.0</td>
<td>R Douglas</td>
<td>26</td>
<td>Adelaide</td>
<td>Gold Coast</td>
<td>Away</td>
<td>137</td>
<td>68</td>
<td>69</td>
<td>0.0</td>
<td>0.020906</td>
<td>0.033684</td>
<td>0.021429</td>
<td>0.019901</td>
<td>0.0</td>
<td>0.083333</td>
<td>0.04</td>
<td>0.049020</td>
<td>0.000000</td>
<td>0.023056</td>
<td>0.031674</td>
<td>0.015337</td>
<td>0.024740</td>
<td>0.031250</td>
<td>0.034483</td>
<td>0.130435</td>
<td>0.057851</td>
<td>0.0</td>
<td>0.043103</td>
<td>0.000000</td>
<td>0.031915</td>
<td>0.014493</td>
<td>0.064516</td>
<td>0.000000</td>
<td>0.033684</td>
<td>0.030597</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0.000000</td>
<td>2012.0</td>
<td>1.724915</td>
<td>10.0</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="modeling-the-2017-brownlow">Modeling The 2017 Brownlow<a class="headerlink" href="#modeling-the-2017-brownlow" title="Permanent link">&para;</a></h2>
<p>Now that we have all of our features, we can simply create a training set (2012-2016), and a test set (2017), and make our predictions for last year! We will use AutoML for this process again. Again, rather than waiting for the model to train, I will save the model so you can simply load it in. We will also scale our features. We can then see how our model went in predicting last year's brownlow, creating a baseline for this years' predictions. We will then predict this year's vote count.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>train_baseline <span style="color: #666666">=</span> features_last_before_train<span style="color: #666666">.</span>query(<span style="color: #BA2121">&quot;season &lt; 2017&quot;</span>)
holdout <span style="color: #666666">=</span> features_last_before_train<span style="color: #666666">.</span>query(<span style="color: #BA2121">&quot;season == 2017&quot;</span>)

scale_cols <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;team_score&#39;</span>, <span style="color: #BA2121">&#39;opposition_score&#39;</span>, <span style="color: #BA2121">&#39;margin&#39;</span>, <span style="color: #BA2121">&#39;CP&#39;</span>, <span style="color: #BA2121">&#39;UP&#39;</span>, <span style="color: #BA2121">&#39;ED&#39;</span>, <span style="color: #BA2121">&#39;DE&#39;</span>,
       <span style="color: #BA2121">&#39;CM&#39;</span>, <span style="color: #BA2121">&#39;GA&#39;</span>, <span style="color: #BA2121">&#39;MI5&#39;</span>, <span style="color: #BA2121">&#39;one_perc&#39;</span>, <span style="color: #BA2121">&#39;BO&#39;</span>, <span style="color: #BA2121">&#39;K&#39;</span>, <span style="color: #BA2121">&#39;HB&#39;</span>, <span style="color: #BA2121">&#39;D&#39;</span>, <span style="color: #BA2121">&#39;M&#39;</span>, <span style="color: #BA2121">&#39;G&#39;</span>,
       <span style="color: #BA2121">&#39;B&#39;</span>, <span style="color: #BA2121">&#39;T&#39;</span>, <span style="color: #BA2121">&#39;HO&#39;</span>, <span style="color: #BA2121">&#39;I50&#39;</span>, <span style="color: #BA2121">&#39;CL&#39;</span>, <span style="color: #BA2121">&#39;CG&#39;</span>, <span style="color: #BA2121">&#39;R50&#39;</span>, <span style="color: #BA2121">&#39;FF&#39;</span>, <span style="color: #BA2121">&#39;FA&#39;</span>, <span style="color: #BA2121">&#39;AF&#39;</span>, <span style="color: #BA2121">&#39;SC&#39;</span>]

other_feature_cols <span style="color: #666666">=</span> [<span style="color: #BA2121">&#39;is_captain&#39;</span>, <span style="color: #BA2121">&#39;kicked_a_bag&#39;</span>, <span style="color: #BA2121">&#39;team_won&#39;</span>, <span style="color: #BA2121">&#39;got_30_possies_2_goals&#39;</span>, <span style="color: #BA2121">&#39;times_in_top_10&#39;</span>, 
                      <span style="color: #BA2121">&#39;ave_votes_last_season&#39;</span>, <span style="color: #BA2121">&#39;error_last_season&#39;</span>, <span style="color: #BA2121">&#39;SC_rank_match&#39;</span>]

all_feature_cols <span style="color: #666666">=</span> scale_cols <span style="color: #666666">+</span> other_feature_cols

<span style="color: #408080; font-style: italic"># Scale features</span>
scaler <span style="color: #666666">=</span> StandardScaler()

train_baseline_scaled <span style="color: #666666">=</span> train_baseline<span style="color: #666666">.</span>copy()
train_baseline_scaled[scale_cols] <span style="color: #666666">=</span> scaler<span style="color: #666666">.</span>fit_transform(train_baseline[scale_cols])

holdout_scaled <span style="color: #666666">=</span> holdout<span style="color: #666666">.</span>copy()
holdout_scaled[scale_cols] <span style="color: #666666">=</span> scaler<span style="color: #666666">.</span>transform(holdout[scale_cols])

<span style="color: #408080; font-style: italic"># Convert categorical columns to categoricals</span>
train_baseline_h2o <span style="color: #666666">=</span> h2o<span style="color: #666666">.</span>H2OFrame(train_baseline_scaled)
holdout_h2o <span style="color: #666666">=</span> h2o<span style="color: #666666">.</span>H2OFrame(holdout_scaled)

<span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> [<span style="color: #BA2121">&#39;is_captain&#39;</span>, <span style="color: #BA2121">&#39;kicked_a_bag&#39;</span>, <span style="color: #BA2121">&#39;team_won&#39;</span>, <span style="color: #BA2121">&#39;got_30_possies_2_goals&#39;</span>]:
    train_baseline_h2o[col] <span style="color: #666666">=</span> train_baseline_h2o[col]<span style="color: #666666">.</span>asfactor()
    holdout_h2o[col] <span style="color: #666666">=</span> holdout_h2o[col]<span style="color: #666666">.</span>asfactor()
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>C:\Users\wardj\AppData\Local\Continuum\anaconda3\lib\site-packages\h2o\utils\shared_utils.py:177: FutureWarning: Method .as_matrix will be removed in a future version. Use .values instead.
  data = _handle_python_lists(python_obj.as_matrix().tolist(), -1)[1]

Parse progress: || 100%
Parse progress: || 100%
</pre></div>


<p>Below I have commented out training and saving the 2017 model. Rather than training it again, we will just load it in. Uncomment this part out if you want to train it yourself.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># aml_2017_model = H2OAutoML(max_runtime_secs = 60*3,</span>
<span style="color: #408080; font-style: italic">#                    balance_classes=True,</span>
<span style="color: #408080; font-style: italic">#                    seed=42)</span>

<span style="color: #408080; font-style: italic"># aml_2017_model.train(y=&#39;brownlow_votes&#39;, x=all_feature_cols, training_frame=train_baseline_h2o)</span>
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># save the model</span>
<span style="color: #408080; font-style: italic"># model_path = h2o.save_model(model=aml_2017_model.leader, path=&quot;models&quot;, force=True)</span>

<span style="color: #408080; font-style: italic"># Get model id</span>
<span style="color: #408080; font-style: italic"># model_name = aml_2017_model.leaderboard[0, &#39;model_id&#39;]</span>

<span style="color: #408080; font-style: italic"># Rename the model on disk</span>
<span style="color: #408080; font-style: italic"># os.rename(f&#39;models/{model_name}&#39;, f&#39;models/brownlow_2017_model_v1&#39;)</span>

<span style="color: #408080; font-style: italic"># Load model in</span>
aml_2017_model <span style="color: #666666">=</span> h2o<span style="color: #666666">.</span>load_model(<span style="color: #BA2121">&#39;models/brownlow_2017_model_v1&#39;</span>)
</pre></div>

<p><div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Predict the 2017 brownlow count</span>
preds_final_2017_model <span style="color: #666666">=</span> aml_2017_model<span style="color: #666666">.</span>predict(holdout_h2o)

<span style="color: #408080; font-style: italic"># Scale these predictions - change negatives to 0s and scale so each game predicts 6 votes total</span>
holdout <span style="color: #666666">=</span> (holdout<span style="color: #666666">.</span>assign(predicted_votes<span style="color: #666666">=</span>preds_final_2017_model<span style="color: #666666">.</span>as_data_frame()<span style="color: #666666">.</span>values)
                  <span style="color: #666666">.</span>assign(predicted_votes_neg_to_0<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>predicted_votes<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> x: <span style="color: #666666">0</span> <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">&lt;0</span> <span style="color: #008000; font-weight: bold">else</span> x))
                  <span style="color: #666666">.</span>assign(unscaled_match_votes<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;match_id&#39;</span>)<span style="color: #666666">.</span>predicted_votes_neg_to_0<span style="color: #666666">.</span>transform(<span style="color: #BA2121">&#39;sum&#39;</span>))
                  <span style="color: #666666">.</span>assign(predicted_votes_scaled<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>predicted_votes_neg_to_0 <span style="color: #666666">/</span> df<span style="color: #666666">.</span>unscaled_match_votes <span style="color: #666666">*</span> <span style="color: #666666">6</span>))

<span style="color: #408080; font-style: italic"># Create an aggregate votes df and show the average SC points and goals scored</span>
agg_predictions_2017 <span style="color: #666666">=</span> (holdout<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>], as_index<span style="color: #666666">=</span><span style="color: #008000">False</span>)
                        <span style="color: #666666">.</span>agg({
                            <span style="color: #BA2121">&#39;brownlow_votes&#39;</span>: <span style="color: #008000">sum</span>,
                            <span style="color: #BA2121">&#39;predicted_votes_scaled&#39;</span>: <span style="color: #008000">sum</span>,
                            <span style="color: #BA2121">&#39;SC&#39;</span>: <span style="color: #BA2121">&#39;mean&#39;</span>,
                            <span style="color: #BA2121">&#39;G&#39;</span>: <span style="color: #BA2121">&#39;mean&#39;</span>})
                        <span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;brownlow_votes&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)
                        <span style="color: #666666">.</span>assign(mae<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: <span style="color: #008000">abs</span>(df<span style="color: #666666">.</span>brownlow_votes <span style="color: #666666">-</span> df<span style="color: #666666">.</span>predicted_votes_scaled))
                        <span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>))
</pre></div>
    stackedensemble prediction progress: || 100%</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>agg_predictions_2017<span style="color: #666666">.</span>head(<span style="color: #666666">15</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>player</th>
<th>team</th>
<th>brownlow_votes</th>
<th>predicted_votes_scaled</th>
<th>SC</th>
<th>G</th>
<th>mae</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>D Martin</td>
<td>Richmond</td>
<td>36.0</td>
<td>37.271060</td>
<td>0.037862</td>
<td>0.064869</td>
<td>1.271060</td>
</tr>
<tr>
<td>1</td>
<td>P Dangerfield</td>
<td>Geelong</td>
<td>33.0</td>
<td>39.288122</td>
<td>0.042441</td>
<td>0.070819</td>
<td>6.288122</td>
</tr>
<tr>
<td>2</td>
<td>T Mitchell</td>
<td>Hawthorn</td>
<td>25.0</td>
<td>28.629859</td>
<td>0.036040</td>
<td>0.016928</td>
<td>3.629859</td>
</tr>
<tr>
<td>3</td>
<td>L Franklin</td>
<td>Sydney</td>
<td>22.0</td>
<td>16.353733</td>
<td>0.034640</td>
<td>0.149203</td>
<td>5.646267</td>
</tr>
<tr>
<td>4</td>
<td>J Kelly</td>
<td>GWS</td>
<td>21.0</td>
<td>19.565321</td>
<td>0.034652</td>
<td>0.033772</td>
<td>1.434679</td>
</tr>
<tr>
<td>5</td>
<td>R Sloane</td>
<td>Adelaide</td>
<td>20.0</td>
<td>21.417347</td>
<td>0.037068</td>
<td>0.034821</td>
<td>1.417347</td>
</tr>
<tr>
<td>6</td>
<td>J Kennedy</td>
<td>Sydney</td>
<td>20.0</td>
<td>13.671891</td>
<td>0.032014</td>
<td>0.030508</td>
<td>6.328109</td>
</tr>
<tr>
<td>7</td>
<td>M Bontempelli</td>
<td>Western Bulldogs</td>
<td>19.0</td>
<td>17.461889</td>
<td>0.033233</td>
<td>0.040498</td>
<td>1.538111</td>
</tr>
<tr>
<td>8</td>
<td>D Beams</td>
<td>Brisbane</td>
<td>17.0</td>
<td>15.414730</td>
<td>0.034848</td>
<td>0.044998</td>
<td>1.585270</td>
</tr>
<tr>
<td>9</td>
<td>O Wines</td>
<td>Port Adelaide</td>
<td>16.0</td>
<td>12.973973</td>
<td>0.031601</td>
<td>0.021967</td>
<td>3.026027</td>
</tr>
<tr>
<td>10</td>
<td>N Fyfe</td>
<td>Fremantle</td>
<td>15.0</td>
<td>11.926030</td>
<td>0.033761</td>
<td>0.031680</td>
<td>3.073970</td>
</tr>
<tr>
<td>11</td>
<td>S Pendlebury</td>
<td>Collingwood</td>
<td>15.0</td>
<td>10.845214</td>
<td>0.033855</td>
<td>0.013660</td>
<td>4.154786</td>
</tr>
<tr>
<td>12</td>
<td>B Ebert</td>
<td>Port Adelaide</td>
<td>15.0</td>
<td>7.633526</td>
<td>0.032795</td>
<td>0.008431</td>
<td>7.366474</td>
</tr>
<tr>
<td>13</td>
<td>L Parker</td>
<td>Sydney</td>
<td>15.0</td>
<td>14.680079</td>
<td>0.031366</td>
<td>0.030311</td>
<td>0.319921</td>
</tr>
<tr>
<td>14</td>
<td>Z Merrett</td>
<td>Essendon</td>
<td>15.0</td>
<td>21.063889</td>
<td>0.033737</td>
<td>0.015362</td>
<td>6.063889</td>
</tr>
</tbody>
</table>
<p>So whilst our model predicted Dangerfield to win, it was pretty damn accurate! Let's find the MAE for the top 100, 50, 25, and 10, and then compare it to 2018's MAE in week, when the Brownlow has been counted.</p>
<p><div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">for</span> top_x <span style="color: #AA22FF; font-weight: bold">in</span> [<span style="color: #666666">10</span>, <span style="color: #666666">25</span>, <span style="color: #666666">50</span>, <span style="color: #666666">100</span>]:
    temp_mae <span style="color: #666666">=</span> <span style="color: #008000">round</span>(agg_predictions_2017<span style="color: #666666">.</span>iloc[:top_x]<span style="color: #666666">.</span>mae<span style="color: #666666">.</span>mean(), <span style="color: #666666">3</span>)
    <span style="color: #008000; font-weight: bold">print</span>(f<span style="color: #BA2121">&quot;The Average Mean Absolute Error for the top {top_x} is {temp_mae}&quot;</span>)
</pre></div>
    The Average Mean Absolute Error for the top 10 is 3.216
    The Average Mean Absolute Error for the top 25 is 2.931
    The Average Mean Absolute Error for the top 50 is 3.15
    The Average Mean Absolute Error for the top 100 is 2.577</p>
<hr />
<h2 id="modelling-this-years-brownlow">Modelling This Year's Brownlow<a class="headerlink" href="#modelling-this-years-brownlow" title="Permanent link">&para;</a></h2>
<p>Let's now predict this year's vote count. These predictions will be on the front page of the GitHub.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>train <span style="color: #666666">=</span> features_last_before_train<span style="color: #666666">.</span>query(<span style="color: #BA2121">&quot;season &lt; 2018&quot;</span>)
test <span style="color: #666666">=</span> features_last_before_train<span style="color: #666666">.</span>query(<span style="color: #BA2121">&quot;season == 2018&quot;</span>)

<span style="color: #408080; font-style: italic"># Scale features</span>
scaler <span style="color: #666666">=</span> StandardScaler()

train_scaled <span style="color: #666666">=</span> train<span style="color: #666666">.</span>copy()
train_scaled[scale_cols] <span style="color: #666666">=</span> scaler<span style="color: #666666">.</span>fit_transform(train[scale_cols])

test_scaled <span style="color: #666666">=</span> test<span style="color: #666666">.</span>copy()
test_scaled[scale_cols] <span style="color: #666666">=</span> scaler<span style="color: #666666">.</span>transform(test[scale_cols])
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Convert categorical columns to categoricals</span>

train_h2o <span style="color: #666666">=</span> h2o<span style="color: #666666">.</span>H2OFrame(train_scaled)
test_h2o <span style="color: #666666">=</span> h2o<span style="color: #666666">.</span>H2OFrame(test_scaled)

<span style="color: #008000; font-weight: bold">for</span> col <span style="color: #AA22FF; font-weight: bold">in</span> [<span style="color: #BA2121">&#39;is_captain&#39;</span>, <span style="color: #BA2121">&#39;kicked_a_bag&#39;</span>, <span style="color: #BA2121">&#39;team_won&#39;</span>, <span style="color: #BA2121">&#39;got_30_possies_2_goals&#39;</span>]:
    train_h2o[col] <span style="color: #666666">=</span> train_h2o[col]<span style="color: #666666">.</span>asfactor()
    test_h2o[col] <span style="color: #666666">=</span> test_h2o[col]<span style="color: #666666">.</span>asfactor()
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>C:\Users\wardj\AppData\Local\Continuum\anaconda3\lib\site-packages\h2o\utils\shared_utils.py:177: FutureWarning: Method .as_matrix will be removed in a future version. Use .values instead.
  data = _handle_python_lists(python_obj.as_matrix().tolist(), -1)[1]

Parse progress: || 100%
Parse progress: || 100%
</pre></div>


<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Train the model - this part is commented out as we will just load our model from disk</span>

<span style="color: #408080; font-style: italic"># aml = H2OAutoML(max_runtime_secs = 60*3,</span>
<span style="color: #408080; font-style: italic">#                    balance_classes=True,</span>
<span style="color: #408080; font-style: italic">#                    seed=42)</span>

<span style="color: #408080; font-style: italic"># aml.train(y=&#39;brownlow_votes&#39;, x=all_feature_cols, training_frame=train_h2o)</span>
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># # save the model</span>
<span style="color: #408080; font-style: italic"># model_path = h2o.save_model(model=aml.leader, path=&quot;models&quot;, force=True)</span>

<span style="color: #408080; font-style: italic"># # Get model id</span>
<span style="color: #408080; font-style: italic"># model_name = aml.leaderboard[0, &#39;model_id&#39;]</span>

<span style="color: #408080; font-style: italic"># # Rename the model on disk</span>
<span style="color: #408080; font-style: italic"># os.rename(f&#39;models/{model_name}&#39;, f&#39;models/brownlow_2018_model_v1&#39;)</span>

<span style="color: #408080; font-style: italic"># Load model in</span>
aml <span style="color: #666666">=</span> h2o<span style="color: #666666">.</span>load_model(<span style="color: #BA2121">&#39;models/brownlow_2018_model_v1&#39;</span>)
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Predict the 2018 brownlow count</span>
preds_final_2018_model <span style="color: #666666">=</span> aml<span style="color: #666666">.</span>predict(test_h2o)

<span style="color: #408080; font-style: italic"># Scale these predictions - change negatives to 0s and scale so each game predicts 6 votes total</span>
test <span style="color: #666666">=</span> (test<span style="color: #666666">.</span>assign(predicted_votes<span style="color: #666666">=</span>preds_final_2018_model<span style="color: #666666">.</span>as_data_frame()<span style="color: #666666">.</span>values)
                  <span style="color: #666666">.</span>assign(predicted_votes_neg_to_0<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>predicted_votes<span style="color: #666666">.</span>apply(<span style="color: #008000; font-weight: bold">lambda</span> x: <span style="color: #666666">0</span> <span style="color: #008000; font-weight: bold">if</span> x <span style="color: #666666">&lt;0</span> <span style="color: #008000; font-weight: bold">else</span> x))
                  <span style="color: #666666">.</span>assign(unscaled_match_votes<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;match_id&#39;</span>)<span style="color: #666666">.</span>predicted_votes_neg_to_0<span style="color: #666666">.</span>transform(<span style="color: #BA2121">&#39;sum&#39;</span>))
                  <span style="color: #666666">.</span>assign(predicted_votes_scaled<span style="color: #666666">=</span><span style="color: #008000; font-weight: bold">lambda</span> df: df<span style="color: #666666">.</span>predicted_votes_neg_to_0 <span style="color: #666666">/</span> df<span style="color: #666666">.</span>unscaled_match_votes <span style="color: #666666">*</span> <span style="color: #666666">6</span>))

<span style="color: #408080; font-style: italic"># Create an aggregate votes df and show the average SC points and goals scored</span>
agg_predictions_2018 <span style="color: #666666">=</span> (test<span style="color: #666666">.</span>groupby([<span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>], as_index<span style="color: #666666">=</span><span style="color: #008000">False</span>)
                        <span style="color: #666666">.</span>agg({
                            <span style="color: #BA2121">&#39;predicted_votes_scaled&#39;</span>: <span style="color: #008000">sum</span>,
                            <span style="color: #BA2121">&#39;match_id&#39;</span>: <span style="color: #BA2121">&#39;count&#39;</span>}) <span style="color: #408080; font-style: italic"># shows how many games they played</span>
                        <span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span><span style="color: #BA2121">&#39;predicted_votes_scaled&#39;</span>, ascending<span style="color: #666666">=</span><span style="color: #008000">False</span>)
                        <span style="color: #666666">.</span>reset_index(drop<span style="color: #666666">=</span><span style="color: #008000">True</span>))
</pre></div>

<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>stackedensemble prediction progress: || 100%
</pre></div>


<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #408080; font-style: italic"># Show the top 25 predictions</span>

agg_predictions_2018<span style="color: #666666">.</span>head(<span style="color: #666666">25</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>player</th>
<th>team</th>
<th>predicted_votes_scaled</th>
<th>match_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>T Mitchell</td>
<td>Hawthorn</td>
<td>35.484614</td>
<td>20</td>
</tr>
<tr>
<td>1</td>
<td>M Gawn</td>
<td>Melbourne</td>
<td>21.544278</td>
<td>22</td>
</tr>
<tr>
<td>2</td>
<td>D Martin</td>
<td>Richmond</td>
<td>20.444488</td>
<td>19</td>
</tr>
<tr>
<td>3</td>
<td>B Grundy</td>
<td>Collingwood</td>
<td>19.543511</td>
<td>22</td>
</tr>
<tr>
<td>4</td>
<td>C Oliver</td>
<td>Melbourne</td>
<td>19.009628</td>
<td>20</td>
</tr>
<tr>
<td>5</td>
<td>J Macrae</td>
<td>Western Bulldogs</td>
<td>18.931594</td>
<td>17</td>
</tr>
<tr>
<td>6</td>
<td>P Dangerfield</td>
<td>Geelong</td>
<td>18.621242</td>
<td>21</td>
</tr>
<tr>
<td>7</td>
<td>D Beams</td>
<td>Brisbane</td>
<td>17.621222</td>
<td>15</td>
</tr>
<tr>
<td>8</td>
<td>E Yeo</td>
<td>West Coast</td>
<td>16.015638</td>
<td>20</td>
</tr>
<tr>
<td>9</td>
<td>L Neale</td>
<td>Fremantle</td>
<td>15.495083</td>
<td>21</td>
</tr>
<tr>
<td>10</td>
<td>A Gaff</td>
<td>West Coast</td>
<td>15.165629</td>
<td>18</td>
</tr>
<tr>
<td>11</td>
<td>D Heppell</td>
<td>Essendon</td>
<td>15.083797</td>
<td>19</td>
</tr>
<tr>
<td>12</td>
<td>J Selwood</td>
<td>Geelong</td>
<td>14.989096</td>
<td>18</td>
</tr>
<tr>
<td>13</td>
<td>S Sidebottom</td>
<td>Collingwood</td>
<td>14.863136</td>
<td>18</td>
</tr>
<tr>
<td>14</td>
<td>N Fyfe</td>
<td>Fremantle</td>
<td>14.692243</td>
<td>11</td>
</tr>
<tr>
<td>15</td>
<td>J Kennedy</td>
<td>Sydney</td>
<td>14.404489</td>
<td>16</td>
</tr>
<tr>
<td>16</td>
<td>Z Merrett</td>
<td>Essendon</td>
<td>13.632131</td>
<td>18</td>
</tr>
<tr>
<td>17</td>
<td>M Crouch</td>
<td>Adelaide</td>
<td>13.503858</td>
<td>16</td>
</tr>
<tr>
<td>18</td>
<td>R Laird</td>
<td>Adelaide</td>
<td>13.274869</td>
<td>19</td>
</tr>
<tr>
<td>19</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>13.240568</td>
<td>21</td>
</tr>
<tr>
<td>20</td>
<td>G Ablett</td>
<td>Geelong</td>
<td>13.018950</td>
<td>15</td>
</tr>
<tr>
<td>21</td>
<td>L Franklin</td>
<td>Sydney</td>
<td>12.792476</td>
<td>13</td>
</tr>
<tr>
<td>22</td>
<td>J Lloyd</td>
<td>Sydney</td>
<td>12.174224</td>
<td>20</td>
</tr>
<tr>
<td>23</td>
<td>J Kelly</td>
<td>GWS</td>
<td>11.982157</td>
<td>14</td>
</tr>
<tr>
<td>24</td>
<td>C Ward</td>
<td>GWS</td>
<td>11.892443</td>
<td>19</td>
</tr>
</tbody>
</table>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span><span style="color: #008000; font-weight: bold">print</span>(agg_predictions_2018<span style="color: #666666">.</span>head(<span style="color: #666666">15</span>))
</pre></div>

<table>
<thead>
<tr>
<th>player</th>
<th>team</th>
<th>predicted_votes_scaled</th>
<th>match_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>T Mitchell</td>
<td>Hawthorn</td>
<td>35.484614</td>
</tr>
<tr>
<td>1</td>
<td>M Gawn</td>
<td>Melbourne</td>
<td>21.544278</td>
</tr>
<tr>
<td>2</td>
<td>D Martin</td>
<td>Richmond</td>
<td>20.444488</td>
</tr>
<tr>
<td>3</td>
<td>B Grundy</td>
<td>Collingwood</td>
<td>19.543511</td>
</tr>
<tr>
<td>4</td>
<td>C Oliver</td>
<td>Melbourne</td>
<td>19.009628</td>
</tr>
<tr>
<td>5</td>
<td>J Macrae</td>
<td>Western Bulldogs</td>
<td>18.931594</td>
</tr>
<tr>
<td>6</td>
<td>P Dangerfield</td>
<td>Geelong</td>
<td>18.621242</td>
</tr>
<tr>
<td>7</td>
<td>D Beams</td>
<td>Brisbane</td>
<td>17.621222</td>
</tr>
<tr>
<td>8</td>
<td>E Yeo</td>
<td>West Coast</td>
<td>16.015638</td>
</tr>
<tr>
<td>9</td>
<td>L Neale</td>
<td>Fremantle</td>
<td>15.495083</td>
</tr>
<tr>
<td>10</td>
<td>A Gaff</td>
<td>West Coast</td>
<td>15.165629</td>
</tr>
<tr>
<td>11</td>
<td>D Heppell</td>
<td>Essendon</td>
<td>15.083797</td>
</tr>
<tr>
<td>12</td>
<td>J Selwood</td>
<td>Geelong</td>
<td>14.989096</td>
</tr>
<tr>
<td>13</td>
<td>S Sidebottom</td>
<td>Collingwood</td>
<td>14.863136</td>
</tr>
<tr>
<td>14</td>
<td>N Fyfe</td>
<td>Fremantle</td>
<td>14.692243</td>
</tr>
</tbody>
</table>
<p>Now that we have the top 25, let's also look at the top 3 from each team.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>agg_predictions_2018<span style="color: #666666">.</span>sort_values(by<span style="color: #666666">=</span>[<span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;predicted_votes_scaled&#39;</span>], ascending<span style="color: #666666">=</span>[<span style="color: #008000">True</span>, <span style="color: #008000">False</span>])<span style="color: #666666">.</span>groupby(<span style="color: #BA2121">&#39;team&#39;</span>)<span style="color: #666666">.</span>head(<span style="color: #666666">3</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>player</th>
<th>team</th>
<th>predicted_votes_scaled</th>
<th>match_id</th>
</tr>
</thead>
<tbody>
<tr>
<td>17</td>
<td>M Crouch</td>
<td>Adelaide</td>
<td>13.503858</td>
<td>16</td>
</tr>
<tr>
<td>18</td>
<td>R Laird</td>
<td>Adelaide</td>
<td>13.274869</td>
<td>19</td>
</tr>
<tr>
<td>51</td>
<td>B Gibbs</td>
<td>Adelaide</td>
<td>7.783425</td>
<td>18</td>
</tr>
<tr>
<td>7</td>
<td>D Beams</td>
<td>Brisbane</td>
<td>17.621222</td>
<td>15</td>
</tr>
<tr>
<td>46</td>
<td>D Zorko</td>
<td>Brisbane</td>
<td>8.123915</td>
<td>14</td>
</tr>
<tr>
<td>55</td>
<td>S Martin</td>
<td>Brisbane</td>
<td>7.243428</td>
<td>19</td>
</tr>
<tr>
<td>19</td>
<td>P Cripps</td>
<td>Carlton</td>
<td>13.240568</td>
<td>21</td>
</tr>
<tr>
<td>50</td>
<td>K Simpson</td>
<td>Carlton</td>
<td>7.864995</td>
<td>18</td>
</tr>
<tr>
<td>88</td>
<td>E Curnow</td>
<td>Carlton</td>
<td>3.725292</td>
<td>19</td>
</tr>
<tr>
<td>3</td>
<td>B Grundy</td>
<td>Collingwood</td>
<td>19.543511</td>
<td>22</td>
</tr>
<tr>
<td>13</td>
<td>S Sidebottom</td>
<td>Collingwood</td>
<td>14.863136</td>
<td>18</td>
</tr>
<tr>
<td>31</td>
<td>A Treloar</td>
<td>Collingwood</td>
<td>10.487535</td>
<td>11</td>
</tr>
<tr>
<td>11</td>
<td>D Heppell</td>
<td>Essendon</td>
<td>15.083797</td>
<td>19</td>
</tr>
<tr>
<td>16</td>
<td>Z Merrett</td>
<td>Essendon</td>
<td>13.632131</td>
<td>18</td>
</tr>
<tr>
<td>57</td>
<td>D Smith</td>
<td>Essendon</td>
<td>6.838857</td>
<td>20</td>
</tr>
<tr>
<td>9</td>
<td>L Neale</td>
<td>Fremantle</td>
<td>15.495083</td>
<td>21</td>
</tr>
<tr>
<td>14</td>
<td>N Fyfe</td>
<td>Fremantle</td>
<td>14.692243</td>
<td>11</td>
</tr>
<tr>
<td>74</td>
<td>M Walters</td>
<td>Fremantle</td>
<td>5.120949</td>
<td>12</td>
</tr>
<tr>
<td>23</td>
<td>J Kelly</td>
<td>GWS</td>
<td>11.982157</td>
<td>14</td>
</tr>
<tr>
<td>24</td>
<td>C Ward</td>
<td>GWS</td>
<td>11.892443</td>
<td>19</td>
</tr>
<tr>
<td>25</td>
<td>S Coniglio</td>
<td>GWS</td>
<td>11.785273</td>
<td>20</td>
</tr>
<tr>
<td>6</td>
<td>P Dangerfield</td>
<td>Geelong</td>
<td>18.621242</td>
<td>21</td>
</tr>
<tr>
<td>12</td>
<td>J Selwood</td>
<td>Geelong</td>
<td>14.989096</td>
<td>18</td>
</tr>
<tr>
<td>20</td>
<td>G Ablett</td>
<td>Geelong</td>
<td>13.018950</td>
<td>15</td>
</tr>
<tr>
<td>80</td>
<td>J Witts</td>
<td>Gold Coast</td>
<td>4.617273</td>
<td>13</td>
</tr>
<tr>
<td>85</td>
<td>J Lyons</td>
<td>Gold Coast</td>
<td>4.043711</td>
<td>14</td>
</tr>
<tr>
<td>114</td>
<td>B Fiorini</td>
<td>Gold Coast</td>
<td>2.798683</td>
<td>6</td>
</tr>
<tr>
<td>0</td>
<td>T Mitchell</td>
<td>Hawthorn</td>
<td>35.484614</td>
<td>20</td>
</tr>
<tr>
<td>39</td>
<td>L Breust</td>
<td>Hawthorn</td>
<td>9.286521</td>
<td>16</td>
</tr>
<tr>
<td>45</td>
<td>J Gunston</td>
<td>Hawthorn</td>
<td>8.341824</td>
<td>19</td>
</tr>
<tr>
<td>1</td>
<td>M Gawn</td>
<td>Melbourne</td>
<td>21.544278</td>
<td>22</td>
</tr>
<tr>
<td>4</td>
<td>C Oliver</td>
<td>Melbourne</td>
<td>19.009628</td>
<td>20</td>
</tr>
<tr>
<td>32</td>
<td>J Hogan</td>
<td>Melbourne</td>
<td>10.198873</td>
<td>13</td>
</tr>
<tr>
<td>26</td>
<td>S Higgins</td>
<td>North Melbourne</td>
<td>11.327596</td>
<td>19</td>
</tr>
<tr>
<td>37</td>
<td>B Brown</td>
<td>North Melbourne</td>
<td>9.550205</td>
<td>13</td>
</tr>
<tr>
<td>42</td>
<td>B Cunnington</td>
<td>North Melbourne</td>
<td>8.857294</td>
<td>17</td>
</tr>
<tr>
<td>27</td>
<td>O Wines</td>
<td>Port Adelaide</td>
<td>11.118795</td>
<td>16</td>
</tr>
<tr>
<td>36</td>
<td>R Gray</td>
<td>Port Adelaide</td>
<td>9.606960</td>
<td>17</td>
</tr>
<tr>
<td>54</td>
<td>J Westhoff</td>
<td>Port Adelaide</td>
<td>7.355449</td>
<td>21</td>
</tr>
<tr>
<td>2</td>
<td>D Martin</td>
<td>Richmond</td>
<td>20.444488</td>
<td>19</td>
</tr>
<tr>
<td>30</td>
<td>J Riewoldt</td>
<td>Richmond</td>
<td>10.557749</td>
<td>15</td>
</tr>
<tr>
<td>59</td>
<td>T Cotchin</td>
<td>Richmond</td>
<td>6.741732</td>
<td>12</td>
</tr>
<tr>
<td>41</td>
<td>S Ross</td>
<td>St Kilda</td>
<td>9.093395</td>
<td>17</td>
</tr>
<tr>
<td>48</td>
<td>J Steven</td>
<td>St Kilda</td>
<td>8.099164</td>
<td>17</td>
</tr>
<tr>
<td>90</td>
<td>J Steele</td>
<td>St Kilda</td>
<td>3.617769</td>
<td>16</td>
</tr>
<tr>
<td>15</td>
<td>J Kennedy</td>
<td>Sydney</td>
<td>14.404489</td>
<td>16</td>
</tr>
<tr>
<td>21</td>
<td>L Franklin</td>
<td>Sydney</td>
<td>12.792476</td>
<td>13</td>
</tr>
<tr>
<td>22</td>
<td>J Lloyd</td>
<td>Sydney</td>
<td>12.174224</td>
<td>20</td>
</tr>
<tr>
<td>8</td>
<td>E Yeo</td>
<td>West Coast</td>
<td>16.015638</td>
<td>20</td>
</tr>
<tr>
<td>10</td>
<td>A Gaff</td>
<td>West Coast</td>
<td>15.165629</td>
<td>18</td>
</tr>
<tr>
<td>38</td>
<td>J Redden</td>
<td>West Coast</td>
<td>9.368163</td>
<td>16</td>
</tr>
<tr>
<td>5</td>
<td>J Macrae</td>
<td>Western Bulldogs</td>
<td>18.931594</td>
<td>17</td>
</tr>
<tr>
<td>40</td>
<td>M Bontempelli</td>
<td>Western Bulldogs</td>
<td>9.272771</td>
<td>16</td>
</tr>
<tr>
<td>44</td>
<td>L Hunter</td>
<td>Western Bulldogs</td>
<td>8.349606</td>
<td>17</td>
</tr>
</tbody>
</table>
<p>If you're looking for a round by round breakdown, just have a look at the test dataframe.</p>
<div class="codehilite" style="background: #f8f8f8"><pre style="line-height: 125%"><span></span>test[[<span style="color: #BA2121">&#39;date&#39;</span>, <span style="color: #BA2121">&#39;round&#39;</span>, <span style="color: #BA2121">&#39;player&#39;</span>, <span style="color: #BA2121">&#39;team&#39;</span>, <span style="color: #BA2121">&#39;opposition&#39;</span>, <span style="color: #BA2121">&#39;margin&#39;</span>, <span style="color: #BA2121">&#39;SC&#39;</span>, <span style="color: #BA2121">&#39;predicted_votes_scaled&#39;</span>]]<span style="color: #666666">.</span>tail(<span style="color: #666666">25</span>)
</pre></div>

<table>
<thead>
<tr>
<th></th>
<th>date</th>
<th>round</th>
<th>player</th>
<th>team</th>
<th>opposition</th>
<th>margin</th>
<th>SC</th>
<th>predicted_votes_scaled</th>
</tr>
</thead>
<tbody>
<tr>
<td>27231</td>
<td>2018-08-26</td>
<td>23</td>
<td>R Lobb</td>
<td>GWS</td>
<td>Melbourne</td>
<td>-45</td>
<td>0.027576</td>
<td>0.007501</td>
</tr>
<tr>
<td>27232</td>
<td>2018-08-26</td>
<td>23</td>
<td>H Perryman</td>
<td>GWS</td>
<td>Melbourne</td>
<td>-45</td>
<td>0.025758</td>
<td>0.000000</td>
</tr>
<tr>
<td>27233</td>
<td>2018-08-26</td>
<td>23</td>
<td>D Shiel</td>
<td>GWS</td>
<td>Melbourne</td>
<td>-45</td>
<td>0.026364</td>
<td>0.000000</td>
</tr>
<tr>
<td>27234</td>
<td>2018-08-26</td>
<td>23</td>
<td>A Tomlinson</td>
<td>GWS</td>
<td>Melbourne</td>
<td>-45</td>
<td>0.026667</td>
<td>0.000000</td>
</tr>
<tr>
<td>27235</td>
<td>2018-08-26</td>
<td>23</td>
<td>C Ward</td>
<td>GWS</td>
<td>Melbourne</td>
<td>-45</td>
<td>0.035455</td>
<td>0.332057</td>
</tr>
<tr>
<td>27236</td>
<td>2018-08-26</td>
<td>23</td>
<td>L Austin</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.027853</td>
<td>0.003928</td>
</tr>
<tr>
<td>27237</td>
<td>2018-08-26</td>
<td>23</td>
<td>J Geary</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.025129</td>
<td>0.000000</td>
</tr>
<tr>
<td>27238</td>
<td>2018-08-26</td>
<td>23</td>
<td>S Gilbert</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.025734</td>
<td>0.000000</td>
</tr>
<tr>
<td>27239</td>
<td>2018-08-26</td>
<td>23</td>
<td>R Marshall</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.028156</td>
<td>0.103389</td>
</tr>
<tr>
<td>27240</td>
<td>2018-08-26</td>
<td>23</td>
<td>B Paton</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.023918</td>
<td>0.000000</td>
</tr>
<tr>
<td>27241</td>
<td>2018-08-26</td>
<td>23</td>
<td>S Ross</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.039055</td>
<td>0.300392</td>
</tr>
<tr>
<td>27242</td>
<td>2018-08-26</td>
<td>23</td>
<td>J Steele</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.042386</td>
<td>1.094723</td>
</tr>
<tr>
<td>27243</td>
<td>2018-08-26</td>
<td>23</td>
<td>J Steven</td>
<td>St Kilda</td>
<td>North Melbourne</td>
<td>-23</td>
<td>0.046624</td>
<td>1.119684</td>
</tr>
<tr>
<td>27244</td>
<td>2018-08-26</td>
<td>23</td>
<td>R Clarke</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.021193</td>
<td>0.050859</td>
</tr>
<tr>
<td>27245</td>
<td>2018-08-26</td>
<td>23</td>
<td>B Cunnington</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.032698</td>
<td>0.212364</td>
</tr>
<tr>
<td>27246</td>
<td>2018-08-26</td>
<td>23</td>
<td>M Daw</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.022404</td>
<td>0.021889</td>
</tr>
<tr>
<td>27247</td>
<td>2018-08-26</td>
<td>23</td>
<td>T Dumont</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.049046</td>
<td>2.042550</td>
</tr>
<tr>
<td>27248</td>
<td>2018-08-26</td>
<td>23</td>
<td>T Goldstein</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.037844</td>
<td>0.347199</td>
</tr>
<tr>
<td>27249</td>
<td>2018-08-26</td>
<td>23</td>
<td>S Higgins</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.039358</td>
<td>0.508419</td>
</tr>
<tr>
<td>27250</td>
<td>2018-08-26</td>
<td>23</td>
<td>N Hrovat</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.025129</td>
<td>0.012548</td>
</tr>
<tr>
<td>27251</td>
<td>2018-08-26</td>
<td>23</td>
<td>J Macmillan</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.024220</td>
<td>0.000000</td>
</tr>
<tr>
<td>27252</td>
<td>2018-08-26</td>
<td>23</td>
<td>J Waite</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.025734</td>
<td>0.057826</td>
</tr>
<tr>
<td>27253</td>
<td>2018-08-26</td>
<td>23</td>
<td>M Williams</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.023312</td>
<td>0.000000</td>
</tr>
<tr>
<td>27254</td>
<td>2018-08-26</td>
<td>23</td>
<td>S Wright</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.029064</td>
<td>0.093219</td>
</tr>
<tr>
<td>27255</td>
<td>2018-08-26</td>
<td>23</td>
<td>J Ziebell</td>
<td>North Melbourne</td>
<td>St Kilda</td>
<td>23</td>
<td>0.033000</td>
<td>0.031010</td>
</tr>
</tbody>
</table>
<p>And there we have it! In a single notebook we have made a fairly good Brownlow predictive model. Enjoy.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../AFLmodelPart4/" title="AFL 04. Weekly predictions" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                AFL 04. Weekly predictions
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://twitter.com/Betfair_Aus" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/company/betfair-australia" class="md-footer-social__link fa fa-linkedin"></a>
    
      <a href="https://facebook.com/betfairaustralia" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://youtube.com/user/betfairaus" class="md-footer-social__link fa fa-youtube"></a>
    
      <a href="https://github.com/betfair-datascientists" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
    <div class="bf-footer">
      <p class="bf-light">Betfair Pty Limited is licensed and regulated by the Northern Territory Government of Australia.</p>
      <p class="bf-dark">Betfair Pty Limited's gambling operations are governed by its Responsible Gambling Code of Conduct and for South
      Australian residents by the South Australian Responsible Gambling Code of Practice.<br>Think! About your choices. Dont let the game play you. Stay in control. Gamble Responsibly.
      Call Gambling Help 1800 858 858 <a href="https://gamblinghelponline.org.au">www.gamblinghelponline.org.au</a></p>
      <ul class="bf-links">
        <li><a href="https://www.betfair.com.au/hub/help/account-help/responsible-gambling/">Responsible Gambling</a><span>|</span></li>
        <li><a href="http://www.betfair.com/AUS_NZL/aboutUs/Terms.and.Conditions/">Terms & Conditions</a><span>|</span></li>
        <li><a href="https://www.betfair.com.au/info/privacy-policy/">Privacy Policy</a><span>|</span></li>
        <li><a href="http://www.betfair.com/en/aboutUs/Rules.and.Regulations/">Rules & Regulations</a><span>|</span></li>
        <li><a href="https://www.betfair.com/AUS_NZL/aboutUs/Dispute.Resolution">Dispute Resolution</a></li>
      </ul>
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.83382bb6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="../../search/main.js"></script>
      
    
    
      
        <script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-125973915-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");if(Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})}),document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>
      
    
  </body>
</html>